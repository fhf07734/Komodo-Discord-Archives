==============================================================
Guild: Komodo
Channel: Archive -2 / cc-pegs
Topic: The Pegs Antara modules is a mechanism for creating a decentralized stable coin, pegged to any asset like fiat currency, stock, crypto that has a reliable price source 
Intro + RPC: https://docs.komodoplatform.com/basic-docs/antara/antara-api/pegs.html
User tutorial: https://docs.komodoplatform.com/basic-docs/antara/antara-tutorials/pegs-module-user-tutorial.html
Peg Creator tutorial: https://docs.komodoplatform.com/basic-docs/antara/antara-tutorials/pegs-module-creator-tutorial.html
==============================================================

[09-Apr-19 02:19 PM] TonyL#3577
🕵


[09-Apr-19 02:23 PM] SHossain#0007
👀


[09-Apr-19 02:26 PM] Alright#0419
💱 ❓


[09-Apr-19 02:52 PM] KomodoWorld#8282
👀


[09-Apr-19 03:19 PM] Llama#1330
sounds like an easy 10x


[09-Apr-19 11:46 PM] jl777c#5810
decentralized method to create a backed and pegged blockchain, the currency it is pegged to can be specified at chain create time


[09-Apr-19 11:47 PM] jl777c#5810
the stablecoin is then backed by crypto deposits, which are "live" in that at any time if they get too close to the edge, can be liquidated for a profit by any node. so the funding is from a decentralized source, ie. anybody. And the balancing is also by anybody


[09-Apr-19 11:47 PM] jl777c#5810
as long as people like free money, the system will work.


[09-Apr-19 11:48 PM] jl777c#5810
it is sort of a way to sell your crypto to the blockchain at the current price (with a reserve), but it is like a pawn shop and the items it can be reclaimed by others if they pay a bit of a premium to you. If the price of crypto goes up, you can extract more stable coins from your account


[09-Apr-19 11:48 PM] jl777c#5810
https://github.com/jl777/komodo/blob/jl777/src/cc/pegs.cpp#L20

{Embed}
https://github.com/jl777/komodo/blob/jl777/src/cc/pegs.cpp
jl777/komodo
Komodo. Contribute to jl777/komodo development by creating an account on GitHub.
https://images-ext-1.discordapp.net/external/ZluS_vPUp--Ma1oFnNdhU0YaB0OEwzwGFNPA2N_uSAk/%3Fs%3D400%26v%3D4/https/avatars2.githubusercontent.com/u/5962559


[09-Apr-19 11:49 PM] jl777c#5810
oh, it does rely on the gateways CC sidechain tech, so there is the reliance on the multisig signers to safekeep the crypto. I think 7 of the top 13 NN operators to be the signers

{Reactions}
💯 (6) 😎 (2) 👍 Komodo 

[10-Apr-19 12:42 AM] KomodoWorld#8282
impressive!


[10-Apr-19 12:43 AM] Deleted User#0000
complicated 😂


[10-Apr-19 12:57 AM] jl777c#5810
trusteless oracles + gateways CC + import CC + prices CC + pegs CC, so yes it is indeed a combination of a lot of different CC

{Reactions}
🤑 🤓 😎 (2) shexy 

[10-Apr-19 01:34 AM] TwilightPunkster K64#7533
Awesome!


[10-Apr-19 07:45 PM] wookie#7663
@jl777c your mind is truly in another stratosphere! 🙏


[10-Apr-19 08:47 PM] polycryptoblog#1173
https://media3-giphy-com.cdn.ampproject.org/i/s/media3.giphy.com/media/enp5EEnd1wlLq/200w.gif?cid=8d8c03585cae2f273755564849b85f3a

{Embed}
https://media3-giphy-com.cdn.ampproject.org/i/s/media3.giphy.com/media/enp5EEnd1wlLq/200w.gif?cid=8d8c03585cae2f273755564849b85f3a
https://images-ext-1.discordapp.net/external/rda-CNce_t4JwgD8-rQ5MIAfB0Ua1qg2ocGbQZyI46I/%3Fcid%3D8d8c03585cae2f273755564849b85f3a/https/media3-giphy-com.cdn.ampproject.org/i/s/media3.giphy.com/media/enp5EEnd1wlLq/200w.gif


[10-Apr-19 08:55 PM] polycryptoblog#1173
How many things out there can we peg!  Every mineral, metal, alloy, stock, bond,   And much much more.  Hundreds of thousands of chains possible right off the get go.


[10-Apr-19 09:07 PM] polycryptoblog#1173
If the atomic swap Dex is the equivalent of a financial nuke ,  this CC is the equivalent of  financial Death Star.    People able to store value in companies or currencies or things even though they don’t have access to their markets


[10-Apr-19 10:29 PM] jl777c#5810
blockchained derivatives. derivatives might have a bit of a bad name, but it is from misuse. very powerful and if misused can be very bad, but there are many good usecases


[10-Apr-19 11:36 PM] polycryptoblog#1173
This CC can be a way of solving the liquidity problem of the Dex .   For every coin and token that lacks liquidity  a chain can be created .   A proxy coin.  Since most volume on crypto exchanges is trading and speculation rather than use , this is preferable for that audience.    However the most important part about this CC I feel is that it allows the growth of the ecosystem ( quantitatively by number of chains ) to be independent to the number of outside developers coming to komodo platform as a tool to use on their own.   This CC has me so geeked.  It may take a couple years to get it working for the average joe but it can be used by them still in the meantime .


[11-Apr-19 04:55 AM] CrisF#3405
Does it have to be a 1:1 peg?


[11-Apr-19 04:59 AM] jl777c#5810
1:1 with the synthetic


[11-Apr-19 05:01 AM] jl777c#5810
if you read the comments:
Appendix Synthetic position definition language:
 
 Let us start from the familiar BTCUSD nomenclature. this is similar (identical) to forex EURUSD and the equivalent. Notice the price needs two things as it is actually a ratio, ie. BTCUSD is how many USD does 1 BTC get converted to. It can be thought of as the value of BTC/USD, in other words a ratio.
 
 The value of BTC alone, or USD alone, it is actually quite an abstract issue and it can only be approximated. Specific ways of how to do this can be discussed later, for now it is only important to understand that all prices are actually ratios.
 
 And these ratios work as normal algebra does. So a/b * b/c == a/c! You can try this out with BTCUSD and USDJPY -> BTC/USD * USD/JPY -> BTC/JPY or the BTCJPY price
 
 division is the reciprocal, so BTCUSD reciprocated is USDBTC
 
 Without getting into all the possible combinations of things, let us first understand what the language allows. It uses a stack based language, where individual tokens update the state. The final state needs to have an empty stack and it will have a calculated price.


[11-Apr-19 05:01 AM] jl777c#5810
The most important is pushing a specific price onto the stack. All the correlated and smoothed prices are normalized so it has each integer unit equal to 0.00000001, amounts above 100 million are above one, amounts less are below one. 100 million is the unit constant.
 
 In the prices CC synthetic definition language, the symbol that is returned pushes the adjusted price to the stack. The adjustment is selecting between the correlated and smoothed if within a day from the bet creation, or just the smoothed if after a day. You can have a maximum depth of 3, any more than that and it should return an error.
 
 This means there are operations that are possible on 1, 2 and 3 symbols. For 1 symbol, it is easy, the only direct operation is the inverse, which is represented by "!". All items in the language are separated by ","
 
 "BTCUSD, !"
 
 The above is the inverse or USD/BTC, which is another way to short BTCUSD. It is also possible to short the entire synthetic with a negative leverage. The exact results of a -1 leverage and inverse, might not be exact due to the math involved with calculating the profit, but it should generally be similar.


[11-Apr-19 05:01 AM] jl777c#5810
For two symbols, there is a bit more we can do, namely multiply and divide, combined with inverting, however to simplify the language any inverting is required to be done by the ordering of the symbols and usage of multiply or divide. multiply is "*" and divide is "/" the top of the stack (last to be pushed) is the divisor, the one right before the divisor is the numerator.
 
 "BTCUSD, USDJPY, *" <- That will create a BTCJPY synthetic
 
 "BTCEUR, BTCUSD, /" <- That will create a USDEUR synthetic
 
 If you experiment around with this, you will see that given two symbols and the proper order and * or /, you can always create the synthetic that you want, assuming what you want is the cancelling out of the term in common with the two symbols and the resulting ratio is between the two unique terms.
 */


[11-Apr-19 05:02 AM] jl777c#5810
// Now we get to the three symbol operations, which there are 4 of *//, **/, *** and ///
 
/*
 these four operators work on the top of the stack in left to right order as the syntax of the definition lists it, though it is even possible to have the value from an earlier computation on the top of the stack. Ultimately all three will be multiplied together, so a * in a spot means it us used without changing. A / means its inverse will be used.
 
 "KMDBTC, BTCUSD, USDJPY, ***" <- this would create a KMDJPY synthetic. The various location of the / to make an inverse is to orient the raw symbol into the right orientation as the pricefeed is only getting one orientation of the ratio.
 So now we have covered all ways to map 1, 2 and 3 values on the top of the stack. A value can be on the top of the stack directly from a symbol, or as the result of some 1, 2 or 3 symbol operation. With a maximum stack depth of 3, it might require some experimentation to get a very complex synthetic to compile. Alternately, a stack deeper than 3 might be the acceptable solution  if there are a family of synthetics that need it.
 
 At this point, it is time to describe the weights. It turns out that all above examples are incomplete and the synthetic descriptions are all insufficient and should generate an error. The reason is that the actual synthetic price is the value of the accumulator, which adds up all the weighted prices. In order to assign a weight to a price value on the stack, you simply use a number that is less than 2048. 
 
 What such a weight number does, is consume the top of the stack, which also must be at depth of 1 and adds it to the accumulator. This allows combining multiple different synthetics into a meta synthetic, like for an aggregated index that is weighted by marketcap, or whatever other type of ratio trade that is desired.


[11-Apr-19 05:02 AM] jl777c#5810
"BTCUSD, 1000, ETHBTC, BTCUSD, *, 300" -> that creates a dual index of BTCUSD and ETHUSD with a 30% ETH weight
 
 all weight operations consumes the one and only stack element and adds its weight to the accumulator, using this a very large number of terms can be all added together. Using inverses, allows to get the short direction into the equation mixed with longs, but all terms must be positive. If you want to create a spread between two synthetics, you need to create two different synthetics and go long with one and short with another.
 
 "BTCUSD, 1" with leverage -2 and "KMDBTC, BTCUSD, *, 1" with leverage 1 this will setup a +KMDUSD -2 BTCUSD spread when the two are combined, and would be at breakeven when KMDUSD gains 2x more percentage wise than BTC does. anytime KMD gains more, will be positive, if the gains are less, would be negative.
 
 Believe it or not, the string to binary compiler for synthetic description and interpretation of it is less than 200 lines of code.


[11-Apr-19 05:03 AM] CrisF#3405
Thank you 👍 I've got some reading to do!


[11-Apr-19 05:36 AM] CrisF#3405
Very easy to read, not as easy to understand 😃  I'm lacking basic knowledge.  So off to build up a bit of background.

{Reactions}
rum 

[11-Apr-19 05:48 AM] Deleted User#0000
it lost me aswelll dont worry, its more econimics that blockchain


[11-Apr-19 05:51 AM] siu#3920
KMDBTC,BTCUSD*,10 is a 10X long in KMDUSD


[11-Apr-19 05:52 AM] siu#3920
KMDBTC,BTCUSD*,-10 is a 10x leverage short on KMDUSD


[11-Apr-19 05:55 AM] siu#3920
We could do a index of all USA outstanding debt products


[11-Apr-19 05:56 AM] siu#3920
Or a muni bonds index


[11-Apr-19 05:57 AM] siu#3920
In other words. If you can find a ticker in bloomberg terminal or any similar source, you could do synthetic crypto trading derivatives👀 👀 👀 👀 👀


[11-Apr-19 06:03 AM] jl777c#5810
yes, i just couldnt quickly find a source of stockmarket quotes


[11-Apr-19 06:05 AM] jl777c#5810
```"KMDBTC, BTCUSD, AAPLUSD, **/, 1" -> KMDAAPL```


[11-Apr-19 06:09 AM] siu#3920
The problem with stock market price terminals is tha the ones worth using are paid for.


[11-Apr-19 07:05 AM] NutellaLicka#4241
So someone could run a crypto 'pegged' stock exchange?


[11-Apr-19 07:33 AM] siu#3920
yes


[11-Apr-19 07:33 AM] siu#3920
but it would be synthetic, no real stock would be traded, just a derivative


[11-Apr-19 07:44 AM] NutellaLicka#4241
Yeah exactly, but an easy way for people to expose themselves to the stock market whilst remaining anonymous in crypto


[11-Apr-19 07:51 AM] Llama#1330
That's huge


[11-Apr-19 09:48 AM] jl777c#5810
just find be a reliable price feed and I will add support for it


[11-Apr-19 09:55 AM] NutellaLicka#4241
Define 'Reliable' ?


[11-Apr-19 09:58 AM] NutellaLicka#4241
It would be interesting to see how authorities would handle a synthetic exchange. 
I mean your buying/selling of the stocks would have 0 impact on the price, whereas on an official stock exchange, because you're buying/selling, it changes the price point


[11-Apr-19 09:59 AM] NutellaLicka#4241
Im not a trader by any means, but surely if your trades dont affect price change, this could be a lot more profitable


[11-Apr-19 10:04 AM] polycryptoblog#1173
With “real” assets you have equity and voting rights , synthetics you are just piggybacking the market price.  Allows for complicated assets to be created without crazy management of underlying assets( because there are none in this case )


[11-Apr-19 10:05 AM] jl777c#5810
also it isnt realtime trading, but one day delay


[11-Apr-19 10:09 AM] NutellaLicka#4241
How does trading work if you're in a day delay? Surely you know the impending price at that point?


[11-Apr-19 10:10 AM] jl777c#5810
everybody trades the day delayed price


[11-Apr-19 11:58 PM] Mylo#8306
wow.   i'm not much of a trader because i find it a little dull - but this looks like making some interesting  marketmaking


[11-Apr-19 11:59 PM] Mylo#8306
@siu thanks for your examples that followed the explanation 👍


[12-Apr-19 12:00 AM] Mylo#8306
`KMDAAPL` is a new kind of awesome in crypto


[12-Apr-19 12:04 AM] Mylo#8306
anyone here interested, IEX trading is one of the largest exchanges.  they are a competitor of NYSE for trading stuff.  have a free API
https://iextrading.com/developer/docs/#getting-started

{Embed}
https://iextrading.com/developer/docs/
API 1.0 | IEX
The IEX API is a free, web-based API supplying IEX quoting and trading data for mobile, desktop, and trading applications.
https://images-ext-2.discordapp.net/external/e3viyCGKqe83uLEQTMfZX0OMYrOSvDoYDk7tnypceEk/https/iextrading.com/images/api/iex-api-card.png


[12-Apr-19 12:06 AM] Mylo#8306
@n2okpride from the top have a skim


[12-Apr-19 12:15 AM] jl777c#5810
how reliable is this iex outfit? will they be around in 3 years? estimate chances


[12-Apr-19 12:18 AM] polycryptoblog#1173
Here is one for commodities.  https://blog.quandl.com/api-for-commodity-data , been around 6 years, acquired by Nasdaq a couple years ago.

{Embed}
https://blog.quandl.com/api-for-commodity-data
API for Commodity Data - Quandl Blog
Using the Quandl API for Commodity Data This document is a comprehensive guide to using the Quandl API to access our free commodity price data. If you haven’t already done so, we recommend reading Quandl’s general API documentation; the functionality will be a lot clearer...


[12-Apr-19 12:20 AM] Mylo#8306
i had a conference call with them before komodo with  some contacts for some offshore gambling stuff, which in their jurisdiction is not legal.   they have built their custom hardware (fabric based stuff for speed) for their clients to do HFT.  The biggest non stock exchange "outfit".   high chance imo.


[12-Apr-19 12:21 AM] Mylo#8306
they are actively looking to invest outside of traditional money markets because they are real tech geeks.


[12-Apr-19 12:22 AM] jl777c#5810
quandl requires registration, not so good for hardcoding inside daemon


[12-Apr-19 12:22 AM] jl777c#5810
i will add an -ac_iex= option to add prices for the specified stocks


[12-Apr-19 12:23 AM] polycryptoblog#1173
Ok let me try to find open api.


[12-Apr-19 12:26 AM] grewalsatinder#9653
I use this:
https://www.freeforexapi.com/api/live?pairs=USDNZD


[12-Apr-19 12:26 AM] grewalsatinder#9653
https://www.freeforexapi.com/

{Embed}
https://www.freeforexapi.com/
Free Forex API | Foreign exchange rates and currency conversion
FreeForexAPI provides a simple, and lightweight API for the fastest and most reliable foreign exchange rates available.


[12-Apr-19 12:26 AM] grewalsatinder#9653
not sure if they are so reliable for next 3+ years


[12-Apr-19 12:27 AM] grewalsatinder#9653
the previous forex API I was using moved from open to registered....


[12-Apr-19 12:27 AM] grewalsatinder#9653
they all kinda end up paid or registered only


[12-Apr-19 12:29 AM] grewalsatinder#9653
there's bitcoin average too


[12-Apr-19 12:29 AM] grewalsatinder#9653
I see them a bit reliable


[12-Apr-19 12:29 AM] grewalsatinder#9653
https://apiv2.bitcoinaverage.com/constants/exchangerates/global


[12-Apr-19 12:29 AM] jl777c#5810
i have daily forex data from ECB


[12-Apr-19 12:29 AM] grewalsatinder#9653
https://apiv2.bitcoinaverage.com/


[12-Apr-19 12:30 AM] jl777c#5810
but it is good to have an alternate source


[12-Apr-19 12:30 AM] grewalsatinder#9653
agree


[12-Apr-19 12:31 AM] Mylo#8306
right.  so we're looking at one chain per stock.  sorry for being so slow to realize.


[12-Apr-19 12:31 AM] jl777c#5810
why?


[12-Apr-19 12:31 AM] jl777c#5810
current test chains are doing 55 prices


[12-Apr-19 12:32 AM] Mylo#8306
`prices for the specified stocks`
didn't notice plural on first read


[12-Apr-19 12:34 AM] jl777c#5810 (pinned)
details are quite important: ./komodod -ac_cbopret=7 -ac_prices="LTC, BCHABC, XMR, IOTA, ZEC, WAVES, LSK, DCR, RVN, DASH, XEM, BTS, ICX, HOT, STEEM, ENJ, STRAT" -pubkey=<yourpubkey> -ac_name=REKT0 -ac_cclib=prices -ac_cc=10777 -ac_reward=3000000000 -ac_supply=120000000 -ac_pubkey=039433dc3749aece1bd568f374a45da3b0bc6856990d7da3cd175399577940a775 -ac_perc=77777 -ac_blocktime=600 -addnode=5.9.102.210 &

{Reactions}
👍 

[12-Apr-19 12:36 AM] Mylo#8306
ok thanks


[12-Apr-19 12:36 AM] Mylo#8306
Pinned a message.


[12-Apr-19 12:36 AM] jl777c#5810
you wouldnt want to put 2048 prices on one chain, even though that is the limit


[12-Apr-19 12:37 AM] KomodoWorld#8282
https://www.alphavantage.co/

{Embed}
https://www.alphavantage.co/
Alpha Vantage - Free APIs for Realtime and Historical Stock, Forex...
Alpha Vantage offers free APIs in JSON and CSV formats for realtime and historical stock and forex data, digital/crypto currency data and over 50 technical indicators. Supports intraday, daily, weekly, and monthly quotes and technical analysis with chart-ready time series. 10...


[12-Apr-19 12:37 AM] KomodoWorld#8282
seems free


[12-Apr-19 12:37 AM] jl777c#5810
if any single one gets a local pricedata error, you will be stuck until it resolves, but so far with latest version 55 prices and all nodes are staying in sync


[12-Apr-19 12:37 AM] jl777c#5810
alphavantage looks good, until you go over the request limit, then they ask you to register and pay


[12-Apr-19 12:38 AM] KomodoWorld#8282
ah there's a catch


[12-Apr-19 12:39 AM] jl777c#5810
yes, it is incredibly hard to find a reliable free data source, without registration


[12-Apr-19 12:51 AM] Mylo#8306
iex, big team, market-making program, enhanced market making program.  free api.


[12-Apr-19 12:51 AM] Mylo#8306
https://iextrading.com/trading/market-making/

{Embed}
https://iextrading.com/trading/market-making/
Market Making | IEX
IEX, the Investors Exchange, is a fair, simple and transparent stock exchange dedicated to investor and issuer protection.
https://images-ext-1.discordapp.net/external/WCGTiXWiuQ_r7IERZ3NLIgqYdMeuXWoTs4zXuDCWvVc/https/iextrading.com/images/iex/iex-card.png


[12-Apr-19 12:51 AM] jl777c#5810
yes, IEX seems good, api is nice and simple, good find!


[12-Apr-19 12:54 AM] Mylo#8306
i think they have a good outlook too, transformative.  the alpha vantage has y combinator funding.   it's not an industry i know, so yeah...got lucky


[12-Apr-19 12:54 AM] Mylo#8306
having dealt with them thru other contacts


[12-Apr-19 12:54 AM] polycryptoblog#1173
rapidapi.com has a bunch of free ones but looks like some digging needs done


[14-Apr-19 11:05 PM] TonyL#3577 (pinned)
http://kmd.money:8050/ prices monitoring website


[14-Apr-19 11:05 PM] TonyL#3577
Pinned a message.


[15-Apr-19 02:16 AM] KomodoWorld#8282
eli5 what differences between traces 0,1,2,3 ?


[15-Apr-19 02:27 AM] TonyL#3577
@KomodoWorld 
Trace 0 - mined (actual received) price
Trace 1 - correlated 
Trace 2 - smoothed
Trace 3 - is trace 0 data with 24 hours back time offset


[15-Apr-19 02:29 AM] KomodoWorld#8282
thanks, seems magic to me


[15-Apr-19 02:39 AM] jl777c#5810
i havent yet populated the other 5 price slots


[15-Apr-19 02:43 AM] jl777c#5810
mined uses the trustless oracles process


[15-Apr-19 02:44 AM] jl777c#5810
correlated protects against the 2% attack. trustless oracles is set currently to allow a +/-1% variance, so an attacker can push the price up 1% and then down 1% to create a 2% swing, which might be enough to change monetary outcomes. not any giant issue for most cases, but still want to be safe than sorry


[15-Apr-19 02:44 AM] jl777c#5810
smoothed is just a 24hr SMA, average value, as the correlation is done over 24hr period


[15-Apr-19 02:45 AM] jl777c#5810
it isnt a realtime signal, but every block there is a trustless price that is updated based on the prior 24hrs that is solid enough to settle contracts automatically with

{Reactions}
👍 

[07-May-19 03:15 AM] Regnar#6164
If anyone is interested I'll post here due to JP's background and knowledge of currencies and monetary policies (traditional as well as some crypto) here's a current tweet based on the DAI peg https://twitter.com/jp_koning/status/1121418943757979648

and his blog "Moneyness" <https://jpkoning.blogspot.com>

{Embed}
JP Koning (@jp_koning)
https://twitter.com/jp_koning/status/1121418943757979648
@ricburton @newcurrency That's what I was wondering. If the goal is to quickly get Dai back to $1 when it deviates, why isn't the stability fee shared with Dai owners in the form of interest? Then as the stability fee is jacked up, so is the interest-rate-on-Dai. Vice vers...
Twitter


[19-Jun-19 05:25 AM] Regnar#6164
More info about pegs by Jpkoning, specifically the MakerDAI

https://jpkoning.blogspot.com/2019/05/revisiting-stablecoins.html?m=1

{Embed}
https://jpkoning.blogspot.com/2019/05/revisiting-stablecoins.html?m=1
Revisiting stablecoins
Source: Gravity Glue  (2014)    Cryptocurrencies were supposed to destroy the traditional monetary system. Ten years on, where are we?   B...
https://images-ext-1.discordapp.net/external/4kU7lONaNF-58nKYJBBdtMB0Io8iFjJaw3cyQtEJv8o/https/1.bp.blogspot.com/-yD0YhxyiCOk/XO0WsJ_aJgI/AAAAAAAAC0c/DqH4rmPWK9EBGoaTAh6kufgpmPSOp9MYwCLcBGAs/w1200-h630-p-k-no-nu/gravityglue.JPG


[25-Jun-19 09:52 AM] KomodoWorld#8282
https://arxiv.org/abs/1906.02152  this is a recent paper about crypto-backed stablecoins

{Embed}
https://arxiv.org/abs/1906.02152
(In)Stability for the Blockchain: Deleveraging Spirals and...
We develop a model of stable assets, including noncustodial stablecoins
backed by cryptocurrencies. Such stablecoins are popular methods for
bootstrapping price stability within public blockchain...


[25-Jun-19 09:52 AM] KomodoWorld#8282
`Based on our results, we suggest design improvements that can improve long-term stability and suggest methods for solving pricing problems that arise in existing stablecoins. In addition to the direct risk of instability, our dynamics results suggest a profitable economic attack during extreme events that can induce volatility in the stable asset. This attack additionally suggests ways in which stablecoins can cause perverse incentives for miners, posing risks to blockchain consensus. `


[09-Jul-19 06:58 AM] Mihailo#5902 (pinned)
Hi all, we have made the initial implementation of PegsCC. For those who are not familiar with PegsCC, it is basically a mechanism to have a coin that is always backed by other crypto at worst 1:1 but it should be more - stablecoin. People deposit some other crypto (lets say KMD,BTC ...) using gateways CC in external chain and get tokens on pegs chain. So now tokens can be deposited in an account and you can take coins in amount of price_of_token*amount (up to 80% of value). Lets call this chain KUSD (1 KUSD should represent 1$) , so with deposit of 100KMD in gateway you'll get 100KMDT, and you can then deposit 100KMDT in account on KUSD chain and take lets say maximum of 120KUSD (KMD=1.5$). When the price changes, if it goes up you can take more KUSD, but if it goes down there is the problem. It is solved with possibility for other users to liquidate worst accounts that are in "debt" 90% or more with a gain of 5%. So in previous example if KMD price is 1.3333$ then 120KUSD is 90% of 133.33$ and this account can be liquidated. Some other user gives 120KUSD and gets 95KMDT (it is worth 126.66$), and 5KMDT goes to the system to improve the overall "debt" of the system. The account holder which had his account liquidated is left with his 120KUSD so he is in loss of 10% because he has not maintained better ratio on his account. This way all coins should be backed by crypto all the time.


[09-Jul-19 06:58 AM] Mihailo#5902 (pinned)
The code is currently in my repo for testing (as there are some modification for testing so that I don't put that in FSM): https://github.com/Mixa84/komodo/tree/pegsCC

Currently there is functionality without validation and probably there are bugs. I have setup test chain so everybody can test. These are the parameters:
```
komodod -ac_supply=1000000 -ac_reward=10000 -ac_name=KUSDTEST -ac_cc=2 -ac_import=PEGSCC -ac_end=1 -ac_perc=0 -ac_cbopret=7 -earlytxid=a130861d422655cb28ffbf788c3b4a07748ba67eb7c413c9440b7cbbfcb9d296 -addnode=116.203.17.140:22993 -addnode=116.203.17.141:22993

KMD token txid:    babf52d3f8586393a3ca45e07ccd9ab247fd56c5104bef3aa6a83be3f104831a
Oracle txid:        bde7c4fb8f7f402891d350715c308179193e4c961c90cac0740a7e89d561b437
Gateway txid:        e41b98f104d5d3a8f94742f5b0237a9efdd6999bea4af2ce64228c7280167b40
Pegs txid:        a130861d422655cb28ffbf788c3b4a07748ba67eb7c413c9440b7cbbfcb9d296
```
In order to get started you will need to mine few blocks so you have for txfee for gatewaysdeposit and gatewaysclaim transactions (20k sat). You can use the gateways TUI from here https://github.com/tonymorony/komodo-cctools-python to send KMD to deposit address and make deposit and claim tx. After having some balance of KMDT, you can do pegsfund to deposit and then pegsget to take KUSD coins.


[09-Jul-19 07:02 AM] Mihailo#5902
NOTE: don't forget to `export CONFIGURE_FLAGS='CPPFLAGS=-DTESTMODE'` before the build and start the chain with -pubkey=<pubkey> to use CC, and when you make KMD tx to deposit address to wait that KMD block data is posted to oracle (you can check with `komodo-cli -ac_name=KUSDTEST oraclessamples bde7c4fb8f7f402891d350715c308179193e4c961c90cac0740a7e89d561b437 REnSwBrnZtuPVPngNy8kWLAn9BjUB1F6Dw 5`)


[09-Jul-19 07:03 AM] Mihailo#5902
@jl777c @TonyL

{Reactions}
🔥 (7) 🚀 (5) 

[09-Jul-19 07:43 AM] gcharang#6833
Pinned a message.


[09-Jul-19 07:47 AM] TonyL#3577
this summer is really hot 😃


[09-Jul-19 09:15 AM] allbits#5898
What is the motivation to deposit KMDT into the system in the first instance, given that one is at risk of loss if price moves against them and they fail to maintain their ratio in time?


[09-Jul-19 09:41 AM] jl777c#5810
you are able to borrow against it


[09-Jul-19 09:41 AM] jl777c#5810
so without selling it you can cash out stablecoins


[09-Jul-19 09:42 AM] jl777c#5810
no need to find counterparty, no need to go to exchange. maybe in some jurisdictions it could be a tax advantaged way


[09-Jul-19 09:43 AM] jl777c#5810
also, as long as you are not liquidated, if your coins are used to fund a withdraw, you do get a bit of a premium


[09-Jul-19 09:44 AM] jl777c#5810
a fiat pegged and backed stablecoin, without any fiat involved


[09-Jul-19 09:45 AM] jl777c#5810
maybe some project wants to create a stablecoin, this is a way they can do it. the issued stablecoins are freely tradeable and are expected to trade on exchanges


[09-Jul-19 10:50 AM] CMaurice#1685
do crypto owners using gateways CC in external chain lose rights to rewards/staking?


[09-Jul-19 10:58 AM] Alright#0419
@CMaurice if you're talking about coins held in the gateway, yes


[09-Jul-19 10:58 AM] Alright#0419
it may be possible for the gateway signers themselves to collect these rewards though


[09-Jul-19 11:11 AM] siu#3920
i was syncing the chain and got this: ```height.2136
height.2137
height.2138
height.2139
CC Eval EVAL_GATEWAYS Invalid: gatewaysdeposit tx is not yet confirmed(notarised)! spending tx ff2efc72e3e75d15be91fa0dcac3673efe0d9c51726d815bbc056ef105fd49e7
BTC/USD 12561.6133, BTC/GBP 10076.5368, BTC/EUR 11205.0219 GBPUSD 1.246620, EURUSD 1.121070 EURGBP 0.899288
(KMD 0.00011950) (ETH 0.02473800)  errs.0```


[09-Jul-19 11:11 AM] siu#3920
started mining and got to block 2140 but im not sure if im forked or not


[09-Jul-19 11:12 AM] siu#3920
am i in the correct chain? ```./komodo-cli -ac_name=KUSDTEST getblockhash 2140
0544b7487eecef27e3aebccc6d8ad70cf7edb1783554c161d4d76e0b5e3b515b
```


[09-Jul-19 11:15 AM] siu#3920
```height.2149
41d9245d1f947e0737060306b761af062e4400000b3b00005b8b000025b90900443300008ed50700d326000059380000ae9a100091de000011310100cba10000d0010100787a03004c116c082f0401001952010014522c005d1f000076e2020081b40400de5213004b290200af940000293500009d940000b6740a007471b400c6a40000f90c0100b6720100dc220000ba2e000084b52500 <- Mineropret
C ht.2150 now.1562696078 htstamp.1562696061 1562696062 - pricebits[0] 1562696001 -> lags.77 -60 61
ContextualCheckBlock failed ht.2150
0157ddb1fe282dd738142cdbe9f5ac7284d433055dfb645e74e50eda56ab8016 Invalid block mined, try again
C ht.2150 now.1562696078 htstamp.1562696061 1562696062 - pricebits[0] 1562696001 -> lags.77 -60 61
ContextualCheckBlock failed ht.2150
07fe4f66d410eef172947a7e797a9d2ef8f2d90baa8c7b10cdd761411f333cc5 Invalid block mined, try again
```


[09-Jul-19 11:15 AM] siu#3920
i keep getting this


[09-Jul-19 11:15 AM] siu#3920
invalid blocks mined


[09-Jul-19 11:28 AM] siu#3920
Is it normal for sync to take a long time for the last couple of blocks?


[09-Jul-19 11:28 AM] siu#3920
@jl777c @Mihailo


[09-Jul-19 11:44 AM] Mihailo#5902
@siu  I forgot to add that you must build it with -DTESTMODE, like for other CCs when testing...

{Reactions}
👍 

[09-Jul-19 11:50 AM] ElectroChemical#3544
Hey there, new to the discord. Is there a FAQ or simple explanation of the stablecoin implementation used for this? Thanks!


[09-Jul-19 12:08 PM] siu#3920
@Mihailo , wait, im confused. Do the `./zcutil/build.sh` with that parameter? Or were should i use that -DTESTMODE paramter?


[09-Jul-19 12:22 PM] Mihailo#5902
@siu Yes, but you must do `export CONFIGURE_FLAGS='CPPFLAGS=-DTESTMODE'     ` first


[09-Jul-19 12:22 PM] siu#3920
ok


[09-Jul-19 12:23 PM] Mihailo#5902
@ElectroChemical We don't have proper documentation on pegs CC yet. Working on it...


[09-Jul-19 12:25 PM] ElectroChemical#3544
Understood, thanks


[09-Jul-19 12:46 PM] Mihailo#5902
@siu You also have to do make clean now before build.


[10-Jul-19 12:02 AM] jl777c#5810
~/komodo/src/cc/pegs.cpp has the initial design description @ElectroChemical


[10-Jul-19 04:41 AM] hyperDEX#6586
So i understand this properly, there is no counter party, there is a bounty for people to liquidate the trades that are in the red?


[10-Jul-19 04:57 AM] jl777c#5810
yes


[10-Jul-19 04:57 AM] jl777c#5810
anybody can borrow against the backing crypto


[10-Jul-19 04:58 AM] jl777c#5810
once they do, if their address ends up being the most leveraged and the overall balance is in the redzone, anybody can get a 5% arbitrage fee


[10-Jul-19 04:59 AM] jl777c#5810
so as long as people like the 5% bounty, the system restores to the safety zone


[10-Jul-19 05:11 AM] hyperDEX#6586
What happens when it goes the other way? They make a profit and want to close out the trade


[10-Jul-19 05:15 AM] hyperDEX#6586
Will new stable coins be minted ?


[10-Jul-19 05:19 AM] jl777c#5810
goes the other way? then it costs more stable coins to close out the position


[10-Jul-19 05:19 AM] jl777c#5810
at any given time you can close your position out by replacing the borrowed stablecoins


[10-Jul-19 05:20 AM] jl777c#5810
i meant in the first sentence that the balance gets better if the price goes up


[10-Jul-19 05:20 AM] jl777c#5810
not sure what you mean by profit. profit in what currency? profit on the unsold coins or the issued stable coins?


[10-Jul-19 05:21 AM] hyperDEX#6586
So as a example.

I deposit 100KMD and get 100USD (assuming $1/each)


[10-Jul-19 05:22 AM] hyperDEX#6586
If KMD goes to $0.5, when i cashout i would be able to swap for 200KMD for the same 100USD right?


[10-Jul-19 05:22 AM] jl777c#5810
cant take out 100%


[10-Jul-19 05:22 AM] jl777c#5810
say you take out 80%


[10-Jul-19 05:22 AM] hyperDEX#6586
Oh how does that work?


[10-Jul-19 05:22 AM] jl777c#5810
you need to leave some collateral


[10-Jul-19 05:22 AM] jl777c#5810
you cant remove all value from your account


[10-Jul-19 05:23 AM] jl777c#5810
unless everything is settled and there are no loans outstanding, then you can just withdraw the KMD


[10-Jul-19 05:23 AM] hyperDEX#6586
oh i think i am confusing myself. You basically are taking out a loan


[10-Jul-19 05:23 AM] jl777c#5810
yes, model is very similar to loan


[10-Jul-19 05:23 AM] jl777c#5810
just that you are borrowing from the blockchain in stablecoins with KMD as collaterral


[10-Jul-19 05:24 AM] hyperDEX#6586
So you deposit 100KMD which is worth $100, you can take out $80 in stable coins for something else


[10-Jul-19 05:24 AM] jl777c#5810
and that anybody can foreclose on you if your account gets too close to busted


[10-Jul-19 05:24 AM] jl777c#5810
yes, the $80 you take out is freely tradeable


[10-Jul-19 05:24 AM] jl777c#5810
and you can redeem the $80 worth of KMD at anytime, from the blockchain (one or more of the existing accounts)


[10-Jul-19 05:24 AM] jl777c#5810
slight premium needs to be paid to redeem


[10-Jul-19 05:24 AM] hyperDEX#6586
If KMD goes up does the 20% collateral go up too?


[10-Jul-19 05:25 AM] jl777c#5810
once you make the loan, you dont have to do anything more


[10-Jul-19 05:25 AM] jl777c#5810
if the collateral value goes below 10%, it will get liquidated by your friendly neighborhood rekting maching


[10-Jul-19 05:26 AM] jl777c#5810
if KMD goes up 20%, then your 100 KMD is worth $120, against an $80 loan, so your ratio is improved


[10-Jul-19 05:27 AM] hyperDEX#6586
So you have the rekting machines, on the flip side could you have a saving machine, where they save that loan from being rekt? 😄


[10-Jul-19 05:27 AM] hyperDEX#6586
i am pretty sure dai has something like that


[10-Jul-19 05:27 AM] jl777c#5810
it is up to you to save yourself by depositing more


[10-Jul-19 05:28 AM] jl777c#5810
or redeeming part or alll


[10-Jul-19 05:28 AM] hyperDEX#6586
Ok is there a situation when you redeem the loan and you get back more KMD than you have locked in for the loan?


[10-Jul-19 05:29 AM] hyperDEX#6586
I guess you lock in the loan then KMD tanks 50%


[10-Jul-19 05:29 AM] jl777c#5810
you got rekt way before that if you took out 80%


[10-Jul-19 05:29 AM] hyperDEX#6586
Ah i see


[10-Jul-19 05:30 AM] jl777c#5810
with 80% out, at about a 10% drop, you are in the redzone and the rekting machines are revving up


[10-Jul-19 05:30 AM] hyperDEX#6586
What if you took out a 40% loan and it drops 50% 😄


[10-Jul-19 05:30 AM] jl777c#5810
they like their 5%


[10-Jul-19 05:30 AM] Mihailo#5902
You ca  get more if you are left with more KUSD than you borrowed. So you can exchange "free" (not bound to account) KUSD anytime.


[10-Jul-19 05:30 AM] hyperDEX#6586
60% becomes 30%+40% yeah still only 70%


[10-Jul-19 05:30 AM] jl777c#5810
yes your own account would be rekt, but the 80 USDK you took out can buy 160 KMD from other accounts


[10-Jul-19 05:31 AM] hyperDEX#6586
hahaha you got rekt but quickly rekt others to get more KMD 😄


[10-Jul-19 05:31 AM] jl777c#5810
actually yes. to rekt a redzone account, you do need the USDK


[10-Jul-19 05:32 AM] hyperDEX#6586
I can see a rekting bot on the cards 😃


[10-Jul-19 05:33 AM] jl777c#5810
i think it should be an rpc call that automatically finds accounts to rekt and makes a tx if there is one


[10-Jul-19 05:36 AM] jl777c#5810
@Mihailo we do need some sort of document to describe how all this works


[10-Jul-19 05:40 AM] Mihailo#5902
@jl777c Yes, proper description of how pegs CC works would be great. As it is pretty confusing in the beginning.


[10-Jul-19 05:41 AM] jl777c#5810
can you write the first draft?


[10-Jul-19 05:44 AM] Mihailo#5902
Yes, I'll do my best.


[10-Jul-19 05:48 AM] hyperDEX#6586
Out of interest is there a interest rate on the loan?


[10-Jul-19 05:49 AM] hyperDEX#6586
It could take into account held collateral rewards


[10-Jul-19 05:50 AM] Mihailo#5902
No, the only thing that hunts you is to maintain the account under the red zone. When you get liquidated then 5% goes to liquidator and 5% goes to the system to improve overall ratio.


[10-Jul-19 05:50 AM] hyperDEX#6586
So when you pay back your loan is there a fee?


[10-Jul-19 05:51 AM] Mihailo#5902
When you payback the loan, you get the deposited tokens. Only fee that you have is txfee 😉


[10-Jul-19 05:51 AM] hyperDEX#6586
It would be good to somehow claim the rewards if possible for the held KMD to go back into the "safu" fund


[10-Jul-19 05:51 AM] Mihailo#5902
You mean the rewards for holding KMD (the yearly 5.1%)?


[10-Jul-19 05:51 AM] hyperDEX#6586
yes


[10-Jul-19 05:52 AM] hyperDEX#6586
But somehow claim that whilst the KMD are held as collateral as the "interest" on the loan


[10-Jul-19 05:52 AM] Mihailo#5902
Pinned a message.


[10-Jul-19 05:54 AM] jl777c#5810
the multisig rewards go to the multisig signers


[10-Jul-19 05:54 AM] Mihailo#5902
I think JL mentioned before that the rewards could also go to the system to improve the overall ratio. The point here is to keep the system stable, and not the profit 😉


[10-Jul-19 05:54 AM] jl777c#5810
it is interest free loans as far as the pegs are concerned


[10-Jul-19 05:54 AM] jl777c#5810
seems a pretty good rate


[10-Jul-19 05:55 AM] jl777c#5810
and with the multisig rewards split between the multisig signers, that should provide enough incentive to keep the nodes running

{Reactions}
👍 

[10-Jul-19 12:50 PM] hyperDEX#6586
True, otherwise no one would run it 😄


[12-Jul-19 06:48 AM] Mihailo#5902 (pinned)
This is the draft docs for Pegs CC and it is still work in progress. https://github.com/Mixa84/komodo/wiki/Pegs-CC
I would really like some comments and suggestions as I'm writting this with understanding of pegs, and would like to hear what was difficult to understand or confusing for someone that has no knowledge of pegs CC, so we can end up with very clear and easy to understand docs.

{Embed}
https://github.com/Mixa84/komodo/wiki/Pegs-CC
Mixa84/komodo
Komodo. Contribute to Mixa84/komodo development by creating an account on GitHub.
https://images-ext-2.discordapp.net/external/5PP5Rc1dp6Lo2v8nwnTvQmRdaXpEf9xjHeMr0XyppBs/%3Fs%3D400%26v%3D4/https/avatars3.githubusercontent.com/u/39563265

{Reactions}
😘 

[12-Jul-19 06:48 AM] Mihailo#5902
Pinned a message.


[12-Jul-19 07:45 AM] jl777c#5810
@gcharang

{Reactions}
👍 

[12-Jul-19 10:22 PM] damon#7265
Stable Coin mechanisms like Maker/DAI are fascinating.
But, I don't understand how Liquidation occurs?

If KMD drops below a certain level, someone else can step in and liquidate (buy KUSD likely at a discount)? and a reduced amount of KMD is returned to the original account, while 5% goes to a global reserve account? What does the liquidator receive for the KUSD that's going to get burned?

Comment: If DEX achieves a certain level of Liquidity, Liquidation could be Automatic.


[12-Jul-19 10:27 PM] damon#7265
2nd Question.

I lock KMD to get KUSD. I use the KUSD to buy KMD on the Market. I then lock this KMD to get more KUSD. Rinse and Repeat.

Is there protection built-in? For instance, not allowing 100% LOCK-IN? Otherwise creation of Money is endless?

I suppose if you locked in 100% and KMD dropped 1%, you'd risk being liquidated, so maybe that's the protection?


[12-Jul-19 10:32 PM] jl777c#5810
cant borrow more than 80%


[12-Jul-19 10:32 PM] jl777c#5810
if you get over 90% loan (based on market fluctuation), anybody can liquidate your account and get 100% of your KMD for the 90% USDK


[12-Jul-19 10:33 PM] jl777c#5810
pocketing a 5% liquidation fee


[12-Jul-19 10:33 PM] jl777c#5810
all the stablecoin is burned and all the KMD goes to the liquidator, so the global ratio is improved


[12-Jul-19 10:35 PM] jl777c#5810
realistically there will be many that run automated "miners" to race to collect the liquidation fee, which is 5% + 10% of the system side for a 5.5% at the 90% level, the incentive is to liquidate as close to the 90% mark as possibl


[12-Jul-19 10:35 PM] jl777c#5810
so if no account is more than 90% loaned out the global balance must be less than 90%


[12-Jul-19 10:36 PM] jl777c#5810
even if you dont have any stablecoins to liquidate, if there is a nice account ready to be harvested, you can create stablecoins one block and then use it to liquidate the other account


[12-Jul-19 10:36 PM] jl777c#5810
since people like free money, i expect there will be people who will like to do this


[12-Jul-19 10:38 PM] damon#7265
Hmmm..  Thinking out loud..

Automated Liquidators, liquidate and get the KMD.

They then dump KMD on the Market (for KUSD), further driving the price down.
They then use the KUSD to liquidate others.
Rinse and Repeat until destabilization.

Am I missing something?


[12-Jul-19 10:42 PM] damon#7265
Maybe some really long Block Count delays?


[12-Jul-19 10:42 PM] jl777c#5810
24 hour price is used for settlement


[12-Jul-19 10:43 PM] damon#7265
ah.. You might have covered all the bases..


[12-Jul-19 10:43 PM] jl777c#5810
the one issue is if the spot price stays 10% below the 24hour price forever


[12-Jul-19 10:43 PM] jl777c#5810
but that cant happen


[12-Jul-19 10:43 PM] jl777c#5810
so it is possible that for some period time during extreme volatility that nobody will want to liquidate


[12-Jul-19 10:44 PM] jl777c#5810
but as the 24hour price gets to within 10% of the spot price the arbitrage is possible again and the system will restore itself to balance


[12-Jul-19 10:46 PM] jl777c#5810
KMD price going up is the easy case and the system just gets lower and lower percentage loaned


[12-Jul-19 10:47 PM] jl777c#5810
if you can see any other attack vector, definitely interested. it is a bit on the complex side, so definitely possible for there to be edge cases


[12-Jul-19 10:48 PM] damon#7265
That just might work.. Might have to think on it over the weekend and see if I can break it..  and UP is always the easy part..


[12-Jul-19 10:50 PM] jl777c#5810
i do assume two things: 1) active liquidators will rekt the accounts reasonably close to the 90% level and 2) there is a decent liquidity KMD/USDK market, better would be if USDK had liquid BTC and other markets


[12-Jul-19 10:51 PM] jl777c#5810
not sure what the USSA tax consequences are for loaning coins to a blockchain


[12-Jul-19 10:51 PM] jl777c#5810
maybe it is better than a sale


[12-Jul-19 10:52 PM] damon#7265
Is it a Rolling 24 hour price or fixed at a certain time like GMT?


[12-Jul-19 10:52 PM] jl777c#5810
rolling, using the 24hr SMA of the correlated price


[12-Jul-19 10:53 PM] jl777c#5810
the correlation adds a lot of random noise to the price to make it unpredictable and hard to manipulate, the 24hr SMA smooths it out


[12-Jul-19 10:53 PM] jl777c#5810
to manipulate the price you would need to sustain it for 24hrs, which if you are doing that can be argued that the price actually did change


[12-Jul-19 10:54 PM] damon#7265
I wonder if there are any PUMPS or DUMPS that you could capitalize on 24 hours later?


[12-Jul-19 10:54 PM] damon#7265
Risky.. and, probably wouldn't break anything.


[12-Jul-19 10:55 PM] jl777c#5810
sure, if you can predict exact price movements, you can make a lot of money by loaning, paying back, etc.


[12-Jul-19 10:55 PM] jl777c#5810
each loan is similar to selling KMD for stablecoin and redeeming like buying KMD for stablecoin


[12-Jul-19 10:56 PM] jl777c#5810
so this allows people to "trade" KMD against USD, without actually trading, certainly no KYC and maybe not even any change of ownership (unless liquidated)


[12-Jul-19 10:58 PM] damon#7265
yes, emulating USD, without actually buying USD which requires a Banking licenses and KYC, or without using Centralized PEGs.. It's a great idea, if someone can't break it..


[12-Jul-19 11:05 PM] jl777c#5810
and even without external markets, just being able to "buy" and "sell" KMD against USD to the blockchain seems a very useful way to hedge


[13-Jul-19 12:36 AM] damon#7265
Just to be certain....
Example: Komodo Current Value = $1.00 USD (easy math)
I lock-in 100 KMD for 80 KUSD (80%).
Komodo drops 11% and I'm now just below 90%.

Which scenario occurs?
Liquidators buy 80 KUSD and liquidate ALL of my KMD?
or
Liquidators buy a little KUSD, and I lose a little KMD at 10% penalty?


[13-Jul-19 12:45 AM] jl777c#5810
Liquidators buy 80 KUSD and liquidate ALL of my KMD?


[13-Jul-19 12:45 AM] jl777c#5810
of course, you can add more KMD to your account to avoid being liquidated


[13-Jul-19 12:45 AM] jl777c#5810
you should be able to keep putting in KMD to stay at 89%


[13-Jul-19 12:46 AM] jl777c#5810
going into the redzone is painful, in a decentralized way we rely on people to avoid being liquidated


[13-Jul-19 12:47 AM] damon#7265
Why can't you take just a little KMD to get it back to less than 90% ?


[13-Jul-19 12:48 AM] jl777c#5810
who is "you"?


[13-Jul-19 12:48 AM] damon#7265
Liquidator..


[13-Jul-19 12:48 AM] jl777c#5810
why would they bother to do it for just a small amount?


[13-Jul-19 12:48 AM] damon#7265
10%


[13-Jul-19 12:48 AM] jl777c#5810
?


[13-Jul-19 12:48 AM] jl777c#5810
the 10% is needed for reserve


[13-Jul-19 12:49 AM] jl777c#5810
so to keep the reserve, there would need to be just a very small liquidation, making it maybe not worth doing


[13-Jul-19 12:49 AM] jl777c#5810
and the system fundamentally relies on liquidators to actively liquidate all >90%


[13-Jul-19 12:50 AM] jl777c#5810
the user who is so leveraged is the one that needs to fix their account


[13-Jul-19 12:50 AM] jl777c#5810
remember there is no interest being charged for the loan


[13-Jul-19 12:51 AM] damon#7265
I sure wouldn't want to be glued to my account every day, especially when 20% price change is normal for Crypto. Can there be  a delay mechanism??


[13-Jul-19 12:51 AM] jl777c#5810
24 hr price moves slowly


[13-Jul-19 12:52 AM] damon#7265
Most people have jobs and sleep. I'd really think about how to take several small liquidations instead of taking it all at once..


[13-Jul-19 12:53 AM] jl777c#5810
make more than one address then


[13-Jul-19 12:53 AM] jl777c#5810
dont leverage more than 80%


[13-Jul-19 12:53 AM] jl777c#5810
run a bot to replenish if it gets close to the liquidation


[13-Jul-19 12:54 AM] jl777c#5810
i think you are making an issue due to assuming borrowers wont have sufficient tools


[13-Jul-19 12:54 AM] damon#7265
The system relies on people locking in - prior to people using KUSD and prior to Liquidators. A heavy penalty for not being glued to the Chain..


[13-Jul-19 12:54 AM] damon#7265
Yes.. I am assuming that..


[13-Jul-19 12:54 AM] jl777c#5810
the important thing is that the rules of the game combined with the ability for people to have automation creates a stable system


[13-Jul-19 12:55 AM] jl777c#5810
certainly without liquidation automation, there wont be timely liquidations


[13-Jul-19 12:55 AM] jl777c#5810
similarily, without replenishment bots, accounts wont be replenished and be liquidated


[13-Jul-19 12:55 AM] jl777c#5810
dont assume liquidators have bots and borrowers dont


[13-Jul-19 12:56 AM] damon#7265
Bots will be available for average user??


[13-Jul-19 12:57 AM] jl777c#5810
by "bot", if you mean a GUI that is running the logic of "if my balance goes above 85%, deposit X amount of KMD", then why not??


[13-Jul-19 12:57 AM] damon#7265
Built in to a wallet ??


[13-Jul-19 12:57 AM] jl777c#5810
i would expect a standalone GUI


[13-Jul-19 12:58 AM] damon#7265
Yea maybe that would work..


[13-Jul-19 01:01 AM] jl777c#5810
let us work backwards from what is need to make this work. define it and then make the "bots"


[13-Jul-19 01:02 AM] damon#7265
Seems like you'd get more people locking in KMD for KUSD, if it wasn't a full liquidation. Very Risky for people who only look at prices once a day..


[13-Jul-19 01:02 AM] damon#7265
or only at a computer once a day..


[13-Jul-19 01:06 AM] jl777c#5810
80% loans are indeed pretty risky, 50% loans not so much


[13-Jul-19 01:06 AM] jl777c#5810
24hr price would take 12+ hrs to change even if a 30% instant price drop without recovery


[13-Jul-19 01:07 AM] jl777c#5810
it wont be like with standard systems where a flash crash wipes out your positions


[13-Jul-19 01:07 AM] damon#7265
It's a bit like Leveraged Derivatives... If your leveraged 5X, and the price drops - look out..


[13-Jul-19 01:07 AM] jl777c#5810
exactly


[13-Jul-19 01:08 AM] jl777c#5810
5x leverage combined with 20% drop...


[13-Jul-19 01:08 AM] jl777c#5810
dont do it and ignore it


[13-Jul-19 01:08 AM] jl777c#5810
!


[13-Jul-19 01:08 AM] jl777c#5810
50% loan is much less stress, especially using daily price


[13-Jul-19 01:08 AM] damon#7265
Some people want to do 1X and ignore it for a week or two.. Slow position trading over weeks..


[13-Jul-19 01:11 AM] jl777c#5810
sure, 50% or even less should allow this, unless the price crashes by over 50% for over a day


[13-Jul-19 01:12 AM] jl777c#5810
not sure if we can allow people to take risks, not monitor and have them protected from catastrophic market actions


[13-Jul-19 01:14 AM] damon#7265
Sure.. You can NOT market to those who want slower, less risky, trades.. Keep to those who are dedicated to it every day..


[13-Jul-19 01:16 AM] damon#7265
or.. You could do both and the market decide. Of course, I don't have to code it..


[13-Jul-19 01:21 AM] jl777c#5810
pegs is not primarily for traders, prices CC is more for traders


[13-Jul-19 01:29 AM] damon#7265
So... It's December 2017 and Cryptos are at all time highs, but you know it's all going to come crashing back down. How do you invest in FIAT, virtually, without going thru the Banks or using USD Backed Coins?


[13-Jul-19 01:29 AM] jl777c#5810
yes, in this case hedge at max 80% and write off the 20%


[13-Jul-19 01:35 AM] damon#7265
Buy KUSD instead of LOCK-IN.


[13-Jul-19 01:35 AM] damon#7265
I appreciate all the time you put into answering my questions..


[13-Jul-19 01:35 AM] damon#7265
Thanks


[13-Jul-19 01:52 AM] jl777c#5810
thanks for identifying needed automation


[13-Jul-19 01:59 AM] damon#7265
Well.. I have about 10 more items, but it's late here and I've taken enough of your time.. Thanks again


[13-Jul-19 02:00 AM] jl777c#5810
anytime!


[13-Jul-19 06:07 AM] Andersen#8337
Will future KUSD, KMD$  contract be linear or inverse  ? Why the question, the inverse  contract in the derivative exchanges with the leverage of 1x   short practically does not have the price of liquidation - the approximate price of a margin call is about 1 $ million per 1 BTC. Are we SAFU ? Below is an explanation of my question.


When you are trading BTC on Deribit or Bitmex, you are using the inverse futures contracts. Perpetual and the 2 other quarterly futures contracts are inverse.

So on inverse USD/BTC it’s quoted at BTC/USD and the chart also shown as BTC/USD.

Short on inverse 1x leverage to lock-in USD (hedge)
When opening a 1x leverage short on an inverse futures contract, you will “lock-in” the USD value. This is why many professional traders short BTC on an inverse futures contract. It’s a great hedge. When you’re short with 1x leverage on an inverse futures contract, it’s almost impossible to get margin called. You could enter a short at $10k and BTC could move to 1 million dollar and you would still not be margin called. This is great for hedging.
Your short position with 1x leverage is always worth the amount of dollars because when you short on BTC/USD on an inverse futures contract, you are actually long on USD/BTC. You actually buy an amount of USD priced in BTC

https://i.postimg.cc/LhKPGmKM/calc.png
https://medium.com/@romanornr/trading-bitcoin-inverse-futures-contracts-dbdccae9eddd



https://twitter.com/ThinkingUSD/status/962053190983155715

{Embed}
https://i.postimg.cc/LhKPGmKM/calc.png
https://images-ext-2.discordapp.net/external/I8t0gWwoEHIgtR5gl-bMge9NoiHVqYGZLbMEmFbdsoQ/https/i.postimg.cc/LhKPGmKM/calc.png

{Embed}
https://medium.com/@romanornr/trading-bitcoin-inverse-futures-contracts-dbdccae9eddd
Trading bitcoin inverse futures contracts - Romano RNR - Medium
On exchanges like Bitmex & Deribit you can trade futures contracts. To trade them against USD without the requirement to actually…
https://images-ext-1.discordapp.net/external/EwNW26OSWg2IymKTAtxXmvXoe7bmGPMnYI2fPMtEFKM/https/miro.medium.com/max/1200/1%2Ac9f0qCEqOAk2gWopvhdsxg.png

{Embed}
Flood [BitMEX] (@ThinkingUSD)
https://twitter.com/ThinkingUSD/status/962053190983155715
Many of you may not know this, but if you want to eliminate your bitcoin exposure without actually going through the process of converting to fiat you can move your holdings into synthetic USD on https://t.co/qr49NsLQCU by shorting with 1x leverage.
Retweets
334
Likes
1355
Twitter


[13-Jul-19 06:28 AM] jl777c#5810
you are making it overcomplicated


[13-Jul-19 06:28 AM] jl777c#5810
what the pegs CC does is track the amount of loan the issued USDK represents


[13-Jul-19 06:29 AM] jl777c#5810
KMD deposited has a USD equivalent price, this is calculated by a simple multiplication of number of KMD by the current price in USD


[13-Jul-19 06:29 AM] jl777c#5810
so 100 KMD at $1 is $100 of deposit


[13-Jul-19 06:31 AM] jl777c#5810
the amount loaned is easy as it is in USD, so if you borrowed 80 USDK from the 100KMD, the loan percentage changes by:
80 / (KMD * price)


[13-Jul-19 06:32 AM] jl777c#5810
its not inverse futures, or options, or anything other than USDK backed by KMD, with the overall system maintaining its balance by the game theory optimal behaviors of the participants, depositor/borrowers and liquidators. as long as liquidators like risk free arbitrage and as long as depositors dont like giving away 10% of their equity, the system will stay in balance out of the danger zone


[13-Jul-19 06:33 AM] jl777c#5810
the one event that could temporarily affect liquidity is if the price drops dramatically in a time period that is much less than a day. in this case it will take a day for the 24hr average price to catch up to the realtime price


[13-Jul-19 10:46 AM] CMaurice#1685
this built fine for me on Debian sid


[13-Jul-19 10:46 AM] CMaurice#1685
seems to be up and running ok with -pubkey, and mining but lots of `00950d9821097f79a63e982f50e9e58ed88a1a808868916261e478d55301c36d Invalid block mined, try again
`


[13-Jul-19 10:46 AM] CMaurice#1685
though have mined a few blocks `./src/komodo-cli -ac_name=KUSDTEST getbalance
0.00050000`


[14-Jul-19 02:38 AM] CMaurice#1685
I suppose you can argue about it, but not if you're a mathematician. BTC/USD 11096.6950 is wrong


[14-Jul-19 02:38 AM] CMaurice#1685
BTC over USD, or BTC per USD? Nope, it is USD per BTC


[14-Jul-19 04:23 AM] CMaurice#1685
Not that I can't work the way others wish to after over four decades of this plaguing me


[14-Jul-19 04:23 AM] CMaurice#1685
But it's still wrong


[14-Jul-19 09:35 AM] damon#7265
Say I lock in KMD and sell my KUSD, then KMD goes up 10X, and now I want to unlock cc-pegs to release my KMD.
Do, I buy back KUSD on the market, the same amount that was in the pegs contract to release my KMD?


[14-Jul-19 10:28 AM] jl777c#5810
yes


[14-Jul-19 10:28 AM] jl777c#5810
BTC divided by USD is indeed approx 11k


[14-Jul-19 10:28 AM] jl777c#5810
BTC/USD makes perfect sense to me


[14-Jul-19 10:38 AM] CMaurice#1685
oh, so I see BTC and USD as being units, not amounts, so BTC/USD is 1/11k to me


[14-Jul-19 10:40 AM] CMaurice#1685
if unit manipulation is used to create synthetics, guess it'll be consistent


[14-Jul-19 11:06 AM] damon#7265
What if KUSD isn't for sale on the market?


[14-Jul-19 11:08 AM] damon#7265
If the price of the whole crypto market is crashing and no one wants to sell?
How do you keep price pegged to $1?


[14-Jul-19 12:27 PM] jl777c#5810
you can just deposit KMD and borrow 80% if nobody is willing to sell


[14-Jul-19 12:28 PM] jl777c#5810
in the day of a catastrophic crash, then liquidations will likely stop for a bit, but as soon as things calm down, the daily average will return to where the realtime price is, at least within 10% of it


[14-Jul-19 12:31 PM] damon#7265
If you're already leveraged in KMD and the price is falling (liquidation looming) and no one is selling KUSD?


[14-Jul-19 12:49 PM] jl777c#5810
so you are saying that the demand for KUSD is overwhelming and it breaks the peg by going above $1?


[14-Jul-19 12:49 PM] jl777c#5810
somebody has to have the KUSD, if you are not willing or able to, somebody else will liquidate it to get the overall system back into balance


[14-Jul-19 12:50 PM] jl777c#5810
and with enough KMD to more than 110% back the issued KUSD, there doesnt seem to be a reason the peg wont hold


[14-Jul-19 12:51 PM] jl777c#5810
i can see that maybe KUSD would trade at some fixed discount, due to slippage, fees and other risk factors that the market prices in, we might need to lock $1.02 worth of KMD to establish a marketprice of $1


[14-Jul-19 12:51 PM] damon#7265
It might rebound that way..


[14-Jul-19 12:58 PM] damon#7265
If liquidators only bought KUSD or liquidated for KMD and never sold.... and if Liquidators were a significant portion of the eco-system... it would go unstable.. But, maybe this is not likely??


[14-Jul-19 01:02 PM] jl777c#5810
it only takes a single liquidator to keep the system in balance


[14-Jul-19 01:03 PM] jl777c#5810
and such a liquidator would have KUSD onhand to liquidate with


[14-Jul-19 01:04 PM] jl777c#5810
each liquidation, he gets more KMD, though if there are no sellers and KUSD is trading above $1.. then things could get stuck for a while. not sure if it is considered a failed peg if the price goes above the target


[14-Jul-19 01:04 PM] jl777c#5810
if it goes below, then that would mean there is plenty of KUSD available


[14-Jul-19 01:05 PM] jl777c#5810
of course, if you specify that there wont be any competent liquidators at all and nobody will be liquidating, then certainly many failure modes can be created, but that contradicts the "people like risk free profits" rule


[14-Jul-19 01:06 PM] damon#7265
for sure - this is the wild wild west


[14-Jul-19 01:08 PM] jl777c#5810
i think if we let enough people that like risk free profits know how to run the automated liquidation program


[14-Jul-19 01:08 PM] jl777c#5810
we wont have a lack of liquidators


[14-Jul-19 01:09 PM] jl777c#5810
much less resource intensive than mining and potentially more lucrative


[14-Jul-19 01:09 PM] jl777c#5810
just advertise to CPU miners, a new form of mining


[14-Jul-19 01:09 PM] jl777c#5810
and maybe that is one source of demand for KUSD


[14-Jul-19 01:28 PM] damon#7265
I think I got it..

If the price goes far above $1.00 then it is a failed peg in a sense, at a minimum, those at risk of Liquidation. Now, it's 2018, price is falling, the Liquidators want KUSD (but ran out after the 1st month of liquidating), the ones about to be Liquidated want KUSD (and can't find any), and the ones wanting to Hedge the 2 yr fall in price don't want to sell.

Everything might freeze for a while if the crash is bad enough. But... this is more or less as intended. Those who short at the right time do well, those who went long do poorly, and the Liquidators are effectively market makers that make bank while things are roaring and very little when no trading is occurring.


[14-Jul-19 01:55 PM] damon#7265
In normal trading if you invest in Nike and Nike goes up 40% then you make 40% but if Nike drops by 40% then you lose 40%.

With cc-pegs, if KMD goes up 40% then you gain 40%, but if KMD drops 40% you lose 100% (unless your watching closely and have the funds to patch the hole and KUSD is available on the market).

In this system, it's more advantageous to be the Buyer of KUSD or the Liquidator, then the Creator.

Do you think this could be better balanced, to attract KUSD Creators?


[14-Jul-19 02:26 PM] damon#7265
One way would be, instead of Liquidators paying the full amount of KUSD (and getting full amount of KMD), they would only pay the difference in price, and liquidation would occur in proper portions with a 5% or 10% fee.


[14-Jul-19 02:50 PM] damon#7265
I'm imagining a Creator frantically trying to fix his cc-pegs contract. KMD is in an extended downtrend and is only able to acquire 50% of KUSD or even still has 50% of KUSD. This way the Liquidator only pays the remaining 50%, both burned, unlocking  KMD @ 50/50, minus a fee against the Creator.


[14-Jul-19 11:38 PM] jl777c#5810
the borrower has a big advantage since they can borrow (repay) at anytime, for a very volatile thing


[14-Jul-19 11:38 PM] jl777c#5810
i think you exaggerate the unintended liquidation scenario


[14-Jul-19 11:39 PM] jl777c#5810
if you take out a 50% loan during normal times, even weekly checking would be enough. if you take out an 80% loan during highly volatile times, then is it so unreasonable that you need to check the price daily??


[14-Jul-19 11:40 PM] jl777c#5810
we do need a way for user to auto-replenish their account to prevent it from being liquidated, but extremely leveraged borrowers that dont pay attention... what really can be done about them


[15-Jul-19 11:37 AM] damon#7265
It might be an exaggerated issue..


[15-Jul-19 11:39 AM] jl777c#5810
@Mihailo can implement can implement an rpc call to detect any account that is getting close to the danger zone, and also a way to replenish


[15-Jul-19 11:39 AM] jl777c#5810
GUI can just call this function and replenish or warn user when it is appropriate


[15-Jul-19 11:40 AM] jl777c#5810
i think we need to assume that people will behave as the game theory will dictate and not base it on risk takers that dont monitor things


[15-Jul-19 11:41 AM] Mihailo#5902
Yes, we can add whatever rpc is needed to make good automated GUI that will protect users.


[15-Jul-19 11:43 AM] damon#7265
Can the borrower replenish from both directions?


[15-Jul-19 11:45 AM] damon#7265
Meaning, Not be liquidated if still holding KUSD or used for the liquidation calculation?


[15-Jul-19 11:48 AM] jl777c#5810
borrower should be able to add either KMD or KUSD at any time to reduce the loan ratio


[15-Jul-19 11:54 AM] damon#7265
Any future plans to collateralize other Coins?


[15-Jul-19 11:59 AM] jl777c#5810
the tech allows any bitcoin protocol coin to be used as collateral, it is a matter to setup the gateways CC


[17-Jul-19 04:46 AM] freakbros#9074
Hi James is this close to working or still being developed thanks


[17-Jul-19 04:54 AM] jl777c#5810
it is in testing


[17-Jul-19 04:54 AM] jl777c#5810
so it mostly works, other than bugs that havent been found yet


[17-Jul-19 06:01 AM] freakbros#9074
Tight


[17-Jul-19 06:01 AM] freakbros#9074
Thanks


[19-Jul-19 02:34 AM] CMaurice#1685
It seems to me that one problem with making such a chain (stablecoin) popular will be any real and/or percieved risk, e.g. from hacks or bugs etc., to deposited coins. Maybe some assurance contract or locked funds by guarantors might be an idea, but I'm sure someone must've been thinking about this for a while


[19-Jul-19 03:18 AM] jl777c#5810
plan is to have a 7 of 13 multisig


[19-Jul-19 03:18 AM] jl777c#5810
with the top NN operators being the 13


[19-Jul-19 03:18 AM] jl777c#5810
other than the multisig redeem, everything else is blockchain enforced


[25-Jul-19 02:30 PM] PirateHodlor#3573
Hey guys. I'm seeking to build a stablecoin backed by Nigerian naira (this is my national fiat). How do I get a chain setup for testing?


[25-Jul-19 08:51 PM] jl777c#5810
@Mihailo or @TonyL can help


[26-Jul-19 12:56 AM] Mihailo#5902
I can help, but I'm off today and whole weekend. If it is not too urgent, we can do it next week.


[26-Jul-19 01:44 AM] PirateHodlor#3573
@Mihailo no problem bro. Next week. Need to get acquainted with some things myself


[26-Jul-19 01:44 AM] PirateHodlor#3573
Thanks


[26-Jul-19 01:53 AM] gcharang#6833
@PirateHodlor 
till then you might want to become familiar with launching a smartchain: https://developers.komodoplatform.com/basic-docs/smart-chains/smart-chain-tutorials/create-a-default-smart-chain.html#introduction
all the available customizations: https://developers.komodoplatform.com/basic-docs/antara/antara-setup/antara-customizations.html

{Embed}
https://developers.komodoplatform.com/basic-docs/smart-chains/smart-chain-tutorials/create-a-default-smart-chain.html
Creating Komodo Smart Chains | Komodo Documentation
Documentation for developers building on Komodo

{Embed}
https://developers.komodoplatform.com/basic-docs/antara/antara-setup/antara-customizations.html
Antara Customizations | Komodo Documentation
Documentation for developers building on Komodo


[26-Jul-19 01:54 AM] PirateHodlor#3573
@gcharang Thanks. Will get on it


[29-Jul-19 03:06 AM] Mihailo#5902
@PirateHodlor I'm available if you need any help 😉


[29-Jul-19 03:21 AM] PirateHodlor#3573
@Mihailo thanks. DMing you now


[31-Jul-19 09:54 AM] sergipcm#2275
hey have couple of questions regarding this:

- liquidator would make a special transaction that sends the debt owed to the system (is it documented anywhere?)
- And then (liquidator) is able to spend your collateral to himself ( is this spending procedure documented too?)


[31-Jul-19 09:57 AM] jl777c#5810
@Mihailo how is the details pegs documentation coming along?


[31-Jul-19 09:58 AM] Mihailo#5902
@jl777c I've made the initial documentation about pegs, but haven't got time to improve it so far as I'm on nSPV CC.


[31-Jul-19 10:00 AM] Mihailo#5902
@sergipcm 
- liquidator gives the amount that the other account has in debt and gets ~5.1% more than he gave at that moemnt in deposited crypto. The rest goes to the system.
- liquidator will get tokens of deposited crypto so you he can withdraw them from gateway whenever he likes


[31-Jul-19 10:05 AM] sergipcm#2275
hey @Mihailo thanks for fast answer, can you let me know when you can put up all doc regarding this together?


[31-Jul-19 10:06 AM] sergipcm#2275
we might give it a try, but definitely if all those calls are spv-friendly for sure it will be much easier to implement somewhere


[31-Jul-19 10:10 AM] Mihailo#5902
@sergipcm The docs need refactoring as we get feedback what is unclear from the first read. I will try to add stuff to docs when I can. But be aware that pegscc is still in development. We haven't tested it properly yet, and there isn't any validation done yet so now you can do what ever bad stuff gets on your mind 😛


[31-Jul-19 10:12 AM] sergipcm#2275
good to know, should get to test it as it gets ready


[31-Jul-19 10:15 AM] jl777c#5810
@Mihailo maybe as you work with shossain, you can spend a bit of time on the documentation side so he can understand enough and help with it too


[01-Aug-19 12:48 AM] smkhound#7640
I've been referring to the docs at https://github.com/Mixa84/komodo/wiki/Pegs-CC
one thing that is not clear is the `pegstxid` is, apart from a required param for most methods. 
Can you please also confirm the current recommended repo to build and test from?

{Embed}
https://github.com/Mixa84/komodo/wiki/Pegs-CC
Mixa84/komodo
Komodo. Contribute to Mixa84/komodo development by creating an account on GitHub.
https://images-ext-2.discordapp.net/external/5PP5Rc1dp6Lo2v8nwnTvQmRdaXpEf9xjHeMr0XyppBs/%3Fs%3D400%26v%3D4/https/avatars3.githubusercontent.com/u/39563265


[01-Aug-19 12:49 AM] smkhound#7640
I've getting  the error below 
``` ~/Mixa84/komodo/src/komodo-cli -ac_name=KUSDTEST pegsinfo a130861d422655cb28ffbf788c3b4a07748ba67eb7c413c9440b7cbbfcb9d296
error code: -1
error message:
to use CC contracts, you need to launch daemon with valid -pubkey= for an address in your wallet
```
pubkey is valid and mine though


[01-Aug-19 12:49 AM] smkhound#7640
```smk762@cctest91:~/Mixa84/komodo/src$ ./komodo-cli -ac_name=KUSDTEST validateaddress R9ujZ53iX12iQWY6v76zcsj933j9hFJqwK
{
  "isvalid": true,
  "address": "R9ujZ53iX12iQWY6v76zcsj933j9hFJqwK",
  "scriptPubKey": "76a91406e93faa91956277701bdd75777afc2f7c93654d88ac",
  "segid": 8,
  "ismine": true,
  "iswatchonly": false,
  "isscript": false,
  "pubkey": "0385ee665344772c8ef6149b3d4eeda2b3d7fad7f94723f90e7fcefbc2bafb47c4",
  "iscompressed": true,
  "account": ""
}
smk762@cctest91:~/Mixa84/komodo/src$ ./komodo-cli -ac_name=KUSDTEST getinfo | jq .pubkey
"0385ee665344772c8ef6149b3d4eeda2b3d7fad7f94723f90e7fcefbc2bafb47c4"
```


[01-Aug-19 12:50 AM] smkhound#7640
Using Mixa84 repo, PegsCC branch
```smk762@cctest91:~/Mixa84/komodo/src$ git remote -v
origin    https://github.com/Mixa84/komodo/ (fetch)
origin    https://github.com/Mixa84/komodo/ (push)
smk762@cctest91:~/Mixa84/komodo/src$ git branch
  master
* pegsCC
```


[01-Aug-19 12:58 AM] smkhound#7640
other CC methods respond without error 🤷🏼 
```smk762@cctest91:~/Mixa84/komodo/src$ ~/Mixa84/komodo/src/komodo-cli -ac_name=KUSDTEST oracleslist
[
]
```


[01-Aug-19 01:03 AM] smkhound#7640
@Mihailo ☝🏼


[01-Aug-19 01:09 AM] Mihailo#5902
@smkhound Have you started the daemon with -pubkey param?


[01-Aug-19 01:16 AM] smkhound#7640
yes


[01-Aug-19 01:17 AM] smkhound#7640
getinfo has the pubkey listed, and validateaddress confirms it is mine and valid


[01-Aug-19 01:23 AM] smkhound#7640
`pegsaddress` method returns result (same with and without my pubkey)


[01-Aug-19 01:23 AM] smkhound#7640
btw, misspelt in doc (pegs`s`address)


[01-Aug-19 01:24 AM] smkhound#7640
```{
  "result": "success",
  "PegsCCAddress": "RHnkVb7vHuHnjEjhkCF1bS6xxLLNZPv5fd",
  "PegsCCBalance": 0.00000000,
  "PegsNormalAddress": "RMcCZtX6dHf1fz3gpLQhUEMQ8cVZ6Rzaro",
  "PegsNormalBalance": 0.00000000,
  "PegsCCTokensAddress": "RHG4K84bPP9h9KKqvpYbUzocaZ3LSUHxLa",
  "PubkeyCCaddress(Pegs)": "RMuotucMRa1D8Tcp1izDqKddYL6dDWfnkZ",
  "PubkeyCCbalance(Pegs)": 0.00000000,
  "myCCAddress(Pegs)": "RMuotucMRa1D8Tcp1izDqKddYL6dDWfnkZ",
  "myCCbalance(Pegs)": 0.00000000,
  "myaddress": "R9ujZ53iX12iQWY6v76zcsj933j9hFJqwK",
  "mybalance": 0.00000000
}
```


[01-Aug-19 01:26 AM] smkhound#7640
could issue be incorrect `pegstxid` param?


[01-Aug-19 01:28 AM] smkhound#7640
not being sure what it should be, I tried the one listed in the docs (a130861d422655cb28ffbf788c3b4a07748ba67eb7c413c9440b7cbbfcb9d296), and when that didnt work, I tried the earlytxid launch param (86618f7fb240550f8e0cca9cb0c955caa06a54e7f8b22ab37031f6161e830444). Both returned the pubkey error


[01-Aug-19 03:34 AM] smkhound#7640
any clues for creating a valid pegstxid to test?


[01-Aug-19 04:05 AM] smkhound#7640
deamon rebuilt, no change. Can confirm `export CONFIGURE_FLAGS='CPPFLAGS=-DTESTMODE' `
in .profile
not sure what to try next.


[01-Aug-19 04:31 AM] CMaurice#1685
mined some blocks?


[01-Aug-19 04:53 AM] smkhound#7640
been trying, nothing yet
```smk762@cctest163:~/Mixa84/komodo/src$ ./komodo-cli -ac_name=KUSDTEST getgenerate
{
  "staking": false,
  "generate": true,
  "numthreads": 1
}
smk762@cctest163:~/Mixa84/komodo/src$ ./komodo-cli -ac_name=KUSDTEST getbalance
0.00000000
```


[01-Aug-19 04:55 AM] CMaurice#1685
hm, that worked for me. height.34773


[01-Aug-19 04:55 AM] smkhound#7640
```  "blocks": 0,
  "longestchain": 0,
```
probably doesnt help


[01-Aug-19 04:56 AM] smkhound#7640
getting readout tho 🤷🏼


[01-Aug-19 04:57 AM] smkhound#7640

{Attachments}
https://cdn.discordapp.com/attachments/564807360472940575/606455369786589186/unknown.png


[01-Aug-19 04:58 AM] smkhound#7640
```2019-08-01 11:52:58 connect() to 95.213.238.98:58487 failed after select(): Connection refused (111)
2019-08-01 11:53:26 connect() to [2a04:2180:0:2::29]:58487 failed after select(): Permission denied (13)
2019-08-01 11:54:25 connect() to 159.65.134.48:58487 failed after select(): Connection refused (111)
```
 @CMaurice lend me an addnode?


[01-Aug-19 05:01 AM] CMaurice#1685
88.98.198.123 have port forwarded p2p but don't know if hooked to machine

{Reactions}
👍🏼 

[01-Aug-19 05:01 AM] CMaurice#1685
bbiab


[01-Aug-19 05:01 AM] CMaurice#1685
let me know


[01-Aug-19 05:05 AM] smkhound#7640
nothing yet. which repo/branch are you using? are blocks progressing or is it on demand without txs?


[01-Aug-19 05:07 AM] smkhound#7640
found the pegstxid 🤦🏼 
searched discord earlier, didnt use a space.
```KMD token txid:    babf52d3f8586393a3ca45e07ccd9ab247fd56c5104bef3aa6a83be3f104831a
Oracle txid:        bde7c4fb8f7f402891d350715c308179193e4c961c90cac0740a7e89d561b437
Gateway txid:        e41b98f104d5d3a8f94742f5b0237a9efdd6999bea4af2ce64228c7280167b40
Pegs txid:        a130861d422655cb28ffbf788c3b4a07748ba67eb7c413c9440b7cbbfcb9d296```


[01-Aug-19 05:10 AM] smkhound#7640
still pubkey err, guess it wont change until I get some blocks.


[01-Aug-19 05:11 AM] CMaurice#1685
restarted, should get port, blocks progressing height.34783 . Good find


[01-Aug-19 05:11 AM] CMaurice#1685
don't remember getting a pubkey reror


[01-Aug-19 05:11 AM] smkhound#7640
i'm still stumbling around in the dark with bruised shins


[01-Aug-19 05:12 AM] CMaurice#1685
me too 😃 even forgot what little understanding I had a few days ago


[01-Aug-19 05:15 AM] CMaurice#1685
a5cbc13e1 (HEAD -> pegsCC, origin/pegsCC) HEAD@{0}: checkout: moving from master to pegsCC
80e74e0c8 (origin/master, origin/HEAD, master) HEAD@{1}: clone: from https://github.com/Mixa84/komodo.git

{Embed}
https://github.com/Mixa84/komodo.git
Mixa84/komodo
Komodo. Contribute to Mixa84/komodo development by creating an account on GitHub.
https://images-ext-2.discordapp.net/external/5PP5Rc1dp6Lo2v8nwnTvQmRdaXpEf9xjHeMr0XyppBs/%3Fs%3D400%26v%3D4/https/avatars3.githubusercontent.com/u/39563265


[01-Aug-19 05:16 AM] smkhound#7640
``` git log -1
commit 8a8ffc3284540a92eb562c18e4a5f7102c73e18b (HEAD -> pegsCC, origin/pegsCC)
Date:   Thu Jul 18 12:21:15 2019 +0200

    Fix
```


[01-Aug-19 05:17 AM] CMaurice#1685
I'm behind a week


[01-Aug-19 05:20 AM] CMaurice#1685
stopping, catching up

{Reactions}
👍🏼 

[01-Aug-19 05:35 AM] CMaurice#1685
up again. I don't get your readout above... 
```height.34800
BTC/USD 9994.9117, BTC/GBP 8249.3503, BTC/EUR 9057.9886 GBPUSD 1.211600, EURUSD 1.103436 EURGBP 0.910727
(KMD 0.00010190) (ETH 0.02136000)  errs.0```


[01-Aug-19 05:40 AM] smkhound#7640
can you pls do `clearbanned`?


[01-Aug-19 05:40 AM] smkhound#7640
``` ./komodo-cli -ac_name=KUSDTEST getpeerinfo
[
]
```


[01-Aug-19 05:41 AM] smkhound#7640
and maybe see if theres more peers I can try and link to


[01-Aug-19 05:51 AM] CMaurice#1685
116.203.17.140:22993 and 116.203.17.141:22993


[01-Aug-19 05:52 AM] CMaurice#1685
which I guess doesn't help


[01-Aug-19 06:10 AM] smkhound#7640
cheers, had those.


[01-Aug-19 06:11 AM] smkhound#7640
will try again tomorrow, or step back and make another pegs chain


[05-Aug-19 04:46 AM] Mihailo#5902
@smkhound @CMaurice Sorry guys, I had couple of days in total chaos. I'm back now, so anything you need for pegs let me know.


[05-Aug-19 04:47 AM] smkhound#7640
I'm a little fluey but will revisit tommoro. Last check my nodes had blocks / longestchain = 0


[05-Aug-19 04:48 AM] CMaurice#1685
hey no worries, just trying to tag along with everything that's going on atm, it's fun


[05-Aug-19 04:49 AM] Mihailo#5902
@smkhound I'll check the two nodes that are working KuSD chain to see if they are ok.


[05-Aug-19 04:49 AM] CMaurice#1685
just saw a acurrency oracle update, must be daily or something: `(BGN 1.7610) (NZD 1.5330) (ILS 3.4923) (RUB 65.2849) (CAD 1.3234)...`


[05-Aug-19 04:49 AM] CMaurice#1685
seem fine from here


[05-Aug-19 04:49 AM] Mihailo#5902
@CMaurice Ok, if you need anything let me know 😉


[05-Aug-19 04:49 AM] CMaurice#1685
will do, thanks


[05-Aug-19 04:50 AM] smkhound#7640
mine was reporting prices, but had pubkey error on some methods. blocks = 0 was something I found trying to debug that


[05-Aug-19 04:51 AM] smkhound#7640
still same, I'll delete ~/.komodo/KUSDTEST and try again


[05-Aug-19 04:53 AM] Mihailo#5902
let me quick check the nodes

{Reactions}
👍🏼 

[05-Aug-19 04:57 AM] Mihailo#5902
They are working fine, mining new blocks


[05-Aug-19 04:57 AM] Mihailo#5902
Can you send me the command line for the daemon?


[05-Aug-19 04:57 AM] smkhound#7640
```./komodod -ac_name=KUSDTEST -ac_reward=700000000 -ac_supply=77777 -ac_cbopret=7 -ac_cc=313 -ac_ccenable=226,236,237,240 -ac_blocktime=300 -ac_notarypay=250000000 -ac_snapshot=288 -ac_sapling=1 -ac_earlytxidcontract=237 -ac_algo=verushash11 -ac_prices="ETH, LTC, BNB, NEO, LRC, QTUM, OMG, ZRX, STRAT, IOTA, XVG, KMD, EOS, ZEC, DASH, XRP, STORJ, XMR, BAT, BTS, LSK, ADA, WAVES, STEEM, RVN, DCR, XEM, ICX, HOT, ENJ" -ac_stocks="AAPL,ADBE,ADSK,AKAM,AMD,AMZN,ATVI,BB,CDW,CRM,CSCO,CYBR,DBX,EA,FB,GDDY,GOOG,GRMN,GSAT,HPQ,IBM,INFY,INTC,INTU,JNPR,MSFT,MSI,MU,MXL,NATI,NCR,NFLX,NTAP,NVDA,ORCL,PANW,PYPL,QCOM,RHT,S,SHOP,SNAP,SPOT,SYMC,SYNA,T,TRIP,TWTR,TXN,VMW,VOD,VRSN,VZ,WDC,XRX,YELP,YNDX,ZEN,BRK.A" -addnode=159.69.45.70 -earlytxid=86618f7fb240550f8e0cca9cb0c955caa06a54e7f8b22ab37031f6161e830444 -daemon -pubkey=$pubkey &
```


[05-Aug-19 04:58 AM] Mihailo#5902
This is not pegscc command!


[05-Aug-19 05:01 AM] smkhound#7640
sorry I'm confused.


[05-Aug-19 05:02 AM] CMaurice#1685
i'm using ```./src/komodod -ac_supply=1000000 -ac_reward=10000 -ac_name=KUSDTEST -ac_cc=2 -ac_import=PEGSCC -ac_end=1 -ac_perc=0 -ac_cbopret=7 -earlytxid=a130861d422655cb28ffbf788c3b4a07748ba67eb7c413c9440b7cbbfcb9d296 -addnode=116.203.17.140:22993 -addnode=116.203.17.141:22993 -pubkey=pubkey```


[05-Aug-19 05:04 AM] Mihailo#5902
@smkhound The command for starting daemon that @CMaurice is using is the correct one!


[05-Aug-19 05:04 AM] Mihailo#5902
Your daemon command looks like it is just for pricescc


[05-Aug-19 05:05 AM] smkhound#7640
thanks, I must have got the wrong params from pricesCC


[05-Aug-19 05:05 AM] Mihailo#5902
That is why blocks were 0


[05-Aug-19 05:08 AM] smkhound#7640
jeez, hope my brain works again one of these days 🤦🏼


[05-Aug-19 05:08 AM] smkhound#7640
looks like sysncing with correct params, thaks for solving mystery, sorry for my stupid


[05-Aug-19 05:09 AM] Mihailo#5902
Np, sorry I couldn't solve it sooner 😉


[06-Aug-19 03:06 AM] smkhound#7640
k, so I've got to node sync'd and so far everything (except mining!) appears to be working as expected. 
seeing `2019-08-06 10:04:12 ERROR: CheckTransaction(): invalid script data for coinbase time lock
` in debug.log
what am I doing wrong this time?


[06-Aug-19 03:07 AM] smkhound#7640
could I pls get a small amount of KUSDT to cover the gateways token creation fee?


[06-Aug-19 03:52 AM] smkhound#7640
`R9LLdCjFFccaGxa8i3omULSe7dd2QuaxL2`


[06-Aug-19 04:07 AM] phm87#7395
@smkhound KUSDT ? Stablecoin ? Is it a public chain ? I am curious


[06-Aug-19 04:08 AM] smkhound#7640
public, in testing.


[06-Aug-19 04:08 AM] smkhound#7640
https://github.com/Mixa84/komodo/wiki/Pegs-CC

{Embed}
https://github.com/Mixa84/komodo/wiki/Pegs-CC
Mixa84/komodo
Komodo. Contribute to Mixa84/komodo development by creating an account on GitHub.
https://images-ext-2.discordapp.net/external/5PP5Rc1dp6Lo2v8nwnTvQmRdaXpEf9xjHeMr0XyppBs/%3Fs%3D400%26v%3D4/https/avatars3.githubusercontent.com/u/39563265


[06-Aug-19 04:08 AM] phm87#7395
Thx


[06-Aug-19 04:09 AM] smkhound#7640
launch params are up a bit ☝🏼


[06-Aug-19 04:09 AM] phm87#7395
Ok. Thank you. I will check in a few days

{Reactions}
👍🏼 

[06-Aug-19 04:10 AM] smkhound#7640
once I get my head around it and time + brain, maybe do something in LABs with it


[06-Aug-19 04:12 AM] phm87#7395
😍 :labs: 😍


[06-Aug-19 04:33 AM] Deleted User#0000
sounds like LABS will be busy soon lol


[06-Aug-19 04:36 AM] SHossain#0007
it's almost ready for testing.


[06-Aug-19 04:37 AM] SHossain#0007
need some CLI test and easy to use TUI & GUI


[06-Aug-19 04:38 AM] Mihailo#5902
public in testing, but in dev still. There is no validation, so a lot of bad stuff can be done. So it needs careful handling for now.


[06-Aug-19 04:38 AM] Mihailo#5902
Mining should work, and you can ignore `invalid script data for coinbase time lock` as this is something from pricesCC, AFAIK just ignore it.


[06-Aug-19 04:39 AM] jl777c#5810
you should have active the minimum number of prices to minimize consensus conflicts


[06-Aug-19 04:40 AM] Mihailo#5902
you won't need to mine the chain, only maybe few blocks to get several 10k sat to be able to do gateway deposit and claim tx. All others will be done from pegsCC funds so no need for coins.


[06-Aug-19 04:40 AM] Mihailo#5902
@jl777c Only default prices are enabled, nothing additional.


[06-Aug-19 04:41 AM] SHossain#0007

{Attachments}
https://cdn.discordapp.com/attachments/564807360472940575/608263309262848000/Screenshot_from_2019-08-06_12-40-59.png


[06-Aug-19 04:50 AM] jl777c#5810
ok


[06-Aug-19 07:23 AM] SHossain#0007
```
./komodo-cli -ac_name=KUSDTEST pegsaccountinfo a130861d422655cb28ffbf788c3b4a07748ba67eb7c413c9440b7cbbfcb9d296
{
  "result": "success",
  "name": "pegsaccountinfo",
  "account info": [
    {
      "token": "KMD",
      "deposit": 0.005,
      "debt": 0,
      "ratio": 0
    }
  ]
}
```


[06-Aug-19 07:24 AM] SHossain#0007
```
./komodo-cli -ac_name=KUSDTEST pegsaccounthistory a130861d422655cb28ffbf788c3b4a07748ba67eb7c413c9440b7cbbfcb9d296
{
  "result": "success",
  "name": "pegsaccounthistory",
  "account history": [
    {
      "action": "fund",
      "amount": 500000,
      "accounttxid": "c8a944145647c26c9d6c560fc352d13c2796c96dc84bcd1afcfde8f8194fb916",
      "token": "KMD",
      "deposit": 500000,
      "debt": 0
    }
  ]
}
```


[06-Aug-19 07:24 AM] SHossain#0007
finally. thanks to @Mihailo for instructing every step


[06-Aug-19 07:26 AM] jl777c#5810
you deposited 500,000 ?


[06-Aug-19 07:26 AM] Mihailo#5902
Tokens 😛


[06-Aug-19 07:27 AM] jl777c#5810
so this is a test setup?


[06-Aug-19 07:27 AM] jl777c#5810
in a real one, it would only be issued when KMD is deposited


[06-Aug-19 07:27 AM] SHossain#0007
it's in satoshis


[06-Aug-19 07:27 AM] SHossain#0007
i'm using Mihailo's test setup


[06-Aug-19 07:27 AM] Mihailo#5902
He deposited 0.01 KMD, and funded pegs with 0.005 KMDT


[06-Aug-19 07:28 AM] SHossain#0007
wish if i had 500,000 KMD 😄


[06-Aug-19 07:28 AM] Mihailo#5902
😄


[06-Aug-19 07:28 AM] SHossain#0007
```
./komodo-cli -ac_name=KUSDTEST pegsaccountinfo a130861d422655cb28ffbf788c3b4a07748ba67eb7c413c9440b7cbbfcb9d296
{
  "result": "success",
  "name": "pegsaccountinfo",
  "account info": [
    {
      "token": "KMD",
      "deposit": 0.005,
      "debt": 0.0025,
      "ratio": "52.25%"
    }
  ]
}
```


[06-Aug-19 07:29 AM] SHossain#0007
now, let's wait for KMD price change. this will change the ratio


[06-Aug-19 07:30 AM] Mihailo#5902
Won't have to wait much these days 😛


[06-Aug-19 07:30 AM] jl777c#5810
oh, its in satoshis


[06-Aug-19 07:30 AM] jl777c#5810
@SHossain you do have 500,000 KMD satoshis!

{Reactions}
😂 

[06-Aug-19 07:31 AM] Mihailo#5902
Yes, have to make it consistent


[06-Aug-19 07:32 AM] Mihailo#5902
@jl777c As this is the test setup and nobody is monitoring the chain we have this situation:
```
./komodo-cli -ac_name=KUSDTEST pegsinfo a130861d422655cb28ffbf788c3b4a07748ba67eb7c413c9440b7cbbfcb9d296
{
  "result": "success",
  "name": "pegsinfo",
  "info": [
    {
      "token": "KMD",
      "total deposit": 1522885,
      "total debt": 1550000,
      "total ratio": "106.49%"
    }
  ],
  "global ratio": "106.49%"
}```
😄 😄 😄


[06-Aug-19 07:33 AM] SHossain#0007
where does that 6.49% comes from?


[06-Aug-19 07:33 AM] SHossain#0007
price flactuations?


[06-Aug-19 07:35 AM] jl777c#5810
are you using the 24 hour average price?


[06-Aug-19 07:35 AM] Mihailo#5902
Basically, the debt is in USD and deposit in KMD, if you calculate it with current price you will get that 106.49% is issued. Price fell down!
But in a regular working pegs chain this should not happen, as there will be liquidators which will liquidate accounts which pass over threshold (90%)


[06-Aug-19 07:36 AM] Mihailo#5902
@jl777c Using price [2]


[06-Aug-19 07:36 AM] jl777c#5810
how could the ratio change so fast?


[06-Aug-19 07:36 AM] jl777c#5810
you need to use 24hr price


[06-Aug-19 07:36 AM] Mihailo#5902
No, this is global ratio. For whole pegs


[06-Aug-19 07:36 AM] jl777c#5810
oh. so you had positions already opened


[06-Aug-19 07:37 AM] jl777c#5810
liquidator nodes needs to be running


[06-Aug-19 07:37 AM] Mihailo#5902
Isn't the price on index 2 in array the 24h price?


[06-Aug-19 07:37 AM] Mihailo#5902
Yes, no liquidators for now


[06-Aug-19 07:38 AM] jl777c#5810
i think so


[06-Aug-19 07:38 AM] jl777c#5810
i though shossain account went from 50% to 106% in a few blocks


[06-Aug-19 07:38 AM] Mihailo#5902
😛


[06-Aug-19 07:41 AM] SHossain#0007
will there be a nice TUI which will remember all txids for local node and tester can select to test? it would make testing easier for my level :abused_smiley:


[06-Aug-19 07:42 AM] Mihailo#5902
Definitely there should be a TUI 😉 There is TUI for gateways, but maybe @TonyL could make one dedicated for pegs with gateway part

{Reactions}
💯 👍 👌 

[06-Aug-19 07:43 AM] SHossain#0007
may our wish comes true.


[06-Aug-19 07:44 AM] Mihailo#5902
May the USDK be stable 😄


[06-Aug-19 07:52 AM] TonyL#3577
Sure, noted into todo list 😃

{Reactions}
shexy yassinheart 

[06-Aug-19 07:52 AM] SHossain#0007
```
./komodo-cli -ac_name=KUSDTEST pegsaccountinfo a130861d422655cb28ffbf788c3b4a07748ba67eb7c413c9440b7cbbfcb9d296
{
  "result": "success",
  "name": "pegsaccountinfo",
  "account info": [
    {
      "token": "KMD",
      "deposit": 0,
      "debt": 0,
      "ratio": 0
    }
  ]
}
```


[06-Aug-19 07:52 AM] SHossain#0007
after `pegsredeem`


[06-Aug-19 07:54 AM] SHossain#0007
`tokenbalance` back to normal
```
./komodo-cli -ac_name=KUSDTEST tokenbalance babf52d3f8586393a3ca45e07ccd9ab247fd56c5104bef3aa6a83be3f104831a
{
  "result": "success",
  "CCaddress": "RRxJdMabVp6LaP7gRKg4kRZSz6RwfBPGpb",
  "tokenid": "babf52d3f8586393a3ca45e07ccd9ab247fd56c5104bef3aa6a83be3f104831a",
  "balance": 1000000
}
```


[06-Aug-19 07:55 AM] SHossain#0007
and the worstaccount is ...
```
./komodo-cli -ac_name=KUSDTEST pegsworstaccounts a130861d422655cb28ffbf788c3b4a07748ba67eb7c413c9440b7cbbfcb9d296
{
  "result": "success",
  "name": "pegsworstaccounts",
  "KMD": [
    {
      "accounttxid": "a9f6d273e916b74831d7ee5822bd47f32e5e2f6c6c6f97a7f8ebcd25cab747a6",
      "deposit": 1000000,
      "debt": 1300000,
      "ratio": "137.19%"
    }
  ]
}
```


[06-Aug-19 07:56 AM] jl777c#5810
so bad, nobody wants it


[07-Aug-19 04:12 AM] smkhound#7640
just confirm... I've run thru this twice, and get `couldnt find merkleroot for ht.1476655 KMD oracle.bde7c4fb8f7f402891d350715c308179193e4c961c90cac0740a7e89d561b437 m.0 vs n.1`

Had oraclefeed running, but insufficient funds to subscribe to it so likely not writing. I assume using the funded oracle pubkey (not mine) returned from oraclesinfo wont work for me?

So to use PegsCC, I need enough funds to 
-subscribe to and fund oracle
-do the gateways transactions
before I can issue Pegs commands?
I've been mining for over 24 hrs, and my balance is only 0.0063
what balance will be sufficient to cover cost of oraclefeed writes without going broke before I can submit a gatewaysdeposit?


[07-Aug-19 05:03 AM] Mihailo#5902
@smkhound Did you do this on KUSDTEST chain? There you won't need to run oraclefeed. In public use of pegsCC notary nodes will run oraclefeed and be in charge of the gateway so you will only need funds to do gateways tx. I have even changed gateways claim to not add any inputs as there is a marker from deposit tx that can be used for txfee. So you will only need 10k sat to use pegs.


[07-Aug-19 05:03 AM] Mihailo#5902
Let me check oraclefeed on KUSDTEST as yesterday it was not working because KMD daemon was down.


[07-Aug-19 05:05 AM] Mihailo#5902
It is working now. Have to check why it is crashing


[07-Aug-19 05:06 AM] Mihailo#5902
@smkhound  You'll have data from block 1476711


[07-Aug-19 05:40 AM] smkhound#7640
thanks, so I dont have to run the feed as a user, its run globally but the chain owner? 🆒


[07-Aug-19 05:42 AM] Mihailo#5902
Yes. The chain owner should setup the gatreway with as much signers possible so it is enough decentrilized. Those msig signers will run oraclefeed so that deposits and withdraw works. In case of pegsCC probably the NNs will be gateways signers and run oraclefeed so you could have the trust in whole system


[07-Aug-19 05:43 AM] Mihailo#5902
I mean, anybody can setup the pegCC on their own chain. But for users to trust it it must have some reliable gateway multisig signers


[07-Aug-19 05:50 AM] smkhound#7640
`  "result": "success",
` :abusedsmily:


[07-Aug-19 06:17 AM] smkhound#7640
```./komodo-cli -ac_name=KUSDTEST pegsaccountinfo a130861d422655cb28ffbf788c3b4a07748ba67eb7c413c9440b7cbbfcb9d296
{
  "result": "success",
  "name": "pegsaccountinfo",
  "account info": [
    {
      "token": "KMD",
      "deposit": 0.1,
      "debt": 0,
      "ratio": 0
    }
  ]
}```


[07-Aug-19 06:18 AM] Mihailo#5902
👍


[07-Aug-19 06:22 AM] smkhound#7640
```./komodo-cli -ac_name=KUSDTEST pegsaccounthistory a130861d422655cb28ffbf788c3b4a07748ba67eb7c413c9440b7cbbfcb9d296
{
  "result": "success",
  "name": "pegsaccounthistory",
  "account history": [
    {
      "action": "fund",
      "amount": 10000000,
      "accounttxid": "2a4b7e4a693283bdc1a6fa5a54d7ad54c540ea0266df854bbd1527491ab2e56a",
      "token": "KMD",
      "deposit": 10000000,
      "debt": 0
    }
  ]
}
```
I like being debt free 😅


[08-Aug-19 05:42 AM] smkhound#7640
@Mihailo below is my attempt to communicate PegsCC in laymans terms. Could you please confirm / correct as required?
```PegCC builds upon on the existing Antara modules Tokens, Gateways, Prices and Oracles.
Tokens are created, and transmitted across chains using Gateways for use within the Pegs chain.
Oracles communicate information about tokens deposited via the Gateway via an “oraclefeed” app, run by the chain owner (and potentially notary nodes).
Oracles also communicate Prices in a trustless manner from a range of external sources, with a 24hr delay.
Via the above, 80% of the value of deposited tokens can be exchanged for a “stablecoin” (e.g. USDK) at current Prices market value as reported by the trustless oracle. It is effectively a “deposit and loan” system, where deposited tokens secure the loan.
The USDK tokens can be traded for fiat / other crypto, or redeemed for the originally deposited crypto used to create them.
If the value of the deposited coin rises, additional USDK is created and available to account holder to withdraw, improving their debt ratio. 
If the value of the deposited coin falls, the worst accounts are subject to liquidation. In this event, a third party can gain a 5% return by paying the debt of the account with an excessive debt ratio (e.g. > 90%). The remainder will be applied to the chain as a whole to improve the global debt ratio to prevent underlying assets of the chain falling below the value of total USDK issued.
```


[08-Aug-19 05:42 AM] smkhound#7640
```For example:
Bob uses gatewaysdeposit to convert 100 KMD to KMDT when the market value is $5 per KMD
Bob uses pegsfund to open a new account and then pegsget to convert this KMDT for 375 USDK.
Bob now has 100 KMD (worth $500) securing a “loan” of 375 USDK (worth $375), effectively a 75% debt ratio (375:500). 
Note: This is the opposite of fractional reserve lending!
After some time, KMD rises to $10. Bob’s debt ratio is now a very healthy 37.5% (375:1000). 
Bob decides to take some profit and exchanges for an additional 375 USDK, rising his debt ratio to 75% (750:1000). 
Bob trades 250 USDK over the counter for $250 USD fiat.
At this stage, Bob’s original 100 KMDT deposit worth $500 at time of account creation has been converted into 750 USDK. He has sold part of this for $250 in fiat, still has 100KMD (worth $1000) securing his account, and has 500 USDK (worth $500) to trade with - a combined total value of $1750 from his original input of 100KMD ($500 at time of account creation).
```


[08-Aug-19 05:42 AM] smkhound#7640
```After some more time passes, the price of KMD drops back down to $8.25. Bob’s debt ratio is now at a dangerous level of 90.0909% (750:825), and subject to liquidation.
Alice uses pegsworstaccounts and sees Bob’s debt ratio has left him vulnerable. She decides to liquidate Bob’s account using pegsliquidate,  buying out Bob’s account for 750 USDK. 
At the current market price of $8.25, the 100KMD which was securing Bob’s account is worth $825. Alice receives a 5% bonus worth 37.5 USDK on top of the 750 USDK cost of liquidating Bob’s account, which is paid out in the form of 95.4545 KMDT, worth $787.5 at the current KMD price of $8.25.
The remaining 4.5454 KMDT from Bob’s account is used to maintain the integrity of the pegs chain by reducing the global debt ratio.
Bob still has his remaining 500 USDK (worth $500), and the US$250 fiat he traded for earlier ($750 total). 
The liquidated 100 KMDT account previously securing Bob’s account (worth $825) is closed, netting Bob a loss of $75 against current $8.25 KMD price at liquidation for failing to maintain a good debt ratio. Fortunately for Bob, he’s still up $250 against the original $500 input at account creation (100 KMD at $5), and has suffered no net loss.
As Bob no longer has an account, he can use pegsexchange to convert his USDK to KMDT and either cash out with pegsredeem to reclaim 90 KMD, or use pegsfund to open a new account and then pegsget to convert up to 80% of his KMDT to USDK.
```


[08-Aug-19 05:45 AM] smkhound#7640
Incidentally, at the risk of sounding juvenile, the `pegsexchange` method risks being misread by giggling teenagers.


[08-Aug-19 05:54 AM] Mihailo#5902
@smkhound Basically that is it, there is a little bit mixing up coins and tokens in the first part. USDK is coin and KMDT is token of real KMD coin. Also, I wouldn't say oraclefeed ran by the chain owner as it can be understood as centralization. And in the last part when there is pegsexchange there is no pegsredeem then. Pegsredeem is used when you have account and pegsexchange when you don't have account. There user wil get deposited tokens and to withdraw them on external chain (the deposited coins) it calls gatewayswithdraw.


[08-Aug-19 05:54 AM] Mihailo#5902
Hehe, peg sex change 😄


[08-Aug-19 07:13 AM] smkhound#7640
thanks, I'll cleanup the token /coin thing, and add gatewayswithdraw  👍🏻


[08-Aug-19 07:19 AM] smkhound#7640
changed to ```
As Bob no longer has an account, he can use pegsexchange to convert his USDK to KMDT and either cash out with gatewayswithdraw to reclaim 90 KMD, or use pegsfund to open a new account and then pegsget to convert up to 80% of his KMDT to USDK.
```


[08-Aug-19 07:19 AM] Mihailo#5902
👍


[09-Aug-19 04:07 AM] grewalsatinder#9653
@smkhound please post your text on some article/blog once you finished it. 
I haven't read your text yet, but I'd be interested in reading your finished blog verified by devs on it's accuracy 🙂 👍


[09-Aug-19 04:16 AM] smkhound#7640
can do, didnt think of that - I'm def due for another blog post. Will maybe try and add some images to make it more digestable also.

{Reactions}
😃 (3) 👍 😎 KMD (4) 

[09-Aug-19 08:49 AM] allbits#5898
I found it digestable. Informative and easy to read and understand.


[10-Aug-19 09:25 PM] smkhound#7640
when liquidating a worst account, I assume the entire debt needs to be paid off? Would it be feasible to allow partial payment/liquidation ?


[11-Aug-19 12:40 AM] jl777c#5810
the owner can do a partial payment, not sure about third parties. it might actually be needed in case there is a very large account that needs to be liquidated


[11-Aug-19 10:45 PM] Mihailo#5902
For now I haven't implemented partial liquidation, but as @jl777c said it may be needed to implement it. But then it will need careful funds balance, as for now if you pay whole debt you get ~5.1% profit depending on who much is the debt ratio. If it is 91% then there 9% left for liquidator profit and system improvment. If 96% then there is inly 4% left. If you do partial liquidating we need to see how to distribute the rest.


[12-Aug-19 01:24 AM] jl777c#5810
maybe the amounts are just prorated


[12-Aug-19 01:25 AM] jl777c#5810
so if 20% of the debt is being liquidated, just divide all the numbers by 5


[12-Aug-19 01:25 AM] jl777c#5810
what remains has an improved ratio and whoever does this is saving the other 80%, but without this we can get stuck where there is a non-liquidatable large balance


[12-Aug-19 01:26 AM] Mihailo#5902
Ok, we can do that. But we should just think about if there is some weird cases that we should prevent. I don't know, maybe there is a partial liquidation and then price changes and something goes wrong 😛


[13-Aug-19 05:48 AM] smkhound#7640
I'm getting 
`couldnt find merkleroot for ht.0 KMD oracle.bde7c4fb8f7f402891d350715c308179193e4c961c90cac0740a7e89d561b437 m.0 vs n.1` at the moment atempting gatewaysdeposit. 
The `ht.0` bit doesnt make sense to me. Has anyone encountered this and might know why its happening?


[13-Aug-19 05:49 AM] Mihailo#5902
hmmm, never had that problem. Are you using TUI for gatewaydeposit?


[13-Aug-19 05:49 AM] smkhound#7640
not TUI, though I have scripted some of the workflow


[13-Aug-19 05:50 AM] Mihailo#5902
Probably you sent wrong height in rpc parameters


[13-Aug-19 05:50 AM] smkhound#7640
I'll add some prints to confirm.


[13-Aug-19 05:53 AM] Mihailo#5902
Send me the rpc for gatewaysdeposit


[13-Aug-19 05:55 AM] smkhound#7640
about to run again, will record params to check in CLI


[13-Aug-19 05:55 AM] smkhound#7640
script (so far) being used is here -  https://pastebin.com/AuLTRipc

{Embed}
https://pastebin.com/AuLTRipc
def setup_pegs_account(source_chain, source_addr,                 ...
https://images-ext-1.discordapp.net/external/lZwHlcJYEP_-CeL744a7RSWVnhrIifPJgiIcmKkDuJY/https/pastebin.com/i/facebook.png


[13-Aug-19 05:57 AM] Mihailo#5902
It probably returned the height 0 when checking height of deposit: blockheight = rpc[source_chain].getblock(tx_info['blockhash'])


[13-Aug-19 05:57 AM] Mihailo#5902
Maybe this returns 0 if it doesn't find it


[13-Aug-19 05:58 AM] smkhound#7640
I suspected perhaps, though I thought added a wait to make sure it was confirmed. might add another wait to make sure its not zero :abusedsmily:


[13-Aug-19 05:59 AM] Mihailo#5902
Just my guess, it doesn't have to be it


[13-Aug-19 06:02 AM] smkhound#7640
I think I found it, testing to confirm


[13-Aug-19 06:03 AM] smkhound#7640
`    blockheight = rpc[source_chain].getblock(tx_info['blockhash'])`
should be 
`    blockheight = rpc[source_chain].getblock(tx_info['blockhash'])['height']
` 🤦🏼


[13-Aug-19 06:14 AM] smkhound#7640
Thats better :abusedsmily: 
```couldnt find merkleroot for ht.1485394```


[14-Aug-19 03:58 AM] smkhound#7640
@Mihailo  is oraclefeed running at the moment? After fixinf blockheight issue on my end, had `couldnt find merkleroot for ht.1485394 KMD oracle.bde7c4fb8f7f402891d350715c308179193e4c961c90cac0740a7e89d561b437 m.0 vs n.1
` since last night. Started another deposit, now its looping `couldnt find merkleroot for ht.1486671 KMD oracle.bde7c4fb8f7f402891d350715c308179193e4c961c90cac0740a7e89d561b437 m.0 vs n.1
`


[14-Aug-19 04:32 AM] Mihailo#5902
Probably crashed, let me check


[14-Aug-19 04:42 AM] smkhound#7640
thanks


[14-Aug-19 04:45 AM] smkhound#7640
is there a restriction on who can run the feed, ie. locked to pubkey? or if I register to the `oracle.bde7c4fb8f7f402891d350715c308179193e4c961c90cac0740a7e89d561b437` will what my pubkey writes to it be valid?


[14-Aug-19 04:46 AM] smkhound#7640
if the first one, curious how we distribute across a group like the notary nodes. would it be a 1 of x multisig pubkey?


[14-Aug-19 06:16 AM] sergipcm#2275
did a fast read of docs...this might potentially only work if it supports BTC and high liquidity crypto

KUSD might be seen as a wide range usage token by lot of people.

KMD is a lot less utility coin since its kind of investment and lacks liquidity of main market coins

As a result, market makers can easily take KMD price 10% down in main markets and take profit of the broken contracts...

Unless I missread oracles and the 24h delay and some kind of 24h average makes it harder/not economical to take KMD price down for a lot of time...which would make the above scheme a bit more difficult


[14-Aug-19 06:17 AM] sergipcm#2275
this is a good read of how hardly DAI will be able to scale: https://medium.com/@hasufly/maker-dai-stable-but-not-scalable-3107ba730484

{Embed}
https://medium.com/@hasufly/maker-dai-stable-but-not-scalable-3107ba730484
Maker Dai: Stable, but not scalable
A lesson in stablecoin arbitrage
https://images-ext-2.discordapp.net/external/04TrMZYGt7jh_P4duwk4Ha4bGFaxSl5vZ4qMepIDtJc/https/miro.medium.com/max/1200/0%2ACCjw4TjCNFV7FCx2


[14-Aug-19 10:11 PM] Mihailo#5902
@smkhound Sorry for late reply, it seems I had food poisoning yesterday, I almost vomited my soul 😫


[14-Aug-19 10:12 PM] smkhound#7640
ouch, thats never fun


[14-Aug-19 10:12 PM] smkhound#7640
I had a sleepless night, woke up in afternoon for the first time in years


[14-Aug-19 10:12 PM] smkhound#7640
hope all the poison has been expelled!


[14-Aug-19 10:14 PM] Mihailo#5902
For the KUSDTEST, I've made gateway with 1of1 signature so it must be only the one pubkey it is registred. In case when notaries will run gateways it will be m of n pubkeys that will run oraclefeed and also sign withdraw txs.

{Reactions}
👍🏽 

[14-Aug-19 10:17 PM] Mihailo#5902
It seems that komodod is crashing, oraclefeed keeps runing but there is no daemon for KMD 😮


[14-Aug-19 10:20 PM] Mihailo#5902
Maybe it is a memory problem, I have only 4g on that machine and running two kmd daemons and oraclefeed


[14-Aug-19 10:20 PM] smkhound#7640
strange, wonder what is upsetting it. Good that the multisig is an option, I was wondering about the distribution of oraclefeed input without possibility of invalid data being broadcast by nefarious nodes


[14-Aug-19 10:21 PM] smkhound#7640
I had similar issues on LABs earlt on with smaller VPS, adding some swap helped but moved to larger VPS a while ago


[14-Aug-19 10:22 PM] Mihailo#5902
Only pubkeys that are set in gateways will be checked for block data in oracle, so it won't be able to submit invalid data. Also I think half of pubkeys are needed to have submitted the block data in order to have valid block data in oracle.


[14-Aug-19 10:23 PM] smkhound#7640
might be something we can test in LABS?


[14-Aug-19 10:30 PM] Mihailo#5902
We should definitely put this on some machines with more ram...


[17-Aug-19 06:20 AM] smkhound#7640
@Mihailo  @Alright  is there some docs for creating the tx to be used as the `earlytxid` launch param?


[17-Aug-19 07:28 AM] Alright#0419
@smkhound yea I have a draft... somewhere


[17-Aug-19 07:29 AM] Alright#0419
😅 don't have access to the machine it's on atm, can give you the gist of it if you need it


[17-Aug-19 07:29 AM] smkhound#7640
rough idea is ok, wont get to it until tommorow tho so can wait


[17-Aug-19 07:30 AM] Alright#0419
will pm a convo i had with gcharang about it


[17-Aug-19 07:30 AM] Alright#0419
basically explained it all to him, hope you can make sense of it


[17-Aug-19 08:25 AM] Mihailo#5902
@smkhound Basically any tx can be put in earlytxid param. The purpose is to have one global txid for CCs which will have only one valid lets say create txid, like pegsCC or for sidechains importgatwaysCC, in order for people to trust it is the valid one. Usually CCs will check the earlytxid and if the txid doesn't match the one in earlytxid it will return an error.


[17-Aug-19 08:26 AM] smkhound#7640
cool, thought it had ot be via specific method. Alright has supplied some notes, I'll apply tommorow


[17-Aug-19 08:26 AM] smkhound#7640
🤞🏽 I'll be testing a PEGS chain creation script


[17-Aug-19 08:27 AM] smkhound#7640
not mulitsig for pub yet, will try that next

{Reactions}
👍 

[31-Aug-19 09:27 AM] smkhound#7640
with pegs, seems there can only be one pegstxid - so a `pegslist` rpc is redundant. Is there a method to return the pegstxid (or earlytxid which is same) via RPC? And given that there is only one pegstxid for the chain, could the RPCs which use it as a param derive it implicitly instead of needing it as an input param?


[02-Sep-19 01:47 AM] Mihailo#5902
@smkhound When I made pegscc I used the same skeleton as for other CCs, so there is pegscclist. But you are right, as we intended that there will be only one pegstxid per chain it is useless to have that RPC. Maybe I can turn it into RPC that will return the pegstxid from earlytxid so you can immediately get the pegstxid without looking at earlytxid from command line.

{Reactions}
rum 

[05-Sep-19 09:09 PM] rainbro7#4735
CC pegs not possible :,(


[05-Sep-19 10:20 PM] smkhound#7640
how do you mean? I've launched a couple. It's a challenge, but not impossible.


[06-Sep-19 02:39 AM] rainbro7#4735
"private and CC wont be easy to do at all" On ask JL777.


[06-Sep-19 02:46 AM] gcharang#6833
yes, but cc-pegs is about creating a Stable coin with transparent addresses


[06-Sep-19 02:57 AM] jl777c#5810
CC pegs is not only possible, it is in testing


[06-Sep-19 02:58 AM] jl777c#5810
private CC pegs... that is a totally different thing. the only way i see to do it is with a massive change to the zaddr restrictions, essentially allowing taddr CC pegs on a private chain, which isnt really any private CC pegs

{Reactions}
😯 

[15-Sep-19 12:14 PM] siu#3920
any updates on which is the best route for testing pegs? current chain being used and a guide to set it up?


[16-Sep-19 07:05 AM] siu#3920
@Mihailo @Alright @smkhound @TonyL I am looking for help on getting familiar with pegs chain setup and mutlsig setup, can someone link me to a guide or document explaining the -ac parameters needed and such?


[16-Sep-19 07:06 AM] siu#3920
Thanks, and sorry for the inconvenience, i have looked around and dont seem to hit the right spot. Only docs explaining how it works but no specifics of parameters.


[16-Sep-19 07:06 AM] siu#3920
also @gcharang


[16-Sep-19 07:06 AM] Mihailo#5902
@siu For pegs the documentation is not written, but basically what you need is setup of multisig gateways and then on top you create pegscc.


[16-Sep-19 07:07 AM] siu#3920
ok


[16-Sep-19 07:07 AM] siu#3920
and the chain parameters? do you have info on those, which are needed and what options i have?


[16-Sep-19 07:08 AM] Mihailo#5902
Take a look at here for creating Gateways CC - https://developers.komodoplatform.com/basic-docs/antara/antara-tutorials/gateways-module-tutorial.html#tutorial

{Embed}
https://developers.komodoplatform.com/basic-docs/antara/antara-tutorials/gateways-module-tutorial.html
Komodo Developer Documentation
Documentation for developers building on the Komodo Platform
https://images-ext-2.discordapp.net/external/JRuH6_LDrjOGd6HbRckiIc9OBFcyJGE1c7DjCukFvtA/https/developers.komodoplatform.com/start-here-pics/Dev_Docs_Introduction_small.png


[16-Sep-19 07:09 AM] Mihailo#5902
For chain params, checkout the pinned post in this channel you will see the command line to run KUSDTEST. Those -ac parameters are necessary and you can add others if oyu need.


[16-Sep-19 07:10 AM] siu#3920
ok, thanks.


[16-Sep-19 07:34 AM] siu#3920
@Mihailo do i still need to set it as a test to get it working?


[16-Sep-19 07:35 AM] siu#3920
i remember you commented something like this a while ago, not sure if it was for pegs or for nSPV 🤔


[16-Sep-19 07:41 AM] Mihailo#5902
You need to compile Komodo in testmode so that you do not have to wait notarization or 100 blocks for a tx to be confirmed.


[16-Sep-19 07:41 AM] siu#3920
ok


[16-Sep-19 07:42 AM] Mihailo#5902
That is also below the pinned post with command line


[16-Sep-19 10:09 AM] siu#3920
is it dumb if i ask what are `-earlytxid` and `-ac_cbopret`?


[16-Sep-19 10:09 AM] siu#3920
@Mihailo


[16-Sep-19 10:25 AM] Mihailo#5902
Earlytxid is a param you need to set to pegs txid after crwating it but before block 100. And cbopret is needed for prices


[16-Sep-19 11:01 AM] siu#3920
ok, thanks.


[16-Sep-19 11:22 AM] siu#3920
ok, i got a chain running, now how do i do the -earlytxid part? @Mihailo


[16-Sep-19 12:09 PM] Mihailo#5902
You just run the daemon with -earlytxid=[pegscreatetxid]


[16-Sep-19 12:12 PM] siu#3920
oh, ok


[18-Sep-19 04:54 AM] Mylo#8306
@siu 
For some related reading, this might interest you

https://github.com/KMDLabs/komodo/blob/master/src/cc/payments.cpp  the comments explain some Payments stuff.  Might not be pegsCC but gives you an idea of the setup for different style of applications


Also the marker pattern is a good read https://developers.komodoplatform.com/basic-docs/antara/antara-tutorials/advanced-series-6.html#marker-pattern

{Embed}
https://github.com/KMDLabs/komodo/blob/master/src/cc/payments.cpp
KMDLabs/komodo
Komodo. Contribute to KMDLabs/komodo development by creating an account on GitHub.
https://images-ext-1.discordapp.net/external/HhyWP-0Sd5I4jG6OLRR8Z4upEFZlVyxGwgtl6Aqq9hw/%3Fs%3D400%26v%3D4/https/avatars0.githubusercontent.com/u/42953759

{Embed}
https://developers.komodoplatform.com/basic-docs/antara/antara-tutorials/advanced-series-6.html
Komodo Developer Documentation
Documentation for developers building on the Komodo Platform
https://images-ext-2.discordapp.net/external/JRuH6_LDrjOGd6HbRckiIc9OBFcyJGE1c7DjCukFvtA/https/developers.komodoplatform.com/start-here-pics/Dev_Docs_Introduction_small.png


[18-Sep-19 04:56 AM] Mylo#8306
eg markers are used to create tokens.  A small amount is sent as a marker (like a bookmark/index) of all created token transactions, for quick look up


[19-Sep-19 10:12 AM] siu#3920
👍


[20-Sep-19 11:42 AM] siu#3920
Ok, i started doing the gatway got stuck in the `gatewaysbind` 😂


[20-Sep-19 11:42 AM] siu#3920
i get this ```
./komodo-cli -ac_name=GOLDTEST gatewaysbind 5d4e310a8b5c3425a8aba3ae74428792b87249247522e8d7d1a4cee4bd637881 04dd02e36215bb3916a1ab227aefdc862f81368e23e2011b5fdca12fe4be2410 KMD 1000000000 1 1 03ea9c062b9652d8eff34879b504eda0717895d27597aaeb60347d65eed96ccb40 60 85 188
{
  "result": "error",
  "error": "M.1 N.1 but pubkeys[0] has no balance"
```


[20-Sep-19 11:47 AM] siu#3920
seems like the gateways wants a deposit before i do the bind?


[20-Sep-19 11:50 AM] siu#3920
ok, got it, i needed to use my out pubkey, not the gateways pubkey


[20-Sep-19 12:00 PM] siu#3920
so now i just noticed i had to sync the komodo chain in the server i was working on 🙄


[20-Sep-19 11:01 PM] TonyL#3577
yep, you need synced KMD daemon on the same machine from which you want to use oraclefeed dapp


[23-Sep-19 06:29 AM] siu#3920
hello guys


[23-Sep-19 06:30 AM] siu#3920
i finally managed to sync the chaing and get everything goin for the `gatewaysdeposit`


[23-Sep-19 06:30 AM] siu#3920
```{
  "result": "error",
  "error": "couldnt find merkleroot for ht.1543903 KMD oracle.04dd02e36215bb3916a1ab227aefdc862f81368e23e2011b5fdca12fe4be2410 m.0 vs n.1"```


[23-Sep-19 06:30 AM] siu#3920
but i get this error when i try to do the transaction


[23-Sep-19 06:31 AM] siu#3920
@Mihailo @TonyL @jl777c


[23-Sep-19 06:33 AM] siu#3920
i do have the oracle feed running btw.


[23-Sep-19 06:37 AM] Mihailo#5902
Had it posted the block number that you need yet?


[23-Sep-19 06:38 AM] Mihailo#5902
What is the block number where is your kmd deposot tx?


[23-Sep-19 06:38 AM] Mihailo#5902
And what is the current block number poated to oraclefeed?


[23-Sep-19 06:39 AM] Mihailo#5902
Also when you start oraclefeed, it goes just 20 blocks behind and post until it reaches 10 blocks before current block, and it is always 10 blocks behind.


[23-Sep-19 06:41 AM] siu#3920
oh, ok, i got it now, but new error appeared: ```{
  "result": "error",
  "error": "deposittxid didnt validate"
}
```


[23-Sep-19 06:42 AM] siu#3920
do i need to import the pubkey i am using the in smartchain to the kmd chain?


[23-Sep-19 07:37 AM] siu#3920
@Mihailo this is the command im sending in case im doing something wrong https://pastebin.com/K8Kg7uJU

{Embed}
https://pastebin.com/K8Kg7uJU
./komodo-cli -ac_name=GOLDTEST  gatewaysdeposit db52e11e272606d4d0...
https://images-ext-1.discordapp.net/external/lZwHlcJYEP_-CeL744a7RSWVnhrIifPJgiIcmKkDuJY/https/pastebin.com/i/facebook.png


[23-Sep-19 07:48 AM] Mihailo#5902
@siu You don't need to import the pubkey of kmd chain. For withdraw from gateways, you will need to import privkey of AC node that runs oraclefeed to kmdchan.


[23-Sep-19 07:49 AM] Mihailo#5902
Start the ac node with -debug=gatewayscc-2 to see what didn't validate in deposittx


[23-Sep-19 07:50 AM] siu#3920
ok


[23-Sep-19 07:50 AM] Mihailo#5902
For all CCs where we implemented logging, you can start the node with -debug=<cc_name>-2 for maximum level of logging (-2 is max)


[23-Sep-19 08:23 AM] siu#3920
```
BTC/USD 9879.4249, BTC/GBP 7948.1258, BTC/EUR 8985.7125 GBPUSD 1.242988, EURUSD 1.099459 EURGBP 0.884529
(KMD 0.00006770) (ETH 0.02118400)  errs.0
couldnt find enough oracle inputs RGvAsPttSwbeRVcK45vaWn96TQANteonVi, limit 1 per utxo

couldnt find enough oracle inputs RGvAsPttSwbeRVcK45vaWn96TQANteonVi, limit 1 per utxo

couldnt find enough oracle inputs RGvAsPttSwbeRVcK45vaWn96TQANteonVi, limit 1 per utxo

couldnt find enough oracle inputs RGvAsPttSwbeRVcK45vaWn96TQANteonVi, limit 1 per utxo

couldnt find enough oracle inputs RGvAsPttSwbeRVcK45vaWn96TQANteonVi, limit 1 per utxo

couldnt find enough oracle inputs RGvAsPttSwbeRVcK45vaWn96TQANteonVi, limit 1 per utxo

couldnt find enough oracle inputs RGvAsPttSwbeRVcK45vaWn96TQANteonVi, limit 1 per utxo

couldnt find enough oracle inputs RGvAsPttSwbeRVcK45vaWn96TQANteonVi, limit 1 per utxo

couldnt find enough oracle inputs RGvAsPttSwbeRVcK45vaWn96TQANteonVi, limit 1 per utxo

couldnt find enough oracle inputs RGvAsPttSwbeRVcK45vaWn96TQANteonVi, limit 1 per utxo

couldnt find enough oracle inputs RGvAsPttSwbeRVcK45vaWn96TQANteonVi, limit 1 per utxo

couldnt find enough oracle inputs RGvAsPttSwbeRVcK45vaWn96TQANteonVi, limit 1 per utxo

```


[23-Sep-19 08:24 AM] Mihailo#5902
This is ok print, oracledata reached maximum data txs per block


[23-Sep-19 08:24 AM] Mihailo#5902
How many subscribes did you do?


[23-Sep-19 08:24 AM] siu#3920
2


[23-Sep-19 08:25 AM] Mihailo#5902
It needs to mine a block to continue posting, but this has nothing to do with error you have. Did you gatewaysdeposit tx and looked for output on daemon?


[23-Sep-19 08:25 AM] siu#3920
yes


[23-Sep-19 08:26 AM] siu#3920
doesnt show anything else other than what i posted here.


[23-Sep-19 08:26 AM] Mihailo#5902
Hmmm


[23-Sep-19 08:27 AM] Mihailo#5902
How did you do the kmd deposit tx?


[23-Sep-19 08:29 AM] siu#3920
```
./komodo-cli z_sendmany "RJN61pcLVwVFtWZFzeWrwdkSmKR3Xi5RBW" '[{"address":"RPYhP8nFq38S85oXaRbkBLfrhKgzoX2s5D","amount":0.0001},{"address":"RPYhP8nFq38S85oXaRbkBLfrhKgzoX2s5D","amount":0.1}]'```


[23-Sep-19 08:30 AM] Mihailo#5902
The only thing that pops right now is that you sent marker to the same address as gateway deposit address. I suppose you used pubkey of the node where oraclefeed is running so it is the same address. Can't remember if I tried that


[23-Sep-19 08:30 AM] Mihailo#5902
Try to deposit to some other pubkey


[24-Sep-19 07:41 AM] smkhound#7640
can confirm, need to use a different pubkey. Pulled out a bit of hair figuring that out


[24-Sep-19 07:41 AM] Mihailo#5902
👍


[24-Sep-19 07:42 AM] smkhound#7640
made some notes here, and TUI was working before I went to the outback for a bit - https://github.com/tonymorony/komodo-cctools-python/blob/master/docs/pegscreate.md

{Embed}
https://github.com/tonymorony/komodo-cctools-python/blob/master/docs/pegscreate.md
tonymorony/komodo-cctools-python
Python libs and interfaces for Komodo cryptoconditions consensus modules - tonymorony/komodo-cctools-python
https://images-ext-1.discordapp.net/external/Holp9AfaeFvGp5-FK21tFWPUG6Vhnnx7aN2SJk6LnTA/https/repository-images.githubusercontent.com/151382224/5007df00-6c99-11e9-8f36-dfd6d7e8d715


[24-Sep-19 08:57 AM] barv#0867
Guys. What is the status of the KUSD coin?


[24-Sep-19 08:59 AM] Mihailo#5902
Currently I'm working on something else. The basic stuff for stable coin are done, but validation is not done yet. And proper testing needs to be done. At one point I think there will be a stable coin by Komodo but at the moment it is not yet on the schedule.


[24-Sep-19 09:02 AM] barv#0867
Okay thanks @Mihailo . So someone should validate. We could help testing of course. I bet you need some liquidity as well to balance it?


[24-Sep-19 09:03 AM] Mihailo#5902
The validation of txs must be implemented, so that you cannot do some bad stuff. That part is not touched yet.


[24-Sep-19 09:04 AM] barv#0867
Can I read in on KUSD somewhere? I am just guessing it works somewhat like DAI, but I actually don't know.


[24-Sep-19 09:05 AM] gcharang#6833
https://github.com/Mixa84/komodo/wiki/Pegs-CC

{Embed}
https://github.com/Mixa84/komodo/wiki/Pegs-CC
Mixa84/komodo
Komodo. Contribute to Mixa84/komodo development by creating an account on GitHub.
https://images-ext-2.discordapp.net/external/5PP5Rc1dp6Lo2v8nwnTvQmRdaXpEf9xjHeMr0XyppBs/%3Fs%3D400%26v%3D4/https/avatars3.githubusercontent.com/u/39563265

{Reactions}
👌 

[24-Sep-19 09:05 AM] barv#0867
The reason I ask is that for CoinCollect (and for AtomicDEX as well) a Komodo based stable coin would be super as DAI always needs an ETH balance


[24-Sep-19 09:08 AM] Mihailo#5902
The pegscc module (that is basically for stable coin) works as you have coins which are backed by some crypto. You can create your own chain, and choose which crypto you will have backing your coin. You can use any Bitcoin protocol coin for backed crypto.
The USDK as we call it now, will probably be created at some point and backed by KMD and some more crypto maybe.


[24-Sep-19 09:32 AM] barv#0867
And it’s kept stable by minting and burning?


[24-Sep-19 09:49 AM] barv#0867
Minting and liquidating I read. Very interesting. Thanks


[24-Sep-19 10:55 AM] Mihailo#5902
It is kept stable by issuing and liquidating. The problem is when price goes down, as when it goes up you can just issue more coins.


[24-Sep-19 10:56 AM] Mihailo#5902
And when it goes down, then liquidating happens, and improves the global ratio of the coin issued/deposited.


[25-Sep-19 11:54 PM] barv#0867
Very cool @Mihailo .  So what has to be done is the validation of txs to prevent bad stuff from happening and some traction to get liquidity in these contracts?


[26-Sep-19 01:38 AM] Mihailo#5902
Yes


[26-Sep-19 01:38 AM] Mihailo#5902
And proper testing


[26-Sep-19 02:30 AM] barv#0867
I discuss it tomorrow with some devs an get back with questions if we have. Thx.


[10-Oct-19 04:30 PM] NutellaLicka#4241
<http://www.abc.net.au/news/2019-10-11/perth-mint-offers-gold-trading-through-blockchain/11590926>
Could this idea effectively be created in the komodo ecosystem with the use of the pegs cc?


[10-Oct-19 09:54 PM] Mylo#8306
#cc-prices more likely.   the price of gold can be fetched by decentralized oracle


[10-Oct-19 09:55 PM] Mylo#8306
https://komodoplatform.com/decentralized-margin-trading/


[10-Oct-19 09:55 PM] Mylo#8306
@NutellaLicka 👆


[10-Oct-19 09:58 PM] NutellaLicka#4241
I will have a read, thank you! I haven't been keeping up with many of the cc's of late. I also see many opportunities for people to use KMD solutions rather than ethereum ones, but unfortunately don't have the requisite knowledge on how they would implement it on this platform instead


[10-Oct-19 10:01 PM] Mylo#8306
yeah, the last 12 months the dev team went guns blazing pushing limits on CC for examples.   very specialized & we have an insight into what can be done


[10-Oct-19 10:02 PM] Mylo#8306
current season is atomicdex, after another 3 or so months, maybe a shift to nspv integrations.


[10-Oct-19 10:58 PM] jl777c#5810
we are actually in the process of testing a chain pegged to Gold ounce price, backed by KMD

{Reactions}
👌 (3) 🙏 (2) 

[10-Oct-19 10:59 PM] jl777c#5810
it is settled in KMD, not actual gold, that is what allows it to be 100% blockchain


[10-Oct-19 11:21 PM] NutellaLicka#4241
That's cool, where is the price derived from? A specific market?


[10-Oct-19 11:27 PM] jl777c#5810
yes, a specific pricefeed, the important thing is that all nodes use the same pricefeed so the DTO consensus is reached


[10-Oct-19 11:31 PM] NutellaLicka#4241
It'd be important to trust that price feed as well. I am not certain on gold prices around the world, but I'm sure they're all slightly different and managed by different entities


[10-Oct-19 11:49 PM] jl777c#5810
https://forex-data-feed.swissquote.com/public-quotes/bboquotes/instrument/XAU/USD


[10-Oct-19 11:50 PM] jl777c#5810
a reputable price source, operating for over 10 years


[10-Oct-19 11:57 PM] jl777c#5810
thanks to siu who found t

{Reactions}
👍 

[11-Oct-19 12:28 AM] NutellaLicka#4241
Awesome! Solves that problem. Goldmodo?


[11-Oct-19 12:28 AM] NutellaLicka#4241
or KGOLD?


[11-Oct-19 12:34 AM] scubapanda#2485
How does it work? If someone buy kgold with 1m KMD. Next week KMD price falls 50% and he sells kgold for KMD. Where does the extra 1m KMD come from?


[11-Oct-19 12:41 AM] jl777c#5810
it is the opposite, as the price falls the KGOLD is liquidated, restoring balance


[11-Oct-19 12:41 AM] jl777c#5810
adaptive supply


[11-Oct-19 12:41 AM] gcharang#6833
<https://github.com/Mixa84/komodo/wiki/Pegs-CC>


[11-Oct-19 12:51 AM] scubapanda#2485
Thanks, I'll read and try to understand.


[11-Oct-19 12:54 AM] jl777c#5810
it lets people borrow gold equivalent using KMD as collateral


[11-Oct-19 12:55 AM] jl777c#5810
think of it as an interest free loan, which you need to make sure has enough collateral. if not, it gets liquidated at 5% to 10% equity. that is how the system restores balance


[11-Oct-19 01:13 AM] scubapanda#2485
Ok, thanks, now I understand it!


[11-Oct-19 08:33 PM] Mylo#8306
@TS @n2okpride @Daniel CP  gold conversation above fyi


[20-Oct-19 07:44 AM] siu#3920
@TonyL hello


[20-Oct-19 07:44 AM] siu#3920
im having this error when i try to run the python cc tools


[20-Oct-19 07:44 AM] siu#3920
```./pegs_creation_tui.py                                            ±[master]
Traceback (most recent call last):
  File "./pegs_creation_tui.py", line 3, in <module>
    from lib import rpclib, tuilib
  File "/home/siu/komodo-cctools-python/lib/rpclib.py", line 5, in <module>
    from slickrpc import Proxy
ModuleNotFoundError: No module named 'slickrpc'
```


[20-Oct-19 07:47 AM] siu#3920
where is this slickrpc module supposed to be


[20-Oct-19 09:06 AM] smkhound#7640

{Attachments}
https://cdn.discordapp.com/attachments/564807360472940575/635509249987837952/unknown.png

{Reactions}
👌 

[20-Oct-19 09:08 AM] smkhound#7640
I have an updated version of tui not yet merged to Tony's repo


[20-Oct-19 09:08 AM] smkhound#7640
https://github.com/smk762/komodo-cctools-python/tree/pegs_tui

{Embed}
https://github.com/smk762/komodo-cctools-python/tree/pegs_tui
smk762/komodo-cctools-python
Python libs and interfaces for Komodo cryptoconditions consensus modules - smk762/komodo-cctools-python
https://images-ext-1.discordapp.net/external/6xcX3Z50JaMIMuZ9mAXOpQv_L8FfDr-TLGFP0GMRbbU/%3Fs%3D400%26v%3D4/https/avatars3.githubusercontent.com/u/35845239


[20-Oct-19 09:08 AM] smkhound#7640
pegs_tui branch


[20-Oct-19 09:20 AM] siu#3920
👍 👍 👍 👍


[23-Oct-19 03:02 PM] eBit#9525
@jl777c I've looked at https://github.com/Mixa84/komodo/wiki/Pegs-CC but something doesn't make sense to me.  Maybe you can help me understand with this example. There are rumors Deutsche Bank may be insolvent.  I figure it might be a good idea to get the equivalent of one ounce of KGOLD on the Komodo platform. Gold is trading at $1500 USD/oz gold. KMD is trading at $1 USD/KMD. I have 3000 KMD so I convert it to 3000 KMDT. I then deposit that for 1 KGOLD.  I go to sleep, and when I wake up, the rumors about Deutche Bank are going wild.  Gold is up and trading at $2400 USD/oz. I decide these rumors are unfounded and liquidate the position.  I have a gain of $900 USD plus the original deposit of 3000 KMD still trading at $ 1USD, So I get back 3900 KMD.  As this position isn't hedged in the market and there is no counterparty to it, where is the 900 KMD coming from?

{Embed}
https://github.com/Mixa84/komodo/wiki/Pegs-CC
Mixa84/komodo
Komodo. Contribute to Mixa84/komodo development by creating an account on GitHub.
https://images-ext-2.discordapp.net/external/5PP5Rc1dp6Lo2v8nwnTvQmRdaXpEf9xjHeMr0XyppBs/%3Fs%3D400%26v%3D4/https/avatars3.githubusercontent.com/u/39563265


[23-Oct-19 04:53 PM] NutellaLicka#4241
I believe because your KMDTokens will be backed by your KGOLD, the way you "liquidate" will be via the issuance(`pegsredeem`? of more KMDTokens because the price has increased. Therefore, all you have to do is redeem the tokens for KMD.
But I'm only just learning about this, so I may be wrong


[23-Oct-19 04:59 PM] jl777c#5810
@eBit i think you are making a few assumptions that are not quite right. first of all, with KGOLD, there is no need to have any USD equivalent involved, as we would make a direct GOLD/KMD price


[23-Oct-19 05:00 PM] jl777c#5810
also, the mechanism is most similar to an interest free loan. it might help to think of it in those terms


[23-Oct-19 05:06 PM] jl777c#5810
you deposit KMD and borrow against it, up to 80% of the possible. to borrow 1 KGOLD at 1500 KMD per ounce, you would lock 1875 KMD and get 1 KGOLD. if gold price goes up 50% in a day, your "loan" went insolvent after several hours. the 1875 KMD would be eligible for liquidation when the GOLD per KMD price hits the 90% mark, around 1687 KMD per ounce of gold. at anytime after that between 1687 and 1875 price, ANYBODY can liquidate your account and arbitrage the difference. also keep in mind that the price used is the 24 hour average, not the instantaneous price


[23-Oct-19 05:08 PM] NutellaLicka#4241
What is the benefit of using a 24hr average over instantaneous pricing? Also, what is the hypothetical that nobody liquidates, or there is a high percentage of liquidatable accounts for one specific peg?


[23-Oct-19 05:08 PM] jl777c#5810
however, you still have the KGOLD, so you can convert it to 2400 KMD assuming the system has reserves to cover it. these reserves would come from other accounts that were liquidated. in the case where there is just a single KGOLD in existence, then of course it wont work without some prefunded amounts to cover this edge case


[23-Oct-19 05:10 PM] jl777c#5810
it relies on people liking 5% arbitrage, that is what keeps the overall system in balance. these liquidators are like miners, they are needed to keep the system working. the 24 hour price comes from the DTO price feed that is made resistant to price tampering. it is still possible to change the price, but would require actually changing the price for over 12 hours. it can be argued that if the price is changed for over 12 hours, the price actually did change


[23-Oct-19 05:11 PM] jl777c#5810
if instantaneous price was used, it would be easy to manipulate the price, by directly changing the KMD price, it assumes the overall liquidity of KMD is more than the peg liquidations


[23-Oct-19 05:13 PM] jl777c#5810
in the even of a massive and quick drop in price of KMD relative to the peg there will be a time period where nobody will see any benefit to liquidating as the 5% gain wont be enough to compensate. the 24 hour average will always correct to the actual price, but it is indeed possible for the entire peg to be underwater if it happens so fast, the overall liquidity cannot handle it.


[23-Oct-19 05:13 PM] jl777c#5810
in this case, the peg will trade at a discount, proportionally to the backing


[23-Oct-19 05:14 PM] NutellaLicka#4241
That makes sense. How will supply of these pegs be controlled? Purely via KMDToken allocation and burning?
I suppose with massive liquidation, the price of tether would drop too :P


[23-Oct-19 05:14 PM] jl777c#5810
so in a way, it degrades gracefully during this underwater period and when the price goes up again, the peg will automatically be reasserted


[23-Oct-19 05:15 PM] jl777c#5810
why do you talk about tether?? there is no tether in this


[23-Oct-19 05:15 PM] jl777c#5810
the supply is created by anybody that wants an interest free loan to lock in the KMD price (in terms of the peg)


[23-Oct-19 05:16 PM] jl777c#5810
so as the KMD price goes up, there will be more and more supply created


[23-Oct-19 05:17 PM] NutellaLicka#4241
I was merely making a comparison to a stable coin that is currently used, that would act the same way in a massive liquidation event. Not saying that this has anything to do with it.


[23-Oct-19 05:18 PM] jl777c#5810
the creation of the KGOLD is decentralized. as KMD price goes up (number of KMD per ounce of gold goes down) it becomes more and more likely that KGOLD is issued. people who already deposite and borrowed at 80%, can borrow again based on how much below 80% their loan ratio is


[23-Oct-19 05:19 PM] jl777c#5810
oh, ok. yes, anything that is massively liquidated will have a volatile price during this time


[23-Oct-19 05:21 PM] NutellaLicka#4241
Mihailo wrote `When the ratio of the system reaches some high value (let's say 60%) then it is possible that other users liquidate accounts that have account ratio very high that we will call "red zone" (for example over 90%).` 
Do the owners of these accounts need to ask for liquidation, or will it happen automatically? Are people able to hold through the price changes, or will their pegs be auto liquidated once the price drops below a certain amount?


[23-Oct-19 05:22 PM] jl777c#5810
when you put up collateral for a loan and the value of the collateral gets too low, what happens?


[23-Oct-19 05:23 PM] jl777c#5810
does the one who took out the loan have control of the liquidation?


[23-Oct-19 05:23 PM] NutellaLicka#4241
Yeah that's fair. Like you said, it keeps the peg healthy by doing auto-liquidations at a certain point.


[23-Oct-19 05:24 PM] NutellaLicka#4241
Answering my question with a question 😂 I like it


[23-Oct-19 05:25 PM] jl777c#5810
of course not, in exchange for borrowing against the KMD, it is locked into the system subject to liquidation. the borrower can improve his equity by depositing more KMD, or repaying some of the debt


[23-Oct-19 05:25 PM] jl777c#5810
the debt creates the pegged coins


[23-Oct-19 05:27 PM] jl777c#5810
risk free 5% arbitrage converts back the pegged coins to KMD, with a 5% margin (to the liquidator and another 5% to the system)


[23-Oct-19 05:29 PM] jl777c#5810
in extreme cases, losses are socialized automatically across all holders of the pegged coins, proportionally


[23-Oct-19 05:29 PM] NutellaLicka#4241
So the auto-liquidations keeps the peg working by forcing people to lower the debt amount in the overall system. Which you've just explained a couple of other ways people can reduce the debt on their holdings personally.


[23-Oct-19 05:30 PM] jl777c#5810
yes, people dont like to lose money for nothing


[23-Oct-19 05:30 PM] NutellaLicka#4241
Or should I say deposit to debt ratio, rather than just debts


[23-Oct-19 05:30 PM] jl777c#5810
the worst equity accounts are subject to liquidation, so those accounts are incentivized to improve their loan ratio

{Reactions}
👍 

[23-Oct-19 05:31 PM] jl777c#5810
that aspect combined with the liquidations, improves the systems overall balance


[23-Oct-19 05:32 PM] NutellaLicka#4241
Where does the 5% margin to the system go?


[23-Oct-19 05:32 PM] jl777c#5810
to the system


[23-Oct-19 05:32 PM] jl777c#5810
locked in CC address


[23-Oct-19 05:33 PM] jl777c#5810
as a specific peg is used, it will gain reserves and this is fully visible on the blockchain


[23-Oct-19 05:33 PM] NutellaLicka#4241
And the reserves are used to pay out on price increase?


[23-Oct-19 05:34 PM] NutellaLicka#4241
I.e KGOLD goes from 2000 to 2200 and somebody want to cash out to KMD, the 200 comes from the reserves?


[23-Oct-19 05:34 PM] jl777c#5810
yes


[23-Oct-19 05:35 PM] NutellaLicka#4241
Would it be true to say that every time you buy KGOLD with KMD, your funds are locked into the same reserve?


[23-Oct-19 05:36 PM] NutellaLicka#4241
Or is that separate


[23-Oct-19 05:36 PM] jl777c#5810
what do you mean by "buy"?


[23-Oct-19 05:36 PM] jl777c#5810
if you are buying a KGOLD, you are buying it, has nothing to do with the peg mechanism


[23-Oct-19 05:37 PM] jl777c#5810
the fact that you could redeem the KGOLD for an ounce worth of KMD will likely make the seller want to get a price that is close to that value


[23-Oct-19 05:38 PM] jl777c#5810
KGOLD (any pegged coin) is freely tradeable, never locked. it can be redeemed and it is backed by the pegged blockchain and its reserves


[23-Oct-19 05:38 PM] NutellaLicka#4241
Apologies, I meant redeem.


[23-Oct-19 05:39 PM] jl777c#5810
if you redeem, you are converting a KGOLD (which is burned) into the KMD that backs it


[23-Oct-19 05:39 PM] NutellaLicka#4241
Or pegsget or pegsfund I meant even aha


[23-Oct-19 05:39 PM] jl777c#5810
the reserve is decreased by the amount redeemed, but the overall system debt is also reduced


[23-Oct-19 05:41 PM] NutellaLicka#4241
I think what I'm thinking about is if everybody was getting and then redeeming only when the price increase, the reserve funds would dwindle quick. Only to be topped up when more people get more KGOLD.


[23-Oct-19 05:41 PM] jl777c#5810
a typical use case for this is for someone that needs some fiat, but doesnt want to sell their KMD, so they deposit 10x what they need. this gives them a 10% loan ratio, very solid and they can they pay it back to unlock all their KMD the next month., so short term loans with no interest


[23-Oct-19 05:41 PM] jl777c#5810
supply goes down if KMD price is going down


[23-Oct-19 05:42 PM] NutellaLicka#4241
Yeah that is definitely a big use case. Especially for a KUSD peg


[23-Oct-19 05:42 PM] jl777c#5810
if the reserves are going down, so is the overall exposure, in fact the reserve ratio gets better


[23-Oct-19 05:43 PM] jl777c#5810
if you are playing with 80% loans, then 10% volatility will wipe out the 20% left, but you still have the 80% of stablecoins


[23-Oct-19 05:44 PM] jl777c#5810
a more safe way to use the system is for interest free loans, at a low exposure. if at 10%, price would need to drop 80%+ before you are in danger of being liquidated


[23-Oct-19 05:45 PM] jl777c#5810
and such a drop historically is taking literally years to happen, not in a single day


[23-Oct-19 05:46 PM] jl777c#5810
clearly, if over a year the price is dropping, the total amount of issued pegged coins must reduce


[23-Oct-19 05:51 PM] NutellaLicka#4241
Yea that makes sense. Is the reserve purely for a single peg, or for all pegs?
In terms of other use cases, could people trade crypto-backed commodities?


[23-Oct-19 05:55 PM] jl777c#5810
there is a dedicated blockchain per peg


[23-Oct-19 05:55 PM] jl777c#5810
so the reserves for that peg will be locked into that blockchain


[23-Oct-19 05:58 PM] jl777c#5810
@gcharang the prior pages should give a good amount of info on how the pegs work. hopefully you can document it so it is clearer than the current wiki page

{Reactions}
👍 

[23-Oct-19 06:02 PM] allbits#5898
As I understand it the effective interest rate will not be zero because one would be giving up rewards. So on the highest possible loan (80%), I'm effectively paying 6.25%

In the example of only taking 10% of locked KMD as a loan my effective interest rate is 50%

Do I have that right?


[23-Oct-19 06:06 PM] NutellaLicka#4241
Thanks for shedding some light on pegs jl.


[23-Oct-19 06:26 PM] jl777c#5810
@allbits assuming that you are collected rewards 100% of the time, yes you do give that up. i think for short term loans, it makes sense. not sure for long term loans. it could be a way to cashout at 80% of marketprice without needing to sell, or having any counterparty


[23-Oct-19 06:30 PM] 9oklp#8901
A komodo version of this would be great! 
https://www.structuredeth.com/

{Embed}
https://www.structuredeth.com/
Structured: Package ETH. De-Risk. Leverage. Receive Fixed Income.
Convert your Ether into fixed income structured products with leverage.
https://images-ext-2.discordapp.net/external/6_zoiGTkhJBOF5eY0fNkzNJbqmXXz112BkEdNySUAmE/https/www.structuredeth.com/images/preview.png


[23-Oct-19 06:46 PM] jl777c#5810
prices CC could do such things


[23-Oct-19 07:59 PM] 9oklp#8901
Yes, make things ultra user friendly, a bit like how the AtomicDEX GUI makes atomic swaps possible for regular crypto users.


[23-Oct-19 08:03 PM] 9oklp#8901
Maybe add a small extra tx fee for the GUI provider.


[23-Oct-19 08:09 PM] 9oklp#8901
Building decentralised synthetic portfolios based on legacy finance products and commodities will be huge, all the attention is on ethereum now for defi, but komodo tech can actually perform at large scale, so ETH defi is the gateway drug into komodo defi.


[23-Oct-19 09:43 PM] polycryptoblog#1173
@allbits#8882   Demurrage  and interest are not equivalent .


[23-Oct-19 10:27 PM] polycryptoblog#1173
Interest rate is charge on principal. You are not paying 50% of your principal.  Additionally locking coins up in a peg necessarily prevents them from being able to the required action to receive the reward


[24-Oct-19 01:58 AM] Mihailo#5902
@eBit If I may add (I haven't read the whole conversation) to answer your question. When you deposit the funds in pegscc account, let say your example of 3000KMD, you are able to get up to 80% of value of your deposit at that moment. So if price of gold is 1500 KMD (we will avoid USD as JL mentioned we can have direct price but lets say 1 KMD 1$ so if 1500$ is the price of gold then lets say at that moment price of gold in KMD is 1500), you can get maximum 1.6 KGOLD. Again let take your example that you took 1 KGOLD, now the price went up, if you want to get back to KMD, you will get back your deposit so 3000KMD there is no 900KMD.
PegsCC must be looked as a mechanisom of deposit vs. borrow. You give the bank your house and take 200k$ loan, when you return the loan you get back the house.


[24-Oct-19 01:59 AM] Mihailo#5902
So you are not making any money with just holding KGOLD or whatever pegged coin, but you can lose money 😛


[24-Oct-19 02:00 AM] Mihailo#5902
On the other hand if you acquire more KGOLD, then you can exchange it for more tokens.


[24-Oct-19 02:03 AM] Mihailo#5902
The problem gose when price goes down. If it goes up you can always take more KGOLD if you want (not necessary). But if it goes down, then you would need to return, but instead of making a system which would burn coins and take it from users, this system works that someone can repay your debt and take your deposit. Then you are left with your KGOLD and you can exchange it for KMD, but you lost some of it as now the price is lower and you cannot get as much as you deposited.


[24-Oct-19 02:04 AM] Mihailo#5902
It is very confusing and complex at beginning, but when you grasp the fundamentals then everything is logical.


[24-Oct-19 04:34 AM] siu#3920
Gotta put into perspective that KGOLD will be swappable in atomicDEX


[24-Oct-19 04:35 AM] siu#3920
So for user friendliness if you want KGOLD you could just buy some


[24-Oct-19 04:39 AM] jl777c#5810
yes. the issuance/liquidation process is not anything most people have to do. once it is put into circulation, it should trade at close to the pegged value


[24-Oct-19 07:44 AM] Mihailo#5902
Someone needs to deposit in order for coins to be issued. But you can always just buy coins regularly. I think most of the people which will make deposits, they will do the liquidation part for profit. Others will regularly use the coins.


[24-Oct-19 10:28 AM] allbits#5898
@polycryptoblog demurrage?? Not sure you're using the right terminology, so your point is lost if you have one. Opportunity cost is cost. I think it's silly to hope nobody would take the opportunity cost Into account when locking KMD


[24-Oct-19 11:09 AM] polycryptoblog#1173
Demurrage = fee for storage .   Interest = payment from borrower on and above the amount borrowed .          How do you figure you are paying a 50% interest rate on a 10:1 peg?


[24-Oct-19 11:51 AM] allbits#5898
Opportunity cost. It's very simple - I feel like you're being willfully blind to a simple point. I have 100 kmd. If I lock it for a year, I forgo about 5% = 5  kmd

If I borrow the equivalent of 10 kmd for that period (the ten percent example) I'm incurring a cost of 5 to borrow 10. There it is. Nothing to do with inaccurately applied terms like demurrage.  Just a simple cost benefit analysis like most normal people would do here.


[24-Oct-19 12:13 PM] polycryptoblog#1173
Ok I get what you mean now,  by your description , interest is also an inaccurate term as well.   Opportunity cost != interest


[24-Oct-19 12:15 PM] allbits#5898
The effect is the same. Presenting this as interest free loan is misleading


[24-Oct-19 12:18 PM] polycryptoblog#1173
If the deposit was not KMD ,  which is possible by cc-peg , then is it misleading?


[24-Oct-19 12:20 PM] allbits#5898
If the deposited coin is a coin that does not have rewards built in, it is quite different.


[24-Oct-19 12:21 PM] allbits#5898
There is slippage or inefficiency when setting up this system with KMD because the rewards "disappear"


[24-Oct-19 12:21 PM] jl777c#5810
the cc-pegs is implemented as interest free loan, it is coin agnostic. the fact that if using KMD has an opportunity cost is independent of the cc-pegs

{Reactions}
👆 

[24-Oct-19 12:22 PM] polycryptoblog#1173
That’s what I was trying to get at thanks @jl777c


[24-Oct-19 12:22 PM] jl777c#5810
but for KMD, which is the coin that makes sense to use, it does have a cost of the lost rewards, which is very real for people that actively collect rewards (about half). the upside is that these rewards can go toward compensating the multisig signers


[24-Oct-19 12:23 PM] jl777c#5810
that makes it a sustainable setup and for shorter term usage, the 0.4% per month is really smaller than most spreads, so shouldnt be much of a factor


[24-Oct-19 12:24 PM] jl777c#5810
i think it is fair to describe cc-pegs as being similar to an interest free loan, we just need to explain that if KMD is used, the rewards are going to the multisig signers


[24-Oct-19 12:30 PM] allbits#5898
pegs on mBTC might be more attractive for long term - interest free loan on my btc by first converting it to the mBTC chain that you are setting up.


[26-Oct-19 05:39 AM] siu#3920
what setup i need to have on the KMD chain to bind gateways?


[26-Oct-19 05:44 AM] siu#3920
@smkhound


[26-Oct-19 05:44 AM] smkhound#7640
funds


[26-Oct-19 05:45 AM] smkhound#7640
gateways are on smartchains


[26-Oct-19 05:45 AM] smkhound#7640
if doing kmd peg, need kmd funds.


[26-Oct-19 05:45 AM] smkhound#7640
cant put gateway on kmd chain tho


[26-Oct-19 05:47 AM] smkhound#7640
https://github.com/Mixa84/komodo/wiki/Pegs-CC

{Embed}
https://github.com/Mixa84/komodo/wiki/Pegs-CC
Mixa84/komodo
Komodo. Contribute to Mixa84/komodo development by creating an account on GitHub.
https://images-ext-2.discordapp.net/external/5PP5Rc1dp6Lo2v8nwnTvQmRdaXpEf9xjHeMr0XyppBs/%3Fs%3D400%26v%3D4/https/avatars3.githubusercontent.com/u/39563265


[26-Oct-19 05:49 AM] siu#3920
funds on the same pubkey as in the smartchain, right?


[26-Oct-19 05:50 AM] smkhound#7640
there is a z_sendmany tx to deposit. one of the reciepient addresses is gateway, other address' pubkey needs to be one smartchain is launched with to claim


[26-Oct-19 05:51 AM] siu#3920
ahh


[26-Oct-19 05:51 AM] siu#3920
that is not in the python tui or is it?


[26-Oct-19 05:51 AM] smkhound#7640
gateways is. there are some newer RPCs not yet integrated tho


[26-Oct-19 05:52 AM] siu#3920
```Gateways created on this assetchain: 

[1] f734077a2e41d9905756a95f79cc7daaf62de7d197d0668d30c5f5f332d5b4e9
[2] 8c574ee9543fc3004b3459b739311ac1a0c6fa5034e1cfd5e2f15e0402d80432
_________________________________________________________________


Select Gateway Bind TXID: 2
Gateways Bind TXID         [8c574ee9543fc3004b3459b739311ac1a0c6fa5034e1cfd5e2f15e0402d80432]
{'result': 'success', 'name': 'Gateways', 'M': 1, 'N': 1, 'pubkeys': ['03bf270c42ec7df480a342779797673de5f10461e7479657b5effd18f98d040f9c'], 'coin': 'KMD', 'oracletxid': '7917a710508d7525e96cbc6323fffddc14630dbe5a9af5e28b548610d0015f18', 'taddr': 0, 'prefix': 60, 'prefix2': 85, 'wiftype': 188, 'deposit': 'RJ8ZnPmwdQufPDehW4EJfzScor4qL8zZAU', 'tokenid': 'ec52db8f216735fecf8e86557405d21d05abd4e421b95ebae9ec51d5c0100214', 'totalsupply': '2.00000000', 'remaining': '2.00000000', 'issued': '0.00000000'}
'oracle_txid'
Something went wrong. Please check your input
```


[26-Oct-19 05:52 AM] siu#3920
whenever i want to see gatways info i get the "something went wrong" meessage


[26-Oct-19 05:53 AM] siu#3920
tho i did all other steps with no issue and the gateway bind worked.


[26-Oct-19 05:54 AM] smkhound#7640
which repo /branch ?


[26-Oct-19 05:55 AM] smkhound#7640
I pushed some updates to pegs_tui branch on my repo yesterday


[26-Oct-19 05:55 AM] siu#3920
im using @dimxy repo


[26-Oct-19 05:55 AM] siu#3920
or you mean the python tui?


[26-Oct-19 05:55 AM] siu#3920
im using tonyl's


[26-Oct-19 05:55 AM] smkhound#7640
I mean for komodo-cctools-python


[26-Oct-19 05:56 AM] smkhound#7640
use mine, it has a bucnh of commits not yet merged to Tony's main repo


[26-Oct-19 05:56 AM] smkhound#7640
https://github.com/smk762/komodo-cctools-python/
use pegs_tui branch

{Embed}
https://github.com/smk762/komodo-cctools-python/
smk762/komodo-cctools-python
Python libs and interfaces for Komodo cryptoconditions consensus modules - smk762/komodo-cctools-python
https://images-ext-1.discordapp.net/external/6xcX3Z50JaMIMuZ9mAXOpQv_L8FfDr-TLGFP0GMRbbU/%3Fs%3D400%26v%3D4/https/avatars3.githubusercontent.com/u/35845239


[26-Oct-19 05:57 AM] siu#3920
have link?


[26-Oct-19 05:57 AM] siu#3920
oh sorry


[26-Oct-19 05:58 AM] smkhound#7640
I will PR to Tony's eventually, but still testing some things


[26-Oct-19 05:58 AM] smkhound#7640
make sure to use `pegs_tui` branch, it is latest and being updated every couple of days


[26-Oct-19 06:06 AM] siu#3920
```~/komodo-cctools-python >>> git checkout pegs_tui                                          ±[●][master]
Branch 'pegs_tui' set up to track remote branch 'pegs_tui' from 'origin'.
Switched to a new branch 'pegs_tui'
~/komodo-cctools-python >>> ls                                                           ±[●][pegs_tui]
antara_tui.py        deposits_list  marmara_tui.py                  rekt_inspector.py  tetris_tui.py
assets_cc_tui.py     docs           payments_cc_tui.py              requirements.txt   tokens_list
connection.json      gateways_list  prices_app_v2.py                rogue_tui.py       undo-redo.css
connection_kmd.json  lib            prices_visualization_server.py  scripts            usergraphs
dash.ini             LICENSE        README.md                       static
```


[26-Oct-19 06:06 AM] siu#3920
i dont see `pegs_usage` script


[26-Oct-19 06:08 AM] siu#3920
@smkhound


[26-Oct-19 06:09 AM] siu#3920
maybe all is good, just have to wait for the 120 blocks confirmations?


[26-Oct-19 06:11 AM] smkhound#7640
use ./antara_tui.py


[26-Oct-19 06:11 AM] smkhound#7640
all the latest stuff in there


[26-Oct-19 06:12 AM] smkhound#7640
moved/moving individual scripts into the main menu


[26-Oct-19 06:16 AM] siu#3920
ok


[26-Oct-19 06:16 AM] siu#3920
but yes, i think the issue im having is wait for bindtx notarization ```{'result': 'error', 'error': 'gatewaysbind tx not yet confirmed/notarized'}
'hex'
Please connect to KMD daemon first!
```


[26-Oct-19 06:16 AM] siu#3920
i guess i didnt set it on testmode

{Reactions}
👍 

[26-Oct-19 07:29 AM] smkhound#7640
`Please connect to KMD daemon first!` error msg isnt in latest TUI. It should force the confirmation wait.


[27-Oct-19 06:37 AM] siu#3920
hello


[27-Oct-19 06:38 AM] siu#3920
does someone has had any issues with gateways claim?


[27-Oct-19 06:38 AM] siu#3920
```./komodo-cli -ac_name=KGOLDTEST gatewaysclaim 8c574ee9543fc3004b3459b739311ac1a0c6fa5034e1cfd5e2f15e0402d80432 KMD 33d4e9e4d66ad57937c81698a19f487340f7c118db7bc23002a217c0d91290f2 0233ccb0c85fb25d0468d34c17154e0584ac40ed52228f1f939f69bdd36eb24a05 0.1
{
  "result": "error",
  "error": "cant find deposittxid 8c574ee9543fc3004b3459b739311ac1a0c6fa5034e1cfd5e2f15e0402d80432"
}```


[27-Oct-19 06:38 AM] siu#3920
i am getting this error but seems weird because 8c57.... is the gateways bind txid not the deposittxid.


[27-Oct-19 10:27 AM] tolken#2655
Reading up/catching up, but maybe not far enough - sounds like this is effectively live? Using the commands outlined here: https://github.com/Mixa84/komodo/wiki/Pegs-CC I can actually take out a loan, backed with Komodo, today?

{Embed}
https://github.com/Mixa84/komodo/wiki/Pegs-CC
Mixa84/komodo
Komodo. Contribute to Mixa84/komodo development by creating an account on GitHub.
https://images-ext-2.discordapp.net/external/5PP5Rc1dp6Lo2v8nwnTvQmRdaXpEf9xjHeMr0XyppBs/%3Fs%3D400%26v%3D4/https/avatars3.githubusercontent.com/u/39563265


[27-Oct-19 10:28 AM] tolken#2655
This looks amazing.


[27-Oct-19 10:28 AM] tolken#2655
I thought this was still many months away.


[27-Oct-19 10:31 AM] tolken#2655
I guess I’d still have to find someone to buy/trade my usdk (for now) If id want to use it somewhere.


[27-Oct-19 10:49 AM] tolken#2655
_keeps reading discord conversation in reverse_


[27-Oct-19 01:16 PM] polycryptoblog#1173
It’s still months away , but the first chains using it are coming out to be tested kgold


[27-Oct-19 01:18 PM] J-Dog#9487
Is gold being tested for any particular reason?


[27-Oct-19 01:20 PM] polycryptoblog#1173
Easy to get free price feeds .  Most people are familiar with gold


[27-Oct-19 02:55 PM] tolken#2655
Will be nice to trade BTCk on AtomicDex, quickly without BTC fees.


[27-Oct-19 03:10 PM] SHossain#0007
Your wish will be granted. Devs are already working on it.


[27-Oct-19 03:34 PM] J-Dog#9487
kBNB


[27-Oct-19 03:35 PM] J-Dog#9487
kUSD 》  DAI/xDAI


[28-Oct-19 01:26 AM] Mihailo#5902
@siu Probably you haven't waited for the block where your deposit is to enter to the oracle.


[28-Oct-19 06:22 AM] siu#3920
i already was able to do the pegsfund


[28-Oct-19 06:22 AM] siu#3920
but still im confused


[28-Oct-19 06:22 AM] siu#3920
```./komodo-cli -ac_name=KGOLDTEST pegsaddress
{
  "result": "success",
  "PegsCCAddress": "RHnkVb7vHuHnjEjhkCF1bS6xxLLNZPv5fd",
  "PegsCCBalance": 89999999.99960000,
  "PegsNormalAddress": "RMcCZtX6dHf1fz3gpLQhUEMQ8cVZ6Rzaro",
  "PegsNormalBalance": 0.00000000,
  "PegsCCTokensAddress": "RHG4K84bPP9h9KKqvpYbUzocaZ3LSUHxLa",
  "myCCAddress(Pegs)": "RDwanrypqUVQCgpt6hwPzFrfaeLqU2S6uC",
  "myCCbalance(Pegs)": 0.00000000,
  "myaddress": "RN8ihckZ5PNMyZxUEDxzHgcTQcgtj3UffD",
  "mybalance": 0.00580000
}
```


[28-Oct-19 06:23 AM] siu#3920
this is my pegsaddress output. Since i did the pegsfund `mybalance` has been rising slowly any particular reason why its done bit by bit and not completely on one move?


[28-Oct-19 06:24 AM] Mihailo#5902
Don't look at pegsaddress at all. You don't need it. And I haven't still modified pegsaddress to have what it needs.


[28-Oct-19 06:25 AM] Mihailo#5902
But, the my balance should not rise as that is your balance in KGOLD coins.


[28-Oct-19 06:25 AM] siu#3920
also these txs look pretty weird with those high fees ```  {
    "account": "",
    "address": "RR5eMpy1ZCHyVyszdT5Djviyr7aPGqSaoQ",
    "category": "send",
    "amount": -0.00010000,
    "vout": 1,
    "fee": 9.95000000,
    "rawconfirmations": 0,
    "confirmations": 0,
    "txid": "aae326beddae632a8878bc8070153b1ea8cda217e892b1e08bc5934caf7ccfc7",
    "walletconflicts": [
    ],
    "time": 1572269053,
    "timereceived": 1572269053,
    "vjoinsplit": [
    ],
    "size": 853
  },
```


[28-Oct-19 06:26 AM] Mihailo#5902
Maybe you are using the same node for testing as that for the signer node (where oraclefeed is ran). Because in that case you will have the balance change when oraclesdata is done


[28-Oct-19 06:26 AM] siu#3920
it does look like i managed to fund the peg ```./komodo-cli -ac_name=KGOLDTEST pegsinfo ee6089e938a46ef88702d364d3b352f0a263e3e25947d64dd0de9b22541f6f6b
{
  "result": "success",
  "name": "pegsinfo",
  "info": [
    {
      "token": "KMD",
      "total deposit": 9000000,
      "total debt": 0,
      "total ratio": 0
    }
  ],
  "global ratio": "0.00%"
}
```


[28-Oct-19 06:26 AM] Mihailo#5902
Yes you managed to fund it. So you have done deposit and claim successfuly


[28-Oct-19 06:26 AM] siu#3920
well, the address is owned by both nodes.


[28-Oct-19 06:26 AM] Mihailo#5902
At least once


[28-Oct-19 06:27 AM] Mihailo#5902
Don't do that!!!


[28-Oct-19 06:27 AM] siu#3920
but one is running with gatway pubkey and the other with the recipients address pubkey


[28-Oct-19 06:27 AM] Mihailo#5902
It is not wrong, but you want be able to tell the difference.


[28-Oct-19 06:27 AM] Mihailo#5902
As oraclenodes need some coins in order to work. But for testing you should have clean piubkey with no funds.


[28-Oct-19 06:27 AM] Mihailo#5902
That way you will be able to test it correctly


[28-Oct-19 06:28 AM] siu#3920
on one node i have the total balance of KGOLD. on the other i have only tokens i got from pegs fun.


[28-Oct-19 06:28 AM] siu#3920
one of the nodes dont own the gatwways pubkey


[28-Oct-19 06:28 AM] Mihailo#5902
Ok, and on that node which have tokens you don't have any coins?


[28-Oct-19 06:28 AM] siu#3920
no


[28-Oct-19 06:28 AM] Mihailo#5902
And this `mybalance` is from which node?


[28-Oct-19 06:29 AM] siu#3920
this is my recipoient node: ```{
  "version": 2001526,
  "protocolversion": 170007,
  "KMDversion": "0.4.0a",
  "synced": false,
  "notarized": 0,
  "prevMoMheight": 0,
  "notarizedhash": "0000000000000000000000000000000000000000000000000000000000000000",
  "notarizedtxid": "0000000000000000000000000000000000000000000000000000000000000000",
  "notarizedtxid_height": "mempool",
  "KMDnotarized_height": 0,
  "notarized_confirms": 0,
  "walletversion": 60000,
  "balance": 0.00640000,
  "blocks": 1884,
  "longestchain": 1884,
  "tiptime": 1572269272,
  "difficulty": 4.983110155113912,
  "keypoololdest": 1571688725,
  "keypoolsize": 102,
  "paytxfee": 0.00000000,
  "sapling": 1,
  "timeoffset": 0,
  "connections": 1,
  "proxy": "",
  "testnet": false,
  "relayfee": 0.00000100,
  "errors": "",
  "pubkey": "0319ba7374011d198c74409274b90b02adad1349f2c5f360235222abb6f50cbfbc",
  "CCid": 2,
  "name": "KGOLDTEST",
  "p2pport": 21856,
  "rpcport": 21857,
  "magic": 405262356,
  "premine": 100000000,
  "reward": "1000000000",
  "halving": "0",
  "decay": "0",
  "endsubsidy": "1",
  "notarypay": "0"
}
```


[28-Oct-19 06:29 AM] siu#3920
this is my gateway node ```./komodo-cli -ac_name=KGOLDTEST getinfo                                                                                                                                   ±[●][prices-gold-feed]
{
  "version": 2001526,
  "protocolversion": 170007,
  "KMDversion": "0.4.0a",
  "synced": true,
  "notarized": 0,
  "prevMoMheight": 0,
  "notarizedhash": "0000000000000000000000000000000000000000000000000000000000000000",
  "notarizedtxid": "0000000000000000000000000000000000000000000000000000000000000000",
  "notarizedtxid_height": "mempool",
  "KMDnotarized_height": 0,
  "notarized_confirms": 0,
  "walletversion": 60000,
  "balance": 8798974.94019172,
  "blocks": 1884,
  "longestchain": 1884,
  "tiptime": 1572269272,
  "difficulty": 4.983110155113912,
  "keypoololdest": 1571680559,
  "keypoolsize": 101,
  "paytxfee": 0.00000000,
  "sapling": 1,
  "timeoffset": 0,
  "connections": 1,
  "proxy": "",
  "testnet": false,
  "relayfee": 0.00000100,
  "errors": "",
  "pubkey": "03bf270c42ec7df480a342779797673de5f10461e7479657b5effd18f98d040f9c",
  "CCid": 2,
  "name": "KGOLDTEST",
  "p2pport": 21856,
  "rpcport": 21857,
  "magic": 405262356,
  "premine": 100000000,
  "reward": "1000000000",
  "halving": "0",
  "decay": "0",
  "endsubsidy": "1",
  "notarypay": "0"
}
```


[28-Oct-19 06:29 AM] Mihailo#5902
Are you mining on receipent node?


[28-Oct-19 06:30 AM] siu#3920
yes


[28-Oct-19 06:30 AM] Mihailo#5902
Hmmm, that is the reason why balance is increasing. But what is strange is that it shouldn't allow rewards from mining.


[28-Oct-19 06:30 AM] siu#3920
i guess that is where the 0.0064 coins came from?


[28-Oct-19 06:30 AM] Mihailo#5902
Can you give me chain params?


[28-Oct-19 06:30 AM] siu#3920
yes


[28-Oct-19 06:32 AM] siu#3920
```./komodod -ac_name=KGOLDTEST -ac_cbopret=1 -ac_import=PEGSCC -ac_end=1 -ac_perc=0 -ac_cclib=prices -ac_cc=2 -ac_supply=100000000 -ac_reward=1000000000 -ac_blocktime=180  -ac_sapling=1 -ac_feeds='[ {"name":"crypto", "url":"https://api.binance.com/api/v1/ticker/price?symbol=%sBTC", "substitutes":["KMD"], "quote":"BTC", "results":{"valuepath":"/price"}, "multiplier":100000000, "interval":120 },  {"name":"metals", "url":"https://forex-data-feed.swissquote.com/public-quotes/bboquotes/instrument/%s/USD", "substitutes":["XAU"], "quote":"USD", "results":{"averagevaluepaths":["/*/spreadProfilePrices/*/ask","/*/spreadProfilePrices/*/bid"] }, "multiplier":10000, "interval":120 } ]' -addnode=74.213.69.65 -pubkey=0319ba7374011d198c74409274b90b02adad1349f2c5f360235222abb6f50cbfbc ```&


[28-Oct-19 06:32 AM] siu#3920
the chain does have reward.


[28-Oct-19 06:32 AM] siu#3920
but it was just a premine.


[28-Oct-19 06:33 AM] Mihailo#5902
Yes, ac_end is 1 so it will stop after 1st block.


[28-Oct-19 06:34 AM] Mihailo#5902
Ahhhh, sorry. Totaly forgot. I had this problem recently.


[28-Oct-19 06:34 AM] Mihailo#5902
Because you are mining, and there is noreward you get only txfees. As there are several txs created by oraclefeed, your node which is mining is getting txfees


[28-Oct-19 06:35 AM] Mihailo#5902
So don't mine on recepient test node!!!


[28-Oct-19 06:35 AM] siu#3920
btw, im using @dimxy  's repo which lets me integrate the price chain within the pegs chain.


[28-Oct-19 06:35 AM] Mihailo#5902
As you will get coins increased


[28-Oct-19 06:36 AM] jl777c#5810
for chains with very expensive reference price, even 0,0001 txfee is a lot, maybe we need to support zero txfee for the special transactions


[28-Oct-19 06:36 AM] jl777c#5810
this is up to the miner


[28-Oct-19 06:36 AM] siu#3920
yeah... i feel like i did something but dont get what i did lol


[28-Oct-19 06:37 AM] siu#3920
im not sure how many coins i should have recieved with the funding i did.


[28-Oct-19 06:39 AM] siu#3920
btw, to the chainparams you need to add ```-ac_earlytxid=ee6089e938a46ef88702d364d3b352f0a263e3e25947d64dd0de9b22541f6f6b```


[28-Oct-19 06:39 AM] Mihailo#5902
With funding you receive nothing. So you can send all the coins to other node


[28-Oct-19 06:39 AM] siu#3920
which was not done early btw.


[28-Oct-19 06:40 AM] siu#3920
i need to execute pegsget, right?


[28-Oct-19 06:40 AM] Mihailo#5902
Yes


[28-Oct-19 06:40 AM] siu#3920
im getting this ``` ./komodo-cli -ac_name=KGOLDTEST pegsget ee6089e938a46ef88702d364d3b352f0a263e3e25947d64dd0de9b22541f6f6b ec52db8f216735fecf8e86557405d21d05abd4e421b95ebae9ec51d5c0100214 0.00001
{
  "result": "error",
  "error": "not possible to take more than 80% of the deposit"
}
```


[28-Oct-19 06:40 AM] siu#3920
im going as low as possible here hehehe


[28-Oct-19 06:40 AM] Mihailo#5902
Fund is to fund the tokens to account, and get is to get the coins!


[28-Oct-19 06:41 AM] Mihailo#5902
What is the price?


[28-Oct-19 06:41 AM] siu#3920
ok


[28-Oct-19 06:41 AM] Mihailo#5902
Of gold


[28-Oct-19 06:41 AM] siu#3920
```poll_one_feed polling...
XAU_USD 14967948```


[28-Oct-19 06:41 AM] siu#3920
$1496.79


[28-Oct-19 06:41 AM] Mihailo#5902
I don't know if dimxys code is latest with pegs. I think I had some changes for that but not sure.


[28-Oct-19 06:43 AM] siu#3920
i may need to wait for 100confs once again


[28-Oct-19 06:43 AM] siu#3920
i didnt do the -TESTMODE variable when i built it before starting thetesting


[28-Oct-19 06:44 AM] siu#3920
that has extended my testing for about a week or so.


[28-Oct-19 06:44 AM] Mihailo#5902
Oh, you must do TESMODE as it is a hell without it


[28-Oct-19 06:45 AM] siu#3920
i ve been through hell... hehehe


[28-Oct-19 06:46 AM] siu#3920
so my guess of having to wait for 100confs on the pegsfund is correct?


[28-Oct-19 06:46 AM] jl777c#5810
until it is notarized


[28-Oct-19 06:48 AM] siu#3920
but the chain is not being notarized yet.


[28-Oct-19 06:48 AM] Mihailo#5902
You must wait 100confs on every tx that changes account, basically every tx ecept info txs.


[28-Oct-19 06:48 AM] jl777c#5810
yes, that is why to use TESTMODE


[28-Oct-19 06:49 AM] siu#3920
if right now i recompile with TESTMODE i can just spin the same chain again and get immediate confs?


[28-Oct-19 06:50 AM] jl777c#5810
as long as all the nodes are doing TESTMODE, then validation will be fine


[28-Oct-19 06:57 AM] dimxy#2587
To merge my prices code (with gold support) with the latest pegs cc I need to push my prices to FSM branch
But i changed the config of prices polling of web resources (there is a new -ac_feeds param instead of -ac_prices and stocks). So I wonder how many people will be affected with this and how to warn them


[28-Oct-19 07:01 AM] jl777c#5810
as long as ac_prices still works, it should be fine


[28-Oct-19 07:06 AM] siu#3920
ok, trying again the pegsfund with TESTMODE


[28-Oct-19 07:10 AM] dimxy#2587
Ok I'provide the  convertation of  ac_prices into ac_feeds


[28-Oct-19 07:10 AM] jl777c#5810
wait, there seems a misunderstanding


[28-Oct-19 07:10 AM] jl777c#5810
you didnt remove ac_prices did  you?


[28-Oct-19 07:11 AM] jl777c#5810
if so, it should still be there and -ac_feeds is an additional way, ie. backward compatible


[28-Oct-19 08:09 AM] dimxy#2587
I removed them as I am managing ac_feeds as a single configuration vector and a corresponding array of the polled price data, but I have now realized that I could convert ac_prices and ac_stocks into two ac_feeds config items


[28-Oct-19 08:10 AM] jl777c#5810
aha. plz keep in mind that backward compatibility is an important aspect


[28-Oct-19 08:12 AM] dimxy#2587
yes seems I forgot about that obvious solution😩


[28-Oct-19 08:19 AM] jl777c#5810
so this code is not yet merged, correct?


[28-Oct-19 08:30 AM] dimxy#2587
not yet, it is in my repo, as I did not khow then how to correctly provide the transition to this.
Now I know how to do it


[28-Oct-19 10:01 AM] SHossain#0007

{Attachments}
https://cdn.discordapp.com/attachments/564807360472940575/638422085974228992/Screenshot_from_2019-10-28_17-01-03.png


[28-Oct-19 10:01 AM] SHossain#0007
depositing KMD via gateway in progress to MBTCTEST chain


[28-Oct-19 10:03 AM] SHossain#0007
```
Transaction is mined
KMD Transaction ID: 88a3d630f4454345b146a4d38f3684c4879ec1d82795fc75350767ad48ca36bd
Info stored in /home/dev/tui/gw_deposits/gw_deposit_88a3d630f4454345b146a4d38f3684c4879ec1d82795fc75350767ad48ca36bd.json
Press [Enter] to continue...
```


[28-Oct-19 10:03 AM] SHossain#0007
and, it is done


[28-Oct-19 10:13 AM] SHossain#0007 (pinned)
**Komodo Source**
```
git clone https://github.com/Mixa84/komodo
cd komodo
git checkout importgateway
export CONFIGURE_FLAGS='CPPFLAGS=-DTESTMODE'
./zcutil/build.sh -j$(nproc)
cd src
```
**Test Chain (MBTCTEST) start command:**
Once MBTCTEST chain is ready, generate a new address or import existing and use `setpubkey`
```
./komodod -ac_name=MBTCTEST -ac_cc=2 -ac_import=KMD -ac_supply=1000 -ac_reward=1 -ac_end=1 -ac_perc=0 -debug=importgateway-2 -printtoconsole=1 -earlytxid=fec28fa1840bfddc532ca8fd4fbd9cfc9d927514ed988d95d5759675736739bc &
```
**Import Gateways Info:**
```
Import Gateways Bind TXID         [fec28fa1840bfddc532ca8fd4fbd9cfc9d927514ed988d95d5759675736739bc]
Import Gateways Name              [ImportGateway]
Import Gateways Required Signers  [2]
Import Gateways Total Signers     [2]
Import Gateways Pubkeys           [['02a827db0926b93ce574fcc0d1f4fd0604c248eecfa6825ae62dfd4de03bc94f76', '03e3e5292cd6f9cb218993771c7174350fd71d42c9bb61a6b825119799f825c872']]
Import Gateways Coin              [KMD]
Import Gateways Oracle TXID       [cd756825b0095b30fa0a8fbed2e94e710a4fed9ad4937762e80986fb6a2f574e]
Import Gateways Deposit Address   [bKEBwCtejNynumGH7qP2rXF67Z3Hk4LVkd]
Import Gateways Taddr             [0]
Import Gateways Prefix            [60]
Import Gateways Prefix2           [85]
Import Gateways Wiftype           [188]
```
You also need to be running KMD daemon and have a little bit of KMD to test. i.e.: 0.5 KMD or 1 KMD.
Test depositing 0.001 or 0.01 KMD and import it to MBTCTEST chain. Claim, withdraw. Try invalid commands, different pubkey to break things intentionally. If you find any bug, please report here.

Make sure both KMD & MBTCTEST chain are fully synced. (`getinfo` should display `"synced": true,` on 4th line)


[28-Oct-19 10:14 AM] SHossain#0007
**Useful Commands**
```
== Crosschain ==
importgatewayaddress [pubkey]
use 'importgatewaybind coin orcletxid M N pubkeys pubtype p2shtype wiftype [taddr]' to bind an import gateway
importgatewaycompletesigning withdrawtxid coin hex
use 'importgatewaydeposit bindtxid height coin burntxid nvout rawburntx rawproof destpub amount' to import deposited coins
importgatewayinfo bindtxid
importgatewaymarkdone completesigningtx coin
importgatewaypartialsign txidaddr refcoin hex
importgatewaypendingwithdraws bindtxid coin
importgatewayprocessed bindtxid coin
use 'importgatewaywithdraw bindtxid coin withdrawpub amount' to burn imported coins and withdraw them on external chain

== Gateways ==
gatewaysaddress [pubkey]
gatewaysbind tokenid oracletxid coin tokensupply M N pubkey(s) pubtype p2shtype wiftype [taddr]
gatewaysclaim bindtxid coin deposittxid destpub amount
gatewayscompletesigning withdrawtxid coin hex
gatewaysdeposit bindtxid height coin cointxid claimvout deposithex proof destpub amount
gatewaysdumpprivkey bindtxid address
gatewaysexternaladdress bindtxid pubkey
gatewaysinfo bindtxid
gatewayslist
gatewaysmarkdone completesigningtx coin
gatewayspartialsign txidaddr refcoin hex
gatewayspendingdeposits bindtxid coin
gatewayspendingwithdraws bindtxid coin
gatewaysprocessed bindtxid coin
gatewayswithdraw bindtxid coin withdrawpub amount
```

{Reactions}
🔥 (3) 

[28-Oct-19 10:14 AM] SHossain#0007
Pinned a message.


[28-Oct-19 10:15 AM] jl777c#5810
if it is depositing KMD, why is it called MBTC? just curios


[28-Oct-19 10:20 AM] Deleted User#0000
wish I had time, this looks 🆒


[28-Oct-19 10:24 AM] SHossain#0007
@jl777c i believe this is just for testing. we are testing with KMD now to get the basic things ready as testing with BTC might be expensive.


[28-Oct-19 10:25 AM] jl777c#5810
ok, makes sense


[28-Oct-19 10:29 AM] siu#3920
MBTC is confusing


[28-Oct-19 10:29 AM] siu#3920
does it relate to millibitcoin?


[28-Oct-19 10:32 AM] SHossain#0007
hmmmm....this is confusing. same would happen if it was KBTC


[28-Oct-19 10:33 AM] SHossain#0007
do you have better suggestion?


[28-Oct-19 10:35 AM] Deleted User#0000
FAKEKMD


[28-Oct-19 10:35 AM] siu#3920
kilobitcoin is bigger than millibticoin :troll:


[28-Oct-19 10:35 AM] siu#3920
KTC 😂


[28-Oct-19 10:36 AM] siu#3920
BTK


[28-Oct-19 10:36 AM] siu#3920
BTCK


[28-Oct-19 10:36 AM] SHossain#0007
BTCK sounds good


[28-Oct-19 10:37 AM] siu#3920
that might be the most obvious name


[28-Oct-19 10:37 AM] siu#3920
not bad


[28-Oct-19 10:41 AM] SHossain#0007
name wasn't finalised. still need to get the testings done for basic calls and iron out the bugs


[28-Oct-19 10:41 AM] siu#3920
sure. just was confused about what the M means

{Reactions}
👍 

[28-Oct-19 04:55 PM] Paro#7842
alternative names
```
Millenium  (MBTC)
Pegs KMD (PKMD)
Gateways  (GKMD)
Test KMD (TKMD)```


[29-Oct-19 01:14 AM] Mihailo#5902
MBTC is supposed to mean that BTC is locked to multisignature address. That's what M stands for. But I agree it is very confusing. Same as KUDS, so we went to USDK. Maybe we should use BTCM, but this suggest as it is anothe BTC fork coin....


[29-Oct-19 02:02 AM] TonyL#3577
Maybe BTCMSIG ?


[29-Oct-19 03:55 AM] siu#3920
LBTC?


[29-Oct-19 03:55 AM] siu#3920
Locked Bitcoin


[29-Oct-19 04:24 AM] SHossain#0007
!kmdtip rain 5


[29-Oct-19 04:24 AM] KMD TipBot#0077
@新币交流QQ群：424495679 @knijia @Zombie259 @Martis @bartwr @bountyXhunter @Deleted User @Cryptopreneur @reo | Lev0x eSports @Sean @Gig @rr5000 @az @Space Rabbit Maco @! pinpin [zergpool.com] @Slyris @Nev @Djean @yuriy @olaszlo @2fast4ever @Mihailo @Kuilef (Ilya) @Cy_Baer @molody(Pungoio) @nopasaran @BadAss @Sir Deer of Monaco @SocialDeveloper @VE @Satish @papacrypt @NIcu @OrionDeimos @Jammer @nax @LarriNavkin @JollyDodger @Smokey @jnn337 @antonio8 @DZuke @Edgemaster [Wagerr] @pogo @Djdambla @Mörökölli (Boogeyman) @slipersty @jdnewland @Upgrayedd @Lordy @Link @jim_671 @ExchangeAssets @moneystacks @𝙊𝙞𝙣𝙠 @modereck @IamLegion @Fedde @Acura @DanielSimplyVC @Hypocalese @psylox @丅ᗩＪᗩ @munhenhos @DeFi Ted (Bakes) @hutchstock @Muxa84 @d3ullist @TegoCryptoman @1karl_rich1982 @CryptoP @Wzahhh @Hashem @bitstardev @Andrew Kang @danssolutions @Emperor_Gorrion @netfreak @Faetos @LordTricky @cryptophasia @GlorymanRTS @Ca|in @Cad @SadykovT @olisa @waleedtee @Florian ;-) @H_tchet @Growdigi


[29-Oct-19 04:25 AM] KMD TipBot#0077
@Styl @TheHoliestRoger @aditzu @kerimbuyukcirak @DastardlyDan @c2k @Nikko92 @SW911 @lc123456 @kingofthekings @Ian M (Cmd_Rav) @0xErnest @matspb @Pumtchak @ShingoMurata @3rd @Oszy @Mete @costa2439 @agnewpickens @Gilagathor @Ederwa @rob @blacksea @I_R_Ben @CryptoprenuerUK @Deleted User @bitcoinsfacil - pedro @X4MiLX @Pwnz @zpajk @CryptoTony @codemanX @Mutte @kamitor - Christiaan @Seiman @OOKAHH @coinmonks || CoinCodeCap @And1 @kp @John Doe @TLMTroublemaker @Tom.T @nille @bourbonmorning @Deleted User @ImKitteh @NutellaLicka @Sri @ponzo @tomtomdrum @sorin90 @dimxy @Patrick @SwimedDragon @Jol<ER @johan | meme.com @Jakob V @Ragnar @Mewnzter @LuckyShadow @ZZZ @halo kitty rules @REX @2fast2hurius @kerimellisundae @Cryptoon @Zurg @Nagato 法 @devconet @Ondalf @sg777 @Neftegrad @Milo @Fractious @Ocean @artem.pikulin @Bruce @Deethz | NullFUD @Malti @TimC @MedaR |  GetZEN & PipeFlare @라소카 @sharkfinbite @Jisu_jung @gymb @chaordic @Mark liu @iazid @Andreas


[29-Oct-19 04:25 AM] KMD TipBot#0077
@ZaferGraph (Don't DM) @ShadowKnight @🚀📈edsky📉🤯 @Mayo @Its Monday Cousin! Get that Bag! @REInVent @jjimmyss @GuilouGuilouOTE @dgoce420 @metallionaire @eclips @VelocityAus @TeXvA @smdmitry @dsalinas79 @lefessan @Orestes @morningsun @Vatoslocos @coinraiser @Matt Harrop / Figment @KOSIUS @BigTweek @Razzle @9jα NiηJα @欧布—Michael @Nariya|CrossLink @Fruit Juice @pixelshove @CryptoBrandon


[29-Oct-19 04:25 AM] KMD TipBot#0077

{Embed}
TipBot
@SHossain (SHossain#0007)
You rained **4.9999988 KMD** onto 212 online user(s)
**(0.0235849 KMD)** each

{Reactions}
3040_kingpeepo (7) 

[29-Oct-19 04:25 AM] sorin90#6811
Thx hossain


[29-Oct-19 04:25 AM] 🚀📈edsky📉🤯#2695
thanks


[29-Oct-19 04:26 AM] 𝙊𝙞𝙣𝙠#3612
Thanks


[29-Oct-19 04:26 AM] SHossain#0007
Keep an eye on this channel....a lot of things are about to happen here going forward 🙂


[29-Oct-19 04:28 AM] siu#3920
So i have this funding on my gold peg ```Enter Pegs TXID: ee6089e938a46ef88702d364d3b352f0a263e3e25947d64dd0de9b22541f6f6b
Token: KMD
Total deposit: 49100000
Total debt: 0
Ratio : 0
Global ratio: 0.00%```


[29-Oct-19 04:28 AM] siu#3920
`49100000` is in satoshi, right?


[29-Oct-19 04:28 AM] Mihailo#5902
Yes


[29-Oct-19 04:28 AM] siu#3920
balance of KMD tokens then?


[29-Oct-19 04:29 AM] siu#3920
and i have the capacity to get 80% of that value in KGOLD coin


[29-Oct-19 04:30 AM] Mihailo#5902
Amount of KMD token that you've funded the account with. And now you can get 80% of the price of gold in KMD.


[29-Oct-19 04:32 AM] siu#3920
the problem i have is that the pegsget i can get (at least from what i have been trying to do) is less than a satoshi in KGOLD terms


[29-Oct-19 04:32 AM] siu#3920
so the tx for pegsget says it cant be done since i am playing with dust 😂


[29-Oct-19 04:32 AM] siu#3920
gold dust is still gold tho 😹

{Reactions}
😂 

[29-Oct-19 04:33 AM] Mihailo#5902
Gold is littlebit confusing, but lets say you ae on USDK chain. You deposited 1KMD (in satoshis 100000000) and KMD is 1$ so you can take 0.80USDK max
If KMD is 0.5$ then you could take 0.4USDK max


[29-Oct-19 04:33 AM] Mihailo#5902
Maybe the price is not configured correctly


[29-Oct-19 04:34 AM] Mihailo#5902
We don't have rpcs to check the price of token in configured price.


[29-Oct-19 04:34 AM] Mihailo#5902
As we are putting synthetic in description, the price is calculated for that synthetic


[29-Oct-19 04:35 AM] jl777c#5810
i think there is an rpc call that given a string that defines the synthetic, returns the price


[29-Oct-19 04:35 AM] jl777c#5810
if not, there should be, but i remember dimxy adding this a while ago


[29-Oct-19 04:36 AM] Mihailo#5902
No, this is in pegs. We've put the synthetic in token description. So when using it in pegs it will calculate price from the description synthetic.


[29-Oct-19 04:36 AM] Mihailo#5902
Or if there is rpc that you can supply sythetic string and get price that would be good


[29-Oct-19 04:36 AM] siu#3920
```Enter Pegs TXID: ee6089e938a46ef88702d364d3b352f0a263e3e25947d64dd0de9b22541f6f6b
Token: KMD
Total deposit: 149100000
Total debt: 0
Ratio : 0
Global ratio: 0.00%
```


[29-Oct-19 04:36 AM] Mihailo#5902
But still, maybe we should add the price in some info rpcs in pegs


[29-Oct-19 04:36 AM] siu#3920
this is my balance


[29-Oct-19 04:36 AM] siu#3920
and even this ```siu@Ubuntu-1804-bionic-64-minimal:~/komodo/src$ ./komodo-cli -ac_name=KGOLDTEST pegsget  ee6089e938a46ef88702d364d3b352f0a263e3e25947d64dd0de9b22541f6f6b ec52db8f216735fecf8e86557405d21d05abd4e421b95ebae9ec51d5c0100214 0.0000001
{
  "result": "error",
  "error": "not possible to take more than 80% of the deposit"
}
```


[29-Oct-19 04:36 AM] Mihailo#5902
so it is 0.149 KMD


[29-Oct-19 04:37 AM] siu#3920
weird.


[29-Oct-19 04:37 AM] Mihailo#5902
Sorry


[29-Oct-19 04:37 AM] Mihailo#5902
1.49


[29-Oct-19 04:37 AM] siu#3920
yes


[29-Oct-19 04:37 AM] siu#3920
so cheap math says that given kmd price at 0.59 cents


[29-Oct-19 04:37 AM] siu#3920
and gold price at $1,500


[29-Oct-19 04:37 AM] siu#3920
i should be able to get 0.00058 or so of KGOLD


[29-Oct-19 04:37 AM] jl777c#5810
price info should definitely be in the rpc returns


[29-Oct-19 04:38 AM] Mihailo#5902
and that is in $0.89


[29-Oct-19 04:38 AM] Mihailo#5902
You should be able to get 0.00056918KGOLD


[29-Oct-19 04:39 AM] siu#3920
so i should be able to ask for 80% of 0.00058, right?


[29-Oct-19 04:39 AM] Mihailo#5902
Yes


[29-Oct-19 04:39 AM] siu#3920
i should be able to get at least 0.0004 out


[29-Oct-19 04:40 AM] siu#3920
``` ./komodo-cli -ac_name=KGOLDTEST pegsget  ee6089e938a46ef88702d364d3b352f0a263e3e25947d64dd0de9b22541f6f6b ec52db8f216735fecf8e86557405d21d05abd4e421b95ebae9ec51d5c0100214 0.0004
{
  "result": "error",
  "error": "not possible to take more than 80% of the deposit"
}
```


[29-Oct-19 04:40 AM] Mihailo#5902
So the price is not correct or something else is wrong


[29-Oct-19 04:40 AM] siu#3920
summoning @dimxy


[29-Oct-19 04:40 AM] Mihailo#5902
Give me chain params, I will sync and check the price


[29-Oct-19 04:41 AM] siu#3920
```XAU_USD 14881048```


[29-Oct-19 04:41 AM] siu#3920
`KMD_BTC 6109`


[29-Oct-19 04:41 AM] Mihailo#5902
Not that price


[29-Oct-19 04:42 AM] Mihailo#5902
I need to check synthetic for KMD token


[29-Oct-19 04:42 AM] Mihailo#5902
There is no rpc for that


[29-Oct-19 04:42 AM] siu#3920
oh


[29-Oct-19 04:42 AM] siu#3920
```./komodod -ac_name=KGOLDTEST -ac_cbopret=1 -ac_import=PEGSCC -ac_end=1 -ac_perc=0 -ac_cclib=prices -ac_cc=2 -ac_supply=100000000 -ac_reward=1000000000 -ac_blocktime=180  -ac_sapling=1 -pubkey=03bf270c42ec7df480a342779797673de5f10461e7479657b5effd18f98d040f9c -ac_feeds='[ {"name":"crypto", "url":"https://api.binance.com/api/v1/ticker/price?symbol=%sBTC", "substitutes":["KMD"], "quote":"BTC", "results":{"valuepath":"/price"}, "multiplier":100000000, "interval":120 },  {"name":"metals", "url":"https://forex-data-feed.swissquote.com/public-quotes/bboquotes/instrument/%s/USD", "substitutes":["XAU"], "quote":"USD", "results":{"averagevaluepaths":["/*/spreadProfilePrices/*/ask","/*/spreadProfilePrices/*/bid"] }, "multiplier":10000, "interval":120 } ]' -ac_earlytxid=ee6089e938a46ef88702d364d3b352f0a263e3e25947d64dd0de9b22541f6f6b -addnode=94.130.173.120 &
```


[29-Oct-19 04:42 AM] Mihailo#5902
And I need tu use dimxy repo, which branch?


[29-Oct-19 04:44 AM] Mihailo#5902
I suppose prices-gold-feed?


[29-Oct-19 04:44 AM] siu#3920
https://github.com/dimxy/komodo/tree/prices-gold-feed

{Embed}
https://github.com/dimxy/komodo/tree/prices-gold-feed
dimxy/komodo
Komodo. Contribute to dimxy/komodo development by creating an account on GitHub.
https://images-ext-2.discordapp.net/external/FG7_8N0jtCftKtsAk7K5U05eeO1dpQWPnEQ9A5NQLBI/%3Fs%3D400%26v%3D4/https/avatars0.githubusercontent.com/u/21120539


[29-Oct-19 04:44 AM] siu#3920
yes


[29-Oct-19 04:58 AM] Mihailo#5902
@dimxy I see that this branch is not uptodate with my pegsCC branch. Could you rebase, I'm not sure if I had some fixes regarding this in the meanwhile...


[29-Oct-19 05:00 AM] dimxy#2587
Yes i ll update rebase onto yours


[29-Oct-19 05:10 AM] dimxy#2587
I suggest also printing here tokeninfo and oracleinfo


[29-Oct-19 05:39 AM] siu#3920
ok


[29-Oct-19 05:40 AM] siu#3920
```./komodo-cli -ac_name=KGOLDTEST tokeninfo ec52db8f216735fecf8e86557405d21d05abd4e421b95ebae9ec51d5c0100214
{
  "result": "success",
  "tokenid": "ec52db8f216735fecf8e86557405d21d05abd4e421b95ebae9ec51d5c0100214",
  "owner": "03bf270c42ec7df480a342779797673de5f10461e7479657b5effd18f98d040f9c",
  "name": "KMD",
  "supply": 200000000,
  "description": "KMD_Equivalent_Token_for_Kgold"
}
```


[29-Oct-19 05:40 AM] siu#3920
```./komodo-cli -ac_name=KGOLDTEST oraclesinfo 7917a710508d7525e96cbc6323fffddc14630dbe5a9af5e28b548610d0015f18
{
  "result": "success",
  "txid": "7917a710508d7525e96cbc6323fffddc14630dbe5a9af5e28b548610d0015f18",
  "name": "KMD",
  "description": "KMD_Equivalent_Token_for_Kgold",
  "format": "Ihh",
  "marker": "RP9JudKVrGgF6WisEiWQGvG8VLjedzPezC",
  "registered": [
    {
      "publisher": "03bf270c42ec7df480a342779797673de5f10461e7479657b5effd18f98d040f9c",
      "baton": "RR5eMpy1ZCHyVyszdT5Djviyr7aPGqSaoQ",
      "batontxid": "40db531eca818158ed7c91025cfa861ca9efb9287dc235513f506f1aa332090a",
      "lifetime": "1044.00000000",
      "funds": "956.21000000",
      "datafee": "0.01000000"
    }
  ]
}
```


[29-Oct-19 05:42 AM] dimxy#2587
well the description is not what it is supposed to be: 
it should be the synthetic expression:


[29-Oct-19 05:43 AM] siu#3920
oh, i didnt know that detail.


[29-Oct-19 05:47 AM] Mihailo#5902
Yes, so there is the problem


[29-Oct-19 05:47 AM] Mihailo#5902
You must put synthetic for KMD/GOLD into description


[29-Oct-19 05:47 AM] Mihailo#5902
So you need completely new chain


[29-Oct-19 05:47 AM] dimxy#2587
"KMD_BTC,BTC_USD,XAU_USD,**/,1" should be


[29-Oct-19 05:47 AM] Mihailo#5902
Without " "


[29-Oct-19 05:47 AM] dimxy#2587
I'm sorry seems I did not mention it to you


[29-Oct-19 05:49 AM] dimxy#2587
it should be both in the token and oracle descriptions


[29-Oct-19 05:49 AM] Mihailo#5902
I think oracle description is not important. Or you changed something?


[29-Oct-19 05:50 AM] Mihailo#5902
You can write any text in oracle description...


[29-Oct-19 05:50 AM] SHossain#0007 (pinned)
@smkhound here are the details you were looking for very early morning. i forgot that i knew about this due to my sleepy head :abused_smiley: 

**> Import the Gateway deposit**
Usage: `importgatewaydeposit bindtxid height coin burntxid nvout rawburntx rawproof destpub amount`
Details:
```
bindtxid  = This is your importgateway identifier which is also known as "earlytxid"
height    = In which block your deposit was confirmed from the earlier step
coin      = Ticker of the coin you deposited
burntxid  = txid of your deposit
nvout     = The amount you sent/deposited
rawburntx = The HEX value from gettransaction call for the deposited txid (available at the end of output)
rawproof  = Use gettxoutproof with the deposit txid
destpub   = The pubkey you are running daemon with
amount    = the amount you sent/deposited
```


[29-Oct-19 05:50 AM] SHossain#0007
hope this helps


[29-Oct-19 05:51 AM] dimxy#2587
no, I did not change oracles, maybe I remember wrong about oracle


[29-Oct-19 05:51 AM] smkhound#7640
thanks you kindly 🙂


[29-Oct-19 05:51 AM] Mihailo#5902
name of token and oracle must be the same. Description is irrelevant


[29-Oct-19 05:52 AM] smkhound#7640
just doing a little work on atomic swap stats api for the stress test and will start updating tui later tonight

{Reactions}
👍 

[29-Oct-19 05:52 AM] SHossain#0007
i'm getting example inputs and outputs ready for this.


[29-Oct-19 05:52 AM] smkhound#7640
Pinned a message.


[29-Oct-19 05:53 AM] siu#3920
Complete new chain or complete new token?


[29-Oct-19 05:53 AM] siu#3920
ahh... no, complete new chain since i already did the pegs 🤦


[29-Oct-19 05:53 AM] Mihailo#5902
Yep


[29-Oct-19 05:54 AM] siu#3920
shite...


[29-Oct-19 05:54 AM] siu#3920
start over yey!


[29-Oct-19 05:54 AM] SHossain#0007
hehe...things are slightly confusing everywhere.... 😛


[29-Oct-19 05:54 AM] SHossain#0007
but, it will be ok once we have a single doc that can be updated as needed

{Reactions}
👍 

[29-Oct-19 05:55 AM] siu#3920
i dont read enough before acting, that is my bad.


[29-Oct-19 05:55 AM] Mihailo#5902
Yes, it needs to be all in one place so people don't need to search across diferent places/repos


[29-Oct-19 05:56 AM] siu#3920
so @dimxy can i keep using your repo or should i wait for some fix?


[29-Oct-19 05:56 AM] siu#3920
there is no fix needed so far, right?


[29-Oct-19 05:56 AM] Mihailo#5902
I think he will update the branch to latest pegs code


[29-Oct-19 05:56 AM] siu#3920
ok, will wait then.


[29-Oct-19 05:57 AM] dimxy#2587
I'm updating on Mihailo's pegCC


[29-Oct-19 05:57 AM] siu#3920
cool, ping me when done 🙂


[29-Oct-19 05:57 AM] dimxy#2587
I'll let you know


[29-Oct-19 05:57 AM] siu#3920
ok, so the synthetic is expressed once in token creation


[29-Oct-19 05:57 AM] siu#3920
which mean all coins will be pegged to that synthetic


[29-Oct-19 05:58 AM] siu#3920
no margin if not expressed before hand on chain creation.


[29-Oct-19 05:59 AM] Mihailo#5902
Yes. And for each token created it will peg to synthetic in description. You can have multiple tokens backing coin.


[29-Oct-19 06:01 AM] siu#3920
multiple tokens within the same chain?


[29-Oct-19 06:01 AM] siu#3920
how do i peg them to the pegs then?


[29-Oct-19 06:02 AM] Mihailo#5902
Well, you have one gateway per token and then you input all txids of gateways when doing pegscreate


[29-Oct-19 06:02 AM] Mihailo#5902
Ofc each gateway has its own oracle and token...


[29-Oct-19 06:02 AM] Mihailo#5902
But for now, work only with one!


[29-Oct-19 06:06 AM] siu#3920
yes, KISS


[29-Oct-19 06:22 AM] SHossain#0007
@Mihailo what to check for this error?
```
{
  "result": "error",
  "error": "burntxid didnt validate!"
}
```


[29-Oct-19 06:22 AM] SHossain#0007
https://kmdexplorer.io/tx/88a3d630f4454345b146a4d38f3684c4879ec1d82795fc75350767ad48ca36bd


[29-Oct-19 06:22 AM] Mihailo#5902
check debug.log or console


[29-Oct-19 06:22 AM] SHossain#0007
this is the burntxid


[29-Oct-19 06:23 AM] SHossain#0007
`claimaddr.RTQ7GDHsnHZ4njDbTjUnmm8GCkRhjifFES != destpubaddr.`


[29-Oct-19 06:24 AM] Mihailo#5902
give me claim command


[29-Oct-19 06:25 AM] Mihailo#5902
I think you have put address instead of pubkey in destpub parameter


[29-Oct-19 06:25 AM] SHossain#0007
oh...i know


[29-Oct-19 06:25 AM] Mihailo#5902
destpub, name tells for itself destination pubkey 😄


[29-Oct-19 06:25 AM] SHossain#0007
i had exact similar issue the other day


[29-Oct-19 06:25 AM] Mihailo#5902
Yes


[29-Oct-19 06:27 AM] SHossain#0007
it would be less confusing if you would change that to `destpubkey` 🙂


[29-Oct-19 06:28 AM] SHossain#0007
`pubkey` & `pubaddr` are kinda uniformed everywhere in the ecosystem


[29-Oct-19 06:28 AM] Mihailo#5902
I did as matter of fact, but did not push changes yet


[29-Oct-19 06:28 AM] SHossain#0007
and, i just forgot that part 😄


[29-Oct-19 06:29 AM] SHossain#0007
ah...nice


[29-Oct-19 06:29 AM] SHossain#0007
Thank you very much


[29-Oct-19 06:29 AM] Mihailo#5902
Pull latest code...


[29-Oct-19 06:33 AM] SHossain#0007
updating


[29-Oct-19 06:53 AM] SHossain#0007
perfect. it's updated. thanks


[29-Oct-19 07:02 AM] SHossain#0007 (pinned)
The first doc for importgateway testing (WIP) https://gist.github.com/himu007/5b61ebb330ee46c4c1f7518d34e30d42
@Paro i removed the ufw commands that you added as for test machine with test funds, it wouldn't be big risk. but, kept the swap file creation and usage part. please let me know if you really want the ufw part back in there, i'll add it.
Thanks to @Mihailo @dimxy @jl777c for all the hard work they put inside.

{Reactions}
👌 

[29-Oct-19 07:03 AM] SHossain#0007
if anyone find any missing/incorrect info, please let me know


[29-Oct-19 07:07 AM] SHossain#0007
@msig-signers if you like, you can test locally using the above guide.


[29-Oct-19 07:22 AM] SHossain#0007
@CHMEX would it be possible for you to provide an explorer for MBTCTEST please? the repo and build guide is in the above doc ^^


[29-Oct-19 07:28 AM] SHossain#0007
Pinned a message.


[29-Oct-19 07:52 AM] CHMEX#0686
@SHossain yes will do in a few hours


[29-Oct-19 07:52 AM] SHossain#0007
thank you very much. no rush.


[29-Oct-19 07:53 AM] SHossain#0007
this is only temporary for testing


[29-Oct-19 09:05 AM] SHossain#0007
```
./komodo-cli -ac_name=MBTCTEST importgatewayaddress 03e732c82d87e1ee47071f3900a79a7507b93321f5bddbb4236c10b6ca4f27e0a2
{
  "result": "success",
  "ImportGatewayCCAddress": "RXJT6CRAXHFuQ2UjqdxMj7EfrayF6UJpzZ",
  "ImportGatewayCCBalance": 0.00010000,
  "ImportGatewayNormalAddress": "RNFRho63Ddz1Rh2eGPETykrU4fA8r67S4Y",
  "ImportGatewayNormalBalance": 0.00000000,
  "ImportGatewayCCTokensAddress": "RAczoarH6zfAzcsY2dX6xuCm6tEU2K6tVK",
  "PubkeyCCaddress(ImportGateway)": "RExKVF4RTyqPMo7tfo3Zhcfak5Kr9su5Tc",
  "PubkeyCCbalance(ImportGateway)": 0.00000000,
  "myCCAddress(ImportGateway)": "RExKVF4RTyqPMo7tfo3Zhcfak5Kr9su5Tc",
  "myCCbalance(ImportGateway)": 0.00000000,
  "myaddress": "RTQ7GDHsnHZ4njDbTjUnmm8GCkRhjifFES",
  "mybalance": 0.00130000
}
```


[29-Oct-19 09:05 AM] SHossain#0007
```
./komodo-cli -ac_name=MBTCTEST importgatewayaddress RTQ7GDHsnHZ4njDbTjUnmm8GCkRhjifFES
{
  "result": "success",
  "ImportGatewayCCAddress": "RXJT6CRAXHFuQ2UjqdxMj7EfrayF6UJpzZ",
  "ImportGatewayCCBalance": 0.00010000,
  "ImportGatewayNormalAddress": "RNFRho63Ddz1Rh2eGPETykrU4fA8r67S4Y",
  "ImportGatewayNormalBalance": 0.00000000,
  "ImportGatewayCCTokensAddress": "RAczoarH6zfAzcsY2dX6xuCm6tEU2K6tVK",
  "myCCAddress(ImportGateway)": "RExKVF4RTyqPMo7tfo3Zhcfak5Kr9su5Tc",
  "myCCbalance(ImportGateway)": 0.00000000,
  "myaddress": "RTQ7GDHsnHZ4njDbTjUnmm8GCkRhjifFES",
  "mybalance": 0.00130000
}
```


[29-Oct-19 09:05 AM] SHossain#0007
same call with pubkey and R addr


[29-Oct-19 09:36 AM] mrlynch#5735
i'll spin up a node tonight. will pester you with questions 😛


[29-Oct-19 09:44 AM] SHossain#0007
no worries 🙂


[29-Oct-19 09:44 AM] SHossain#0007
we are still testing basic functionalities


[29-Oct-19 09:44 AM] SHossain#0007
we need to try breaking it


[29-Oct-19 10:54 AM] SHossain#0007
```
./komodo-cli -ac_name=MBTCTEST importgatewaypendingwithdraws fec28fa1840bfddc532ca8fd4fbd9cfc9d927514ed988d95d5759675736739bc KMD
{
  "coin": "KMD",
  "pending": [
  ],
  "queueflag": 0
}
```


[29-Oct-19 10:54 AM] SHossain#0007
no pending withdraws pending currently


[29-Oct-19 10:57 AM] SHossain#0007
```
./komodo-cli -ac_name=MBTCTEST importgatewaypendingwithdraws fec28fa1840bfddc532ca8fd4fbd9cfc9d927514ed988d95d5759675736739bc LTC
```
this command doesn't return anything. wouldn't it be good to display something like `Invalid coin.` or `Coin is not on list.` or `Not a valid coin ticker. Please try again with the right ticker.`


[29-Oct-19 11:00 AM] SHossain#0007
Also, if I use any invalid `bindtxid` it doesn't return any error or warning. Just does nothing.


[29-Oct-19 11:00 AM] SHossain#0007
Empty reply


[29-Oct-19 11:53 AM] SHossain#0007
Tried to withdraw more funds than i deposited :abused_smiley: 
```
./komodo-cli -ac_name=MBTCTEST importgatewaywithdraw fec28fa1840bfddc532ca8fd4fbd9cfc9d927514ed988d95d5759675736739bc KMD RWzux9j8EhYb85E7xoH18BcP1fRyDPYWYL 0.00154644
{
  "result": "error",
  "error": "cant find enough normal inputs"
}
```


[29-Oct-19 11:54 AM] SHossain#0007
But, if I do the exact same amount I deposited, it works
```
./komodo-cli -ac_name=MBTCTEST importgatewaywithdraw fec28fa1840bfddc532ca8fd4fbd9cfc9d927514ed988d95d5759675736739bc KMD RWzux9j8EhYb85E7xoH18BcP1fRyDPYWYL 0.001
{
  "result": "success",
  "hex": "0400008085202f8901e4051a91fb0b06ff1e8cfd6b0fc315464a45ee9e0fed4e99e129b2b6c28ce0f2000000006b483045022100efe6b148174bc036850a6b2cddb584a87fab3b5e2091601c37626ae790f6745b0220788afa697a66f2c25c134e87ec353702d9f4457575b58dc1c4607397d16e20cf012103e732c82d87e1ee47071f3900a79a7507b93321f5bddbb4236c10b6ca4f27e0a2ffffffff041027000000000000302ea22c802023fdb7aec87075c24597e7d04613e9ee31f5ed9bf1a799de3c42a2e9a11c28f58103120c008203000401cca086010000000000232102bc396773759675d5958d98ed1475929dfc9cbd4ffda82c53dcfd0b84a18fc2feac5487000000000000232103e732c82d87e1ee47071f3900a79a7507b93321f5bddbb4236c10b6ca4f27e0a2ac0000000000000000546a4c51f357bc396773759675d5958d98ed1475929dfc9cbd4ffda82c53dcfd0b84a18fc2fe2103e732c82d87e1ee47071f3900a79a7507b93321f5bddbb4236c10b6ca4f27e0a2034b4d4400a08601000000000000000000b81900000000000000000000000000"
}
```


[29-Oct-19 11:56 AM] SHossain#0007
```
./komodo-cli -ac_name=MBTCTEST sendrawtransaction 0400008085202f8901e4051a91fb0b06ff1e8cfd6b0fc315464a45ee9e0fed4e99e129b2b6c28ce0f2000000006b483045022100efe6b148174bc036850a6b2cddb584a87fab3b5e2091601c37626ae790f6745b0220788afa697a66f2c25c134e87ec353702d9f4457575b58dc1c4607397d16e20cf012103e732c82d87e1ee47071f3900a79a7507b93321f5bddbb4236c10b6ca4f27e0a2ffffffff041027000000000000302ea22c802023fdb7aec87075c24597e7d04613e9ee31f5ed9bf1a799de3c42a2e9a11c28f58103120c008203000401cca086010000000000232102bc396773759675d5958d98ed1475929dfc9cbd4ffda82c53dcfd0b84a18fc2feac5487000000000000232103e732c82d87e1ee47071f3900a79a7507b93321f5bddbb4236c10b6ca4f27e0a2ac0000000000000000546a4c51f357bc396773759675d5958d98ed1475929dfc9cbd4ffda82c53dcfd0b84a18fc2fe2103e732c82d87e1ee47071f3900a79a7507b93321f5bddbb4236c10b6ca4f27e0a2034b4d4400a08601000000000000000000b81900000000000000000000000000
dd691b85e26ff976d7107b0fd63bf1d20e03d665aede34c9ab4a1941a689d0ee
```


[29-Oct-19 11:59 AM] SHossain#0007
I'm assuming next step is to use this call `importgatewaycompletesigning withdrawtxid coin hex`


[29-Oct-19 11:59 AM] SHossain#0007
but, this didn't work


[29-Oct-19 11:59 AM] SHossain#0007
```
error code: -26
error message:
16: mandatory-script-verify-flag-failed (Script evaluated without error but finished with a false/empty top stack element)
```


[29-Oct-19 12:01 PM] SHossain#0007
@Mihailo please let me know which calls are needed to withdraw funds from importgateway.


[29-Oct-19 12:52 PM] SHossain#0007
Once i get the withdraw completed, i can update the gist


[29-Oct-19 12:53 PM] Mihailo#5902
@SHossain, you just need to create withdraw tx, then oraclefeed do the rest


[29-Oct-19 12:53 PM] Mihailo#5902
And you should get the funds to pubkey you set in withdraw, on your external chain address


[29-Oct-19 12:53 PM] SHossain#0007
`importgatewaywithdraw` completed. i have the txid `dd691b85e26ff976d7107b0fd63bf1d20e03d665aede34c9ab4a1941a689d0ee`


[29-Oct-19 12:54 PM] SHossain#0007
so, maybe i have to wait 100 blocks


[29-Oct-19 12:54 PM] Mihailo#5902
So check in next few blockc on MBTCTEST if you got it on KMD.


[29-Oct-19 12:54 PM] Mihailo#5902
No, you need to wait few blocks for signing and actual withdraw.


[29-Oct-19 12:55 PM] Mihailo#5902
But it is little bit more complicated as oraclefeed will execute withdraws only when posting KMD block data to oracle so if it is waiting a new block on kmd nothing will happen until new block comes.


[29-Oct-19 12:56 PM] Mihailo#5902
I wanted to decouple this but never got to do it...


[29-Oct-19 01:06 PM] SHossain#0007
the 0.001 KMD didn't arrive at dest KMD addr


[29-Oct-19 01:51 PM] Mihailo#5902
I'll have to check the logs...

{Reactions}
👍 

[29-Oct-19 01:53 PM] Mihailo#5902
Hmm, I have some errors in the log, will check it out in the morning.


[29-Oct-19 01:56 PM] SHossain#0007
hope that is a small bug


[29-Oct-19 04:05 PM] SHossain#0007 (pinned)
MBTCTEST explorer is up by CHMEX https://mbtctest.explorer.dexstats.info/

{Embed}
https://mbtctest.explorer.dexstats.info/
Komodo Explorer
Komodo Insight. View detailed information on all komodo transactions and block. {{ $root.title + $root.titleDetail }}

{Reactions}
👌 👍 

[29-Oct-19 04:05 PM] SHossain#0007
Pinned a message.


[30-Oct-19 01:31 AM] tolken#2655
Where does liquidity come from in this system? In the scenario where one deposits 100 usd worth of Kmd, withdrawing 80 kUSD, is AtomicDEX initially the only place to trade it for other assets, or will there be a way to redeem the kUSD for Komodo through/from the peg reserves?


[30-Oct-19 01:40 AM] jl777c#5810
you can redeem the USDk at anytime via the blockchain


[30-Oct-19 01:41 AM] jl777c#5810
the liquidity is created in a decentralized way. anybody can decide to create new stablecoins


[30-Oct-19 01:41 AM] jl777c#5810
of course, you can just buy it via atomicDEX, also working on getting a fiat conversion for the USDk, but that is full of external issues.


[30-Oct-19 01:42 AM] jl777c#5810
since the USDk is fully backed by KMD in the reserves, we expect it to trade very close to $1. Certainly short term supply/demand imbalances can change the price a bit. in fact, this is what i expect will motivate people to create new stablecoins, the fact that it is trading at a slight premium that can then be arbitraged


[30-Oct-19 01:43 AM] jl777c#5810
there is no central bank


[30-Oct-19 01:43 AM] jl777c#5810
in a way, it is a decentralized central banking function of creating new stablecoins


[30-Oct-19 01:44 AM] jl777c#5810
and the supply is removed in a way that is also decentralized, i envision it like mining where at risk accounts are liquidated for profit by the liquidators. to do this they will need a supply of stablecoins


[30-Oct-19 01:47 AM] jl777c#5810
also, to avoid being liquidated, users would have a demand for KMD and the stablecoin to move their account away from the at risk border. to allow redeems at anytime, accounts that are not above the 90% can be used as the source. but in this case they wont lose any equity as it is done at the current price. it might be a bit confusing when the details of the account changes from this external redeem, so we will need a good GUI for it.


[30-Oct-19 01:48 AM] jl777c#5810
it will be very interesting to see how USDk trades in the open market

{Reactions}
👍 (2) 

[30-Oct-19 02:46 AM] Mihailo#5902
@SHossain It seems that you either supplied wrong destination pubkey or something else is wrong...


[30-Oct-19 02:48 AM] Mihailo#5902
This is what I get for pubkey when I decode opret in withdraw tx: `ff0000000000000000000000000000000000000000000000000000000000000000`


[30-Oct-19 02:49 AM] Mihailo#5902
I should add to validation check of the pubkey, if it is not valid then it should reject tx.


[30-Oct-19 02:53 AM] Mihailo#5902
Ok, I found what may cause wrong pubkey...


[30-Oct-19 04:17 AM] Mihailo#5902
@SHossain I may need to invalidate a block where your withdraw tx is, and continue a new chain from there....


[30-Oct-19 04:17 AM] jl777c#5810
ok


[30-Oct-19 04:19 AM] SHossain#0007
Sure. No worries


[30-Oct-19 04:41 AM] SHossain#0007
@Mihailo i used the R address to withdraw the deposit. `RWzux9j8EhYb85E7xoH18BcP1fRyDPYWYL` this is the address it was originated from


[30-Oct-19 04:47 AM] Mihailo#5902
Again, you need to use pubkey!

{Reactions}
👍 

[30-Oct-19 04:54 AM] SHossain#0007
please update `withdrawpub` to `withdrawpubkey` 🙂


[30-Oct-19 04:55 AM] Mihailo#5902
Ok, I did now. But I don't know how pub does not associate to pubkey ...


[30-Oct-19 04:57 AM] SHossain#0007
sorry, call me a noob on that


[30-Oct-19 04:57 AM] Oszy#5734
could mean public address 😄

{Reactions}
👆 

[30-Oct-19 04:57 AM] SHossain#0007
there is pubaddr and pubkey


[30-Oct-19 04:59 AM] jl777c#5810
we just need some better error checking


[30-Oct-19 04:59 AM] Mihailo#5902
Ok, np. I changed it!


[30-Oct-19 04:59 AM] Mihailo#5902
And I've added error checking


[30-Oct-19 04:59 AM] jl777c#5810
dont allow addresses to be used if a pubkey is needed


[30-Oct-19 05:00 AM] Mihailo#5902
I'm checking if pubkey IsFullyValid(). Hope that is enough check.


[30-Oct-19 05:00 AM] SHossain#0007
aha, yes, that also is a good idea


[30-Oct-19 05:00 AM] Mihailo#5902
Ok, I split the chain from that problematic block


[30-Oct-19 05:00 AM] Mihailo#5902
Please do `komodo-cli -ac_name=MBTCTEST invalidateblock "015eaca0a937db368f70d9d00938a2e69aba3e5bc891f3b9f1d2d716d06babc1"` and sync again


[30-Oct-19 05:01 AM] SHossain#0007
doing it now


[30-Oct-19 05:02 AM] Mihailo#5902
@SHossain Wait


[30-Oct-19 05:06 AM] SHossain#0007
ok


[30-Oct-19 05:06 AM] SHossain#0007
used it already and got this
```
error code: -5
error message:
Block not found
```


[30-Oct-19 05:07 AM] Mihailo#5902
Ok, go ahaed now


[30-Oct-19 05:07 AM] Mihailo#5902
and different block needs to be invalidated


[30-Oct-19 05:07 AM] Mihailo#5902
`komodo-cli -ac_name=MBTCTEST invalidateblock "009973d4909853646111e1bc441619a9c9d8a32471de21f18f8563a355119211"`


[30-Oct-19 05:08 AM] SHossain#0007
this one seems to have done few things
```
UpdateTip: new best=00c26b827e142a07981700979e25b4f27ea6fba3123dea0f9730fbd2e7b2619c  height=6379  log2_work=20.832078  log2_stake=-inf  tx=18944  date=2019-10-29 18:51:33 progress=1.000000  cache=0.1MiB(515tx)
InvalidChainFound: invalid block=009973d4909853646111e1bc441619a9c9d8a32471de21f18f8563a355119211  height=6380  log2_work=20.832215  log2_stake=-inf  date=2019-10-29 18:52:08
InvalidChainFound:  current best=00c26b827e142a07981700979e25b4f27ea6fba3123dea0f9730fbd2e7b2619c  height=6379  log2_work=20.832078  log2_stake=-inf  date=2019-10-29 18:51:33
AddToWallet dd691b85e26ff976d7107b0fd63bf1d20e03d665aede34c9ab4a1941a689d0ee
```


[30-Oct-19 05:08 AM] SHossain#0007
latest showing this


[30-Oct-19 05:08 AM] Mihailo#5902
Now restart daemon


[30-Oct-19 05:08 AM] Mihailo#5902
And it will sync with current chain


[30-Oct-19 05:08 AM] Mihailo#5902
And, pull latest code


[30-Oct-19 05:08 AM] SHossain#0007
👍


[30-Oct-19 05:09 AM] Mihailo#5902
Just a sec


[30-Oct-19 05:09 AM] Mihailo#5902
Pull now


[30-Oct-19 05:12 AM] Mihailo#5902
You must delete the branch and checkout again as I rebased it and force pushed


[30-Oct-19 05:12 AM] SHossain#0007
ok.


[30-Oct-19 05:13 AM] SHossain#0007
already updated and restarted chain, if this doesn't work, i'll do fresh clone


[30-Oct-19 05:13 AM] Mihailo#5902
You didn't get merge conflicts when pulling?


[30-Oct-19 05:15 AM] SHossain#0007
nope


[30-Oct-19 05:15 AM] Mihailo#5902
Hmmm, strange


[30-Oct-19 05:15 AM] SHossain#0007
```
git pull
remote: Enumerating objects: 9, done.
remote: Counting objects: 100% (9/9), done.
remote: Total 9 (delta 8), reused 9 (delta 8), pack-reused 0
Unpacking objects: 100% (9/9), done.
From https://github.com/Mixa84/komodo
   074047141..7ad985ac2  importgateway -> origin/importgateway
Updating 074047141..7ad985ac2
Fast-forward
 src/cc/gateways.cpp      | 24 +++++++++++++++++++-----
 src/cc/import.cpp        |  5 +++++
 src/cc/importgateway.cpp | 24 +++++++++++++++++++-----
 src/rpc/crosschain.cpp   |  2 +-
 4 files changed, 44 insertions(+), 11 deletions(-)
```


[30-Oct-19 05:15 AM] SHossain#0007
i got the conflict yesterday i believe


[30-Oct-19 05:15 AM] SHossain#0007
i had to delete and use fresh clone


[30-Oct-19 05:15 AM] Mihailo#5902
Ah, that is it.


[30-Oct-19 05:16 AM] Mihailo#5902
I haven't updated nodes few days


[30-Oct-19 05:17 AM] SHossain#0007
explorer will have wrong data now. @CHMEX please pull latest update, nuke data dir and start the explorer again please 🙂


[30-Oct-19 05:18 AM] SHossain#0007
@Mihailo my balance is back. i'll process withdraw now


[30-Oct-19 05:19 AM] Mihailo#5902
Wait


[30-Oct-19 05:20 AM] Mihailo#5902
It is not all done, just the nodes are reseted


[30-Oct-19 05:20 AM] Mihailo#5902
I have to start oraclefeed


[30-Oct-19 05:20 AM] SHossain#0007
i didn't start the process yet 🙂


[30-Oct-19 05:20 AM] SHossain#0007
just starting KMD to get the pubkey of that withdraw address


[30-Oct-19 05:22 AM] SHossain#0007
will wait for your GO signal


[30-Oct-19 05:22 AM] Mihailo#5902
Hmm, I can't reach one of my nodes. Just did a reboot


[30-Oct-19 05:41 AM] CHMEX#0686
Compiled and resyncing


[30-Oct-19 05:42 AM] SHossain#0007
Thanks @CHMEX


[30-Oct-19 05:55 AM] SHossain#0007
explorer is back on right height


[30-Oct-19 06:16 AM] Mihailo#5902
@SHossain I have brought both nodes with oraclefeed back.


[30-Oct-19 06:16 AM] Mihailo#5902
You can try to withdraw, I hope it will work.


[30-Oct-19 06:16 AM] Mihailo#5902
Just hoping there will not be another problem where I will need to gork the chain.


[30-Oct-19 06:17 AM] SHossain#0007
processing now


[30-Oct-19 06:20 AM] SHossain#0007
```
./komodo-cli -ac_name=MBTCTEST importgatewaywithdraw fec28fa1840bfddc532ca8fd4fbd9cfc9d927514ed988d95d5759675736739bc KMD 029782fe2477bf26ab7a443d2349df3cd0af2bc07acff0256c43fb563b67e706e1 0.001
{
  "result": "success",
  "hex": "0400008085202f8901e4051a91fb0b06ff1e8cfd6b0fc315464a45ee9e0fed4e99e129b2b6c28ce0f2000000006b483045022100a6ccfbcebd45e3b9bb6f9b9dad8afc31883cfe3f317f5e46d91020f01b213d1d0220266dbbc937fd8d7936d148a946d2441868c3898fbb7236299681dd8486f8850a012103e732c82d87e1ee47071f3900a79a7507b93321f5bddbb4236c10b6ca4f27e0a2ffffffff041027000000000000302ea22c802023fdb7aec87075c24597e7d04613e9ee31f5ed9bf1a799de3c42a2e9a11c28f58103120c008203000401cca086010000000000232102bc396773759675d5958d98ed1475929dfc9cbd4ffda82c53dcfd0b84a18fc2feac5487000000000000232103e732c82d87e1ee47071f3900a79a7507b93321f5bddbb4236c10b6ca4f27e0a2ac0000000000000000756a4c72f357bc396773759675d5958d98ed1475929dfc9cbd4ffda82c53dcfd0b84a18fc2fe2103e732c82d87e1ee47071f3900a79a7507b93321f5bddbb4236c10b6ca4f27e0a2034b4d4421029782fe2477bf26ab7a443d2349df3cd0af2bc07acff0256c43fb563b67e706e1a086010000000000000000000d1a00000000000000000000000000"
}
```


[30-Oct-19 06:20 AM] SHossain#0007
`sendrawtransaction` with this HEX gave me `1df91cb9a1a40e64ce7accf5712b1c5f772b891d1abf8b01f8d706e19bf097cb`


[30-Oct-19 06:21 AM] SHossain#0007
https://mbtctest.explorer.dexstats.info/tx/1df91cb9a1a40e64ce7accf5712b1c5f772b891d1abf8b01f8d706e19bf097cb


[30-Oct-19 06:36 AM] SHossain#0007
Woot! Woot! my funds returned https://kmdexplorer.io/tx/04495bd3a5254e11f4c0a8d10f82be2465493566a89027dc4a45c74c97329bc3


[30-Oct-19 06:37 AM] SHossain#0007
but, i withdrew `0.001` and got back `0.0008`


[30-Oct-19 06:38 AM] SHossain#0007
0.0002 used for txfee on 2 places? 2x 0.0001


[30-Oct-19 06:56 AM] jl777c#5810
it would be good to use lowest txfees for withdraws, maybe 0.00001 if zero txfee wont be reliable


[30-Oct-19 06:57 AM] jl777c#5810
i know we use 0.0001 for txfee in most all places, but if doing BTC or even GOLD, 0.0001 is on the expensive side


[30-Oct-19 07:20 AM] SHossain#0007
yes, lower txfee for BTC and GOLD would be awesome


[30-Oct-19 07:21 AM] jl777c#5810
i think txfee of 1000 sats should just work, for now that makes it not so bad, and 10 cents per transaction is not cheap, but would get decent hashrate on the chain


[30-Oct-19 07:22 AM] jl777c#5810
we might want to change the mintxfee (whereever it is in the code) to 100 sats for the high value coins


[30-Oct-19 07:22 AM] SHossain#0007
generally on all smart chains i use 0 txfee...even some txs of KMD i use 0 fee


[30-Oct-19 07:22 AM] SHossain#0007
and, it works perfectly


[30-Oct-19 07:22 AM] SHossain#0007
on KMD with 0 fee it might take some extra time to get confirmation


[30-Oct-19 07:23 AM] SHossain#0007
few script from Decker and few LABS script has this 0 fee thing


[30-Oct-19 07:24 AM] jl777c#5810
oh, i guess you can verify this with settxfee


[30-Oct-19 07:24 AM] jl777c#5810
but not sure that is used by the CC rpc


[30-Oct-19 07:25 AM] jl777c#5810
pretty sure it isnt, but we do need to solve the $1 txfee issue before spinning up even a BTC test chain as that can get expensive very fast


[30-Oct-19 07:26 AM] SHossain#0007
i'll test with txfee 1000 sats soon on KMD and MBTCTEST chain. need to get some groceries first 🙂


[30-Oct-19 07:26 AM] SHossain#0007
after few more successful deposits and withdrawals i'll try to use invalid parameters/data


[30-Oct-19 07:27 AM] SHossain#0007
it is good that both deposit and withdraw are working now


[30-Oct-19 07:27 AM] SHossain#0007
i'll also update the gist guide with withdrawal steps


[30-Oct-19 07:39 AM] Mihailo#5902
CC rpc have fixed txfee in the code of 10k sat


[30-Oct-19 07:40 AM] Mihailo#5902
We could make it per CC contract to define txfee


[30-Oct-19 07:47 AM] jl777c#5810
ok, however we can solve it is good


[30-Oct-19 08:00 AM] Mihailo#5902
@jl777c Is there some limitation in code for txfee amount? Like if you set below some amount it will get lower priority?


[30-Oct-19 08:03 AM] jl777c#5810
i think somewhere there is a 1000 sats minimum where if it isnt there, it is very low priority, but not sure. maybe you can look into that a bit

{Reactions}
👍 

[30-Oct-19 08:03 AM] jl777c#5810
the miner can mine whatever txfee it wants to, so maybe any txfee is fine from a consensus standpoint and we just need to tweak the miner


[30-Oct-19 09:26 AM] tolken#2655
Thanks for the explanation re: redeeming kUSD, this truly is the most awesome crypto lending system I’ve heard of.


[30-Oct-19 09:27 AM] tolken#2655
AtomicDex market makers could do some nice automated kUSD to USDc trades move back to fiat relatively easy.


[30-Oct-19 09:31 AM] tolken#2655
considering Salt, Nexo Lending at BEST offer 6% loans (with less favorable terms), trading 5% Kmd for a loan is a no brainer.


[31-Oct-19 04:07 AM] Mihailo#5902
@jl777c As we also have markers in CCs, and that does affect something like txfee affects mining, I suppose we can lower the value of the marker even below 1k sats. Maybe put it 1 sat? 😛


[31-Oct-19 07:01 AM] jl777c#5810
for markers that wont be spent, maybe that is good, for markers that need to be spent, it is a very small utxo. but optimizing this area is important when each coin is $10000


[01-Nov-19 03:24 AM] Mihailo#5902
On MBTC chain (importgateway), there are no markers that won't be spent I think (gateways have those markes on gatewaysdeposit, and importgatewaydeposit have tombstone). There are also markers that will be spent and put back to users address (example signers that sign txs will get marker value when they do markdone tx).


[01-Nov-19 04:43 AM] Mihailo#5902
@jl777c It would be good to lower the fees of oracles too (to 1000sats), as if someone else takes to mine the chain he will get the txfees of oracles transactions. On a chain with big coins like BTC 10k sats can be noticable.


[01-Nov-19 04:46 AM] Mihailo#5902
Also is there a way we can set default txfee for regular txs. I think 5k sat is regular when using sendtoaddress.


[01-Nov-19 04:59 AM] Mihailo#5902
I see that 5k is hardcoded in sendtoaddress:
```cpp
                CAmount nFeeNeeded = GetMinimumFee(nBytes, nTxConfirmTarget, mempool);
                if ( nFeeNeeded < 5000 )
                    nFeeNeeded = 5000;```
By current BTC price, one tx would be ~0.5$


[01-Nov-19 05:32 AM] Mihailo#5902
@SHossain Are there any noticable issues on MBTC or USDK?


[01-Nov-19 05:39 AM] SHossain#0007
no other issues observed


[01-Nov-19 05:39 AM] SHossain#0007
is your `txfeetest` branch ready for testing?


[01-Nov-19 06:08 AM] Mihailo#5902
Not yet, I need to modify oracles and bring up test chain with 2 nodes and setup everything to see if it works.


[01-Nov-19 06:10 AM] Mihailo#5902
@SHossain try to abuse MBTCTEST little bit. I'm sure there should be some sanity checks for input data, like we had a problem with pubkey and address. So try to see which parameters can be modifed and the tx passes.
The biggest problem I see could be on withdraw side, as we made it to be sequential (1 withdraw at a time), so if some withdraw is blocked it will stall everything.


[01-Nov-19 06:16 AM] SHossain#0007
sure. i'm on it


[01-Nov-19 06:16 AM] SHossain#0007
if i find inconsistencies or if something doesn't make sense, i'll post 🙂


[01-Nov-19 06:39 AM] Mihailo#5902
Great


[01-Nov-19 07:04 AM] jl777c#5810
@Mihailo i think most of the txfee changes are not-consensus related, but you need to be careful when changing it. i have not looked into all the details, for oracles, gateways and other areas where cost matters, we should use the lowest txfee that is possible, whatever that is


[01-Nov-19 07:04 AM] Mihailo#5902
Understand.


[01-Nov-19 07:05 AM] Mihailo#5902
Just one more question. Do we want to make a ac parameter to set txfee for all CC modules for example?


[01-Nov-19 07:20 AM] jl777c#5810
probably not. just tune the txfee as low as we can across the board


[01-Nov-19 07:31 AM] SHossain#0007
error check for oracles seems to be in place and working
```
{
  "result": "error",
  "error": "couldnt find merkleroot for ht.1599649 KMD oracle.cd756825b0095b30fa0a8fbed2e94e710a4fed9ad4937762e80986fb6a2f574e m.0 vs n.2"
}
```


[01-Nov-19 07:32 AM] SHossain#0007
when the block height is not passed, importgatewaydeposit wouldn't work and throw that error. it works fine as soon as oracle validation is done


[01-Nov-19 07:38 AM] SHossain#0007
@Mihailo is this call supposed to list all history of processed txs?
```
./komodo-cli -ac_name=MBTCTEST importgatewayprocessed fec28fa1840bfddc532ca8fd4fbd9cfc9d927514ed988d95d5759675736739bc KMD
```
i'm getting only this
```
{
  "coin": "KMD",
  "processed": [
  ],
  "queueflag": 0
}
```


[01-Nov-19 07:41 AM] Mihailo#5902
No, just the ones tha has been signed but not executed on external chain yet


[01-Nov-19 07:45 AM] SHossain#0007
i see. thanks


[01-Nov-19 07:46 AM] SHossain#0007
did you put the validation for withdraw on pubkey or pubaddr?


[01-Nov-19 07:46 AM] SHossain#0007
i don't want another reorg :abused:


[01-Nov-19 11:01 AM] Mihailo#5902
walidation is to have a pubkey, so if you put addr it shouldn't validate, even rpc won't allow it


[01-Nov-19 11:03 AM] SHossain#0007
cool. let me test this. didn't want to put address in there just in case


[01-Nov-19 11:08 AM] Mihailo#5902
See if rpc gives you error, if not then let me know


[01-Nov-19 11:09 AM] SHossain#0007
```
./komodo-cli -ac_name=MBTCTEST importgatewaywithdraw fec28fa1840bfddc532ca8fd4fbd9cfc9d927514ed988d95d5759675736739bc KMD RWzux9j8EhYb85E7xoH18BcP1fRyDPYWYL 0.01
{
  "result": "error",
  "error": "withdraw destination pubkey is invalid"
}
```

{Reactions}
👍 

[01-Nov-19 11:09 AM] SHossain#0007
perfect. now, we can't do mistake


[01-Nov-19 11:24 AM] SHossain#0007
tried to withdraw more than what i deposited
```
./komodo-cli -ac_name=MBTCTEST importgatewaywithdraw fec28fa1840bfddc532ca8fd4fbd9cfc9d927514ed988d95d5759675736739bc KMD 027ad67d9b0d3afac9670ce51a5cdce781b9215946ea8a0f0acb027edc2008f739 0.015
{
  "result": "error",
  "error": "cant find enough normal inputs"
}
```


[01-Nov-19 11:24 AM] SHossain#0007
also throws error if i use txid as withdraw addr 😛


[01-Nov-19 11:25 AM] Mihailo#5902
Would be cool to deposit to two different addresses, and then send total amount to single address and try withdraw all that you have


[01-Nov-19 11:28 AM] jl777c#5810
please come up with more test scenarios like this, so we can be sure it is 100% solid


[01-Nov-19 11:28 AM] jl777c#5810
@SHossain plz document the list of tests so we dont forget, in some single place for description of tests, i guess link to the pegs wiki

{Reactions}
👍 

[01-Nov-19 11:30 AM] SHossain#0007
i had other addresses with mined funds. i combined them together on the address that i'm running the MBTCTEST daemon with. couldn't withdraw mined funds


[01-Nov-19 11:30 AM] SHossain#0007
i was only allowed to withdraw which i ONLY deposited


[01-Nov-19 11:30 AM] Mihailo#5902
That's what I thought now


[01-Nov-19 11:31 AM] Mihailo#5902
But I think there is no check of how much funds is on the deposit address. So it could be we could make a withdraw which would not be able to process.


[01-Nov-19 11:33 AM] SHossain#0007
will do this one now `deposit to two different addresses, and then send total amount to single address and try withdraw all that you have`


[01-Nov-19 11:35 AM] Mihailo#5902
👍


[01-Nov-19 11:54 AM] SHossain#0007
the previous withdraw tx hasn't been deposited yet into my KMD wallet. has 20 confs https://mbtctest.explorer.dexstats.info/tx/663de8b1d7816534a54dce61abcf2a34f8f6e1c353eff652f3a224986c5e6f04


[01-Nov-19 11:54 AM] SHossain#0007
might take some more time. just reporting in


[01-Nov-19 12:10 PM] Mihailo#5902
Ahh, one of my signing nodes is unreachable


[01-Nov-19 12:11 PM] Mihailo#5902
It is my local server at the office. It is late here and I can't go now to the office. I'll reboot it tomorrow morning.


[01-Nov-19 12:12 PM] Mihailo#5902
I see that one node signed the withdraw!


[01-Nov-19 12:27 PM] SHossain#0007
cool. no worries


[01-Nov-19 12:51 PM] SHossain#0007
i've added few list of test cases here https://gist.github.com/himu007/5b61ebb330ee46c4c1f7518d34e30d42#test-cases


[01-Nov-19 01:16 PM] SHossain#0007
once i get more cases, i can add them and can create a separate section if needed


[01-Nov-19 01:18 PM] SHossain#0007
i've done 2 deposits of 0.01 KMD
```
./komodo-cli -ac_name=MBTCTEST getbalance
0.02014644
```
the pubkey that the daemon launched with see only 1 deposit which is normal. will transfer all balance to this one and try to withdraw 0.02 KMD
```
./komodo-cli -ac_name=MBTCTEST importgatewayaddress
{
  "result": "success",
  "ImportGatewayCCAddress": "RXJT6CRAXHFuQ2UjqdxMj7EfrayF6UJpzZ",
  "ImportGatewayCCBalance": 0.00020000,
  "ImportGatewayNormalAddress": "RNFRho63Ddz1Rh2eGPETykrU4fA8r67S4Y",
  "ImportGatewayNormalBalance": 0.00000000,
  "ImportGatewayCCTokensAddress": "RAczoarH6zfAzcsY2dX6xuCm6tEU2K6tVK",
  "myCCAddress(ImportGateway)": "RExKVF4RTyqPMo7tfo3Zhcfak5Kr9su5Tc",
  "myCCbalance(ImportGateway)": 0.00000000,
  "myaddress": "RTQ7GDHsnHZ4njDbTjUnmm8GCkRhjifFES",
  "mybalance": 0.01014644
}
```


[01-Nov-19 01:21 PM] SHossain#0007
combining done


[01-Nov-19 01:21 PM] SHossain#0007
https://mbtctest.explorer.dexstats.info/tx/2f3bdfb0dc4f517f23995e1321a6becd0348402b32761d6131dc930de0e10132


[01-Nov-19 01:27 PM] SHossain#0007
but, until the previous withdraw completes, i can't do more
```
./komodo-cli -ac_name=MBTCTEST importgatewaywithdraw fec28fa1840bfddc532ca8fd4fbd9cfc9d927514ed988d95d5759675736739bc KMD 027ad67d9b0d3afac9670ce51a5cdce781b9215946ea8a0f0acb027edc2008f739 0.02
{
  "result": "error",
  "error": "unable to create withdraw, another withdraw pending"
}
```


[01-Nov-19 01:29 PM] SHossain#0007
this is the previous one
```
./komodo-cli -ac_name=MBTCTEST importgatewaypendingwithdraws fec28fa1840bfddc532ca8fd4fbd9cfc9d927514ed988d95d5759675736739bc KMD
{
  "coin": "KMD",
  "pending": [
    {
      "withdrawtxid": "663de8b1d7816534a54dce61abcf2a34f8f6e1c353eff652f3a224986c5e6f04",
      "withdrawtxidaddr": "RVm2gXQ8qQFFqRsWxYnEumtRQUFcsV1qZY",
      "withdrawaddr": "RSgL9Af3uNTJ79P14Q4nmjHQNmmQQKYZGv",
      "amount": "0.01000000",
      "confirmed_or_notarized": true,
      "number_of_signs": 1,
      "last_txid": "3f00a6276008b406be80e877e4b68ef31389e2da1d5da10f4e122d18fd259696",
      "hex": "0400008085202f8902a2bb4795e8058101aa4c6225ee38286ee841c11c1b75ec0cc40be719f0696f1c010000009200483045022100882050c82a0b6972999e1f49ff37b074095816e1a7b8d68b797df95858b4bd0702204e89f34c5adbcf789f75f1c40554d51d4d5ee8e214db1db7cec8d358cab3f73a0147522102a827db0926b93ce574fcc0d1f4fd0604c248eecfa6825ae62dfd4de03bc94f762103e3e5292cd6f9cb218993771c7174350fd71d42c9bb61a6b825119799f825c87252aeffffffffc39b32974cc7454adc2790a86635496524be820fd1a8c0f4114e25a5d35b490402000000910047304402202bb2a9e057f77fb71a61aa00a357db9c14d3ea99aea763d7ad55435405ba997e0220472782de1b61389d29ca5b057272bae8a5ec29b80ebe0933f3a4a007abf9b04b0147522102a827db0926b93ce574fcc0d1f4fd0604c248eecfa6825ae62dfd4de03bc94f762103e3e5292cd6f9cb218993771c7174350fd71d42c9bb61a6b825119799f825c87252aeffffffff0320f40e00000000001976a914beda6fa1911c00959440407ec9287c9265a73b6688ac10270000000000001976a914e0a651a293e8c5ad23b572552ef992ff71a40f2f88ac00127a000000000017a9144748d84df2176c67e74b20e600b15bdd9b4fc4f88700000000956a18000000000000000000000000"
    }
  ],
  "queueflag": 0
}
```


[01-Nov-19 01:30 PM] SHossain#0007
hopefully in the morning i can process the next one


[01-Nov-19 01:30 PM] Mihailo#5902
You will, I'll reboot it first thing in the morining


[01-Nov-19 01:32 PM] SHossain#0007
i wonder what does this RPC call does? `importgatewayprocessed`


[01-Nov-19 01:33 PM] SHossain#0007
`importgatewaypendingwithdraws` shows the pending ones


[01-Nov-19 01:33 PM] Mihailo#5902
As I mentioned, it shows withdraws that are completely signed but not yet done on external chain.


[01-Nov-19 01:33 PM] SHossain#0007
ah, sorry. understood correctly now


[01-Nov-19 01:33 PM] SHossain#0007
thanks again


[01-Nov-19 01:34 PM] SHossain#0007
this is a whole new chapter for KMD ecosystem 🙂


[01-Nov-19 06:18 PM] CrisF#3405
Hi, can I try out Pegs?


[02-Nov-19 02:04 AM] Mihailo#5902
Yes, but we don't currently have a doc on how to set it up and use it.


[02-Nov-19 03:44 AM] CrisF#3405
Thanks, I'll see if I can get somewhere with it.


[02-Nov-19 05:23 AM] Mihailo#5902
@SHossain We got to a problem that KMD tx that was signed has expired:
```error code: -26
error message:
16: tx-overwinter-expired
```
I thought that I addressed this issue with setting expiry to something long, but it seems I didn't fixed it.


[02-Nov-19 05:23 AM] Mihailo#5902
I can cancel this withdraw with making markdone tx, but you won't get the funds.


[02-Nov-19 05:23 AM] SHossain#0007
ok. no worries


[02-Nov-19 05:24 AM] SHossain#0007
it was 0.01 KMD only 🙂


[02-Nov-19 05:24 AM] Mihailo#5902
👍


[02-Nov-19 05:25 AM] SHossain#0007
glad that this issue is identified while one of your node was offline


[02-Nov-19 05:25 AM] Mihailo#5902
Yeah, basically because my node signed it now it passed the exipry height and is no longer valid


[02-Nov-19 05:25 AM] Mihailo#5902
I discarded the withdraw.


[02-Nov-19 05:25 AM] Mihailo#5902
You can try now if you want the aggregate test.


[02-Nov-19 05:30 AM] SHossain#0007
while starting the chain, i got this now on the console output
```
ERROR: ContextualCheckTransaction(): transaction dd691b85e26ff976d7107b0fd63bf1d20e03d665aede34c9ab4a1941a689d0ee is expired, expiry block 6584 vs current block 9751
 txhex.0400008085202f8901e4051a91fb0b06ff1e8cfd6b0fc315464a45ee9e0fed4e99e129b2b6c28ce0f2000000006b483045022100efe6b148174bc036850a6b2cddb584a87fab3b5e2091601c37626ae790f6745b0220788afa697a66f2c25c134e87ec353702d9f4457575b58dc1c4607397d16e20cf012103e732c82d87e1ee47071f3900a79a7507b93321f5bddbb4236c10b6ca4f27e0a2ffffffff041027000000000000302ea22c802023fdb7aec87075c24597e7d04613e9ee31f5ed9bf1a799de3c42a2e9a11c28f58103120c008203000401cca086010000000000232102bc396773759675d5958d98ed1475929dfc9cbd4ffda82c53dcfd0b84a18fc2feac5487000000000000232103e732c82d87e1ee47071f3900a79a7507b93321f5bddbb4236c10b6ca4f27e0a2ac0000000000000000546a4c51f357bc396773759675d5958d98ed1475929dfc9cbd4ffda82c53dcfd0b84a18fc2fe2103e732c82d87e1ee47071f3900a79a7507b93321f5bddbb4236c10b6ca4f27e0a2034b4d4400a08601000000000000000000b81900000000000000000000000000
ERROR: AcceptToMemoryPool: ContextualCheckTransaction failed
```


[02-Nov-19 05:31 AM] SHossain#0007
also, the funds from 2 different address combined into one can't be withdrawn


[02-Nov-19 05:31 AM] SHossain#0007
```
./komodo-cli -ac_name=MBTCTEST importgatewaywithdraw fec28fa1840bfddc532ca8fd4fbd9cfc9d927514ed988d95d5759675736739bc KMD 027ad67d9b0d3afac9670ce51a5cdce781b9215946ea8a0f0acb027edc2008f739 0.02
{
  "result": "error",
  "error": "cant find enough normal inputs"
}
```


[02-Nov-19 05:32 AM] Mihailo#5902
It is probably some tx on your node that didn't got transmitted, so it trying to resend it


[02-Nov-19 05:32 AM] Mihailo#5902
And what is your balance?


[02-Nov-19 05:32 AM] Mihailo#5902
do `getbalance` and `listaddressgroupings`


[02-Nov-19 05:33 AM] SHossain#0007
```
./komodo-cli -ac_name=MBTCTEST importgatewayaddress
{
  "result": "success",
  "ImportGatewayCCAddress": "RXJT6CRAXHFuQ2UjqdxMj7EfrayF6UJpzZ",
  "ImportGatewayCCBalance": 0.00010000,
  "ImportGatewayNormalAddress": "RNFRho63Ddz1Rh2eGPETykrU4fA8r67S4Y",
  "ImportGatewayNormalBalance": 0.00000000,
  "ImportGatewayCCTokensAddress": "RAczoarH6zfAzcsY2dX6xuCm6tEU2K6tVK",
  "myCCAddress(ImportGateway)": "RExKVF4RTyqPMo7tfo3Zhcfak5Kr9su5Tc",
  "myCCbalance(ImportGateway)": 0.00000000,
  "myaddress": "RTQ7GDHsnHZ4njDbTjUnmm8GCkRhjifFES",
  "mybalance": 0.02009644
}
```


[02-Nov-19 05:33 AM] SHossain#0007
ah...ok. because the daemon was looking for 0.0001 txfee. so, withdrawing 0.02 wouldn't work anyway


[02-Nov-19 05:33 AM] Mihailo#5902
yep


[02-Nov-19 05:34 AM] Mihailo#5902
try 0.019


[02-Nov-19 05:34 AM] SHossain#0007
```
./komodo-cli -ac_name=MBTCTEST importgatewaywithdraw fec28fa1840bfddc532ca8fd4fbd9cfc9d927514ed988d95d5759675736739bc KMD 027ad67d9b0d3afac9670ce51a5cdce781b9215946ea8a0f0acb027edc2008f739 0.0198
{
  "result": "success",
  "hex": "0400008085202f89013201e1e00d93dc31611d76322b404803cdbea621135e99237f514fdcb0df3b2f000000006a47304402206d736293ebae11f6a9302bfb1d020d75a02cb12d5d111e8ab264567242b243f502207e55558418273b2603880c95568f5b5fb0f651f63c3ea1aa6aa227acba46c108012103e732c82d87e1ee47071f3900a79a7507b93321f5bddbb4236c10b6ca4f27e0a2ffffffff031027000000000000302ea22c802023fdb7aec87075c24597e7d04613e9ee31f5ed9bf1a799de3c42a2e9a11c28f58103120c008203000401cc60361e0000000000232102bc396773759675d5958d98ed1475929dfc9cbd4ffda82c53dcfd0b84a18fc2feac0000000000000000756a4c72f357bc396773759675d5958d98ed1475929dfc9cbd4ffda82c53dcfd0b84a18fc2fe2103e732c82d87e1ee47071f3900a79a7507b93321f5bddbb4236c10b6ca4f27e0a2034b4d4421027ad67d9b0d3afac9670ce51a5cdce781b9215946ea8a0f0acb027edc2008f73960361e000000000000000000932a00000000000000000000000000"
}
```


[02-Nov-19 05:34 AM] SHossain#0007
0.0198 works


[02-Nov-19 05:34 AM] SHossain#0007
```
7a27ba0b16f7ba1414b06169a2ea733102bc5aad90b73e7b3569d67d06299fd0
```
got a txid after `sendrawtrandaction`


[02-Nov-19 05:35 AM] SHossain#0007
with the hex above


[02-Nov-19 05:35 AM] SHossain#0007
@CrisF if you like to test, let me know. i can help if needed with current testing setup


[02-Nov-19 05:36 AM] SHossain#0007
you need KMD and MBTCTEST chain. the step/guides are here https://gist.github.com/himu007/5b61ebb330ee46c4c1f7518d34e30d42


[02-Nov-19 05:36 AM] SHossain#0007
you specifically need to compile using the steps mentioned on that gist


[02-Nov-19 05:36 AM] Mihailo#5902
@SHossain That is not pegs 😉 That is import gateway. Pegs are UDSKTEST...


[02-Nov-19 05:36 AM] SHossain#0007
sorry, yes.


[02-Nov-19 05:37 AM] Mihailo#5902
Maybe it would be good to rename this CC to sidechain CC and create a separate channel for it?


[02-Nov-19 05:37 AM] SHossain#0007
you want a `cc-importgateway` channel?


[02-Nov-19 05:38 AM] SHossain#0007
or `cc-sidechain`?


[02-Nov-19 05:38 AM] Mihailo#5902
It's not just a channel, but I think import gateway CC is a confusing name.


[02-Nov-19 05:39 AM] Mihailo#5902
Ok, you withdraw has been broadcasted  to KMD

{Reactions}
shexy 

[02-Nov-19 05:39 AM] SHossain#0007
you can change the name if you like. i don't have any issues with that 🙂


[02-Nov-19 05:40 AM] SHossain#0007
so, that means, combining balance from different address and withdrawing works


[02-Nov-19 05:42 AM] SHossain#0007
these burn txs are pretty cool (from yesterday) https://mbtctest.explorer.dexstats.info/tx/308757db90ca20c4afad255ba31213124ff37434b14d2bbdf308d16b06c32167


[02-Nov-19 05:44 AM] SHossain#0007
and, yes, i received my funds back on KMD chain  https://kmdexplorer.io/tx/a56891271a15f9109d282a49af76f15603e4bfb7af72c37b84c856582fa86f68


[02-Nov-19 05:45 AM] Mihailo#5902
Those txs are deposit tx where import is used. Import txs are really wierd!


[02-Nov-19 05:45 AM] SHossain#0007
yep, that's what i was thinking


[02-Nov-19 05:46 AM] SHossain#0007
i guess we have seen that during a scaletest and testing on LABS


[02-Nov-19 05:47 AM] Mihailo#5902
I think I saw few things that can go wrong on this flow, so I need to address them


[02-Nov-19 05:48 AM] SHossain#0007
cool. can you please send 1 or 2 MBTCTEST coins here `RTQ7GDHsnHZ4njDbTjUnmm8GCkRhjifFES` when you have time?


[02-Nov-19 05:49 AM] SHossain#0007
otherwise, i have to start mining 0.0001 blocks :abusedsmily:


[02-Nov-19 05:49 AM] Mihailo#5902
I'll send it right now


[02-Nov-19 05:50 AM] Mihailo#5902
Sent


[02-Nov-19 05:50 AM] SHossain#0007
thanks. i want to see if i can withdraw that


[02-Nov-19 05:50 AM] Mihailo#5902
You cannot but let see if it is going to tell you or make the withdraw and get it stuck


[02-Nov-19 05:50 AM] SHossain#0007
it would be interesting to see nevertheless


[02-Nov-19 05:51 AM] Mihailo#5902
This is the balance of gateway:
```"bKEBwCtejNynumGH7qP2rXF67Z3Hk4LVkd",
      0.09020000,
```


[02-Nov-19 05:51 AM] Mihailo#5902
So try 0.1 if you want


[02-Nov-19 05:51 AM] SHossain#0007
```
./komodo-cli -ac_name=MBTCTEST importgatewaywithdraw fec28fa1840bfddc532ca8fd4fbd9cfc9d927514ed988d95d5759675736739bc KMD 027ad67d9b0d3afac9670ce51a5cdce781b9215946ea8a0f0acb027edc2008f739 0.05
{
  "result": "success",
  "hex": "0400008085202f89018bbed1faf93ed548772d2f1330e360ab364892e1727b147de073152b71335602010000006a473044022058f11ed44f00a7723c64fb9bfa4019d630f430a93138e4fc470e1b6a6f3db2f502203557d1d4caabd598e08668c1ab7adf8a71256e33e59536c4607c523dee671c91012103e732c82d87e1ee47071f3900a79a7507b93321f5bddbb4236c10b6ca4f27e0a2ffffffff041027000000000000302ea22c802023fdb7aec87075c24597e7d04613e9ee31f5ed9bf1a799de3c42a2e9a11c28f58103120c008203000401cc404b4c0000000000232102bc396773759675d5958d98ed1475929dfc9cbd4ffda82c53dcfd0b84a18fc2feaca047a90500000000232103e732c82d87e1ee47071f3900a79a7507b93321f5bddbb4236c10b6ca4f27e0a2ac0000000000000000756a4c72f357bc396773759675d5958d98ed1475929dfc9cbd4ffda82c53dcfd0b84a18fc2fe2103e732c82d87e1ee47071f3900a79a7507b93321f5bddbb4236c10b6ca4f27e0a2034b4d4421027ad67d9b0d3afac9670ce51a5cdce781b9215946ea8a0f0acb027edc2008f739404b4c000000000000000000af2a00000000000000000000000000"
}
```


[02-Nov-19 05:51 AM] SHossain#0007
0.05 seems working


[02-Nov-19 05:51 AM] Mihailo#5902
Probably it will create withdraw and wont be able to withdraw it on KMD


[02-Nov-19 05:51 AM] SHossain#0007
shall i broadcast the hex?


[02-Nov-19 05:52 AM] Mihailo#5902
This is the problem as MBTCTEST and KMD have no information on each other.


[02-Nov-19 05:52 AM] Mihailo#5902
The bridge for those two is oraclefeed


[02-Nov-19 05:53 AM] SHossain#0007
```
./komodo-cli -ac_name=MBTCTEST importgatewaywithdraw fec28fa1840bfddc532ca8fd4fbd9cfc9d927514ed988d95d5759675736739bc KMD 027ad67d9b0d3afac9670ce51a5cdce781b9215946ea8a0f0acb027edc2008f739 0.1
{
  "result": "success",
  "hex": "0400008085202f89018bbed1faf93ed548772d2f1330e360ab364892e1727b147de073152b71335602010000006b48304502210088bbc90330e2513eff5b6ad2560b4a978e8f885892846d1544d87192437a7483022011264f41ff366824f10c116ff45c5121f52b140c1e5499b9c15528054e3e1564012103e732c82d87e1ee47071f3900a79a7507b93321f5bddbb4236c10b6ca4f27e0a2ffffffff041027000000000000302ea22c802023fdb7aec87075c24597e7d04613e9ee31f5ed9bf1a799de3c42a2e9a11c28f58103120c008203000401cc8096980000000000232102bc396773759675d5958d98ed1475929dfc9cbd4ffda82c53dcfd0b84a18fc2feac60fc5c0500000000232103e732c82d87e1ee47071f3900a79a7507b93321f5bddbb4236c10b6ca4f27e0a2ac0000000000000000756a4c72f357bc396773759675d5958d98ed1475929dfc9cbd4ffda82c53dcfd0b84a18fc2fe2103e732c82d87e1ee47071f3900a79a7507b93321f5bddbb4236c10b6ca4f27e0a2034b4d4421027ad67d9b0d3afac9670ce51a5cdce781b9215946ea8a0f0acb027edc2008f739809698000000000000000000b02a00000000000000000000000000"
}
```
0.1 also provides me hex


[02-Nov-19 05:53 AM] Mihailo#5902
And it works with both chains. So it would need to have some way tha MBTCTEST can know the balance of KMD gateway deposit address


[02-Nov-19 05:53 AM] SHossain#0007
of course the last one will be rejected


[02-Nov-19 05:53 AM] Mihailo#5902
Everything will work as long you have balance


[02-Nov-19 05:54 AM] SHossain#0007
https://mbtctest.explorer.dexstats.info/tx/872e4f428c33d98aaf5e8dcba3119c638a991bc9bb27f79d7adc842cfd93d578


[02-Nov-19 05:54 AM] SHossain#0007
broadcasted the 0.05 value tx


[02-Nov-19 05:54 AM] SHossain#0007
let see


[02-Nov-19 05:54 AM] Mihailo#5902
I will monitor logs


[02-Nov-19 05:54 AM] Mihailo#5902
It won't be able to create tx


[02-Nov-19 05:55 AM] Mihailo#5902
Maybe it will even be stuck so I would need to fork the chain


[02-Nov-19 05:55 AM] SHossain#0007
i will put bit more KMD into gateway if needed


[02-Nov-19 05:55 AM] Mihailo#5902
Yes, that will make it work


[02-Nov-19 05:55 AM] Mihailo#5902
But let see first


[02-Nov-19 05:56 AM] Mihailo#5902
Ah sorry, 0.05 will work


[02-Nov-19 05:56 AM] Mihailo#5902
0.1 won't


[02-Nov-19 05:57 AM] SHossain#0007
if 0.05 works. my next test would be try to withdraw more than the gateway has


[02-Nov-19 05:58 AM] Mihailo#5902
Yes, that won't work, but we can fix it by adding more funds to gateway address


[02-Nov-19 05:59 AM] SHossain#0007
i'll add 1 KMD there after these tests


[02-Nov-19 05:59 AM] Mihailo#5902
👍


[02-Nov-19 05:59 AM] SHossain#0007
oh..wait. i'll deposit 0.777 KMD 😄


[02-Nov-19 06:00 AM] Mihailo#5902
0.05 broadcasted


[02-Nov-19 06:02 AM] SHossain#0007
yes, it arrived https://kmdexplorer.io/tx/3c03d7a09d54d7ced6568d76ccbf8587be302e756e0ae3c8db24adcab3a68d24


[02-Nov-19 06:03 AM] SHossain#0007
```
./komodo-cli -ac_name=MBTCTEST importgatewaywithdraw fec28fa1840bfddc532ca8fd4fbd9cfc9d927514ed988d95d5759675736739bc KMD 027ad67d9b0d3afac9670ce51a5cdce781b9215946ea8a0f0acb027edc2008f739 0.1
{
  "result": "success",
  "hex": "0400008085202f890178d593fd2c84dc7a9df727bbc91b998a639c11a3cb8d5eaf8ad9338c424f2e870200000049483045022100ac0b2a3aaeb2e5b25c5ef52bd75dea668918a1d9f8f96bfbcba754a64726f06802203d1efcbdc924034226bc6fd732be0f2c724596af2b5a032e2031665e3dea2f3701ffffffff041027000000000000302ea22c802023fdb7aec87075c24597e7d04613e9ee31f5ed9bf1a799de3c42a2e9a11c28f58103120c008203000401cc8096980000000000232102bc396773759675d5958d98ed1475929dfc9cbd4ffda82c53dcfd0b84a18fc2feac0063100500000000232103e732c82d87e1ee47071f3900a79a7507b93321f5bddbb4236c10b6ca4f27e0a2ac0000000000000000756a4c72f357bc396773759675d5958d98ed1475929dfc9cbd4ffda82c53dcfd0b84a18fc2fe2103e732c82d87e1ee47071f3900a79a7507b93321f5bddbb4236c10b6ca4f27e0a2034b4d4421027ad67d9b0d3afac9670ce51a5cdce781b9215946ea8a0f0acb027edc2008f739809698000000000000000000bd2a00000000000000000000000000"
}
```


[02-Nov-19 06:03 AM] SHossain#0007
doing a 0.1 withdraw


[02-Nov-19 06:03 AM] SHossain#0007
tx broadcasted https://mbtctest.explorer.dexstats.info/tx/6afba9d460b90d0b43976d5d896d61268b0c41f7bbc91ed6f81cb3f8fb53b9c6


[02-Nov-19 06:03 AM] SHossain#0007
on MBTCTEST chain


[02-Nov-19 06:04 AM] SHossain#0007
shouldn't MTBCTEST chain stop me from trying to withdraw more than the gateway has?


[02-Nov-19 06:05 AM] Mihailo#5902
```not enough funds to create withdraw tx
couldnt create rawtx or find previous partial signed tx
```


[02-Nov-19 06:05 AM] Mihailo#5902
As I mentioned, MBTCTEST doesn't know how much there is on gateways address


[02-Nov-19 06:05 AM] Mihailo#5902
as that is on KMD


[02-Nov-19 06:08 AM] CrisF#3405
Hi @SHossain , thanke!  Yes, I'm interested to see if I can set something up.
Found the Pegs wiki, import-gateway wiki and your import-gateway doc so far.  Will read.
Help appreciated!

{Reactions}
👍 

[02-Nov-19 06:09 AM] Mihailo#5902
@SHossain can you send 1 KMD to `bKEBwCtejNynumGH7qP2rXF67Z3Hk4LVkd` to see if it is going to solve the problem


[02-Nov-19 06:11 AM] SHossain#0007
sure.


[02-Nov-19 06:12 AM] SHossain#0007
sent https://kmdexplorer.io/tx/885a78e263a3e8dc65f993aa4618643bb692a5f7c9013640a025f5e98e3c5514


[02-Nov-19 06:16 AM] Mihailo#5902
Signing started so it will successed

{Reactions}
👌 

[02-Nov-19 06:24 AM] SHossain#0007
https://kmdexplorer.io/tx/c167ab8e61f063c45b4c6f12185f18ee2b832519ddbbdf0ad21865b60de96178


[02-Nov-19 06:24 AM] SHossain#0007
it worked


[02-Nov-19 06:24 AM] Mihailo#5902
Yes


[03-Nov-19 05:31 AM] Mihailo#5902
@SHossain The disk on my local node seems to be dying. I have 3 vps nodes, 2 I'm using for USDK, and 1 for MBTC. Can I get another VPS node to move MBTC from my local node?


[03-Nov-19 05:32 AM] SHossain#0007
sure. yes.


[03-Nov-19 05:33 AM] SHossain#0007
i can use one of my dedicated server to run MBTCTEST chain.


[03-Nov-19 05:34 AM] SHossain#0007
will prepare the server soon with your repo


[03-Nov-19 06:11 AM] Mihailo#5902
Hmm, I haven't written the private key of that node no where.


[03-Nov-19 06:12 AM] Mihailo#5902
Let me try to dump it in the morning and I'll send you the key to import and run with that pub key


[03-Nov-19 06:27 AM] SHossain#0007
cool. i have komodo source from your repo compiled


[03-Nov-19 09:21 AM] zeki#6135
it's a brilliant idea to sell cheques("marmara credit loops") before dates.  its increases circulation of cheques.

{Reactions}
👌 

[03-Nov-19 09:24 AM] SHossain#0007
yes, this is an interesting idea


[03-Nov-19 10:28 AM] Paro#7842
easier to explain by graph.


[03-Nov-19 02:32 PM] Regnar#6164 (pinned)
```- Pegs
  - Pegs Explainer - [https://github.com/Mixa84/komodo/wiki/Pegs-CC](https://github.com/Mixa84/komodo/wiki/Pegs-CC)
  - Pegs CC Creation TUI in Python - [https://github.com/tonymorony/komodo-cctools-python/blob/master/pegs_creation_tui.py](https://github.com/tonymorony/komodo-cctools-python/blob/master/pegs_creation_tui.py)
  - Pegs CC Usage TUI in Python - [https://github.com/tonymorony/komodo-cctools-python/blob/master/pegs_usage_tui.py](https://github.com/tonymorony/komodo-cctools-python/blob/master/pegs_usage_tui.py)```

Hey all, if you have any proof of concepts, or built something cool for Pegs CC, please let me know. The goal is to build out a list of concepts using CCs to help show other developers what is possible and add this to the Komodo docs page. TUIs are good too


[04-Nov-19 01:38 AM] Mylo#8306
Pinned a message.


[04-Nov-19 03:22 AM] CrisF#3405
Hi, I'm reading up on pegged/stable coins and have a question about Pegs.
Will the funds that accumulate in the Pegs CC global reserve be able to collect the KMD 5.1% rewards?


[04-Nov-19 03:27 AM] jl777c#5810
yes, that will fund the multisig operators, so this is a sustainable model

{Reactions}
KMD (2) 

[04-Nov-19 03:50 AM] Mihailo#5902
@SHossain I have dumped the private key of my local node. So we can prepare it on your node.


[04-Nov-19 03:50 AM] Mihailo#5902
Now the node is working, but I don't know how long as it has failures to write to disk.


[04-Nov-19 03:51 AM] SHossain#0007
please DM me the privkey


[04-Nov-19 03:51 AM] SHossain#0007
are you not using SSD?


[04-Nov-19 03:59 AM] Mihailo#5902
Yes, I'm using SSD. That's why it is strange


[04-Nov-19 04:00 AM] Mihailo#5902
It could be that SSD is failing


[04-Nov-19 05:12 AM] SHossain#0007
Samsung 860 Pro or Sandisk 3D SSD are good ones


[04-Nov-19 05:13 AM] SHossain#0007
Intel makes good SSD too. But I used only one of their DC level SSD


[04-Nov-19 05:30 AM] Paro#7842
@Mihailo I had also had the same problem.  Ram min 8 gb, 2 CPU, It is sufficient. After waiting 20 minutes, the installation will begin.


[04-Nov-19 05:40 AM] SHossain#0007
i have Mihailo's setup ready in my server


[04-Nov-19 06:39 AM] Mihailo#5902
@jl777c What do you think that we add the balance of deposit address to be submitted in oracle when submitting block data, so that on gateways chains we can check if the withdraw is possible?
As for now this cannot be done on AC because AC does not have any info on external deposit address balance. The only point that works with both chains is oraclefeed, but then you have already made the withdraw tx and if it is impossible it will basically block withdraw (as we have single withdraw limitation for the problem of creating raw tx in the same time)


[04-Nov-19 06:40 AM] jl777c#5810
sure that and whatever other data makes it easier can be added to what the oracle needs to be writing out.

{Reactions}
👍 

[04-Nov-19 07:41 AM] Mihailo#5902
Hmm, I have moved my local node to another VPS node, synced everything. And now when I start AC I get this:
```
ERROR: mempool transaction missing input
komodod: miner.cpp:345: CBlockTemplate* CreateNewBlock(CPubKey, const CScript&, int32_t, bool): Assertion `"mempool transaction missing input" == 0' failed.
Aborted (core dumped)
```


[04-Nov-19 07:41 AM] Mihailo#5902
Never had this error....


[04-Nov-19 07:45 AM] SHossain#0007
i'm mining with your pubkey


[04-Nov-19 07:45 AM] SHossain#0007
shall i stop that?


[04-Nov-19 07:45 AM] Mihailo#5902
Hmmm, not sure it is a problem. Maybe


[04-Nov-19 07:45 AM] Mihailo#5902
Stop the node and oraclefeed


[04-Nov-19 07:46 AM] SHossain#0007
on it now


[04-Nov-19 07:46 AM] SHossain#0007
done


[04-Nov-19 07:48 AM] Mihailo#5902
Again same


[04-Nov-19 08:08 AM] Mihailo#5902
If I don't mine then it is ok


[04-Nov-19 08:41 AM] SHossain#0007
maybe try to get a `gdb` backtrace?


[04-Nov-19 08:47 AM] jl777c#5810
maybe we dont need to support mining on special nodes?


[04-Nov-19 09:34 AM] Mihailo#5902
It seems the wallet had some tx that node couldn't mine


[04-Nov-19 09:34 AM] Mihailo#5902
I removed it and now it works ok


[05-Nov-19 05:52 AM] Mihailo#5902
@jl777c On KMD chains we have getaddressbalance (if address index is turned on). But on other chains like BTC we don't have that method. I want to add balance of deposit address to oracle for gateways so looking how to check address balance.


[05-Nov-19 08:08 AM] jl777c#5810
not built into BTC, would need to use and external service (like explorer) as a data source, or a list of txids/value


[05-Nov-19 08:08 AM] Mihailo#5902
so there is no way to check the address balance from cli?


[05-Nov-19 08:09 AM] Mihailo#5902
Even if that address is in the wallet. Because I'm adding multisig address to wallet!


[05-Nov-19 08:09 AM] Mihailo#5902
I know I can use listaddressgroupings, but wanted to see if there is a better way


[05-Nov-19 08:10 AM] jl777c#5810
maybe if you added the multisig address as a watch-only address you can getbalance for it, at least a listunspent with that address, but not sure if BTC will consider a msig address as part of any specific wallet


[05-Nov-19 08:11 AM] Mihailo#5902
listunspent can be done, and I can sum all unspents


[05-Nov-19 08:11 AM] Mihailo#5902
Maybe the msig address can be imported with a label and then I can use getbalance "label"


[05-Nov-19 08:12 AM] Mihailo#5902
In BTC you cannot supply label/account for getbalance:
```Arguments:
1. dummy                (string, optional) Remains for backward compatibility. Must be excluded or set to "*".
2. minconf              (numeric, optional, default=0) Only include transactions confirmed at least this many times.
3. include_watchonly    (boolean, optional, default=false) Also include balance in watch-only addresses (see 'importaddress')
```


[05-Nov-19 08:13 AM] jl777c#5810
labels are mostly if not totally deprecated


[05-Nov-19 08:16 AM] Mihailo#5902
Yes, in KMD we have accounts but here I cannot getbalance for "account"


[05-Nov-19 08:18 AM] jl777c#5810
listunspents for address seems the best


[07-Nov-19 06:59 AM] Mihailo#5902
@jl777c I'm finishing the balance in oracle for gateways. I have a doubt what would be the best way to choose right balance when you have n signers submitting balance and it differs. Should I take what n/2 says it is or should I go with min or max balance? Every option has its disadvantages...


[07-Nov-19 07:01 AM] jl777c#5810
n/2 seems good as those are the signers


[07-Nov-19 07:03 AM] Mihailo#5902
OK, so I'm thinking if it is possible that n/2 hasn't yet got the info that balance has changed (for example after n/2 submits the balance on one node that is not one of n/2 nodes some withdraw is broadcasted on external chain and reduces balance) and in this way it allows the withdraw to be created but there is not enough funds now and that will basically make the iwthdraw process stuck!


[07-Nov-19 07:09 AM] jl777c#5810
after the pending withdraw confirms, will it resolve?


[07-Nov-19 07:10 AM] Mihailo#5902
Well, pending withdraw will "never" confirm if there is not enough funds to execute it. It can only resolve if  more funds are deposited.


[07-Nov-19 07:13 AM] jl777c#5810
but if n/2 agreed on balance, the balance would be there?


[07-Nov-19 07:13 AM] Mihailo#5902
So that withdraw will stay pending until there is enough funds available and block any other withdraw. That is the disadvantage of single withdraw system, and we made it like that as there was a problem of creating parallel withdraws as when creating raw tx it uses unspents but before previous withdraw is not finished the utxos stay unspent.


[07-Nov-19 07:15 AM] Mihailo#5902
Well, that was my point. What if n/2 submitted one balance, and then after that moment balance changed and the next submit is not yet on the way. So the balance would be incorrect.


[07-Nov-19 07:27 AM] jl777c#5810
but the balance can only go up?


[07-Nov-19 07:27 AM] jl777c#5810
so wouldnt there be enough funds to do the withdraw


[07-Nov-19 07:31 AM] Mihailo#5902
Deposit address balance goes up and down. It goes up when people deposit coins, and down when they iwthdraws. So if there is a situation I mentioned, then the withdraws would be stuck, and balance would go up only when someone deposits and then withdraws can continue.


[07-Nov-19 07:47 AM] jl777c#5810
maybe we need to be able to force cancel a pending withdraw in such a case?


[07-Nov-19 07:53 AM] Mihailo#5902
We can make that, but then the gateway mechanism distance more from the decentralized principe of working as you can cancel withdraws from central point.


[07-Nov-19 07:58 AM] jl777c#5810
if this is only valid after a full day, it seems ok as under normal condition withraws are processed much faster than a day


[07-Nov-19 07:59 AM] jl777c#5810
maybe a withdraw request is only good for a day (or some shorter time limit)


[07-Nov-19 08:00 AM] SHossain#0007
12 hours?


[07-Nov-19 08:09 AM] Mihailo#5902
We can make that withdraw request expires. It would solve that withdraws is not indefinetely stuck.
I would be satisfied the most if I could solve the parallel withdraw issue and then we don't care if somebody created the withdraw that is not possible. We can make it expire at some point. It would also make withdraws fast as you won't need to wait for your withdraw to get at top of the queue...


[07-Nov-19 08:28 AM] jl777c#5810
i assume we can solve parallel withdraws later?


[07-Nov-19 08:48 AM] Mihailo#5902
I think so, just saying that maybe it is better to invest time to solve it now then to fix the issues of single withdraw.


[07-Nov-19 08:53 AM] jl777c#5810
true, but having a withdraw expire after a long time, seems a good thing in any case


[07-Nov-19 08:53 AM] Mihailo#5902
Yes, agree. I mentioned it up there.


[11-Nov-19 02:52 AM] Mihailo#5902
@jl777c I gave a thought on solving the parallel withdraw problem on friday and over the weekend. I have and idea to create another msig address from the same pubkeys (if possible) and move the funds that are used for withdraw over there. This would solve both parallel withdraw and the balance thing as we would know how much is left. Ofc, the withdraw should expire after sometime and those fund need to be returned to the deposit address so it can be used again and have correct balance. That part is IMHO little bit picky as we have to be sure funds are not stuck at temp address.


[11-Nov-19 02:54 AM] jl777c#5810
great!


[11-Nov-19 02:54 AM] jl777c#5810
just change the order of the pubkeys in the redeemscript


[11-Nov-19 02:54 AM] jl777c#5810
you can make N! different msig addresses from N pubkeys


[11-Nov-19 02:55 AM] Mihailo#5902
Aha, so if the order of keys is 1,3,2 it wil give different address than 1,2,3.


[11-Nov-19 02:57 AM] jl777c#5810
the msig address is rmd160(sha256(redeemscript))


[11-Nov-19 02:57 AM] Mihailo#5902
👍


[11-Nov-19 02:58 AM] Mihailo#5902
Ok, so I'll try this with oraclefeed. And I will introduce withdraw expiration (basicallly it will check tx time and if some time has passed it will not look it as pending anymore)


[11-Nov-19 03:35 AM] Mihailo#5902
For 1of1 gateway can I generate somehow another address from the pubkey and to always be the same?


[11-Nov-19 03:38 AM] jl777c#5810
might need to have a dummy pubkeys and make it a 1of2


[11-Nov-19 03:38 AM] jl777c#5810
then you can make the second pubkey any random one to make a new address


[11-Nov-19 03:39 AM] Mihailo#5902
Ok, it is not really important right now. As usually MofN gateway will be used. 1of1 we use for test, but I don't expect any significant use in production.


[11-Nov-19 03:39 AM] Mihailo#5902
Ah, I can use 1of2 address from the same pubkey!


[11-Nov-19 03:41 AM] jl777c#5810
but same pubkey twice is the same address in both A B vs B A


[11-Nov-19 03:42 AM] Mihailo#5902
Yes, but it is different address than single pubkey address. I just need different address!

{Reactions}
🙂 

[11-Nov-19 03:52 AM] jl777c#5810
oh, yes a 1of1 msig is different than p2pk/p2pkh

{Reactions}
👍 

[12-Nov-19 03:03 AM] Mihailo#5902
@jl777c Is there a way that the utxo is found from mempool like with listunspent with regular rpc commands. I want to move funds from deposit address to tmp address and right away create raw tx using those utxos from tmp address. I would like to avoid waiting it to be mined and then creating raw tx in another step as it would need another tx and syncing with external chain...


[12-Nov-19 03:26 AM] Mihailo#5902
Or maybe I don't need to look for unspents, but just send funds to tmpaddress and then use that txid and vout as vin for createrawtx.


[12-Nov-19 03:27 AM] jl777c#5810
yes


[12-Nov-19 03:27 AM] jl777c#5810
you can getrawmempool and scan for the utxo to spend, but if you know precisely the txid already, it is easier


[12-Nov-19 03:28 AM] Mihailo#5902
I will know it as I will first make move of funds and then right away createrawtransaction


[12-Nov-19 03:31 AM] Mihailo#5902
Ahhhhhhhhhh, I didn't thought about this enough. To move the funds from deposit to temp address it again needs to have signing process done 😔


[12-Nov-19 03:31 AM] Mihailo#5902
I mix 1of1 and multisig situations when thinking as I was testing a lot with 1of1 gateway...


[12-Nov-19 04:35 AM] Mihailo#5902
For the sake of knowing exact balance and for parallel withdraw, it would be good to reserve the utxos that will be spent in withdraw. The best way was to spend them to temp address as it would have exact utxo and the rest utxo would be available for spending in other withdraws. But as this also needs multiple signing process, something else must be done in order to solve this.


[12-Nov-19 04:40 AM] jl777c#5810
maybe think in terms of managing the total balance in convenient sizes. the msig signers can prepare these utxos while collecting the 5% rewards


[12-Nov-19 04:50 AM] Mihailo#5902
The collecting rewards thing haven't been made yet, and this will also be difficult as multi signing thing must be done. Nevertheless, even if we have convenient sizes we must mark that utxo will be spent in order to both know exact balance at the moment and to avoid using same utxo in two parallel withdraws.


[12-Nov-19 04:54 AM] jl777c#5810
how about 8 parallel withdraws


[12-Nov-19 04:55 AM] jl777c#5810
prepare ahead of time 1/8th of balance in each of 8 subaddresses. for each withdraw, do a userpubkey % 8 to find which of the 8 parallel tracks it will use and single thread within each.


[12-Nov-19 04:55 AM] jl777c#5810
the restriction is that no more than 1/8th of total balance can be withdrawn at once, which seems an acceptable limitation


[12-Nov-19 04:56 AM] jl777c#5810
each withdraw track, can then use a baton to ensure only one pending withdraw at a time


[12-Nov-19 04:57 AM] jl777c#5810
as a withdraw happens, then a rebalancing of funds in the 7 other addresses would need to happen, maybe just do this once per day, along with collection of rewards


[12-Nov-19 04:57 AM] jl777c#5810
something like this. where the withdraws are constrained to allow multiple withdraws that dont conflict at all


[12-Nov-19 04:58 AM] jl777c#5810
and total balance info can be put into the opreturn and validated that it properly adjusts from the previous balance, this way we dont need an external source for balance info


[12-Nov-19 05:07 AM] Mihailo#5902
Hmmm, I have to think about it little bit. Splitting in 8 different balances is ok, and baton (on AC side I suppose) would resolve reserving utxos for withdraw. The rebalancing thing would require automated "withdraw" of all 8 balances back to new 8 balances and the siging process to be done....


[12-Nov-19 05:08 AM] Mihailo#5902
In the beginning when there are little deposits, it will be probably difficult to iwthdraw your deposit as it can be more than 1/8 of balance...


[12-Nov-19 05:17 AM] jl777c#5810
unless, we make specific set of initial deposits to cover the startup case


[12-Nov-19 05:18 AM] jl777c#5810
with a daily rebalancing, the msig nodes can just spend all the 8 balances to the 8 addresses in a single rebalancing transaction, i guess skipping any pending withraws


[12-Nov-19 05:18 AM] jl777c#5810
if an incremental method can be made, it would be better


[12-Nov-19 05:20 AM] jl777c#5810
maybe a just in time process where funds are kept in the main msig address and only transferred to the 8 withdraw balance addresses, as needed. it is an extra transaction, but if we can do this, then it handles the case when there are not enough funds in the 1/8th address


[12-Nov-19 05:20 AM] jl777c#5810
once that case is handled, if we notice that there are already enough funds in the 1/8th address, then the transfer from main address can be skipped


[12-Nov-19 05:20 AM] jl777c#5810
i think it is a matter to carefully track the 9 balances, and 8 pending withdraws


[12-Nov-19 05:21 AM] Mihailo#5902
Every transfer is again multi sig tx which needs signing


[12-Nov-19 05:21 AM] jl777c#5810
and there are the new funds that are coming in, that start as unallocated. maybe they can be moved to the 1/8th address with the lowest balance, so this is the incremental aspect


[12-Nov-19 05:21 AM] jl777c#5810
yes, i am assuming that automating a msig tx is achieved already


[12-Nov-19 05:22 AM] Mihailo#5902
We have automated signing process, but it is slow and it requires txs on AC.


[12-Nov-19 05:23 AM] jl777c#5810
so the various states that a utxo can be in needs to be tracked and then make sure that the opreturn data has the required summaries. it could be that we have an "intialize" process that takes all the existing balances and gets things into a proper state


[12-Nov-19 05:23 AM] jl777c#5810
as long as it is automated, slow is ok, just not too slow. 10 blocks for a signature is 10 minutes, which seems ok


[12-Nov-19 05:24 AM] Mihailo#5902
This all brings complexity of the system to a whole new level and creates space for errors. The utxo system was a perfect thing but with msig it is difficult to use it as it requires complete process for signing


[12-Nov-19 05:25 AM] jl777c#5810
maybe we need to do it like iguana notarizer and make it direct p2p to get the msig tx signed


[12-Nov-19 05:26 AM] jl777c#5810
but regardless of signing method, i think as long as a withdraw progresses toward completion, or times out and can be resubmitted, it will be complex, but will still work


[12-Nov-19 05:27 AM] Mihailo#5902
That would be great, to reduce the overhead we have for signing and to have instant signing. Then we would be able to move the funds to temp address.


[12-Nov-19 05:28 AM] jl777c#5810
what if you used the mempool?


[12-Nov-19 05:28 AM] Mihailo#5902
For what?


[12-Nov-19 05:28 AM] jl777c#5810
why wait for confirmations to complete the signing?


[12-Nov-19 05:28 AM] jl777c#5810
couldnt the msig signers scan the mempool and see if there is any new tx that needs to be signed?


[12-Nov-19 05:30 AM] Mihailo#5902
Can't remember why I did it this way. I think there was some issue, but maybe it can be done.


[12-Nov-19 05:34 AM] Mihailo#5902
So the flow would be like this:
- withdraw tx created (on AC)
- oraclefeed takes utxos and make utxo to temp address in exact amount
- signing is done immediately in mempool and external tx broadcasted
- then createrawtx can be done right away without waiting for previous external tx to be mined
- signing again starts and it finishes completely in mempool
- now the real withdraw tx is broadcasted on external chain (but waiting for previous tx to be mined)


[12-Nov-19 05:37 AM] Mihailo#5902
I think there was some problem with race condition for signing, and one by one tx was making it ok.


[12-Nov-19 05:37 AM] jl777c#5810
maybe separate the rawtx construction and signing


[12-Nov-19 05:37 AM] Mihailo#5902
But with a baton, there will not be any race condition


[12-Nov-19 05:38 AM] jl777c#5810
each node can independently sign the same rawtx and just submit the signature in an opretuen


[12-Nov-19 05:38 AM] jl777c#5810
then you can combine M of the signatures to make a valid signed transaction


[12-Nov-19 05:40 AM] Mihailo#5902
I think there will be no problem with that as long as I'm using sequential signing with a baton. If two nodes want to sign and spend baton at the sametime, one will succed and other won't as baton will be spent


[12-Nov-19 05:42 AM] Mihailo#5902
This temp address thing wil take one more txfee from the external funds so the user will receive amount-2*txfees-non-spending marker fee. For expensive coins I think we can set txfee to minimum and marker fee can be like 1k sat


[12-Nov-19 05:43 AM] Mihailo#5902
We could also make markers 1 sat, is there anything against this?


[12-Nov-19 05:50 AM] jl777c#5810
it might fall below dust threshold


[12-Nov-19 05:50 AM] jl777c#5810
can the marker be on the AC side?


[12-Nov-19 05:50 AM] jl777c#5810
i mean baton


[12-Nov-19 05:56 AM] Mihailo#5902
Baton is on AC side, but the non-spendable marker to mark that the external withdraw has been executed and prevent double withdraws must be on external chain. That is why I'm asking how low we can go with the amount?


[12-Nov-19 05:57 AM] Mihailo#5902
And baton on the ac side will in the end be spent to the nodes pubkey which does markdone tx on AC


[12-Nov-19 06:00 AM] jl777c#5810
i think 500 or 600 sats is the dust level for a lot of chains


[12-Nov-19 06:01 AM] Mihailo#5902
Ok so we can go with 1k sat


[12-Nov-19 06:01 AM] Mihailo#5902
This will be insignificant for BTC


[12-Nov-19 06:01 AM] jl777c#5810
a 10 cents per BTC withdraw is not so bad, we just need to have a minimum withdraw so the percentage is reasonable max


[12-Nov-19 06:04 AM] Mihailo#5902
With 100k BTC price this will be 1$. With 10k it is 0.10$


[12-Nov-19 06:38 AM] jl777c#5810
it seems acceptable, just have a minimum withdraw big enough so it is never more than 5% fee


[15-Nov-19 05:59 AM] Mihailo#5902
@jl777c So I have totaly refactored the logic of gateways withdraw (for now on importgateway to test) and it seems this will be better. The flow goes like this:
- withdraw tx created by user
- when confirmed/notarized, oraclefeed takes one withdraw at the time and creates raw tx
- signing happens in mempool so it should be fast and while not signed completely no new withdraws are processed
- when it is signed completely it is broadcasted on external chain and markedone
- then new withdraw is taken from the queue and processed
So we have parallel withdraws created, but serial processing of them one by one (probably it can be more than one per block as everything happens in mempool).

And now thee is only the question of checking balance, as I think the n/2 consensus is not good because when the withdraw is broadcasted externally in that moment the balance is lowered and until it reaches n/2 nodes publishing it in the mean time another withdraw could be created. So I suggest we use minimum that is reporeted in latest oraclesdata. Even if some node reports false balance that is lower, it could only get withdraws halted until we resolve it.


[15-Nov-19 06:01 AM] jl777c#5810
this does sound a lot better! serialized, but processed via mempool is a good trick!


[15-Nov-19 06:01 AM] jl777c#5810
that will allow precise calculation of available balances


[15-Nov-19 06:03 AM] Mihailo#5902
Yes, just hope there will not be some problem because everything is in mempool, if some tx does not reach mined block it could block others that depend on it...


[15-Nov-19 06:05 AM] jl777c#5810
in that case it will get mined in the next block. given a chain of mempool tx, it cant be mined out of order!


[15-Nov-19 06:10 AM] Mihailo#5902
Yeah


[15-Nov-19 06:10 AM] Mihailo#5902
Just thinking if something can cause problems


[15-Nov-19 06:10 AM] jl777c#5810
it might cause tx to expire and invalidate a chain if it isnt mined in time


[15-Nov-19 06:12 AM] jl777c#5810
make sure to disable expiration. if you dont use nlocktime and set expireblocks to 0, it wont expire. of course, then you wont collect the rewards... so i think we need to make sure that rewards are actively collected to not lose too much unclaimed rewards. then when needed to do a withdraw, it is only a few hours of lost rewards. that will keep the mempool chain of tx all valid, regardless of how long they take to confirm.


[15-Nov-19 06:12 AM] jl777c#5810
also, rebroadcasting the unconfirmed rawtx until it confirms will assure that it will eventually confirm


[15-Nov-19 06:36 AM] Mihailo#5902
Are you talking about external txs or on AC?


[15-Nov-19 08:08 AM] jl777c#5810
for any mempool tx chain. rebroadcasting will maximize chance it is mined sooner than later. important thing is to make sure the tx cannot expire via the mempool expiration, or for KMD via nlocktime being too old


[18-Nov-19 02:35 AM] Mihailo#5902
I have set locktime to 0 for createrawtransaction on all chains, and for Sapling chains I have set expiryheight to 10000 that should be enough for approx. 7 days when blocktime is 1 min. But the withdraw will expire probably in an few hours as now when signing is in mempool it should execute at worst after hour or so (after initial withdraw tx is confirmed for chains without notarziation).


[18-Nov-19 02:36 AM] jl777c#5810
ok


[18-Nov-19 02:37 AM] Mihailo#5902
I didn't know that expiryheight 0 is to not expire at all, I can set 0 instead!


[18-Nov-19 02:37 AM] Mihailo#5902
But I didn't get the reward part you mentioned...


[18-Nov-19 02:39 AM] jl777c#5810
i guess you can claim rewards even with locktime of 0, but the output wont be valid for claiming as it needs locktime


[18-Nov-19 02:40 AM] jl777c#5810
so we would need to have a daily rewards claiming among the msig nodes to minimize the lost rewards from not claiming


[18-Nov-19 02:40 AM] jl777c#5810
during withdraws


[18-Nov-19 02:40 AM] Mihailo#5902
Are you speaking about the rewards for holding KMD?


[18-Nov-19 02:40 AM] jl777c#5810
if you remember, to claim rewards in KMD, it needs to be one hour old and be >10KMD and have locktime set


[18-Nov-19 02:40 AM] jl777c#5810
yes


[18-Nov-19 02:41 AM] jl777c#5810
this is the funds that pays for the msig signers running the nodes long term


[18-Nov-19 02:41 AM] Mihailo#5902
Ok, I haven't at all approached the reward thing yet. Aha, ok that is the business logic for msig signers.


[18-Nov-19 02:42 AM] jl777c#5810
yes, at first it wont be much, but if we get significant deposits, it could be important to be properly supported


[18-Nov-19 02:42 AM] Mihailo#5902
So I remeber that you need to move the funds at least once a month in order to be able to claim rewards.


[18-Nov-19 02:43 AM] jl777c#5810
after one month, the rewards stop increasing for a specific utxo


[18-Nov-19 02:43 AM] Mihailo#5902
YEs


[18-Nov-19 02:43 AM] Mihailo#5902
That I meant


[18-Nov-19 02:43 AM] jl777c#5810
so not claiming monthly, loses rewards


[18-Nov-19 02:43 AM] jl777c#5810
but you can claim more often, just not so often to have txfees dominate


[18-Nov-19 02:43 AM] Mihailo#5902
Right


[18-Nov-19 02:44 AM] jl777c#5810
i think it is complex enough, the withdraw process. maybe the rewards claiming is done totally separately


[18-Nov-19 02:44 AM] Mihailo#5902
So we need to watch about two things. One is to be able to claim rewards (so I have to check that locktime thing) and the other that utxos are not over 30 days old


[18-Nov-19 02:44 AM] jl777c#5810
of course, if a claim is being done, the withdraw cant be done


[18-Nov-19 02:44 AM] jl777c#5810
for withdraws, you want to make sure the utxo is less than an hour old. that way you lose no rewards


[18-Nov-19 02:45 AM] Mihailo#5902
Hmmm


[18-Nov-19 02:45 AM] Mihailo#5902
"if a claim is being done, the withdraw cant be done", you mean at that moment or after?


[18-Nov-19 02:48 AM] jl777c#5810
utxo used for a claim, cant also be in a withdraw


[18-Nov-19 02:48 AM] jl777c#5810
of course, after the claim is done, it can be used for withdraw


[18-Nov-19 02:48 AM] Mihailo#5902
Ok


[18-Nov-19 02:49 AM] jl777c#5810
so maybe there is a mutually exclusive mode for the msig signers, periods where they are doing claims and separately doing withdraws


[18-Nov-19 02:49 AM] jl777c#5810
this is a non-consensus thing, but still important part of the system


[18-Nov-19 02:50 AM] Mihailo#5902
Yes, we can set some short period when they are claiming rewards and in that period withdraws won't work. But if I understand correct that period can be short. Just tx to claim rewards and move utxo to new one?


[18-Nov-19 02:50 AM] Mihailo#5902
I'm not too much familiar with reward system


[18-Nov-19 02:51 AM] jl777c#5810
yes, it can just be something done once per hour to check to see if any rewards should be claimed


[18-Nov-19 02:51 AM] jl777c#5810
there is no actual rewards system


[18-Nov-19 02:51 AM] jl777c#5810
it is just blockchain rules


[18-Nov-19 02:51 AM] jl777c#5810
you spend a utxo that is over an hour old and more than 10 KMD and has locktime set, then you can spend more than the utxo value


[18-Nov-19 02:51 AM] jl777c#5810
the value increases at 5% rate, but stops growing after a month


[18-Nov-19 02:51 AM] jl777c#5810
THAT is the entire "system"


[18-Nov-19 02:52 AM] jl777c#5810
people then are motivated to spend monthly or more frequently to collect the rewards, but it is fully up to each address owner


[18-Nov-19 02:52 AM] Mihailo#5902
BTW, I saw that default for createrawtransaction is locktime set to 0. So this means that txs created with that RPC by default can't get rewards, so you must set locktime?


[18-Nov-19 02:53 AM] jl777c#5810
if locktime isnt sent, it wont be eligible


[18-Nov-19 02:53 AM] jl777c#5810
set it to 6 minutes in the past, should work well


[18-Nov-19 02:54 AM] jl777c#5810
you can sum the amount of interest you can claim, from the listunspent output


[18-Nov-19 02:54 AM] Mihailo#5902
So some dapps that are using createrawtransaction and not setting locktime cannot take rewards. I mean there are probably someone that doesn't know they can use this.


[18-Nov-19 02:54 AM] jl777c#5810
just increase the total you are spending by the sum of interest fields


[18-Nov-19 02:55 AM] jl777c#5810
if you are using createrawtransaction, it is assumed you know what you are doing


[18-Nov-19 02:56 AM] jl777c#5810
we cant be claiming rewards hourly as that resets the counter, and there is not interest for the first hour


[18-Nov-19 02:56 AM] jl777c#5810
maybe it should be that if doing a withdraw requires using utxo with significant amounts of rewards accrued, the msig signers would do a rewards claim first


[18-Nov-19 02:56 AM] Mihailo#5902
And what locktime is default for sendtoaddress?


[18-Nov-19 02:56 AM] jl777c#5810
i think 777 seconds in the past


[18-Nov-19 02:57 AM] jl777c#5810
so the check for accrued interest becomes part of the withdraw process


[18-Nov-19 02:57 AM] jl777c#5810
and after 3 weeks, can have some background claiming process


[18-Nov-19 02:58 AM] Mihailo#5902
BTW, claiming reward can also be part of withdraw? You spend the utxo by giving the amount to user and adding the interest to vins and having change back to deposit address?


[18-Nov-19 02:58 AM] jl777c#5810
it could, but then it would need to have locktime set


[18-Nov-19 02:59 AM] jl777c#5810
in the event it doesnt get broadcast within an hour, it will expire


[18-Nov-19 02:59 AM] jl777c#5810
i guess that is not a very common occurance, so if you take into account failed withdraws due to expiration (ie. even if properly signed, if it takes too long, it wont be valid) then we can indeed combine the withdraw with claiming


[18-Nov-19 03:00 AM] Mihailo#5902
And if we need to have locktime set it needs to be at least 1 hour?


[18-Nov-19 03:01 AM] jl777c#5810
what do you mean "at least 1 hour"


[18-Nov-19 03:01 AM] Mihailo#5902
On how much locktime needs to be set?


[18-Nov-19 03:01 AM] jl777c#5810
locktime must be > mediantimepast, which is about 10 minutes ago


[18-Nov-19 03:01 AM] jl777c#5810
it cant be in the future


[18-Nov-19 03:01 AM] jl777c#5810
so there is a 10 minutes of valid values


[18-Nov-19 03:02 AM] Mihailo#5902
Hmmm, than I'm confused what locktime represents


[18-Nov-19 03:02 AM] jl777c#5810
but, there is an additional check in KMD that prevents locktime more than an hour old


[18-Nov-19 03:02 AM] jl777c#5810
just imagine locktime to mean "now", approximately


[18-Nov-19 03:03 AM] jl777c#5810
cant set it too far back in time, and cant set it in the future


[18-Nov-19 03:03 AM] Mihailo#5902
I thought locktime indicates the earliest time or earliest block when that transaction may be added to the block chain.


[18-Nov-19 03:03 AM] jl777c#5810
yes


[18-Nov-19 03:03 AM] jl777c#5810
the specific check is against the median time past, so the time of 9 blocks ago


[18-Nov-19 03:04 AM] jl777c#5810
KMD had to add a restriction of "no more than one hour old" to prevent back dating a tx to gain rewards


[18-Nov-19 03:05 AM] Mihailo#5902
Ok, so if we set locktime to now we have approx. 9 blocks for tx to enter and then it expires?


[18-Nov-19 03:05 AM] jl777c#5810
if you set it to now, it will be valid for an hour


[18-Nov-19 03:07 AM] jl777c#5810
but depending on the miner that sets the blocktime, it might not be accepted (if it ends up being after the miners blocktime), so setting it to the recent past is the safest and still gives 50+ minutes to confirm


[18-Nov-19 03:10 AM] Mihailo#5902
I don't get the calc but never mind. So in order to KISS, we can expire a withdraw after an hour or so to make the invalid withdraws expire and also the valid ones if they didn't finished in hour it means someting is wrong. And this way we can also use claiming rewards as a part of withdraw. BTW, the chains that uses gateways (any variant) should need to have notarization as without it regardless of this limitation it will be bad UX to wait for 100 confs before it can sign it and broadcast it.


[18-Nov-19 03:31 AM] jl777c#5810
correct


[19-Nov-19 05:34 AM] SHossain#0007
@gcharang channel topic updated!

{Reactions}
👍 (2) 

[19-Nov-19 05:36 AM] gcharang#6833 (pinned)
The Pegs Antara modules is a mechanism for creating a decentralized stable coin, pegged to any asset like fiat currency, stock, crypto that has a reliable price source 
Intro + RPC: <https://docs.komodoplatform.com/basic-docs/antara/antara-api/pegs.html>
User tutorial: <https://docs.komodoplatform.com/basic-docs/antara/antara-tutorials/pegs-module-user-tutorial.html>
Peg Creator tutorial: <https://docs.komodoplatform.com/basic-docs/antara/antara-tutorials/pegs-module-creator-tutorial.html>

Testing and Feedback are welcome!


[19-Nov-19 05:36 AM] gcharang#6833
Pinned a message.


[19-Nov-19 05:37 AM] jl777c#5810
@Mihailo plz review the docs for accuracy


[19-Nov-19 05:57 AM] Mihailo#5902
Ok, np.


[20-Nov-19 02:15 AM] Mihailo#5902
@gcharang I have read the documents, here are my remarks.
Intro:
- "To prevent their deposit from being liquidated, the user can either return some of the USDK coins or deposit more tokenized KMD to maintain a good debt ratio."  -> user must either cover whole debt or deposit more KMD, there is no partial return
- In Pegs Anatar Module Flow, I would add a step where user deposits external crypto into tokens

User tutorial:
- Add the part between KMD deposit and gateway deposit: You must wait for the block where the KMD tx is mined to be submitted to oracle. This can be checkd using oraclessamples call to fetch for exmaple last 5 data entries and check if the height is more or equal to the heigth of the KMD block where the tx is.

Craetor tutorial:
- The synthetic price won't work as it is refering to KMD and the external chain used is KMDTEST. Basically everything must match: external coin name, name in synthetic, token name and oracle name!

{Reactions}
👍 

[20-Nov-19 02:45 AM] Mihailo#5902
@jl777c One more thing regarding locktime. As users that are depositing use z_sendmany to send to deposit address, I think locktime isn't set there. So we must initially spend the utxo to set locktime and then it can stay for accumulating reward?
This is all ofc for KMD chain only, as others don't have rewards...


[20-Nov-19 02:54 AM] jl777c#5810
i had thought z_sendmany set locktime. can people use sendmany?


[20-Nov-19 03:02 AM] Mihailo#5902
Ha, you are correct. Locktime is set in z_sendmany. 
Yes, we have used z_sendmany as deposit tx in all tutorials from the start. I don't know why that was but I inherited it when I start working on gateways.


[20-Nov-19 03:04 AM] jl777c#5810
probably because z_sendmany can specify a source address


[20-Nov-19 03:04 AM] Mihailo#5902
Yes, I remebered now.


[20-Nov-19 08:37 AM] Mihailo#5902
@jl777c I have one dilema. When you make the withdraw and it is broadcasted on external chain, than that utxo won't show in listunspent until tx is mined. Currently I have posted deposit address balance to oracle by using listunspent. On my test chain I had just one utxo so when withdraw is broadcasted I don't have any more utxo so the balance is 0. My question is, should I check the mempool also to see if there are some vouts that goes to deposit address? (it might catch also deposit tx and count those for balance too)


[20-Nov-19 08:38 AM] jl777c#5810
in non-consensus code, you can scan mempool for balance calcs


[20-Nov-19 08:40 AM] Mihailo#5902
This is basically check in oraclefeed. And it will post it to oracle along with block data. And then in rpc and validation the balance will be checked from oracle to see if the withdraw tx can be created for given amount


[20-Nov-19 08:54 AM] jl777c#5810
ok, yes, use the mempool info. you are doing a majority test, so it should match in most of the nodes


[20-Nov-19 08:55 AM] jl777c#5810
maybe make the oracle have confirmed and uncomfirmed balance?


[20-Nov-19 08:55 AM] jl777c#5810
that way, a discrepancy in the mempool info can be somehow accounted for


[29-Nov-19 06:55 AM] SHossain#0007
We have new MBTCTEST chain for those who are testing. Please delete old komodo source dir, data dir. Clone fresh, compile as per the guide and start the KMD & MBTCTEST chain. You should be able to make multiple withdraws, but they will be processed serialized (one by one). The withdraw should complete fast as after withdraw tx is confrimed it will be signed and broadcasted immediatelly. So you can check on your KMD node with `getunconfirmedbalance` to see it before the block is mined!
Initial Guide: https://gist.github.com/himu007/5b61ebb330ee46c4c1f7518d34e30d42
Break the system if you can with your testing power.


[29-Nov-19 07:02 AM] mrlynch#5735
gimme a few and i'll jump on it as well

{Reactions}
👌 

[29-Nov-19 07:07 AM] SHossain#0007
the new `bindtxid` on MBTCTEST chain is `564027c872ee30a82aa9ce7b2f6a5041669d4b63ea9d86d7253c4b773fce22ab`. easily identifiable from the chain start param where it appears as `-earlytxid`


[29-Nov-19 07:14 AM] SHossain#0007
@CHMEX please update the explorer with fresh clone of komodo and with fresh data dir as per the guide above when you get some time. `git pull` will not work.


[29-Nov-19 07:28 AM] SHossain#0007
@Mihailo my KMD deposit tx has 20 confirms, but, can't get it imported into MBTCTEST. getting this error
```
{
  "result": "error",
  "error": "couldnt find merkleroot for ht.1639501 KMD oracle.40e2959f8063a3ff52fadfecf17cd0a393aa075a1091518d438bb5cbc72ad9e8 m.0 vs n.2"
}
```
are your systems online?


[29-Nov-19 07:46 AM] Mihailo#5902
They should be, let me check.


[29-Nov-19 07:49 AM] Mihailo#5902
On one node KMD is not running, on the other oraclefeed is not running. I'll check it out, but can't do it now as some virus is breaking me and I don't feel well. I'll let you know when I fix it.


[29-Nov-19 07:49 AM] SHossain#0007
thanks


[29-Nov-19 07:49 AM] SHossain#0007
i'll wait


[29-Nov-19 07:50 AM] SHossain#0007
i suspected oraclefeed wasn't working


[29-Nov-19 10:53 AM] CHMEX#0686
@SHossain  updated and synced


[29-Nov-19 10:55 AM] SHossain#0007
thank you very much 👍


[30-Nov-19 12:04 AM] Mihailo#5902
It seems there is a memory leak on oraclefeed, so I'll have to figure it out where it is.


[30-Nov-19 01:03 AM] Mihailo#5902
Found it and fixed it. I think nodes will be running fine now.


[30-Nov-19 07:32 AM] SHossain#0007
The last deposit i've done yesterday, still can't import it


[30-Nov-19 08:48 AM] SHossain#0007
new deposits are working fine


[30-Nov-19 08:49 AM] jl777c#5810
yes, we dont have support for recovering missed deposits (yet)


[30-Nov-19 08:49 AM] jl777c#5810
when we do, there is already a missed deposit that should be found


[30-Nov-19 08:50 AM] SHossain#0007
it's fine for now. the multisig account has those deposits. so, withdrawing wouldn't be an issue as we have more funds in there 🙂


[30-Nov-19 08:50 AM] SHossain#0007
i'm just depositing only 0.01 KMD each time


[30-Nov-19 08:53 AM] SHossain#0007
as you mentioned couple of days ago `to submit the missing heights on oraclefeed startup` would be nice to have


[30-Nov-19 08:57 AM] SHossain#0007
i will try to use different `nvout` and `amount` for importing than what i'm depositing. initial tests showed i can't do that as using fake amounts doesn't validate the `burntxid`
```
{
  "result": "error",
  "error": "burntxid didnt validate!"
}
```


[30-Nov-19 08:58 AM] SHossain#0007
i wonder what other case i can use to abuse the deposits 🤔


[30-Nov-19 09:01 AM] SHossain#0007
if i ONLY change `nvout` (the marker tx amount) to `0` or anything else, it validates the import


[30-Nov-19 09:02 AM] SHossain#0007
but, that marker amount doesn't do anything extra as that is not the deposit amount and it doesn't get credited


[30-Nov-19 09:39 AM] SHossain#0007
```
./komodo-cli -ac_name=MBTCTEST importgatewayaddress
{
  "result": "success",
  "ImportGatewayCCAddress": "RXJT6CRAXHFuQ2UjqdxMj7EfrayF6UJpzZ",
  "ImportGatewayCCBalance": 0.00001000,
  "ImportGatewayNormalAddress": "RNFRho63Ddz1Rh2eGPETykrU4fA8r67S4Y",
  "ImportGatewayNormalBalance": 0.00000000,
  "ImportGatewayCCTokensAddress": "RAczoarH6zfAzcsY2dX6xuCm6tEU2K6tVK",
  "myCCAddress(ImportGateway)": "RD3Fjm4m7p5esuukUzxsAMepiu2Erhq9rv",
  "myCCbalance(ImportGateway)": 0.00000000,
  "myaddress": "REz25A9g1yoD6ioXfb7g7kDTRqNKnWHvHK",
  "mybalance": 0.03050000
}
```


[30-Nov-19 09:39 AM] SHossain#0007
3 deposits of `0.01` and 5 mined block reward


[30-Nov-19 10:26 AM] SHossain#0007
it seems marker amount doesn't matter much. tried with lower than 0.0001 and it worked
```
./komodo-cli z_sendmany "RUX3snTWZmt6bnTcJAi3gh9NvxAjk5ne6K" '[{"address":"REz25A9g1yoD6ioXfb7g7kDTRqNKnWHvHK","amount":0.000001},{"address":"bJktnoQ8tdvfU4cSx2VmL17MgDUqzcYDPV","amount":0.001}]'
```


[30-Nov-19 10:27 AM] SHossain#0007
for some reason this deposit tx not being credited into my account for some time `931f313c815cd593ffb2f3d96e09882dfdd9fc4edbccf22531276575d82b9046`


[30-Nov-19 10:28 AM] SHossain#0007
it was credited after 7 MBTCTEST blocks


[30-Nov-19 10:28 AM] SHossain#0007
```
new hash 37d8db636781d7820bb8140a21e37a7765464153709768490b0e76092bb39f73
check 37d8db636781d7820bb8140a21e37a7765464153709768490b0e76092bb39f73
end of loop
deposit txid.e31b4c174a5a93dc2ffef4a9efd93d70449fa1dfb0137979f3aca81ab46cbff9 m.1 of n.2
verified proof for burntxid in merkleroot
verified proof for burntxid in merkleroot
verified proof for burntxid in merkleroot
AddToWallet 931f313c815cd593ffb2f3d96e09882dfdd9fc4edbccf22531276575d82b9046  new
UpdateTip: new best=00a5cf40903349a3e64713cfb36df7593047b4f778ed5fd62f2375b10b4893ef  height=3610  log2_work=19.07974  log2_stake=-inf  tx=7174  date=2019-11-30 18:21:50 progress=1.000000  cache=0.5MiB(1573tx)
AddToWallet 931f313c815cd593ffb2f3d96e09882dfdd9fc4edbccf22531276575d82b9046  
UpdateTip: new best=015edf60152522ebcd9c9bd895498ed6dcc77a4d50261eb31501acaedde266e2  height=3611  log2_work=19.080091  log2_stake=-inf  tx=7177  date=2019-11-30 18:22:45 progress=1.000000  cache=0.5MiB(1572tx)
AddToWallet 931f313c815cd593ffb2f3d96e09882dfdd9fc4edbccf22531276575d82b9046  
UpdateTip: new best=016b2f0fc50e7ef88c2ea9b94d1324244cc54cba1e4ff87f96e4b9fb48e73cef  height=3612  log2_work=19.08044  log2_stake=-inf  tx=7182  date=2019-11-30 18:23:07 progress=1.000000  cache=0.5MiB(1575tx)
```


[30-Nov-19 10:28 AM] SHossain#0007
```
AddToWallet 931f313c815cd593ffb2f3d96e09882dfdd9fc4edbccf22531276575d82b9046  
UpdateTip: new best=01d359f8c98ef1aac958789459817550c7c1c609c5a060bb0073e543e466869b  height=3613  log2_work=19.080789  log2_stake=-inf  tx=7187  date=2019-11-30 18:23:57 progress=1.000000  cache=0.5MiB(1578tx)
AddToWallet 931f313c815cd593ffb2f3d96e09882dfdd9fc4edbccf22531276575d82b9046  
UpdateTip: new best=011ad056539f83e3f7a0ee3e02b27a4e1d7eb55438210c8267ef6786cfd05052  height=3614  log2_work=19.081127  log2_stake=-inf  tx=7192  date=2019-11-30 18:24:46 progress=1.000000  cache=0.5MiB(1578tx)
AddToWallet 931f313c815cd593ffb2f3d96e09882dfdd9fc4edbccf22531276575d82b9046  
UpdateTip: new best=01b3b988bafb19d51a8cf89fb1ae7ac1ed78d4fb35366bc74401e05c0f3eeb5e  height=3615  log2_work=19.08146  log2_stake=-inf  tx=7201  date=2019-11-30 18:26:12 progress=1.000000  cache=0.5MiB(1583tx)
AddToWallet 931f313c815cd593ffb2f3d96e09882dfdd9fc4edbccf22531276575d82b9046  
UpdateTip: new best=01668aec3df3b1f83a802625b4df7bb3d8b48cd319bc2ccb15eefa15a9e3c4c6  height=3616  log2_work=19.081788  log2_stake=-inf  tx=7208  date=2019-11-30 18:27:16 progress=1.000000  cache=0.5MiB(1583tx)
AddToWallet 931f313c815cd593ffb2f3d96e09882dfdd9fc4edbccf22531276575d82b9046  
verified proof for burntxid in merkleroot
UpdateTip: new best=006fc436e58c84bf0d9a4f42cec195ce559f4f015da4a898f41d7b1343a6e593  height=3617  log2_work=19.082118  log2_stake=-inf  tx=7210  date=2019-11-30 18:27:19 progress=1.000000  cache=0.5MiB(1586tx)
AddToWallet 931f313c815cd593ffb2f3d96e09882dfdd9fc4edbccf22531276575d82b9046  update
```


[01-Dec-19 04:39 AM] Mihailo#5902
It didn't got into mempool probably for some time, don't know why, had this things before


[01-Dec-19 04:40 AM] Mihailo#5902
I think it is a node sync problem...


[01-Dec-19 04:41 AM] SHossain#0007
it's not critical issue. i just wanted to report


[01-Dec-19 04:41 AM] SHossain#0007
i'll get to testing again tomorrow


[02-Dec-19 05:24 AM] SHossain#0007
wonder if it's just me or oraclefeed validates txs very quickly


[02-Dec-19 05:24 AM] SHossain#0007
no need to wait longer for the txid to be validated by oraclefeed


[02-Dec-19 05:25 AM] Mihailo#5902
Hehe, I just wanted to write to JL about that. In some refactor I removed the 10 block behind limit


[02-Dec-19 05:26 AM] SHossain#0007
makes sense. deposits are faster now


[02-Dec-19 05:27 AM] SHossain#0007
i will start testing parallel withdrawing now.


[02-Dec-19 05:30 AM] Mihailo#5902
@jl777c I wanted to see is there some smart reason why you made initally oraclefeed to be 10 blocks behind?


[02-Dec-19 05:33 AM] SHossain#0007
maybe for security? as dPoW works at 10 min interval


[02-Dec-19 05:35 AM] Mihailo#5902
Yeah, probably. To try to leave it to be notarized.


[02-Dec-19 05:35 AM] Mihailo#5902
I'll return this soon.


[02-Dec-19 05:38 AM] SHossain#0007
@Mihailo do you think making 2 or 3 withdraw HEX first and brodcasting them one by one would be parallel?


[02-Dec-19 05:41 AM] Mihailo#5902
Parallel in this case is basically to broadcast multiple withdraws before withdraws are processed. So basically the best test would be to broadcast few withdraws in one block and then check if they are going to be received to the address one by one. You can do several mportgatewaywithdraw and sendrawtransaction fast so that they get into same block.


[02-Dec-19 05:43 AM] SHossain#0007
cool. my commands are ready. will issue them now. if you like, you can monitor your processing nodes


[02-Dec-19 05:43 AM] Mihailo#5902
Ok


[02-Dec-19 05:43 AM] jl777c#5810
yes, to have things notarized, the delay was added


[02-Dec-19 05:43 AM] jl777c#5810
for testmode, not needed


[02-Dec-19 05:44 AM] Mihailo#5902
@SHossain You can also monitor with
```komodo-cli -ac_name=MBTCTEST importgatewaypendingsignwithdraws 564027c872ee30a82aa9ce7b2f6a5041669d4b63ea9d86d7253c4b773fce22ab KMD```


[02-Dec-19 05:44 AM] SHossain#0007
did 3


[02-Dec-19 05:45 AM] SHossain#0007
```
./komodo-cli -ac_name=MBTCTEST importgatewaypendingsignwithdraws 564027c872ee30a82aa9ce7b2f6a5041669d4b63ea9d86d7253c4b773fce22ab KMD
{
  "coin": "KMD",
  "pending": [
    {
      "withdrawtxid": "58ac739cf4e82034ddc8c0d985b2da0ff369904a6e037172426b553fe7478da5",
      "withdrawtxidaddr": "RF2BX7Pst1qEpKM8dHoJBGxqHLTZzYC6kN",
      "withdrawaddr": "RUX3snTWZmt6bnTcJAi3gh9NvxAjk5ne6K",
      "amount": "0.01000000",
      "confirmed_or_notarized": false,
      "last_txid": "58ac739cf4e82034ddc8c0d985b2da0ff369904a6e037172426b553fe7478da5",
      "number_of_signs": 0
    }
  ],
  "queueflag": 0
}
```


[02-Dec-19 05:45 AM] Mihailo#5902
Yes, that is the first one


[02-Dec-19 05:45 AM] SHossain#0007
ok. shouldn't the queueflag show more 2?


[02-Dec-19 05:45 AM] SHossain#0007
just thinking


[02-Dec-19 05:46 AM] SHossain#0007
```
./komodo-cli -ac_name=MBTCTEST importgatewaypendingsignwithdraws 564027c872ee30a82aa9ce7b2f6a5041669d4b63ea9d86d7253c4b773fce22ab KMD
{
  "coin": "KMD",
  "pending": [
    {
      "withdrawtxid": "c6066567447dc30f751688b9d8192e2b112cb06c2bdf6cb2d4c21f362251ae94",
      "withdrawtxidaddr": "RTaBMw4BG4A6tYhSH7ExjQUKHGZuGGV7XQ",
      "withdrawaddr": "RUX3snTWZmt6bnTcJAi3gh9NvxAjk5ne6K",
      "amount": "0.01000000",
      "confirmed_or_notarized": false,
      "last_txid": "c6066567447dc30f751688b9d8192e2b112cb06c2bdf6cb2d4c21f362251ae94",
      "number_of_signs": 0
    }
  ],
  "queueflag": 0
}
```


[02-Dec-19 05:46 AM] Mihailo#5902
Ok,No, queueflag is just a flag meaning if you are a signer and have a queue or not


[02-Dec-19 05:46 AM] SHossain#0007
different one above


[02-Dec-19 05:46 AM] Mihailo#5902
Yes, it will show the latest I think


[02-Dec-19 05:46 AM] SHossain#0007
cool


[02-Dec-19 05:46 AM] SHossain#0007
guess i was fast enough with 3 withdraws


[02-Dec-19 05:47 AM] Mihailo#5902
Depending on how it is mined


[02-Dec-19 05:48 AM] Mihailo#5902
Ok, problem


[02-Dec-19 05:51 AM] SHossain#0007
one deposit arrived in my KMD wallet
```
  {
    "txid": "596f4d563010126829e1881141ce32acb141582f9b227ba27930858b8ac16eaf",
    "vout": 0,
    "generated": false,
    "address": "RUX3snTWZmt6bnTcJAi3gh9NvxAjk5ne6K",
    "segid": 17,
    "amount": 0.00994000,
    "interest": 0.00000000,
    "scriptPubKey": "76a914d3095dcf98417aae49e544f1eb8f3f734e5b1d3188ac",
    "rawconfirmations": 1,
    "confirmations": 1,
    "spendable": true
  }
```


[02-Dec-19 05:52 AM] Mihailo#5902
Yes, that one went


[02-Dec-19 05:52 AM] Mihailo#5902
But, the other two were created on same utxo.


[02-Dec-19 05:52 AM] Mihailo#5902
I have to check what is going on.


[02-Dec-19 05:53 AM] Mihailo#5902
I'll mark those withdraws done, but funds won't be lost. You'll just need to have some more coins to withdraw that...


[02-Dec-19 05:53 AM] SHossain#0007
it's fine. if needed you can keep those funds into gateway address for testing


[02-Dec-19 05:54 AM] SHossain#0007
the way i created those withdraws was
1. issue `importgatewaywithdraw` 
2. issue `sendrawtransaction` with the hex from above
3. same `1` & `2` for 2 more withdraws


[02-Dec-19 05:55 AM] Mihailo#5902
Yeah, that was fine

{Reactions}
👍 

[03-Dec-19 12:50 AM] Alright#0419
anyone have peers for this MBTCTEST chain?


[03-Dec-19 12:50 AM] Alright#0419
pinned message has no IPs


[03-Dec-19 12:53 AM] jl777c#5810
```komodod -ac_name=MBTCTEST -ac_cc=2 -ac_import=KMD -ac_end=1 -ac_reward=1 -ac_supply=1000 -ac_perc=0 -dns=0 -dnsseed=0 -listenonion=0 -debug=importgateway-2 -printtoconsole=1 -addnode=116.203.17.138 -addnode=78.47.131.224 -earlytxid=564027c872ee30a82aa9ce7b2f6a5041669d4b63ea9d86d7253c4b773fce22ab```

{Reactions}
👍 (2) 

[03-Dec-19 12:58 AM] Alright#0419
Could you explain the interaction between kmd node and MBTCTEST node? Must KMD be running the latest pegs code? Is it only needed on gateway?


[03-Dec-19 01:03 AM] jl777c#5810
only the gateways needs to run the KMD


[03-Dec-19 01:04 AM] jl777c#5810
of course if you are making deposits, you probably want a KMD node, maybe eventually we can also support using nspv node


[03-Dec-19 01:04 AM] Alright#0419
is the deposit any special kind of tx?


[03-Dec-19 01:05 AM] jl777c#5810
have you read the pinned docs?


[03-Dec-19 01:05 AM] Alright#0419
reading a lot right now 😅


[03-Dec-19 01:05 AM] jl777c#5810
maybe ask questions after you have read them


[03-Dec-19 01:05 AM] Alright#0419
code comments, blog posts, wikis


[03-Dec-19 01:05 AM] Alright#0419
getting there, piecing it together


[03-Dec-19 01:05 AM] jl777c#5810
any questions you have are improvements that can be made to the docs


[03-Dec-19 01:06 AM] Alright#0419
👌


[03-Dec-19 01:06 AM] jl777c#5810
if you cant figure things out by what is written, then i consider it a bug that needs to be fixed

{Reactions}
👍 

[03-Dec-19 03:47 AM] SHossain#0007
last night i did a single withdraw of `0.01128`, that worked fine


[03-Dec-19 03:57 AM] SHossain#0007
received amount `0.01122`


[03-Dec-19 04:40 AM] SHossain#0007
that emptied my balance. i'll deposit some more and be prepared for @Mihailo to appear with fixes on parallel withdraw


[03-Dec-19 05:23 AM] SHossain#0007
funds deposited and imported
```
{
  "result": "success",
  "ImportGatewayCCAddress": "RXJT6CRAXHFuQ2UjqdxMj7EfrayF6UJpzZ",
  "ImportGatewayCCBalance": 0.00001000,
  "ImportGatewayNormalAddress": "RNFRho63Ddz1Rh2eGPETykrU4fA8r67S4Y",
  "ImportGatewayNormalBalance": 0.00000000,
  "ImportGatewayCCTokensAddress": "RAczoarH6zfAzcsY2dX6xuCm6tEU2K6tVK",
  "myCCAddress(ImportGateway)": "RD3Fjm4m7p5esuukUzxsAMepiu2Erhq9rv",
  "myCCbalance(ImportGateway)": 0.00000000,
  "myaddress": "REz25A9g1yoD6ioXfb7g7kDTRqNKnWHvHK",
  "mybalance": 0.10000000
}
```


[03-Dec-19 05:31 AM] SHossain#0007
@mrlynch @siu @gcharang @Paro @Alright @smkhound let me know if you have any issues following the gist guide.

{Reactions}
👍🏻 

[03-Dec-19 05:32 AM] SHossain#0007
constructing a call can take some time. but, if you use a notepad or something like that, it becomes easier


[03-Dec-19 05:33 AM] SHossain#0007
Alright found `MY_DEST_CC_ADDRESS` was confusing on the guide. I changed that to `myaddress` for the deposits which actually matches my above output.


[03-Dec-19 06:10 AM] Paro#7842
use it ? https://gist.github.com/himu007/5b61ebb330ee46c4c1f7518d34e30d42


[03-Dec-19 06:12 AM] Paro#7842
and this https://discordapp.com/channels/412898016371015680/564807360472940575/651345320411791361


[03-Dec-19 06:13 AM] Mihailo#5902
@SHossain I will have the fix tomorrow probably, had to change the way it was done to fix current problem.

{Reactions}
👍🏻 (2) 

[03-Dec-19 06:18 AM] SHossain#0007
@Paro yes. the guide already has the updated chain param since Mihailo updated it

{Reactions}
👍🏻 

[03-Dec-19 06:18 AM] SHossain#0007
thanks @Mihailo


[03-Dec-19 07:49 AM] SHossain#0007
@CHMEX the explorer has crashed i assume https://mbtctest.explorer.dexstats.info/


[03-Dec-19 07:49 AM] SHossain#0007
showing 502 bad gateway error


[03-Dec-19 07:53 AM] SHossain#0007
no rush. when you get time to fix it is ok


[03-Dec-19 08:12 AM] CHMEX#0686
Indeed now it runs again


[03-Dec-19 08:14 AM] SHossain#0007
Thanks very much @CHMEX


[03-Dec-19 09:40 AM] SHossain#0007
@msig-signers please generate 2 keys SECURELY as you would do for your notary nodes. 1 key we will use soon for testing and other will be used for production. please don't use those keys with Agama or any other application. best to generate them on an offline computer. once you have keys, please DM me the test `pubkey` only. keep the production key safe. and, as always, never share your private key 🙂

{Reactions}
👍 

[03-Dec-19 10:34 AM] SHossain#0007
Also, feel free to ask me if you have any question.


[03-Dec-19 11:13 AM] Mihailo#5902
I have paused oraclefeed as I have a bug in new withdraw process. I'll continue it tomorrow. Hold any deposits for now.

{Reactions}
👌 

[03-Dec-19 11:14 AM] SHossain#0007
Thanks. not depositing any more now. i have enough to test withdraws when you resume


[03-Dec-19 11:58 AM] mrlynch#5735
`please don't use those keys with Agama` 🤣 i'll ping you the test key shortly

{Reactions}
👌 (2) abusedsmily 

[04-Dec-19 10:39 AM] Mihailo#5902
@jl777c I have a case I already mentioned, but now it is making me a real problem. Now that signing is in mempool, it often happens that nodes start signing withdraw at the same time and they create a separate sign txs both with one sign and spending the same utxo from withdraw. Then one of them gets mined but the other that is not mined stays still in wallet of the node which created it and every next block it is trying to add it to mempool. I think we have to address this problem that when the chain tip moves every tx that refers to unspent utxo should be discarded. I don't know if this will break something, and maybe someone made it like it is now at some point!


[04-Dec-19 10:41 AM] jl777c#5810
we probably need to add a specific test for an invalid utxo in mempool and purge it. would that fix the issue?


[04-Dec-19 10:43 AM] Mihailo#5902
Yes, so if on the next block the tx is removed then it will continue signing normaly until again 2 or more nodes does the same. I was thinking how could I sync the oraclfeed nodes so that there is no race condition, but didn't think of anything.


[04-Dec-19 10:44 AM] Mihailo#5902
If you have some cool idea happy to hear it.


[04-Dec-19 10:46 AM] Mihailo#5902
When I restart the daemon, tx is gone. But if daemon stays running, the tx will be there indefinetly (I think)


[04-Dec-19 10:48 AM] jl777c#5810
there is code that purges the mempool when a tx expires


[04-Dec-19 10:48 AM] jl777c#5810
you can look at that to see how to properly purge a tx


[04-Dec-19 10:49 AM] jl777c#5810
then on a new block, iterate the mempool (actually i think in main.cpp it already iterates the mempool) and make sure all tx in the mempool still have valid inputs


[04-Dec-19 10:49 AM] Mihailo#5902
Ok, I'll get on it now.


[04-Dec-19 10:50 AM] jl777c#5810
to make different nodes select different utxos, you can make them search the utxo list in a sorted order, offset by their msig id


[04-Dec-19 10:51 AM] jl777c#5810
so first msig node would scan offset 0, N, 2*N, ..., 1, N+1, 2*N+1, ...


[04-Dec-19 10:51 AM] Mihailo#5902
That is not a problem, for now there is only one withdraw at a time processed.


[04-Dec-19 10:51 AM] jl777c#5810
what do you mean by "sync the oraclfeed nodes so that there is no race condition"


[04-Dec-19 10:51 AM] Mihailo#5902
But the problem is that for example the first sign that happens, 2 nodes take it at the same time and broadcast signtx. I want to sync them like that only one signs at the moment.


[04-Dec-19 10:53 AM] Mihailo#5902
Before the first node that signed the tx broadcasted it to mempool and that tx reached 2nd node mempool, at that point other node thinks it needs to take the withdraw for signing.


[04-Dec-19 10:53 AM] jl777c#5810
use the same idea


[04-Dec-19 10:53 AM] jl777c#5810
each node gets a msig id


[04-Dec-19 10:53 AM] jl777c#5810
and each node only signs when the timestamp is id % N


[04-Dec-19 10:54 AM] Mihailo#5902
Hmmm, nice...


[04-Dec-19 10:54 AM] jl777c#5810
maybe 1 second is too fast, as the tx needs to propagate, if so, you can make it 2 seconds


[04-Dec-19 10:57 AM] Mihailo#5902
Yeah, so this would allow 30 nodes (which is enough) and each node can take id % N *2 second to process. Eventualy if some nodes are not live it could be that it will need 1 minute to sign it completely, but that is acceptable.


[04-Dec-19 10:58 AM] Mihailo#5902
And I would use the time from komodo (GetTime()) to check ?


[04-Dec-19 11:00 AM] jl777c#5810
assume all msig signing nodes have done ntp recently so they are in sync to the millisecond


[04-Dec-19 11:00 AM] jl777c#5810
as long as each node can process multiple withdraws during their timeslot, it is all good


[04-Dec-19 11:00 AM] jl777c#5810
we get a pipelined signing process with minimal collisions


[04-Dec-19 11:00 AM] jl777c#5810
another way to avoid collisions is to add random sleeps


[04-Dec-19 11:01 AM] jl777c#5810
and make sure to update state often so if a node sees another node did something, it wont do anything to contradict it


[04-Dec-19 11:01 AM] Mihailo#5902
Well, nodes will not process multiple withdraws as only one withdraw at the time is processed. But maybe we could expand it later with this idea to choose different utxos, and monitor which utxos are already used...


[04-Dec-19 11:04 AM] jl777c#5810
maybe a better way is to go as fast as possible, but wait for an earlier msig id to sign it


[04-Dec-19 11:04 AM] jl777c#5810
so at first second, msig.0 would be the only one that signs it


[04-Dec-19 11:05 AM] jl777c#5810
if he doesnt, then the next second msig,1 (and msig.0) are eligible to sign


[04-Dec-19 11:05 AM] jl777c#5810
etc.


[04-Dec-19 11:05 AM] jl777c#5810
once a single signature tx is seen, then the next msig.id is first to sign, the next second the next msig id is eligibile, etc.


[04-Dec-19 11:06 AM] jl777c#5810
i think a tx will get M signatures in close to N seconds


[04-Dec-19 11:06 AM] Mihailo#5902
Yeah, maybe serialization is good. But how long should it wait until next msig.id takes for signing? msig.0 can be down...


[04-Dec-19 11:07 AM] jl777c#5810
1 second


[04-Dec-19 11:07 AM] jl777c#5810
if nothing appears, then msig.1 takes the lead


[04-Dec-19 11:07 AM] jl777c#5810
after 2 seconds if nothing, then msig.2 takes the lead


[04-Dec-19 11:08 AM] jl777c#5810
then 3, 4, 5, ... to N-M


[04-Dec-19 11:08 AM] jl777c#5810
that is for the first signature


[04-Dec-19 11:08 AM] jl777c#5810
then once there is a single signature tx in the mempool, the next msig.id has one second to sign and broadcast


[04-Dec-19 11:08 AM] jl777c#5810
if not, then first+2, first+3, ... to N-M-1


[04-Dec-19 11:09 AM] jl777c#5810
now we have a 2 signature tx, so the msig.second+1 is eligible the first timeslot


[04-Dec-19 11:09 AM] jl777c#5810
second is the msig.id of the second signer


[04-Dec-19 11:13 AM] Mihailo#5902
Ok, but there is still a problem. If in 1st second msig.1 took the tx for signing and it broadcasted but it didn't propagate to msig.2 node in 2nd second msig.2 will take the initial withdraw to sign.


[04-Dec-19 11:14 AM] Mihailo#5902
Basically if in 2 seconds it still doesn't propagate same will happen, but mostly it will be ok in 2 seconds.


[04-Dec-19 11:21 AM] jl777c#5810
msig.3 would see both and then only pick one of the two, so maybe it is not a big issue?


[04-Dec-19 11:21 AM] jl777c#5810
msig.2 would refrain from signing the first one, as it already signed it as the initial signer


[04-Dec-19 11:21 AM] Mihailo#5902
Ohhh


[04-Dec-19 11:21 AM] Mihailo#5902
Ok, get it


[04-Dec-19 11:22 AM] jl777c#5810
maybe there are some edge cases i dont see as this is just an intuitive design off the top of my head, but i think it should allow pretty decent practical performance


[04-Dec-19 11:22 AM] Mihailo#5902
But it may be the issue with this. 1&2 sign the same and spend same input, 3 sees both and chooses 1, but 2 gets mined and 1 is invalid then...


[04-Dec-19 11:23 AM] jl777c#5810
if 1 and 2 sign the same one, then only one will be accepted by 3 into its mempool


[04-Dec-19 11:23 AM] jl777c#5810
also, if each node is choosing utxo in an interleaved fashion, they wouldnt be choosing the same utxo


[04-Dec-19 11:24 AM] jl777c#5810
let us imagine 1 and 2 both submit singly signed tx. now 3 will either accept 1 or 2, if it accepts 1, it will wait one second for 2 to sign it, but it wont happen and then it will sign it the next second


[04-Dec-19 11:24 AM] jl777c#5810
if it accepts 2, then it just immediately signs it


[04-Dec-19 11:24 AM] Mihailo#5902
utxos cannot be chosen interleaved for siging. So when signing there is a marker which is spent in each signing iteration. So it must be serialezed.


[04-Dec-19 11:25 AM] jl777c#5810
ok


[04-Dec-19 11:25 AM] jl777c#5810
still the waiting for the signing time slot should resolve these tx signing forks


[04-Dec-19 11:25 AM] Mihailo#5902
I think it may work. Let me try....


[04-Dec-19 11:26 AM] jl777c#5810
if 3 and 4 have the same issue, then msig.5 would choose between 1+3 or 2+3 or 1+4 and 2+4


[04-Dec-19 11:26 AM] jl777c#5810
oh, the same utxo can be accepted into all the mempools as it is a multisig


[04-Dec-19 11:27 AM] jl777c#5810
oh, its the mempool on the assetchain!


[04-Dec-19 11:27 AM] Mihailo#5902
No, it is not a multisig. The signing is regular!


[04-Dec-19 11:27 AM] jl777c#5810
so you can have a baton to get mutual exclusion


[04-Dec-19 11:27 AM] Mihailo#5902
There are two types of utxos. The external utxos, and AC utxos.


[04-Dec-19 11:27 AM] Mihailo#5902
baton is basically marker


[04-Dec-19 11:27 AM] jl777c#5810
anyway, i think you have the idea of how to solve this now


[04-Dec-19 11:27 AM] Mihailo#5902
Yes


[04-Dec-19 11:27 AM] jl777c#5810
let me know if anything comes up that makes it not work so well


[04-Dec-19 11:28 AM] Mihailo#5902
I'll try it. Thnx


[04-Dec-19 12:03 PM] Mihailo#5902
@jl777c BTW, @Alright put my attention to it. The N for MofN is now limitted to 15. Do we want to make it little bit more, like 30?


[04-Dec-19 12:04 PM] Alright#0419
was thinking like a matrix of signers could work?


[04-Dec-19 12:04 PM] Alright#0419
many b addresses


[04-Dec-19 12:15 PM] jl777c#5810
15 is the max that fits


[04-Dec-19 12:15 PM] jl777c#5810
practically speaking 7 of 13 signers should be sufficient


[04-Dec-19 12:16 PM] Alright#0419
can't scale it up with additional multisigs?


[04-Dec-19 12:16 PM] Alright#0419
7 nodes down at once doesn't seem unlikely


[04-Dec-19 12:16 PM] Alright#0419
especially if purposefully taken down


[04-Dec-19 12:17 PM] jl777c#5810
when they come back up, it should process whatever was missed


[04-Dec-19 12:17 PM] jl777c#5810
finding 30 long term reliable operators will be a lot harder than 13


[04-Dec-19 12:19 PM] Alright#0419
keep them behind tor if possible 😅


[04-Dec-19 12:22 PM] Mihailo#5902
Signers will be notary opreators.


[04-Dec-19 12:51 PM] Alright#0419
not saying this is at all practical, just a bit curious about the math behind it now that I'm thinking about it. Given for example 60 signers, there are 386206920 subsets of 7 signers. Obviously you couldn't have this amount of addresses, but I'm trying to figure out how much more "coverage"(not sure what the term would be) we could get by having say 10 deposit multisigs.


[04-Dec-19 12:54 PM] Mihailo#5902
I don't get why you keep thinking about multiple msgi addresses? For one set of pubkeys you have one address. You don't get anything by having more addresses, it is still the same pubkeys.
What is your concern about 15 signers exactly?


[04-Dec-19 12:54 PM] Alright#0419
Am just brain storming, will take it elsewhere if you don't want to hear it


[04-Dec-19 12:55 PM] Alright#0419
again, `not saying this is at all practical` literally just curious about this math problem


[04-Dec-19 12:56 PM] Mihailo#5902
`but I'm trying to figure out how much more "coverage" we could get by having say 10 deposit multisigs.`
What you mean by this?


[04-Dec-19 12:56 PM] Alright#0419
so with 386206920 total addreses, any 7/60 could sign, this would be 100% "coverage"


[04-Dec-19 12:56 PM] Alright#0419
sorry, I know that's confusing 🤣


[04-Dec-19 12:57 PM] Mihailo#5902
Don't get `any 7/60 can sign`. Now also any 7/60 could sign (if N could be 60)


[04-Dec-19 12:57 PM] Alright#0419
eh never mind, don't let me waste your time


[04-Dec-19 12:58 PM] Mihailo#5902
I'm just checking if you didn't maybe get something right so you are thinking in wrong direction.


[04-Dec-19 12:58 PM] Alright#0419
it's not relevant


[04-Dec-19 12:58 PM] Mihailo#5902
That is why I asked what is your concern exactly


[04-Dec-19 01:03 PM] Alright#0419
to be frank, the concern would be the gateway going defunct. I know it's unlikely to happen given the signers, but I wouldn't want to hold coins on these chains for anything but short term


[04-Dec-19 01:04 PM] SHossain#0007
as of today i have collected 7 pubkeys from signers for the test phase. once we have parallel processing ready and initially tested, we can ask them to setup node for testing.


[04-Dec-19 01:04 PM] SHossain#0007
i guess others will submit their keys too soon


[04-Dec-19 01:04 PM] Alright#0419
so was just brain storming on how it might be possible to decrease point of failures(signers)


[04-Dec-19 01:05 PM] Mihailo#5902
Increasing point of failures can be just with bigger N (more different pubkeys and nodes).


[04-Dec-19 01:05 PM] Alright#0419
yes, but 15 is a hard limit unless we hack script code


[04-Dec-19 01:05 PM] Alright#0419
Jl is right though, 7of15 is practical and will work


[04-Dec-19 01:06 PM] Mihailo#5902
I can increase the limit to 10000. But the gateways that will be setup for now will have 13 signers.


[04-Dec-19 01:06 PM] Mihailo#5902
6of13


[04-Dec-19 01:06 PM] SHossain#0007
7 of 13


[04-Dec-19 01:06 PM] Mihailo#5902
Yes


[04-Dec-19 01:06 PM] Mihailo#5902
sorry


[04-Dec-19 01:06 PM] Alright#0419
why 13 not 15?


[04-Dec-19 01:06 PM] Mihailo#5902
That is not a question for me 😉


[04-Dec-19 01:07 PM] SHossain#0007
```
 
jl777cToday at 20:15
15 is the max that fits
practically speaking 7 of 13 signers should be sufficient
```


[04-Dec-19 01:07 PM] SHossain#0007
13 is the lucky number i guess 🙂


[04-Dec-19 01:08 PM] Alright#0419
7 of 15 means 9 signers must disappear to kill gateway
7 of 13 means 7 

Again unlikely to happen, but I don't understand why 13 would be chosen instead of 15


[04-Dec-19 01:10 PM] SHossain#0007
James would have to explain that to you.


[04-Dec-19 01:10 PM] SHossain#0007
we can only speculate different things


[04-Dec-19 01:11 PM] Mihailo#5902
If it was 15 it would be 8of15. To have more than 51% 😉


[04-Dec-19 01:11 PM] Alright#0419
might be something obvious I hadn't considered


[04-Dec-19 01:11 PM] SHossain#0007
`If it was 15 it would be 8of15. To have more than 51% :wink:`
yep


[04-Dec-19 01:11 PM] Alright#0419
increasing sigs isn't always necessarily better


[04-Dec-19 01:11 PM] Alright#0419
it decreases the amount of people that need to disappear to lock funds forever


[04-Dec-19 01:12 PM] Alright#0419
oh sorry, nope


[04-Dec-19 01:12 PM] Mihailo#5902
Yes, but it increases the number of people that needs to be corrupt to steal funds 😉


[04-Dec-19 01:12 PM] Alright#0419
ignore me, just sitting here zoned out still thinking about that math problem


[04-Dec-19 01:12 PM] Alright#0419
I have that wrong anyway


[04-Dec-19 01:14 PM] Alright#0419
oh, no that's right 😫 
8of15 requires only 8 people to disappear compared to 7of15 at 9


[04-Dec-19 01:15 PM] jl777c#5810
after 1 or 2 disappear, a new msig is created


[04-Dec-19 01:15 PM] jl777c#5810
also to do a 13 of 64 multisig, i came up with the notarization method, and while that can be added to KMD, I doubt BTC legacy devs would be open to any such PR


[04-Dec-19 01:16 PM] jl777c#5810
a combined if/else each with a multisig redeemscript can be made, but why do all this?


[04-Dec-19 01:16 PM] jl777c#5810
the solution to disappearing operators is to transfer funds to a new set of signers. i am assuming that can be done or is the chain hardcoded to a specific multisig signers?


[04-Dec-19 01:17 PM] Mihailo#5902
Ah, also forgot that limit of msig address is 15 😉


[04-Dec-19 01:21 PM] jl777c#5810
how is the msig address specified? is there a way to change that after chain is launched?


[04-Dec-19 01:22 PM] SHossain#0007
https://github.com/Mixa84/komodo/wiki/Side-chain-setup-(Import-Gateway-CC)#import-gateway-bind


[04-Dec-19 01:22 PM] SHossain#0007
i guess it's specified at that point of setting up side chains which becomes hardcoded


[04-Dec-19 01:23 PM] Mihailo#5902
How do you mean how it is specified?


[04-Dec-19 01:25 PM] SHossain#0007
can we change the msig address after few months if required without changing chain param or without any hardfork of the chain?


[04-Dec-19 01:26 PM] Mihailo#5902
Oh. Well I think we can change ot if we change the order of pubkeys.


[04-Dec-19 01:27 PM] SHossain#0007
nice. can we remove old key and add new ones on the fly?


[04-Dec-19 01:27 PM] Mihailo#5902
Like in code we can reverse or somthing like that and we would get different addres


[04-Dec-19 01:27 PM] Mihailo#5902
That no


[04-Dec-19 01:28 PM] Mihailo#5902
When a bind tx is made it cannot be changed


[04-Dec-19 01:28 PM] SHossain#0007
for example, if one signer want to stop permanently and we get a new signer, how would we go about that?


[04-Dec-19 01:29 PM] Mihailo#5902
Have to think about it


[04-Dec-19 01:30 PM] SHossain#0007
thanks.
there are certain things in life that we can't control. we might find ourselves in a situation to change a single key or more in the future.


[04-Dec-19 01:45 PM] jl777c#5810
we need to support a way to change the msig signers. as long as the current msig signers sign this, then we can make a new set active. not sure the best way to implement this


[04-Dec-19 01:52 PM] Mihailo#5902
For regular gateway it could be done easily as new one could be created and funds from one deposit addres could be moved to other. But importgateway is hard as there is only one bindtx that is supported in earlytxid param.


[04-Dec-19 01:54 PM] Mihailo#5902
If we make a list of pubkeys of chain then it could be done but again that is then not in consensus and we would need to make some external consensus on pubkey change


[04-Dec-19 01:54 PM] Alright#0419
could always airdrop to a new chain, but you lose tx history each time you do that


[04-Dec-19 01:55 PM] Mihailo#5902
Yes, new chain is possible. But I think it is way too much work for a pubkey change


[04-Dec-19 01:56 PM] Alright#0419
shouldn't ever really happen, but would want to be prepared. Just suggested that in case it's very much impractical to make it work otherwise


[04-Dec-19 01:59 PM] Mihailo#5902
@jl777c if signer nodes would work p2p as notary nodes, we could make pubkeys approval and msig signing offchain, but it would require careful development.


[04-Dec-19 02:02 PM] jl777c#5810
what if there was a way to update the earlytxid?


[04-Dec-19 02:05 PM] Mihailo#5902
Hmmm, maybe we can put pubkeys in anothertx which wouldn't ve bind tx, but it would spend a baton from bindtx so we know it is the right one and next would spend baton from previous. It would work in a way as withdraw works. MofN would need to sign some external tx which will transfer funds from one deposit to another deposit addres and in opret has pubkeys list and that would be submitted as transfer tx and from that point it will look that tx for pubkeys.


[04-Dec-19 02:05 PM] Mihailo#5902
If it is understandable...


[04-Dec-19 02:05 PM] jl777c#5810
yes, the list of pubkeys is what is in the earlytxid, with a msig baton


[04-Dec-19 02:06 PM] jl777c#5810
something like that. it would allow the msig signers to update to a new set of pubkeys, baton makes it mutually exclusive. we can have the convention that the two most recent set of pubkeys are valid. that allows a smooth transition


[04-Dec-19 02:07 PM] jl777c#5810
so the new set of pubkeys is approved by the msig signers. now both addresses are valid, so there shouldnt be a problem with transferring funds from the old to the new address


[04-Dec-19 02:07 PM] Mihailo#5902
Ok, remind me to try to refactor it to support this. But first I need to finish this refactor and make withdraw to work smoothly.


[04-Dec-19 02:08 PM] jl777c#5810
yes, this is not needed for the next iteration, but a very good thing to have before production release


[04-Dec-19 02:08 PM] Mihailo#5902
Before production we must have this.

{Reactions}
💯 (2) 

[04-Dec-19 02:09 PM] jl777c#5810
ok


[04-Dec-19 02:09 PM] jl777c#5810
definitely seems solvable


[04-Dec-19 03:57 PM] Regnar#6164
Cool video on Stablecoins from CoinfestUK 2019. Seems related to this channel if anyone is interested
<https://vimeo.com/channels/cfuk>


[05-Dec-19 07:15 AM] NNoperator#3835
I am not able to build importgateway ATM  ```Fetching libgmp...
curl: (3) <url> malformed
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
curl: (22) The requested URL returned error: 403 Forbidden```


[05-Dec-19 07:19 AM] SHossain#0007
https://github.com/Mixa84/komodo/blob/importgateway/depends/packages/libgmp.mk#L21
https://github.com/KomodoPlatform/komodo/blob/beta/depends/packages/libgmp.mk#L21
try to change the content on that line to `https://ftp.gnu.org/gnu/gmp`


[05-Dec-19 07:20 AM] SHossain#0007
@NNoperator ^^


[05-Dec-19 10:51 AM] Mihailo#5902
@jl777c The time slots for signing works like a charm. I moved them to 2 seconds as I had problems with 1 second.And I have made 3 withdraws in same block, they have been processed one by one without problem.

{Reactions}
shexy 

[05-Dec-19 10:53 AM] jl777c#5810
good to hear!


[05-Dec-19 10:53 AM] Mihailo#5902

{Attachments}
https://cdn.discordapp.com/attachments/564807360472940575/652221103682355261/node1.png


[05-Dec-19 11:23 AM] Mihailo#5902
@SHossain You can try multiple withdraw now!


[05-Dec-19 11:24 AM] Alright#0419
what is multiple withdraw?


[05-Dec-19 11:25 AM] Mihailo#5902
Ah, nothins special. Creating withdrwas in same block and to see if they are going to be processed one by one.


[05-Dec-19 11:26 AM] Mihailo#5902
As withdraws at the same time cannot be done, because of utxos that are not spent until sign i completed. But that could also be optimized...


[05-Dec-19 11:26 AM] Alright#0419
Ah I see the issue there


[05-Dec-19 11:27 AM] Alright#0419
had a thought last night about withdraws. Have you considered just how large of a tx there will be with 15 sigs?


[05-Dec-19 11:27 AM] Alright#0419
or 13, whatever it is


[05-Dec-19 11:28 AM] Alright#0419
on BTC, that might be a pretty significant fee


[05-Dec-19 11:28 AM] Mihailo#5902
Well yes, it will be more fee. But it wont be 13, it will be 7 (7of13)


[05-Dec-19 11:28 AM] Mihailo#5902
But still larger than regular tx.


[05-Dec-19 11:28 AM] Alright#0419
does the gateway consolidate utxos at all?


[05-Dec-19 11:29 AM] SHossain#0007
i'll compile latest and try now


[05-Dec-19 11:29 AM] Mihailo#5902
It was, but I removed it recently as it was making a problem. But as there will be rewards claiming for KMD external chain, that process will consolidate utxos.


[05-Dec-19 11:29 AM] Alright#0419
let's say there are 10 BTC utxos in the gateway, combining these 10 for a withdraw with 7 sigs for each will create a massive tx


[05-Dec-19 11:30 AM] Mihailo#5902
Yes, definitely it will be some higher fee with big txs.


[05-Dec-19 11:31 AM] Mihailo#5902
@jl777c BTW, initially txfee was hardcoded to 20k sats for BTC I think. We should see how this should change overtime if at some point txfees rise, we would not get the tx confirmed long time if it is lower fee.


[05-Dec-19 11:34 AM] Mihailo#5902
We should definitely first use txfee per byte


[05-Dec-19 11:34 AM] jl777c#5810
correct, maybe use the BTC adaptive fee estimator


[05-Dec-19 11:34 AM] Mihailo#5902
But then if fee is high we should be able to adjust it


[05-Dec-19 11:35 AM] jl777c#5810
i forget what it is called, they keep changing the rpc calls


[05-Dec-19 11:35 AM] Mihailo#5902
Oh, so there is some rpc. I'll check it out


[05-Dec-19 11:35 AM] jl777c#5810
it used to be estimatefee


[05-Dec-19 11:37 AM] Mihailo#5902
`estimatesmartfee`


[05-Dec-19 11:42 AM] SHossain#0007
did 3 tx


[05-Dec-19 11:42 AM] SHossain#0007
4 actually


[05-Dec-19 11:43 AM] Mihailo#5902
monitoring


[05-Dec-19 11:45 AM] SHossain#0007
all confirmed on block 10837


[05-Dec-19 11:45 AM] Mihailo#5902
Good


[05-Dec-19 11:46 AM] Mihailo#5902
I'm mining only with one node so blocks come slowly


[05-Dec-19 11:46 AM] Mihailo#5902
Ahhh, they signed first withdraw at same time...


[05-Dec-19 11:47 AM] SHossain#0007
```
AddToWallet 458ed4f96ff86f32b6c9eb4e00f70c5e11dfe27c53e4a3f388d34f567e52b6d5  new
AddToWallet e3865cb7a0d77f672ab18b4fdb13e92804262ad64d4d3ac6e3717597a766bac2  new
AddToWallet 649ed031ccaf0eb96136a0abe85cdd01d0fb9444ae30d55ed5fe211ad662a2c6  new
AddToWallet 57768ea5dec37b362261e7008b22731e033aebb32794f8bf1f5deca88ff5d965  new
UpdateTip: new best=0020c800f0b8975a4038867465d15c3be564c7f9a4aa784dd4eb738b7ba55eda  height=10837  log2_work=20.684336  log2_stake=-inf  tx=23775  date=2019-12-05 19:42:55 progress=1.000000  cache=0.7MiB(2857tx)
AddToWallet 458ed4f96ff86f32b6c9eb4e00f70c5e11dfe27c53e4a3f388d34f567e52b6d5  update
AddToWallet e3865cb7a0d77f672ab18b4fdb13e92804262ad64d4d3ac6e3717597a766bac2  update
AddToWallet 649ed031ccaf0eb96136a0abe85cdd01d0fb9444ae30d55ed5fe211ad662a2c6  update
AddToWallet 57768ea5dec37b362261e7008b22731e033aebb32794f8bf1f5deca88ff5d965  update
UpdateTip: new best=021aee62133a31f588e25d8ba73d07029fe301bdbddabc29859ab111408859b8  height=10838  log2_work=20.684424  log2_stake=-inf  tx=23784  date=2019-12-05 19:45:59 progress=1.000000  cache=0.7MiB(2861tx)
ImportGateway tx validated
UpdateTip: new best=01bbf354caed2a23fab0da06022f77907f1755ea5bb7b4984b33d8d65ce8cd77  height=10839  log2_work=20.684513  log2_stake=-inf  tx=23785  date=2019-12-05 19:46:06 progress=1.000000  cache=0.7MiB(2862tx)
ImportGateway tx validated
UpdateTip: new best=0214ef358cd7f4500b70b1942928d484c212dedbc42ea96ce037716442b816e0  height=10840  log2_work=20.684601  log2_stake=-inf  tx=23787  date=2019-12-05 19:46:20 progress=1.000000  cache=0.7MiB(2864tx)
```


[05-Dec-19 11:54 AM] SHossain#0007
i'm getting these now
```
ImportGateway tx validated
ImportGateway tx validated
ImportGateway tx validated
ImportGateway tx validated
UpdateTip: new best=012d431edca19c2cec07c8014f3d66716693178278f2d858e739542ce700b802  height=10846  log2_work=20.685071  log2_stake=-inf  tx=23803  date=2019-12-05 19:51:26 progress=1.000000  cache=0.7MiB(2871tx)
UpdateTip: new best=002334c5f521d7ebcbd5a8087472305ba7abf0da7ac1bea5cb3f7caa253c632d  height=10847  log2_work=20.685148  log2_stake=-inf  tx=23808  date=2019-12-05 19:51:43 progress=1.000000  cache=0.7MiB(2875tx)
ProcessMessages: advertizing address 195.206.169.231:51532
receive version message: /MagicBean:2.0.15rc2/: version 170008, blocks=10847, us=195.206.169.231:63435, peer=5
UpdateTip: new best=01745a0f776b3ad2f628ec91f5b48b891f8f45b1e675b03fab105b8ac9c6fc56  height=10848  log2_work=20.685224  log2_stake=-inf  tx=23812  date=2019-12-05 19:52:17 progress=1.000000  cache=0.7MiB(2874tx)
UpdateTip: new best=02213f84b9f27d23950c87c9f199ec3c3a8ff98af0c2b9268050435a23ace161  height=10849  log2_work=20.6853  log2_stake=-inf  tx=23814  date=2019-12-05 19:52:34 progress=1.000000  cache=0.7MiB(2876tx)
ImportGateway tx validated
ImportGateway tx validated
ImportGateway tx validated
ImportGateway tx validated
ImportGateway tx validated
ImportGateway tx validated
ImportGateway tx validated
```


[05-Dec-19 11:54 AM] Mihailo#5902
All 4 processed


[05-Dec-19 11:54 AM] Mihailo#5902
But I had to turn off daemon, and start it again.


[05-Dec-19 11:56 AM] Mihailo#5902
Try 2-3 more


[05-Dec-19 11:56 AM] SHossain#0007
only 1 arrived in my KMD wallet
```
  {
    "txid": "b47f3c79fcbc42e24cbb1119afbf7c009a0f1f2dc98689f4f9e351a834bd8b2e",
    "vout": 0,
    "generated": false,
    "address": "RUX3snTWZmt6bnTcJAi3gh9NvxAjk5ne6K",
    "segid": 17,
    "amount": 0.00994000,
    "interest": 0.00000000,
    "scriptPubKey": "76a914d3095dcf98417aae49e544f1eb8f3f734e5b1d3188ac",
    "rawconfirmations": 1,
    "confirmations": 1,
    "spendable": true
  }
```


[05-Dec-19 11:57 AM] Mihailo#5902
```
b47f3c79fcbc42e24cbb1119afbf7c009a0f1f2dc98689f4f9e351a834bd8b2e
9d0c2ea4f6ce7d747f77d6b6cda4518d68f6c2314900868e01cce3baaea94d68
ae0796045cad565cc38d7d94a6794907069d2f9569a00c7ff43b03c2ed9af401
48d2132177251493d93feb37279786150dceac3babf32806e3e8b9c0eec246ca
```


[05-Dec-19 11:57 AM] Mihailo#5902
These should be KMD txs.


[05-Dec-19 11:57 AM] Mihailo#5902
Maybe some are not yet mined.


[05-Dec-19 11:57 AM] SHossain#0007
possible


[05-Dec-19 11:57 AM] Mihailo#5902
when I said processed, I meant on MBTCTEST, so you need o wait for it to be mined on KMD


[05-Dec-19 11:58 AM] SHossain#0007
all arrived


[05-Dec-19 11:58 AM] Mihailo#5902
👍


[05-Dec-19 11:58 AM] SHossain#0007
i'll do few more now


[05-Dec-19 11:58 AM] Mihailo#5902
Let me know to monitor


[05-Dec-19 11:59 AM] SHossain#0007
4 more done


[05-Dec-19 12:00 PM] SHossain#0007
please monitor


[05-Dec-19 12:03 PM] Mihailo#5902
mining is slow...


[05-Dec-19 12:03 PM] Mihailo#5902
maybe I had to do adaptive pow? What does it do?


[05-Dec-19 12:05 PM] SHossain#0007
let me start mining


[05-Dec-19 12:05 PM] SHossain#0007
```
AddToWallet 657da570c25c9f6ab244310d55fb8ad33f631cea261857bddc8a3275897be5d2  new
AddToWallet c526f246f6da8a06d15d4addd3e51e70acc1cd6c57605cca0b64284cd517f8cc  new
AddToWallet e078972869fb28607f28fd0651f48eef8fae71a9eb18d734267cc99419e18192  new
AddToWallet 6fd1bc1a827887d73285800768e71bb0078f894f9a4636f9e744bdb85a840f93  new
./komodo-cli -ac_name=MBTCTEST setgenerate true 1
KomodoMiner started
try MBTCTEST Mining with tromp
ERROR: mempool transaction missing input
komodod: miner.cpp:372: CBlockTemplate* CreateNewBlock(CPubKey, const CScript&, int32_t, bool): Assertion `"mempool transaction missing input" == 0' failed.
```


[05-Dec-19 12:05 PM] SHossain#0007
opppssss


[05-Dec-19 12:06 PM] Mihailo#5902
I had this problems!


[05-Dec-19 12:06 PM] SHossain#0007
`adaptivepow` is for different issues. when large ASIC mines for a bit, diff goes high and they leave


[05-Dec-19 12:06 PM] Mihailo#5902
I thought it was because some of txs stayed on mempool on nodes where I had some problems before


[05-Dec-19 12:07 PM] Mihailo#5902
Ok, new block


[05-Dec-19 12:07 PM] SHossain#0007
a lot of new blocks came in now


[05-Dec-19 12:07 PM] SHossain#0007
i restarted the chain with `gdb`


[05-Dec-19 12:07 PM] SHossain#0007
didn't mine those blocks


[05-Dec-19 12:08 PM] Mihailo#5902
2nd processed


[05-Dec-19 12:08 PM] Mihailo#5902
3rd


[05-Dec-19 12:08 PM] Mihailo#5902
4th


[05-Dec-19 12:08 PM] Mihailo#5902
All done


[05-Dec-19 12:08 PM] Mihailo#5902
just wait KMD to be mined


[05-Dec-19 12:08 PM] SHossain#0007
yep...waiting


[05-Dec-19 12:09 PM] Mihailo#5902
or use getunconfirmedbalance


[05-Dec-19 12:09 PM] SHossain#0007
after this i'll do another batch


[05-Dec-19 12:09 PM] SHossain#0007
```
./komodo-cli getunconfirmedbalance
0.00376000
```


[05-Dec-19 12:09 PM] Mihailo#5902
That is basically 0.004 minuse fees


[05-Dec-19 12:09 PM] SHossain#0007
btw, this call also shows same info
```
./komodo-cli getwalletinfo
{
  "walletversion": 60000,
  "balance": 0.67486700,
  "unconfirmed_balance": 0.00376000,
  "immature_balance": 0.00000000,
  "txcount": 35,
  "keypoololdest": 1571070297,
  "keypoolsize": 101,
  "paytxfee": 0.00000000,
  "seedfp": "406b064db0e9fa137f30f68ca24b76bdaefbdc2e9109181763c3d5d29e9a775e"
}
```


[05-Dec-19 12:09 PM] Mihailo#5902
Ok


[05-Dec-19 12:10 PM] SHossain#0007
but, `getunconfirmedbalance` shows only unconfirmed which might be beneficial for GUIs if they don't use `getwalletinfo`


[05-Dec-19 12:11 PM] Mihailo#5902
BAsically, this problem with mining is also something that adaptive pow could fix maybe. The problem is that with low mining power, there is no block for some time, then the difficulty loweres, then few block comes and difficulty goes up.


[05-Dec-19 12:11 PM] Mihailo#5902
@jl777c BTW, which DAA are we using now?


[05-Dec-19 12:11 PM] SHossain#0007
only you were mining. i wasn't. that might be the issue


[05-Dec-19 12:11 PM] Mihailo#5902
How it showed in zawys tests?


[05-Dec-19 12:12 PM] Mihailo#5902
Well, difficulty should be adjusted gradually so that there are no spikes.


[05-Dec-19 12:12 PM] SHossain#0007
with Zawy's test, it might take few mins for a block sometimes


[05-Dec-19 12:12 PM] SHossain#0007
we can test that on the next chain


[05-Dec-19 12:12 PM] SHossain#0007
all balances here. i'll issue another 3-4. please monitor


[05-Dec-19 12:13 PM] Mihailo#5902
Ok, then I will be AFK


[05-Dec-19 12:13 PM] SHossain#0007
strange. now, my miner didn't crash the daemon


[05-Dec-19 12:14 PM] SHossain#0007
and it mined the block


[05-Dec-19 12:14 PM] Mihailo#5902
Sometimes it crashes


[05-Dec-19 12:14 PM] SHossain#0007
i'll keep it running with `gdb` on the next tests to catch this bug


[05-Dec-19 12:15 PM] SHossain#0007
now it's great that we have parallel multiple withdraws working 🙂


[05-Dec-19 12:15 PM] Mihailo#5902
I think the problem is that input is spent, but same thing with problem I had with tx staying in wallet and added to nodes mempool


[05-Dec-19 12:15 PM] SHossain#0007
nice job on this


[05-Dec-19 12:15 PM] Mihailo#5902
1st


[05-Dec-19 12:15 PM] Mihailo#5902
2nd


[05-Dec-19 12:15 PM] Mihailo#5902
3rd


[05-Dec-19 12:16 PM] Mihailo#5902
4th


[05-Dec-19 12:16 PM] SHossain#0007
yep, i see unconfirmed balance


[05-Dec-19 12:16 PM] SHossain#0007
```
./komodo-cli getunconfirmedbalance
0.00376000
```


[05-Dec-19 12:16 PM] Mihailo#5902
It would be faster, but I added 10 second delay so that KMD tx is propagated before siwtching to next, to not use same utxos


[05-Dec-19 12:20 PM] SHossain#0007
i'll issue few more withdraws


[05-Dec-19 12:24 PM] SHossain#0007
did about 10 now


[05-Dec-19 12:24 PM] SHossain#0007
before that i stopped mining


[05-Dec-19 12:24 PM] SHossain#0007
started mining after issuing those withdraws, couldn't crash daemon


[05-Dec-19 12:24 PM] SHossain#0007
they are being validated now


[05-Dec-19 12:26 PM] Mihailo#5902
@jl777c Someone could make a DoS attack by creating a lot of small withdraws and clog up the queue so nobody elses withdraw gets processed. Maybe a limit should be done, but for BTC and high valued coins it shouldn't be high!


[05-Dec-19 12:26 PM] Mihailo#5902
@SHossain  no more funds to do withdraws!


[05-Dec-19 12:27 PM] SHossain#0007
we need a bash script to quickly withdraw 50 or 100 and broadcast them. would be faster to test than manual


[05-Dec-19 12:27 PM] SHossain#0007
@Mihailo you tagged someone else 😛


[05-Dec-19 12:27 PM] Mihailo#5902
😛


[05-Dec-19 12:27 PM] SHossain#0007
i'll deposit more tonight


[05-Dec-19 12:28 PM] Mihailo#5902
👍


[05-Dec-19 12:28 PM] Mihailo#5902
Hmmm, this could also be a problem.


[05-Dec-19 12:28 PM] Mihailo#5902
Balance that is submitted into oracle comes every 10 seconds.


[05-Dec-19 12:29 PM] Mihailo#5902
And these withdraws can be processed before balance is submitted...


[05-Dec-19 12:29 PM] Mihailo#5902
I'll have to figure out something


[05-Dec-19 12:29 PM] SHossain#0007
i still have balance in my MBTCTEST chain that i deposited
```
./komodo-cli -ac_name=MBTCTEST importgatewayaddress
{
  "result": "success",
  "ImportGatewayCCAddress": "RXJT6CRAXHFuQ2UjqdxMj7EfrayF6UJpzZ",
  "ImportGatewayCCBalance": 0.00008000,
  "ImportGatewayNormalAddress": "RNFRho63Ddz1Rh2eGPETykrU4fA8r67S4Y",
  "ImportGatewayNormalBalance": 0.00000000,
  "ImportGatewayCCTokensAddress": "RAczoarH6zfAzcsY2dX6xuCm6tEU2K6tVK",
  "myCCAddress(ImportGateway)": "RD3Fjm4m7p5esuukUzxsAMepiu2Erhq9rv",
  "myCCbalance(ImportGateway)": 0.00000000,
  "myaddress": "REz25A9g1yoD6ioXfb7g7kDTRqNKnWHvHK",
  "mybalance": 0.04447000
}
```


[05-Dec-19 12:29 PM] SHossain#0007
who took ma money? :abused:


[05-Dec-19 12:29 PM] Mihailo#5902
But I think I have accounted the balance for created withdraws, so it shouldn't be...


[05-Dec-19 12:29 PM] Mihailo#5902
😄


[05-Dec-19 12:29 PM] SHossain#0007
maybe the tx fees that were used for withdraws


[05-Dec-19 12:30 PM] SHossain#0007
yes, this is an issue


[05-Dec-19 12:30 PM] SHossain#0007
actually a big one


[05-Dec-19 12:31 PM] Mihailo#5902
txfee is currently 10k but I think I tested it with 1k so I can lower it. And marker fee is lowered to 1k. So 11k goes per withdraw


[05-Dec-19 12:31 PM] Alright#0419
these chains are going to need APOW


[05-Dec-19 12:31 PM] SHossain#0007
yes, we will get apow.


[05-Dec-19 12:31 PM] Alright#0419
need some way to keep blocks moving without stalling with no incentive to mine


[05-Dec-19 12:32 PM] Alright#0419
might be better to only allow signers to produce blocks? These chains aren't likely to have much hashrate and will be subject to censorship attacks


[05-Dec-19 12:33 PM] Mihailo#5902
dPoW and aPoW is a must I think


[05-Dec-19 12:33 PM] SHossain#0007
yes


[05-Dec-19 12:33 PM] SHossain#0007
all chains will have dPoW and aPoW


[05-Dec-19 12:33 PM] Alright#0419
apow with little hashrate still vuln to censorship


[05-Dec-19 12:34 PM] Mihailo#5902
@Alright what is censorship attack?


[05-Dec-19 12:34 PM] Alright#0419
mine every block with no transactions


[05-Dec-19 12:35 PM] Mihailo#5902
Aha, so the miner is set not to add txs?


[05-Dec-19 12:35 PM] Alright#0419
yes and reorg any blocks that do


[05-Dec-19 12:35 PM] Mihailo#5902
Ok, and how other chains fight with this?


[05-Dec-19 12:35 PM] Alright#0419
hashrate or pos


[05-Dec-19 12:36 PM] Mihailo#5902
aha, ok so every chain with low hashrate has this problem?


[05-Dec-19 12:37 PM] Alright#0419
yes, it requires like 150% of hashrate


[05-Dec-19 12:37 PM] Alright#0419
but with a CPU mined chain, that is nothing


[05-Dec-19 12:37 PM] Mihailo#5902
👍


[05-Dec-19 12:37 PM] SHossain#0007
then, leave the mining only to those 13 nodes


[05-Dec-19 12:38 PM] SHossain#0007
and, for dPoW, we have 64 nodes of KMD mainnet


[05-Dec-19 12:38 PM] SHossain#0007
guess, they could also mine the chain, if there is value


[05-Dec-19 12:39 PM] SHossain#0007
i'm just typing raw ideas as suggestion


[05-Dec-19 12:39 PM] Alright#0419
I'll mine the BTC chain any day 😂


[05-Dec-19 12:39 PM] Alright#0419
don't touch default tx fees


[05-Dec-19 12:39 PM] Alright#0419
🤣


[05-Dec-19 12:40 PM] Mihailo#5902
I have rebooted the nodes so that they start everything in background


[05-Dec-19 12:40 PM] Mihailo#5902
I'm going to have some sleep. Will continue tomorrow.


[05-Dec-19 12:40 PM] SHossain#0007
cool


[05-Dec-19 12:41 PM] Alright#0419
Just realized that notarization tx will need to be tweaked for the BTC chain at least


[05-Dec-19 12:41 PM] SHossain#0007
@Alright then, we can just limit those mining only to 13 msig-signers. they have to run default original source-code anyway since there is no race at the moment.


[05-Dec-19 12:41 PM] Alright#0419
would be paying just as much as we do to notarize to BTC


[05-Dec-19 12:41 PM] Alright#0419
@jl777c ^


[05-Dec-19 12:44 PM] jl777c#5810
not planning to run BTC backed chain


[05-Dec-19 12:45 PM] Alright#0419
just KMD?


[05-Dec-19 12:46 PM] Alright#0419
tbh that's a bit disappointing, was looking forward to that


[05-Dec-19 12:46 PM] phm87#7395
I was also waiting for BTC baked chain


[05-Dec-19 12:47 PM] phm87#7395
https://twitter.com/notgrubles/status/1202652769796182016?s=21

{Embed}
grubles (@notgrubles)
https://twitter.com/notgrubles/status/1202652769796182016?s=21
What if I told you you can download an app off the app store and send BTC using Confidential Transactions /right now/ using a wallet that can run over Tor?
Likes
150
https://images-ext-2.discordapp.net/external/Q3_LgAy_9MyzLygy5zl7fBApU6_U3inyb_ZiM9be66I/https/pbs.twimg.com/media/ELCuUXXXsAESZN_.jpg%3Alarge
Twitter


[05-Dec-19 12:47 PM] phm87#7395
I don t like liquid. I hope the same on kmd


[05-Dec-19 12:48 PM] Alright#0419
nothing stopping us from organizing it @phm87


[05-Dec-19 12:48 PM] Alright#0419
well other than what I just mentioned


[05-Dec-19 12:49 PM] phm87#7395
Ok. I still have things in my to do list (finish apow tests on chips, secret project on mm2 ...) but I agree to look at this after. Thank you alright


[05-Dec-19 01:16 PM] SHossain#0007
i used `0.00000100` as market amount and it worked last time. doing the same with a new deposit


[05-Dec-19 01:18 PM] SHossain#0007
depositing 0.2 KMD now


[05-Dec-19 01:38 PM] SHossain#0007
getting this while doing this deposit
```
error code: -26
error message:
16: bad-txns-opret-too-big
```


[05-Dec-19 01:40 PM] SHossain#0007
```
height.1648383 vs search ht.1648381
new hash 8e32fa8e9271a666be4a5a5a917d5933f37c39f76163cacbf2bf3d09a849f965
check 8e32fa8e9271a666be4a5a5a917d5933f37c39f76163cacbf2bf3d09a849f965
decoded 8e32fa8e9271a666be4a5a5a917d5933f37c39f76163cacbf2bf3d09a849f965
height.1648382 vs search ht.1648381
new hash 24e5cf772af1071b057345f629ef29fd994e91773af4e3abebaf3296b1b22eac
check 24e5cf772af1071b057345f629ef29fd994e91773af4e3abebaf3296b1b22eac
decoded 24e5cf772af1071b057345f629ef29fd994e91773af4e3abebaf3296b1b22eac
found merkleht.1648381 len.36 len2.68 073f0186a5b3bb5b7fbdf4d74907cefb88f2cde12091977bb2eef959da1c6f03 25e7a9088f062a27073840a25d084ca05f796cc3aaf04ab72e5372f310edfe57
set txid
deposit txid.80c934e2c96f7d941f9652449ef34dddd78f71409460139f61a0a18fb9295005 m.2 of n.2
verified proof for burntxid in merkleroot
ERROR: CheckTransaction(): txout.scriptPubKey.size() too big
ERROR: AcceptToMemoryPool: CheckTransaction failed
ERROR: CheckTransaction(): txout.scriptPubKey.size() too big
ERROR: AcceptToMemoryPool: CheckTransaction failed
```


[05-Dec-19 02:04 PM] SHossain#0007
`importgatewaydeposit` call seems to validate the data
```
found merkleht.1648381 len.36 len2.68 073f0186a5b3bb5b7fbdf4d74907cefb88f2cde12091977bb2eef959da1c6f03 25e7a9088f062a27073840a25d084ca05f796cc3aaf04ab72e5372f310edfe57
set txid
deposit txid.80c934e2c96f7d941f9652449ef34dddd78f71409460139f61a0a18fb9295005 m.2 of n.2
verified proof for burntxid in merkleroot
```


[05-Dec-19 02:05 PM] SHossain#0007
just `sendrawtransaction` shows the error above


[05-Dec-19 02:06 PM] SHossain#0007
`bad-txns-opret-too-big`
i wonder if that has anything to do with the original KMD tx which included a lot of utxos


[05-Dec-19 02:06 PM] SHossain#0007
24 utxos to be exact


[05-Dec-19 02:07 PM] SHossain#0007
https://kmdexplorer.io/tx/80c934e2c96f7d941f9652449ef34dddd78f71409460139f61a0a18fb9295005


[05-Dec-19 02:30 PM] Mihailo#5902
Yes, it has.


[05-Dec-19 02:31 PM] Mihailo#5902
Because we are puting raw hex in AC tx an proof it gets wuite huge and probably over 10k limit


[05-Dec-19 03:54 PM] SHossain#0007
would that be hard or bad to increase that limit? i guess we need a way to import that type of deposits. some user might use more utxos than me.


[05-Dec-19 08:43 PM] jl777c#5810
we need to make the gui consolidate utxos to fit


[05-Dec-19 08:43 PM] jl777c#5810
what if somebody has 100,000 utxo? do we need to make it work with that?


[05-Dec-19 08:44 PM] jl777c#5810
better to make sure user has a sane number of utxo for the deposit


[06-Dec-19 02:06 AM] SHossain#0007
yes, GUI consolidation of utxos would be good. 100,000 utxos sounds a lot 🙂


[06-Dec-19 02:06 AM] SHossain#0007
i didn't think 24 utxos would create issues. could consolidate them before depositing


[06-Dec-19 02:07 AM] SHossain#0007
i'll put the consolidate part in the guide


[06-Dec-19 03:27 AM] jl777c#5810
maybe that should be a standard thing to do, send to self desired amount + txfee


[06-Dec-19 03:27 AM] jl777c#5810
then it will always just be one utxo


[06-Dec-19 03:30 AM] SHossain#0007
i added this on the guide
```
Note: Before depositing, make sure you have very low number of utxos in your wallet. Ideal to have 1 to 5 utxos. You can find how many utxos you have by issuing `listunspent` call on the source chain. If you have a lot of utxos, try consolidating them using `sendtoaddress` call to same wallet address before doing the `z_sendmany`. Otherwise, you might run into issues when importing them into destination chain. The daemon might complain with `bad-txns-opret-too-big`.
```


[06-Dec-19 07:01 AM] Mihailo#5902
Basically, the best use of sidechains and pegs would be using GUI. Too many stuff can go wrong and funds could be lost so only someone 100% sure what he is doong should be using it manually (this is for production). In GUI the consolidation of utxos can be done and whole deposit tx which is big will be on a button click.


[06-Dec-19 07:05 AM] SHossain#0007
Thanks. yes, this would be a must to do for GUI


[06-Dec-19 10:18 AM] SHossain#0007
did couple of withdraws, worked fine


[06-Dec-19 10:18 AM] SHossain#0007
will deposit more


[06-Dec-19 10:18 AM] SHossain#0007
also withdrawn my mined funds 😛


[06-Dec-19 10:46 AM] SHossain#0007
queued 7 withdraws


[06-Dec-19 10:49 AM] SHossain#0007
seems all are working


[06-Dec-19 10:51 AM] SHossain#0007
the only current issue we know of is, msig address might run out of funds. txfee needs to be lowered or use 0 fee for txs. 0 fee should work fine as it works with KMD and other smartchains


[06-Dec-19 12:09 PM] Mihailo#5902
Zero fee would be great


[06-Dec-19 10:12 PM] jl777c#5810
the mining code needs to be changed to allow for zerofee tx without limits


[06-Dec-19 10:12 PM] jl777c#5810
right now, only a few per block are mined


[06-Dec-19 10:13 PM] jl777c#5810
so maybe the gateway/pegs tx can get an exemption in the miner, i think CreateNewBlock is the function


[06-Dec-19 11:38 PM] Alright#0419
-minrelaytxfee=0 should work I think


[07-Dec-19 12:05 AM] jl777c#5810
but we dont want it for all tx, just for the pegs related ones


[07-Dec-19 12:06 AM] jl777c#5810
so a conditional for pegs tx, that does what minrelaytxfee=0 would do


[07-Dec-19 01:20 AM] jl777c#5810
@Mihailo if we dont already have a way for a >50% equity account to be closed, we should add it. otherwise people who have a lot of equity but no other KMD available are locked out and can only withdraw more stablecoins


[07-Dec-19 01:21 AM] Mihailo#5902
Not sure what you mean?


[07-Dec-19 01:21 AM] Mihailo#5902
We have redeem of coins at any time for account holders.


[07-Dec-19 01:23 AM] jl777c#5810
let us say someone borrows 80% against 1000 KMD deposit


[07-Dec-19 01:23 AM] jl777c#5810
spends the stablecoins and has nothing else left


[07-Dec-19 01:23 AM] jl777c#5810
KMD price goes 10x


[07-Dec-19 01:24 AM] jl777c#5810
now there is a lot of equity in the account, but how can it be extracted? seems only by taking out more stablecoins. is there a way to use the equity that is in the account and using that to close it out?


[07-Dec-19 01:25 AM] jl777c#5810
whatever more stablecoins you take out, increases the debt, so you wont ever be able to take out stablecoins to get the stablecoins needed to close out the account


[07-Dec-19 01:25 AM] Mihailo#5902
If he has nothing left how will he close account. There is still little debt even if equity is high as he initially took X coins.


[07-Dec-19 01:25 AM] jl777c#5810
yes, but on paper, this equity exists


[07-Dec-19 01:26 AM] jl777c#5810
say 1000 KMD deposit and takes out 10 EUR worth


[07-Dec-19 01:26 AM] Mihailo#5902
Only if you want the account to be closed and partial funds returned to user and rest (debt covering) goes to pegs account


[07-Dec-19 01:26 AM] jl777c#5810
yes, for accounts with over 50% equity, it should be possible to close it out and get whatever net balance there is


[07-Dec-19 01:27 AM] jl777c#5810
without any extra coins being used. i think it is a matter to just do the price calculation to reduce the amount of KMD equity that can be paid out


[07-Dec-19 01:28 AM] Mihailo#5902
We could maybe make it similar to liquidate. But pegs global account will be the one which "liquidates" this account and give the rest of KMD-5% to user and the KMD to cover the value of debt and 5% goes to pegs account


[07-Dec-19 01:30 AM] jl777c#5810
why does there have to be a 5% fee in this case?


[07-Dec-19 01:31 AM] jl777c#5810
i guess closing an account that has more equity than the average would make the overall average a bit worse...


[07-Dec-19 01:31 AM] Mihailo#5902
It doesn't have to be, just saying if you have no coins maybe there should be a small penalty


[07-Dec-19 01:31 AM] Mihailo#5902
Yes


[07-Dec-19 01:32 AM] jl777c#5810
and this is only possible by the account holder


[07-Dec-19 01:32 AM] Mihailo#5902
Big equity accounts will worsen the goobal ratio


[07-Dec-19 01:32 AM] Mihailo#5902
Even putting it in loquidating zone


[07-Dec-19 01:33 AM] jl777c#5810
but trapping funds with a high fee barrier would reduce the funds flowing in the system. if i know that at any time, i can liquidate without penalty, that seems better from a user standpoint


[07-Dec-19 01:33 AM] Mihailo#5902
We have a ratio before liquodating is not available, before certain ratio of global account


[07-Dec-19 01:33 AM] Mihailo#5902
Lets give it a thought, when I start implementing


[07-Dec-19 01:34 AM] jl777c#5810
i guess we can make it so if overall balance is healthy, we can allow self-liquidations without penalty


[07-Dec-19 01:34 AM] jl777c#5810
otherwise there would be some sort of liquidation fee, based on how close to danger zone the global balance is


[07-Dec-19 01:34 AM] jl777c#5810
something like that


[07-Dec-19 01:39 AM] Mihailo#5902
👍


[07-Dec-19 11:44 PM] Mylo#8306
Yeah with debt ratio at only 10%, needing it to be >50% to self liquidate seems to be a little against the intention of the depositor/hodler.

Eg 1000KMD, withdraw 180USDK.
KMD moons to $1.80, the 180USDK represents 10% of the mooning initial deposit.
To close account / self liquidate, the >50% debt ratio to enable this would mean withdrawing  further USDK (720), to take debt to 900USDK.  Self liquidate giving back 500KMD.

Maybe if self liquidate is <50% debt ratio, a 0.5% fee is reasonable for this type of line of credit?


[07-Dec-19 11:47 PM] Mylo#8306
Maybe too high, depending on length of time the funds were locked up.  If longer than a month, 0% fee, because reward could be claimed by network/pegfund.


[07-Dec-19 11:49 PM] jl777c#5810
you have it backwards


[07-Dec-19 11:50 PM] jl777c#5810
equity > 50% -> debt < 50%


[07-Dec-19 11:50 PM] jl777c#5810
as soon as the mooning price reduces the debt ratio below 50%, you would be able to close the account and extract the net balance


[08-Dec-19 01:15 PM] Mihailo#5902
@Mylo this is in case you have no more coins (you spent them on something). If you have coins you can always cover your debt and take the deposit. This case is when you have lost the coins but you account is not in big debt so you close your account and get the rest of KMD that is rest fro covering your debt. The question is should it there be a penalty as with this action you can influence the global ratio of pegs and maybe put it in liquidation zone


[08-Dec-19 03:31 PM] jl777c#5810
maybe just require that globally it wont be in the liquidation zone, if it is, then close account needs to wait

{Reactions}
👍 

[08-Dec-19 05:50 PM] artik123#2884
@Mihailo It doesn't have to be only when the user has no more coins. It is also useful for other use cases. Closing an account this way may also have tax advanteges. In many jurisdictions, selling other asset to buy usdk in order to cover the loan may trigger capital gain tax, and by this approach it can be avoided.


[09-Dec-19 01:14 AM] Mylo#8306
Sweet thanks!  That old backwards trick... thanks jl mihailo 🙏💪


[09-Dec-19 01:22 AM] Mihailo#5902
@jl777c  We should definitely think about implementing partial redeem and close account with any amount of coins. As currently you can only redeem if you have at least full amount of debt in coins. So if you took 100USDK, if you have 90USDK you are trapped. If you have nothing you are still trapped and the only way to take the deposit is to buy USDK coins. Maybe we should allow to redeem any amount of coins to get deposit at current price until you are let say below yellow zone and you do not put global account in red zone.


[09-Dec-19 01:23 AM] Mihailo#5902
Don't know it there is some case which will make an exploit if we enable this.


[09-Dec-19 01:25 AM] jl777c#5810
it is a very good feature to have. i think as long as closing it doesnt put the global balance in jeopardy, it is like it never happened. not sure how to exploit that


[09-Dec-19 01:27 AM] Mihailo#5902
Probably it is ok, it will show in testing.


[09-Dec-19 01:31 AM] Mihailo#5902
So basically we should have only one command which will be called let say pegscloseaccount and there you can put any amount of coins or none and with that get right amount of deposit. If you put the whole debt then it is like redeem now. If you put some of the coins you will get deposit minus value of uncoverd debt. If you put no coins you will get just the deposit that is left after covering the debt. And these two cases can be done only if you don't enter in some of danger zones.


[09-Dec-19 01:34 AM] jl777c#5810
oh, that is even better, so you can partially cashout from a positive equity situation. yes, that is good, this way people can feel comfortable funding it, knowing they can withdraw out of it at anytime

{Reactions}
👍 

[09-Dec-19 01:35 AM] jl777c#5810
clearly, we need to avoid pushing global balance into danger and some sort of rising fee as it gets closer and just not allowing it if it would make it go into the danger zone. that should avoid the attacks by people who deposit a lot and then close it, just to push the system to the brink


[09-Dec-19 01:35 AM] jl777c#5810
the ending global balance after the close would establish the fee


[09-Dec-19 01:36 AM] jl777c#5810
if all is in the green and far away from danger, then no fee


[09-Dec-19 01:36 AM] jl777c#5810
that seems a fair way to do it, so if the system is in danger, all participants are together protecting the global balance


[09-Dec-19 01:37 AM] Mihailo#5902
👍


[09-Dec-19 02:12 AM] Mylo#8306
This global balance is new to me but reading it I think I follow.  Yes, those features you’re describing mihailo seem to fulfill the intentions of any user of the system.  If you can work out the balance and get it correct, that’s awesome!

The large depositor scenario sets off a bit of an alarm bell, but that fee to dissuade tom foolery behaviour sounds like it would do the trick 🤷‍♂️


[09-Dec-19 04:26 AM] Mihailo#5902
The global balance is basically total balance of all users deposits and debts. The liquidation is enabled only when global ratio reaches 60% debt. So if one user is in red zone (90% or more) but the global ratio is let say 40% nothing is in danger. When total debt vs. total deposit reaches 60% then liquidation is active and the worst accounts >90% are subject to liquidation.


[09-Dec-19 04:27 AM] Mihailo#5902
If large depositr would close account and in that way put the global ratio in >=60% ratio then we wouldn't allow it.


[09-Dec-19 06:24 AM] Mihailo#5902
@jl777c As currently I know that only left for gateways is to claim rewards and figure out better solution to submit balance, I would switch to pegs now and bring up EURK chain and change the thing we spoke about close account.


[09-Dec-19 06:27 AM] jl777c#5810
ok, and lets make sure to use adaptivepow this time around to get it as close to the production chain as we can, just less on the msig signers


[09-Dec-19 06:28 AM] jl777c#5810
how complete is the validation code


[09-Dec-19 06:28 AM] Mihailo#5902
Which validatio, pegs or gateways?


[09-Dec-19 06:29 AM] jl777c#5810
both


[09-Dec-19 06:29 AM] Mihailo#5902
gateways should be 100% (if there is no bugs or missed things), pegs is on 0% - no validation done yet


[09-Dec-19 06:30 AM] Mihailo#5902
I thought to change this behaviour for closeaccount and then start doing validation


[09-Dec-19 06:30 AM] jl777c#5810
oh, yes, definitely a good plan


[09-Dec-19 06:31 AM] jl777c#5810
so we should test gateways in an abusive way as it has validation, but have to be nice to pegs


[09-Dec-19 06:32 AM] Mihailo#5902
Yes


[09-Dec-19 06:40 AM] SHossain#0007
as soon as we can test 0 fee txs on importgateway that would be great. we can test deposits and withdrawals and check if msig address runs out of balance or not


[09-Dec-19 06:43 AM] Mihailo#5902
I was thinking about 0 txfees. I can set 0 but on importgateway and also pegs chain you will have coins and regular transactions which if used with for example `sendtoaddress` it will set 5k sat txfee. So those transactions will be mined first as they have higher fee. So the deposit and withdraw tx will not be a priority. And I think it need to be different way. So maybe I lower txfees to 5k and we see how it goes.


[09-Dec-19 06:45 AM] Mihailo#5902
On the other hand, as only miners that will mine the chain will probably be only the signers, then it can be ok to lower 0 to all txs and maybe we can add txfee flag to `sendtoaddress` if it is importgateway CC or pegs CC chain? @jl777c


[09-Dec-19 06:48 AM] SHossain#0007
these scripts uses 0 fee txs
https://github.com/DeckerSU/komodo_scripts/blob/master/sendawaynn_auto.sh
https://github.com/KMDLabs/StakedNotary/blob/master/splitfunds.sh


[09-Dec-19 06:48 AM] SHossain#0007
but, these are external scripts and not built-in into daemon


[09-Dec-19 06:56 AM] Mihailo#5902
Yes, that is my point. I can set 0 txfee for depposit/withdrwa/sigining txs. But if we don't set 0 for all txs then those with higher fee will get mined first (at least I think it will be like that). So maybe we can set in code for importgateway and pegs CC to have txfee set to 0 for all commands, like sendtoaddress and others.


[09-Dec-19 06:57 AM] Mihailo#5902
Or even better to be set in chain params so we can bring up chain with 0 txfee or some other...


[09-Dec-19 07:06 AM] SHossain#0007
yes, higher tx fee gets mined fast. since among all the chains in Komodo ecosystem, KMD has high txs on average. and, a 0 fee tx can take from few minutes to about 10 mins to be mined. (on rare cases, it might take longer)


[09-Dec-19 07:06 AM] SHossain#0007
on smart chains, the 0 fee txs gets mined very fast since they have low amount of txs


[09-Dec-19 07:08 AM] Mylo#8306
Thanks for fund liquidation details, I've only read tutorial commands - not the words, hope they are in there, and if they are already sorry to have to repeat yourself


[09-Dec-19 07:39 AM] jl777c#5810
i think we need to add special case code to the miner to allow the gateways/pegs transactions to be zerofee, without having it be lower priority

{Reactions}
💯 

[09-Dec-19 10:46 AM] SHossain#0007
i like this idea most


[09-Dec-19 10:48 AM] Mihailo#5902
This can be done easily I think, but what happens with other regular transaction like sendtoaddress and etc. I think we should add to code that if it is importgateway chain or pegs chain that all txs are zero fee...


[09-Dec-19 10:49 AM] jl777c#5810
why zero fee for all tx?


[09-Dec-19 10:50 AM] jl777c#5810
if the txfees are enough from activity, then we can get hashrate from miners, which is always a good thing


[10-Dec-19 02:55 AM] Mihailo#5902
Because other txs will get higher priority than zero fee so they will be mined first. Abd we want all txs same priority


[10-Dec-19 03:19 AM] jl777c#5810
no, i mean change the priority so that gateways/pegs tx gets equal priority to normally paid tx


[10-Dec-19 03:20 AM] jl777c#5810
does that make sense? we need to make it so doing the gateways/pegs/oracles tx are zerofee, but at the same priority in the miner


[10-Dec-19 03:20 AM] Deleted User#0000
`if (tx.IsCoinImport())
            {
                CAmount nValueIn = GetCoinImportValue(tx); // burn amount
                nTotalIn += nValueIn;
                dPriority += (double)nValueIn * 1000;  // flat multiplier... max = 1e16.` 
Does that work for that?


[10-Dec-19 03:21 AM] Deleted User#0000
I think we messed with this a lot and found the flat multiplier to be fine


[10-Dec-19 03:21 AM] Deleted User#0000
only had issues when the value sent was very small and the mempol very large


[10-Dec-19 03:30 AM] Mihailo#5902
I think something like that will do the trick


[10-Dec-19 03:30 AM] Mihailo#5902
Then ok. I'll try it out


[12-Dec-19 06:59 AM] Mihailo#5902
@SHossain @jl777c I have stopped USDKTEST chain to bring up new chain on pegs with new gateway. We said the new chain should have aPoW, is there anything else we mentioned that we need to add to these chains?


[12-Dec-19 07:10 AM] jl777c#5810
lets make it a EUR peg


[12-Dec-19 07:10 AM] Mihailo#5902
Yes, I'm doing that - EURK


[12-Dec-19 07:11 AM] jl777c#5810
other than -adaptivepow, i dont think any other changes from last time around


[12-Dec-19 07:15 AM] Mihailo#5902
Ok, just checking if I forgot something


[12-Dec-19 08:00 AM] Mihailo#5902
@jl777c The plan for txfees is to set to all cc transactions that we use in pegs and side chains (oracles, gateways, tokens, pegs ...) txfee to 0. And then I will add to miner code priority with flat multiplier. The question is should I give that high priority only to CC txs or to all txs on that chain? (I think only to those CC txs)


[12-Dec-19 08:12 AM] Mihailo#5902
Hmmm, weird thing. I started the chain with same ac parameters on 2 nodes and got different magic number and port...


[12-Dec-19 08:13 AM] Mihailo#5902
Ahhh, never mind. Error in copy paste


[12-Dec-19 08:35 AM] jl777c#5810
high priority only for the special tx, other tx should just default to normal mechanism


[12-Dec-19 08:39 AM] Mihailo#5902
Ok, I thought so. And another thing is we should branch the txfee somehow. If I put in code 0 txfee then on all chains for Oracles fro example it will be 0 txfee. Maybe we can add it as parameter on launch, and for certain CCs check if parameter is set and set txfee to that value, if not then default 10k txfee.


[12-Dec-19 08:41 AM] Mihailo#5902
@TonyL As I changed format for oracles with gateways to `IhhL` can you change it in TUI so oracles can be created with TUI for gateways?


[12-Dec-19 08:56 AM] TonyL#3577
@Mihailo Sure, will do 👍


[12-Dec-19 08:58 AM] TonyL#3577
https://github.com/tonymorony/komodo-cctools-python/commit/c701f8807a46ec76237d108343d6fb1c3b8239ad


[12-Dec-19 09:05 AM] Mihailo#5902
👏


[12-Dec-19 10:28 AM] Mihailo#5902
@jl777c I got AC node to exit, but not sure exact cause:
```UpdateTip: new best=06a4ddcadf250c6eec3b7e43b80ec87fc2c7206c0856114758db90d0f86fc856  height=54  log2_work=9.9023751  log2_stake=-inf  tx=109  date=2019-12-12 18:11:23 progress=1.000000  cache=0.0MiB(42tx)
AddToWallet 3ca37c03cc4aa525e23b991d792a22c3d90437728695266039a9b4639b885f0c  update
AddToWallet 42fc163c52007d66b41f20047025aab982ef1bc2a107e40440ec50d937f9806c  update
AddToWallet af0ab0f38171024ba9571dcfd038eec6e29cc1b5c8397582794cfa4c38d8ffac  update
AddToWallet 17b6aabcb7480a011c1510560b4df5b99414758aa3170077289aa1d46f86e37e  update
height.54
ERROR: ContextualCheckBlock: block height mismatch in coinbase
ERROR: mempool transaction missing input
komodod: miner.cpp:372: CBlockTemplate* CreateNewBlock(CPubKey, const CScript&, int32_t, bool): Assertion `"mempool transaction missing input" == 0' failed.
Aborted (core dumped)```


[12-Dec-19 10:30 AM] Mihailo#5902
I think it could be bacuse there are small chain forks as both nodes are mining with cpu with one thread and some times there are chain splits but when longer chain happens it one node switches to main chain, and maybe then this happens...


[12-Dec-19 10:30 AM] Mihailo#5902
Not sure.


[12-Dec-19 10:30 AM] jl777c#5810
no idea. seems some malformed tx


[12-Dec-19 10:31 AM] Mihailo#5902
I'm thinking about oracles tx from oraclefeed for block data


[12-Dec-19 10:31 AM] jl777c#5810
mempool transaction missing input" == 0


[12-Dec-19 10:32 AM] Mihailo#5902
What would happen if one node goes in other direction and when it switches to main chain, the transaction in mempool could be refering input that does not exist anymore.


[12-Dec-19 10:32 AM] Mihailo#5902
But those txs should be removed from mempool


[12-Dec-19 10:32 AM] Mihailo#5902
Also not sure why this: `ERROR: ContextualCheckBlock: block height mismatch in coinbase`


[12-Dec-19 10:32 AM] jl777c#5810
there does seem to be a bug where invalid tx are not purged from mempool


[12-Dec-19 10:33 AM] jl777c#5810
if it can be reproduced, you need to work backwards from the error


[12-Dec-19 10:34 AM] Mihailo#5902
Yes, the problem is that it happens sometimes. Not sure how to reproduce it...


[12-Dec-19 10:34 AM] Mihailo#5902
But looking now, it seems my chain splitted on block 26


[12-Dec-19 10:37 AM] Mihailo#5902
```[
  {
    "height": 60,
    "hash": "0d80f4f20ca7ec1a4bed6614b24716c3e2e9926e11645001511b5b285f48ea55",
    "branchlen": 0,
    "status": "active"
  },
  {
    "height": 26,
    "hash": "0df5c1c17747acd1929327f566a6b5928d6aec46c65b0d2750b54eab2584606d",
    "branchlen": 9,
    "status": "valid-fork"
  }
]```


[12-Dec-19 10:37 AM] Mihailo#5902
```[
  {
    "height": 41,
    "hash": "05f47ed6256bfc38167860e6e293d162dc6b8e8ff70e6180cb203b719f9fabba",
    "branchlen": 0,
    "status": "active"
  },
  {
    "height": 26,
    "hash": "0df5c1c17747acd1929327f566a6b5928d6aec46c65b0d2750b54eab2584606d",
    "branchlen": 9,
    "status": "headers-only"
  }
]```


[12-Dec-19 10:38 AM] jl777c#5810
not a good idea to be mining on more than one node during the early blocks


[12-Dec-19 10:38 AM] Mihailo#5902
Aha, didn't know that. What is the reason? Whate changes after more blocks?


[12-Dec-19 10:39 AM] jl777c#5810
before 100 blocks things are just very prone to forking


[12-Dec-19 10:39 AM] jl777c#5810
probably due to the total chain work being so small, it can easily flip flop between two very different forks


[12-Dec-19 10:40 AM] jl777c#5810
i just always mine on a single node until it is in the 1000+ height to avoid such problems


[12-Dec-19 10:40 AM] Mihailo#5902
Aha, good. As I noticed that it forks often. Now I know 😉


[12-Dec-19 10:46 AM] Mihailo#5902
Wow, what is this. Seeing it first time!
```
UpdateTip: new best=01710692f551110133fae0daa20404dc08a3d4d187514f9684e442aa7c00ee23  height=66  log2_work=10.202124  log2_stake=-inf  tx=125  date=2019-12-12 18:45:25 progress=1.100000  cache=0.0MiB(69tx)
height.66
00387860ffd83ced71321c5cd7f244d673bf9556bed38fdf868dce3455f2f2dc height.67 O.0 , W.1  width.1    53 vs 120 , deficit   67 tip.2
002b4c07e0ded288ce703afb7e90ff972474538ef34d6a161e4f765fd8ad73d0 height.67 O.0 , W.2  width.2    54 vs 180 , deficit  126 tip.2
00529baa210965038fd778f83962215d47d9b3651cba4aea091db5f36c73ae10 height.67 O.0 , W.3  width.3   139 vs 240 , deficit  101 tip.2
8b8af25da9724b0413aa4603758ddd03721f0000f8a21e00 <- Mineropret
00387860ffd83ced71321c5cd7f244d673bf9556bed38fdf868dce3455f2f2dc height.67 O.0 , W.1  width.1    53 vs 120 , deficit   67 tip.2
002b4c07e0ded288ce703afb7e90ff972474538ef34d6a161e4f765fd8ad73d0 height.67 O.0 , W.2  width.2    54 vs 180 , deficit  126 tip.2
00529baa210965038fd778f83962215d47d9b3651cba4aea091db5f36c73ae10 height.67 O.0 , W.3  width.3   139 vs 240 , deficit  101 tip.2
00387860ffd83ced71321c5cd7f244d673bf9556bed38fdf868dce3455f2f2dc height.67 O.0 , W.1  width.1    53 vs 120 , deficit   67 tip.2
002b4c07e0ded288ce703afb7e90ff972474538ef34d6a161e4f765fd8ad73d0 height.67 O.0 , W.2  width.2    54 vs 180 , deficit  126 tip.2
00529baa210965038fd778f83962215d47d9b3651cba4aea091db5f36c73ae10 height.67 O.0 , W.3  width.3   139 vs 240 , deficit  101 tip.2
Running KomodoMiner.tromp with 1 transactions in block (295 bytes)```


[12-Dec-19 10:59 AM] jl777c#5810
adaptivepow


[12-Dec-19 10:59 AM] Mihailo#5902
Oh, that`s why I didn't see it 😉


[12-Dec-19 10:59 AM] jl777c#5810
i guess the prints could be commented out


[12-Dec-19 11:00 AM] jl777c#5810
but it is quite interesting to see it adapt

{Reactions}
🙂 

[12-Dec-19 11:15 AM] Mihailo#5902
🙂


[13-Dec-19 07:42 AM] Mihailo#5902
@jl777c It seems that combination of aPoW and prices creates some difficulties in mining and node sync. Currently I have 3 nodes i network, only one mining but other 2 nodes won't sync to current chain tip. Also, new blocks need too much time sometimes...


[13-Dec-19 07:43 AM] jl777c#5810
why wont it sync? that seems a bug


[13-Dec-19 07:43 AM] jl777c#5810
what blocktime are you using?


[13-Dec-19 07:44 AM] jl777c#5810
maybe use a 5 minute blocktime?


[13-Dec-19 07:55 AM] Mihailo#5902
I'm using regular blocktime - 1 min


[13-Dec-19 07:55 AM] Mihailo#5902
Now they are synced. I'll monitor it for a while. But definetely when I start daemons they need more time to synce than regular


[13-Dec-19 07:57 AM] Mihailo#5902
And I also have strange node blocking. On one node where I don't mine, I do gatewayswithdraw and then sendrawtransaction and it hangs on send rpc


[13-Dec-19 08:23 AM] Mihailo#5902
Found the blocking reason, my bad didn't do unlock of critical section in gatewayswithdraw


[13-Dec-19 08:46 AM] Mihailo#5902
@jl777c I think the problem with combination of aPoW and pricesCC is that prices reject block if it can't find some correct calc and then aPoW starts again...
```ERROR: CheckTransaction(): invalid script data for coinbase time lock
ContextualCheckBlock failed ht.242```


[13-Dec-19 08:46 AM] Mihailo#5902
I had period with 10 minutes no block


[13-Dec-19 08:47 AM] Mihailo#5902
But also, aPoW seems to run long until it even find block (without prices rejecting it).


[13-Dec-19 08:49 AM] Mihailo#5902
Who made aPoW? Can he checks out what is going on on EURKTEST as I don't have experience with aPoW.


[13-Dec-19 08:51 AM] jl777c#5810
any chain with DTO shouldnt have a blocktime faster than 5 minutes


[13-Dec-19 08:51 AM] jl777c#5810
can you see if the problem goes away with 5 minute blocks?


[13-Dec-19 08:53 AM] Mihailo#5902
Ok, how do I set block time to 5 minutes? But block time of 5 minutes will be bad UX with gateways (deposit, claim, withdraw, signing will all last 5 times longer).


[13-Dec-19 08:54 AM] Mihailo#5902
Saw -ac_blocktime, but this will change magic calc?


[13-Dec-19 08:54 AM] Mihailo#5902
I can run another chain without creating oracle, tokens, gateways. Just mine blocks to see how it behaves


[13-Dec-19 08:59 AM] jl777c#5810
yes ac_blocktime=300


[13-Dec-19 08:59 AM] jl777c#5810
will change magic


[13-Dec-19 09:00 AM] Mihailo#5902
OK, I'll run another chain


[13-Dec-19 09:00 AM] jl777c#5810
i thought you did parallel withdraws


[13-Dec-19 09:00 AM] jl777c#5810
so from mempool it does it


[13-Dec-19 09:00 AM] Mihailo#5902
Yes, sorry. It won't affect signing as it happens in mempool.


[13-Dec-19 09:01 AM] Mihailo#5902
Let me check if it solves anything, then we'll think how to optimize it.


[13-Dec-19 09:01 AM] jl777c#5810
ok


[13-Dec-19 09:10 AM] Mihailo#5902
Another bad thing with 5 minute block would be that for example if external chain is 1 minute block, a lot blocks can accumulate to be submitted in oracle before new block on AC so we'll have to make 10-15 subscribes per publisher in order to be able to submit all blocks and not be to behind external chain.


[13-Dec-19 10:06 AM] Mihailo#5902
@jl777c Still same problem even with blocktime 300 (but it may be because chain didn't stabilize yet - blocks were pretty fast), no block for 24 minutes now.


[13-Dec-19 10:07 AM] Mihailo#5902
It seems it was working ok until aPoW kicked in...


[13-Dec-19 10:10 AM] jl777c#5810
so apow is not compatible for some reason with a prices chain? this will take a bit to fix. i guess for now skip the adaptivepow, good thing we found this issue


[13-Dec-19 10:11 AM] jl777c#5810
keep that chain alive if you can. i will try to debug it next week


[13-Dec-19 10:11 AM] jl777c#5810
but not sure if i will have the time, so best to skip it for this iteration


[13-Dec-19 10:16 AM] Mihailo#5902
Left it running, if you can just take a look what happens it would be good. I'll also check out when it stabilizes


[13-Dec-19 04:00 PM] Alright#0419
@Mihailo chain params?


[15-Dec-19 04:50 AM] Mihailo#5902
@Alright Sorry I was busy yesterday, here is for 300sec block time chain params:
```komodod -ac_name=300BLKTIME -ac_cc=2 -ac_import=PEGSCC -ac_supply=1000000 -ac_end=1 -ac_reward=1 -ac_perc=0 -ac_cbopret=5 -ac_adaptivepow=1 -ac_blocktime=300 -dns=0 -dnsseed=0 -listenonion=0 -debug=pegscc-2 -debug=importcoin -debug=cctokens -debug=gatewayscc -printtoconsole=1 -addnode=116.203.17.140 -addnode=116.203.17.141```


[16-Dec-19 04:33 AM] Mihailo#5902
Nothing has changed after chain stabilization, it is on block 800 almost and there are still very fast blocks and parts without block for 30mins +


[16-Dec-19 04:33 AM] Mihailo#5902
```UpdateTip: new best=0032c4a278f75cdda9b8211a07d1717bb1b96252c53e1852f7f33143495a3821  height=733  log2_work=17.696499  log2_stake=-inf  tx=753  date=2019-12-16 09:07:07 progress=0.977333  cache=0.2MiB(668tx)
height.733
UpdateTip: new best=000c2b198367d7de6b6e86583495ab0f82bbe420b5b408e89fc55952350f1990  height=734  log2_work=17.706853  log2_stake=-inf  tx=754  date=2019-12-16 09:36:00 progress=0.978667  cache=0.2MiB(669tx)
height.734
UpdateTip: new best=01960f62257109c152655914960080067b29b525c2e8366edea4cfc929f1cffb  height=735  log2_work=17.707615  log2_stake=-inf  tx=755  date=2019-12-16 09:36:07 progress=0.980000  cache=0.2MiB(670tx)
height.735
UpdateTip: new best=0023ab579ce501696f6b472e0ec45d473c572f5cdf9138022ac1515e645a3d59  height=736  log2_work=17.708336  log2_stake=-inf  tx=756  date=2019-12-16 09:36:27 progress=0.981333  cache=0.2MiB(671tx)
height.736
UpdateTip: new best=00370c4ccb4634da549d3766e6ce939eed777572b45cc57407b2a7e92d1bde76  height=737  log2_work=17.712695  log2_stake=-inf  tx=757  date=2019-12-16 09:37:50 progress=0.982667  cache=0.2MiB(672tx)
height.737
UpdateTip: new best=00e1716d2fa0b4cb47a3630d4968dbda88dff00c7707e2e41bee99474c6b273b  height=738  log2_work=17.713964  log2_stake=-inf  tx=758  date=2019-12-16 10:19:57 progress=0.984000  cache=0.2MiB(673tx)
height.738
UpdateTip: new best=08d4b0337ee57d0c78cf308ba689b93814239c86461c04e281394792208ae416  height=739  log2_work=17.714091  log2_stake=-inf  tx=759  date=2019-12-16 10:21:14 progress=0.985333  cache=0.2MiB(674tx)
```


[16-Dec-19 04:41 AM] jl777c#5810
ok, i will investigate. for now, lets just test without adaptivepow


[16-Dec-19 04:42 AM] Mihailo#5902
Ok 👍


[16-Dec-19 04:48 AM] jl777c#5810
please keep at least 2 nodes on this chain. i think best if the mining is turned off so i can control the mining when testing


[16-Dec-19 05:04 AM] Mihailo#5902
You are talking about 5 minute chain?


[16-Dec-19 05:04 AM] Mihailo#5902
I will turn off mining


[16-Dec-19 05:04 AM] Mihailo#5902
Ok, mining turned off, 2 nodes running


[16-Dec-19 05:04 AM] Mihailo#5902
chain params up there


[16-Dec-19 05:09 AM] jl777c#5810
dealing with vrsc today so wont get to it till later this week. hopefully the idling chain will just wait for me to debug.


[16-Dec-19 05:14 AM] Mihailo#5902
Np


[16-Dec-19 06:07 AM] Mihailo#5902
To get back on pegs (which is the point of this channel 😛 ), command to close account can be used in this cases:
1) covering whole debt with coins and getting deposit back
2) without coins getting back the deposit minus the value of debt in deposit coins at that moment (what happens here when price goes down, the coins were covered then but now depoist is missing for total number of issued coins)
3) if user has partial number of coins for the debt he could return that and get deposit minus the rest of debt in deposit coins (same issue as previous)
2 and 3 could only be done if it doesn't put global ratio in red zone (60% current).


[16-Dec-19 06:34 AM] jl777c#5810
i think as long as the global ratio is not put in danger and the user gets back the net equity, that is what is important. having some fee (that rises) as the global ratio gets worse and worse, with a cap at some percentage, like 70%. maybe is the way to allow someone to liquidate their position at a slight cost


[16-Dec-19 06:37 AM] Mihailo#5902
OK, but what happens with the coins for which the debt is covered and then the price fell. There is no more account for those coins, but it should be accounted somewhere and be covered by some deposit. We can maybe use the global deposit (those 5% that goes to the system from liquidation) but then what happens when that deposit is covered with debt and there is more?


[16-Dec-19 06:42 AM] jl777c#5810
if the account is being closed, then it should be totally closed. not sure the scenario you mean


[16-Dec-19 06:44 AM] Mihailo#5902
The two scenarios I mentioned up there (2 & 3). So if user spent all coins but he has more equity than the debt, he should be able to close account and take the rest. That we talked about last time. That is ok, but at that moment those coins that he don't have anymore are covered from his deposit and he closed the account, but what happens with the coins now, they are not accounted anywhere...


[16-Dec-19 06:47 AM] jl777c#5810
they should be out of the system totally at that point. the global balance is updated. not sure what the issue is. what coins?


[16-Dec-19 06:50 AM] jl777c#5810
maybe the fee can be based on how far away from the global balance you are. so basically if your account was better than the global balance, there is no fee at all


[16-Dec-19 06:51 AM] jl777c#5810
as closing both sides of it, just improves the global balance


[16-Dec-19 06:51 AM] jl777c#5810
if it is worse than the global balance, then depending on how much worse, the fee is changes


[16-Dec-19 06:51 AM] jl777c#5810
though if you have less than 50% equity, you wouldnt be able to close the account anyway, so maybe it is a moot point


[16-Dec-19 06:53 AM] Mihailo#5902
Scenario like this:
1) user funded account (100KMD)
2) took 10USDK coins
3) spend 10USDK, balance 0
4) close account and take the rest of deposit (let say KMD 1$ so 90KMD redeemed and 10KMD has stayed in pegs to cover 10USDK)
Now there is no user account, maybe we should ad it to a global account and add 10USDK debt and 10KMD deposit. And price of KMD went to 0.5$ where is the cover for 10USDK now (5USDK un covered)?


[16-Dec-19 06:56 AM] Mihailo#5902
Initially when we had option to close account only when you cover whole debt was ok as there was not more coins and everything is covered. But this creates wierd cases.


[16-Dec-19 06:57 AM] jl777c#5810
it seems the 10 USDK debt needs to go somewhere, or maybe we make it so that only 80 KMD can be withdrawn, so not totally closed, but that leaves a 10KMD balance with 10 USDK issued, so they are in balance


[16-Dec-19 06:58 AM] jl777c#5810
or 12.5 KMD to meet the 80%


[16-Dec-19 06:58 AM] Mihailo#5902
It is ok to transfer the debt somewhere, we can make a global account. But the problem is what to do when debt overpasses the deposit. We cannot liquidate global account 😛


[16-Dec-19 06:58 AM] jl777c#5810
that keeps things in balance and still allows user to closeout most of a high equity account


[16-Dec-19 06:58 AM] jl777c#5810
best not to mess with global account as we cant risk that


[16-Dec-19 06:58 AM] Mihailo#5902
Even if we leave twice as much deposit for left coins, what happens when price fells 2.5x


[16-Dec-19 06:59 AM] jl777c#5810
it is in a normal user account at the 80% loaned ratio. if it goes below 10% equity it is liquidated as usual


[16-Dec-19 06:59 AM] jl777c#5810
basically "close account" is really more "take out as much KMD as i can and leave the balance at 80% borrowed"


[16-Dec-19 07:00 AM] Mihailo#5902
Ok, but what when borrowed ratio goes to 101%?


[16-Dec-19 07:00 AM] Mihailo#5902
After the close


[16-Dec-19 07:00 AM] jl777c#5810
how can it?


[16-Dec-19 07:00 AM] jl777c#5810
after the close it is at 80%


[16-Dec-19 07:00 AM] Mihailo#5902
And price changes right?


[16-Dec-19 07:00 AM] jl777c#5810
then each block it can gradually go to 90%+ and then get liquidated, just as any account


[16-Dec-19 07:01 AM] jl777c#5810
you need to do the calculations as of the block it is being confirmed in


[16-Dec-19 07:01 AM] Mihailo#5902
Oh, you mean to keep the account as is just to reduce the deposit so it is at 80%.


[16-Dec-19 07:01 AM] Mihailo#5902
Then when it reaches 90% someone can liquidate it


[16-Dec-19 07:01 AM] jl777c#5810
after the "close" account, the user is left with a max borrow percentage of 80%


[16-Dec-19 07:02 AM] jl777c#5810
so it doesnt actually close it, but rather changes it to a max leveraged account that can be created normally. that covers the left over coins


[16-Dec-19 07:03 AM] Mihailo#5902
So in case I mentioned it woudl be like this:
- account 100KMD:10USDK (ratio 10%)
- "close" account with gettting out 87.5KMD and leaving 12.5 after which 10USDK is 80%
- price changes and account reaches 90%
- liquidated by someone...


[16-Dec-19 07:04 AM] jl777c#5810
yes, it is just a convenience function for the user, the system is put into a normal state of an 80% account


[16-Dec-19 07:06 AM] Mihailo#5902
Good, will do it like that. What should the command be called? Up to now it was pegsreedem, we could leave it that way. So you can reedem deposit with either covering all debt (then a real account close), or partial or 0 debt covered and get deposit to leave the account at 80% debt.


[16-Dec-19 07:14 AM] jl777c#5810
however makes sense to you seems fine


[17-Dec-19 06:27 AM] jl777c#5810
@Mihailo i "fixed" the adaptivepow, but i dont think it was a bug exactly. my guess is that you were mining with not so many cores, maybe even just 1. that would make the variance very high and in that case it would make the diff all the way to mindiff, which can be mined pretty fast, even with one core. which makes it look like a big hashrate increase.
so, what i did was make new adaptivepow=N values. using values of 3, 4, 5, 6, 7 you can have different levels of sensitivity. the more normal miners you have, the smaller the number can be. so without many miners, then adaptivepow=7 might make sense, but the higher the number the less responsive it will be to hashrate increases.


[17-Dec-19 06:27 AM] jl777c#5810
for a chain without block rewards, that probably isnt a big concern, so i would make a chain with adaptivepow=6 or 7


[17-Dec-19 06:27 AM] jl777c#5810
unfortunately it is a hardforking change, so you will need a new chain to change the adaptivepow= value


[17-Dec-19 06:29 AM] jl777c#5810
oh, wait, i need to fix the commit


[17-Dec-19 06:29 AM] Mihailo#5902
Ok, great. Yes I was mining with 1 or 2 cores and only one node to avoid forks in beginning of the chain.


[17-Dec-19 06:33 AM] jl777c#5810
ok fixed


[17-Dec-19 06:33 AM] Mihailo#5902
It will be in FSM?


[17-Dec-19 06:33 AM] jl777c#5810
its there


[17-Dec-19 06:33 AM] Mihailo#5902
👍


[17-Dec-19 06:34 AM] jl777c#5810
mine on just one node, with max cores you can without disrupting other things


[17-Dec-19 06:34 AM] jl777c#5810
one node using N cores wont contribute to forking, as it all happens in one node


[17-Dec-19 06:34 AM] jl777c#5810
using adaptivepow=6 should work much smoother (10x) with 6+ cores


[17-Dec-19 06:35 AM] jl777c#5810
i am still testing on the last chain to make sure my theory is correct. it just was so slow, i went ahead and fixed the problem before i got all the timing results


[17-Dec-19 07:03 AM] Mihailo#5902
My nodes are with 2 cores so cannot mine with much more


[17-Dec-19 07:03 AM] Mihailo#5902
But I will mine locally on my machine


[17-Dec-19 07:03 AM] Mihailo#5902
With 8 cores


[19-Dec-19 03:57 AM] Mihailo#5902
@jl777c There is still problem with mining on adaptivepow and having pricescc enabled.
```
00002f57a4774125cb51deab2cd028de00e2e5234108eff9deb9f062645b9013 height.67 O.1 , W.1  width.2   137 vs 180 , deficit   43 tip.631
b0456f802423bb7bc197648b19f9fc2fe6cd7ef95a4977983cf82df98ceaa111 height.67 O.1 , W.2  width.3   140 vs 240 , deficit  100 tip.631
699f23ea931c35803f807382d98ea722434bda1e191aae2c22c8acd78ee477ab height.67 O.1 , W.3  width.4   146 vs 300 , deficit  154 tip.631
32c59371b5d49cfacd103e918b2d45328f1e6b7af843c90292d75d9f6d3ac278 height.67 O.1 , W.6  width.7   255 vs 480 , deficit  225 tip.631
0008a171a72fb91c8a8fc4402c8eddbf7252d6e4f7f26260e4a36050293aee70 exp() to the rescue cmp.1 mult.211 for ht.67
00002f57a4774125cb51deab2cd028de00e2e5234108eff9deb9f062645b9013 height.67 O.1 , W.1  width.2   137 vs 180 , deficit   43 tip.631
b0456f802423bb7bc197648b19f9fc2fe6cd7ef95a4977983cf82df98ceaa111 height.67 O.1 , W.2  width.3   140 vs 240 , deficit  100 tip.631
699f23ea931c35803f807382d98ea722434bda1e191aae2c22c8acd78ee477ab height.67 O.1 , W.3  width.4   146 vs 300 , deficit  154 tip.631
32c59371b5d49cfacd103e918b2d45328f1e6b7af843c90292d75d9f6d3ac278 height.67 O.1 , W.6  width.7   255 vs 480 , deficit  225 tip.631
```


[19-Dec-19 03:58 AM] Mihailo#5902
No block for more than 10 mins. Can you try to mine on this chain and debug it?


[19-Dec-19 03:58 AM] Mihailo#5902
Here are params:
```komodod -ac_name=EURKTEST -ac_cc=2 -ac_import=PEGSCC -ac_supply=1000000 -ac_end=1 -ac_reward=1 -ac_perc=0 -ac_cbopret=5 -ac_adaptivepow=6 -dns=0 -dnsseed=0 -listenonion=0 -debug=pegscc-2 -debug=importcoin -debug=cctokens -debug=gatewayscc -printtoconsole=1 -addnode=116.203.17.140 -addnode=116.203.17.141 -earlytxid=a8e2624ba348a5eb00fc631d4cd8767a915d24b653a3c44ab87a5d33dccd6379```


[19-Dec-19 04:08 AM] jl777c#5810
ok i will see if there are any issues, some block variance is always going to be there


[19-Dec-19 04:09 AM] Mihailo#5902
I think it is to much (tip went to 1000 before it found block). I think the problem is in rejecting prices stuff as it cannot calculate stuff for coinbase...


[19-Dec-19 04:10 AM] jl777c#5810
that is 3x, it might happen once in a while, especially during turblent price changes


[19-Dec-19 04:11 AM] jl777c#5810
i cant connect to the chain


[19-Dec-19 04:11 AM] jl777c#5810
this is blocktime of 60 seconds?


[19-Dec-19 04:12 AM] Mihailo#5902
Yes


[19-Dec-19 04:12 AM] Mihailo#5902
Try now, I was stoping nodes and starting in background


[19-Dec-19 04:12 AM] Mihailo#5902
So I can disconnect from nodes


[19-Dec-19 04:12 AM] jl777c#5810
connection rejected


[19-Dec-19 04:13 AM] Mihailo#5902
I'm able to connect


[19-Dec-19 04:14 AM] jl777c#5810
what is your magic and port


[19-Dec-19 04:14 AM] Mihailo#5902
```"p2pport": 37586,
  "rpcport": 37587,
  "magic": -1343013210,
```


[19-Dec-19 04:14 AM] jl777c#5810
mine are all different. let me switch branches


[19-Dec-19 04:15 AM] Mihailo#5902
```komodod -ac_name=EURKTEST -ac_cc=2 -ac_import=PEGSCC -ac_supply=1000000 -ac_end=1 -ac_reward=1 -ac_perc=0 -ac_cbopret=5 -ac_adaptivepow=6 -dns=0 -dnsseed=0 -listenonion=0 -debug=pegscc-2 -debug=importcoin -debug=cctokens -debug=gatewayscc -printtoconsole=1 -addnode=116.203.17.140 -addnode=116.203.17.141 -earlytxid=a8e2624ba348a5eb00fc631d4cd8767a915d24b653a3c44ab87a5d33dccd6379```


[19-Dec-19 04:15 AM] Mihailo#5902
Use FSM


[19-Dec-19 04:16 AM] jl777c#5810
building


[19-Dec-19 04:16 AM] Mihailo#5902
It is probably your latest modification for adaptive pow


[19-Dec-19 04:16 AM] Mihailo#5902
👍


[19-Dec-19 04:16 AM] jl777c#5810
yes, i was in the DEX branch, hadnt rebased


[19-Dec-19 04:18 AM] Mihailo#5902
Leave it to mine and check it from time to time. I had big pause more than 10mins on 1 minute block. Was mining with 8 cores.


[19-Dec-19 04:20 AM] jl777c#5810
ok, i will check. you should stop mining, so i can tell it is my node affecting things


[19-Dec-19 04:26 AM] jl777c#5810
ok, height 85, i am mining


[19-Dec-19 04:26 AM] jl777c#5810
something is wrong... adaptivepow=6 seems to not have the expected effect. investigating


[19-Dec-19 04:53 AM] jl777c#5810
pushed fix


[19-Dec-19 04:53 AM] jl777c#5810
it might not need a hardfork, not sure, but my node is mining from where it used to be


[19-Dec-19 04:55 AM] jl777c#5810
it forked. probably best to start a new chain


[19-Dec-19 05:39 AM] Mihailo#5902
Ok, I'll update abd try


[19-Dec-19 05:42 AM] jl777c#5810
if you see W.3 or W.2 or W.1 it is incorrect


[19-Dec-19 05:42 AM] jl777c#5810
those are the high frequency filters that adaptivepow=6 is supposed to not do, let me know when the chain is past block 100 and i will add one node to mine to track it


[19-Dec-19 05:43 AM] Mihailo#5902
I'll try with same chain, and if not I'll create a new one


[19-Dec-19 05:47 AM] Mihailo#5902
W.6


[19-Dec-19 05:50 AM] jl777c#5810
yes, W.6 and W.12 are the only ones you should see


[19-Dec-19 05:50 AM] jl777c#5810
if so, the adaptivepow=6 logic is working


[19-Dec-19 05:50 AM] jl777c#5810
and should avoid the large back and forth


[19-Dec-19 05:50 AM] Mihailo#5902
BTW, what is the logic behined aPoW params, what 1,2,3,4,5,6,7 means


[19-Dec-19 05:50 AM] jl777c#5810
1 is all the windows active


[19-Dec-19 05:51 AM] jl777c#5810
2 is not really used, legacy for a totally different method


[19-Dec-19 05:51 AM] jl777c#5810
3 means all the filters and i guess works the same as 1


[19-Dec-19 05:51 AM] jl777c#5810
4 means all the filter other than W.1


[19-Dec-19 05:51 AM] jl777c#5810
5 is all but W.1 and W.2


[19-Dec-19 05:51 AM] jl777c#5810
6 is all but W.1, W.2 and W.3


[19-Dec-19 05:52 AM] jl777c#5810
7 is only W.12


[19-Dec-19 05:52 AM] jl777c#5810
there are 5 windows 1, 2, 3, 6, 12 blocks wide


[19-Dec-19 05:52 AM] Mihailo#5902
And I suppose those windows means how often it will adjust difficulty


[19-Dec-19 05:52 AM] jl777c#5810
if there is a variance that indicates an increased hashrate, it forces the blocktime to be slower


[19-Dec-19 05:52 AM] jl777c#5810
the DAA is adjusting every second, within the block, once a W.x is triggered


[19-Dec-19 05:53 AM] Mihailo#5902
Aha, and window is how far to look when adjusting?


[19-Dec-19 05:54 AM] jl777c#5810
no


[19-Dec-19 05:54 AM] jl777c#5810
the window is a detection width


[19-Dec-19 05:55 AM] jl777c#5810
so if in the last 1, 2, 3, 6, or 12 blocks it is solved significantly faster than expected, then it goes into adaptive mode


[19-Dec-19 05:55 AM] Mihailo#5902
Aha, ok. Similair to what I thought


[19-Dec-19 05:55 AM] jl777c#5810
once it starts the adaptive mode, it stays active for 20, 30, 40, or 50 blocks or until the time deficit is made up


[19-Dec-19 05:55 AM] jl777c#5810
so it boosts the diff up to correspond with what it things the actual hashrate is


[19-Dec-19 05:56 AM] jl777c#5810
then if after 10 minutes there is no block, it starts making it easier to cover the case where it was too aggressive


[19-Dec-19 05:56 AM] jl777c#5810
so it isnt perfect, but over time the average blocktime ends up where it should be


[19-Dec-19 05:57 AM] Mihailo#5902
👍


[19-Dec-19 05:57 AM] jl777c#5810
certainly if it kicks in, the blocktimes will become much less consistent for a while but that is the cost for being able to recover from a billion-fold diff stranding


[19-Dec-19 08:25 AM] Mihailo#5902
It seems that it is working fine now 😉


[19-Dec-19 08:25 AM] Mihailo#5902
I left it mining for some time


[19-Dec-19 08:26 AM] Mihailo#5902
Maybe the blocks are too fast but I'll let it mine more so that chain stabilizes


[19-Dec-19 08:26 AM] jl777c#5810
genminingCSV rpc call will make a spreadsheet with all the blocktimes and other info


[19-Dec-19 08:27 AM] Mihailo#5902
Ah good, didn't know that


[19-Dec-19 08:27 AM] jl777c#5810
takes 1000+ blocks at first to stabilize the blocktime


[19-Dec-19 08:29 AM] Mihailo#5902
👍


[20-Dec-19 05:30 PM] CrisF#3405
Can't vouch for the accuracy of this, but maybe of interest. Useful when writing Pegs docs/comaprisons?
I see Komodo on page 16, looking connected to the ethereum base coins.

{Attachments}
https://cdn.discordapp.com/attachments/564807360472940575/657756763562704897/Stablecoins.pdf


[23-Dec-19 03:26 AM] phm87#7395
About apow, I added a previous version of jl777 work into CHIPS, I still need to test it in details.
I read that apow code needed fune tuning when used with price_cc or with some blocktimes. Do you think that I should read the new changes to apow of jl777 or is it unrelated to Chips ?
Thank you


[23-Dec-19 03:30 AM] jl777c#5810
might as well merge in the latest fix, it adds options for the filters being used


[23-Dec-19 03:31 AM] phm87#7395
ok thank you, I'll read the changes and merge to my branch on Chips


[24-Dec-19 07:28 AM] Mihailo#5902
@Deleted User @jl777c I made the priority of tx with setting max priority to 1e16. But something seems to be chaning the priority of the tx. I put this priority on two places, in miner.cpp and in main.cpp AcceptToMemoeryPool (view.GetPriority()). Are there some other places where the priority of tx can be changed?


[24-Dec-19 07:29 AM] Mihailo#5902
At some point I have priority to 1e16 but then it changes, sometimes some big number sometimes 0.


[24-Dec-19 07:30 AM] Mihailo#5902
```"5cfee3a104ea00652680e1fadaaf1fd5da7e7d581b5a94f142244bb28e0e06fe": {
    "size": 975,
    "fee": 0.00010000,
    "time": 1577200960,
    "height": 60,
    "startingpriority": 0,
    "currentpriority": 0,
    "depends": [
    ]
  }
```


[24-Dec-19 07:30 AM] Mihailo#5902
```"d53392284ec7b241e1accecddbb4a97166f78adf8527bf4588f55f8eabc2c4a9": {
    "size": 974,
    "fee": 0.00010000,
    "time": 1577201351,
    "height": 68,
    "startingpriority": 1569506098.654709,
    "currentpriority": 1569506098.654709,
    "depends": [
      "0bb74e48e41964a4578de491bea6a2d8ca5724b2d14b80804333ef351799a41b"
    ]
  },
```


[24-Dec-19 07:31 AM] Mihailo#5902
I've put this in miner near the end of parsing a tx in block:
```cpp
// Priority is sum(valuein * age) / modified_txsize
            unsigned int nTxSize = ::GetSerializeSize(tx, SER_NETWORK, PROTOCOL_VERSION);
            dPriority = tx.ComputePriority(dPriority, nTxSize);

            uint256 hash = tx.GetHash();
            mempool.ApplyDeltas(hash, dPriority, nTotalIn);

            CFeeRate feeRate(nTotalIn-tx.GetValueOut(), nTxSize);

----->>>    if (tx.vout.size()>0 && tx.IsPriorityCC()) dPriority=1e16;```


[24-Dec-19 07:33 AM] Mihailo#5902
And in GetPriority() called from main in AcceptToMemoryPool:
```cpp
if (tx.vjoinsplit.size() > 0 || tx.vShieldedSpend.size() > 0 || tx.vShieldedOutput.size() > 0 || tx.IsCoinImport() || tx.IsPegsImport() || tx.IsPriorityCC()) {
        return MAX_PRIORITY;
    }```


[24-Dec-19 08:31 AM] Mihailo#5902
Ahh, I had a problem with extracting eval code from vout


[24-Dec-19 08:31 AM] Mihailo#5902
Now they all have 1e16 priority


[24-Dec-19 08:32 AM] Mihailo#5902
Hmmm, but when I start mining they switch to 0 priority


[24-Dec-19 08:43 AM] Mihailo#5902
Hmmm it seems that only when I start mining it sets current txs in mempool to 0, then after adding new ones it stays on 1e16


[24-Dec-19 08:44 AM] Mihailo#5902
No, at some point they go to 0


[06-Jan-20 03:04 AM] Mihailo#5902
@jl777c @Deleted User I haven't figuered out what is the reason why on mining nodes the 1e16 priority txs get to 0. I noticed that they get to 0 when they are readded after unsuccssesful block mined because of prices.


[06-Jan-20 03:04 AM] Mihailo#5902
But it only happens on mining node, on other nodes txs stay at 1e16 priority.


[06-Jan-20 03:07 AM] Mihailo#5902
I have used -printpriority switch to check the priority in miner.cpp but the prints give me that it is at highest priority. Not sure where it could be set to 0.


[06-Jan-20 03:32 AM] Mihailo#5902
```ERROR: CheckTransaction(): invalid script data for coinbase time lock
ContextualCheckBlock failed ht.357
1d16cd7bccd8841e6b89494db522f0534809e84485cf45b148703f9173b7d7e6 height.357 O.1 , W.6  width.7   287 vs 480 , deficit  193 tip.69
029908c282e16a21145b0f28a0408b18dba7697446314b09f7ded79f9cf6c3a8 height.357 O.1 , W.12 width.13  733 vs 840 , deficit  107 tip.69
priority 9999999999999990.0 fee 0.00000000 KMD/kB txid 494b0d1e412116c6835398596161991275bed155d218e87a8208210f8ecb8fe8
priority 9999999999999990.0 fee 0.00000000 KMD/kB txid 00f1b783644494593c216e32f8260b0d5da7bc128c766d2eb41e848d5066dee0
priority 9999999999999990.0 fee 0.00000000 KMD/kB txid 1f873db7719c293cfc8e34687b36c2a7620fbd49bbeafd23da6142d43de380ac
priority 9999999999999990.0 fee 0.00000000 KMD/kB txid 8c74bdb7f85a7ba2a16814d69fa5bebc0e7c97c55dcc1ad1f5c3e762eb68d3fd
priority 9999999999999990.0 fee 0.00000000 KMD/kB txid 6500f5e4d581495d7851f84c38550e8a2f05d811098be35eb8c052ca6cd7b30f
priority 9999999999999990.0 fee 0.00000000 KMD/kB txid 5d0e6be82df5b3d27dfab3ea6c15d60120769fe74bf8f9f17715740404c05e18
priority 9999999999999990.0 fee 0.00000000 KMD/kB txid 1032b8b7190d42f5ec99378e3b7231b40f1556311891bc2e31369d9ab936d637
priority 9999999999999990.0 fee 0.00000000 KMD/kB txid 1940b26e1b39728a2b065d1115f2a568f0a837e4e62558495d1e23a3bda14cf0
```


[06-Jan-20 03:37 AM] Mihailo#5902
```"00f1b783644494593c216e32f8260b0d5da7bc128c766d2eb41e848d5066dee0": {
    "size": 861,
    "fee": 0.00000000,
    "time": 1578310300,
    "height": 356,
    "startingpriority": 0,
    "currentpriority": 0,
    "depends": [
    ]
  },
  "494b0d1e412116c6835398596161991275bed155d218e87a8208210f8ecb8fe8": {
    "size": 862,
    "fee": 0.00000000,
    "time": 1578310300,
    "height": 356,
    "startingpriority": 0,
    "currentpriority": 0,
    "depends": [
    ]
  },
```


[06-Jan-20 03:38 AM] jl777c#5810
could that coinbase error be clearing the priority?


[06-Jan-20 03:41 AM] Mihailo#5902
Well I'm checking the mempoolToJSON now as the problem could be there. Priority print is showing it is at max priority (1e16 - 10, this is for notarisation tx to be the first).


[06-Jan-20 03:41 AM] Mihailo#5902
```cpp
double
CTxMemPoolEntry::GetPriority(unsigned int currentHeight) const
{
    CAmount nValueIn = tx.GetValueOut()+nFee;
    double deltaPriority = ((double)(currentHeight-nHeight)*nValueIn)/nModSize;
    double dResult = dPriority + deltaPriority;
    return dResult;
}```


[06-Jan-20 03:41 AM] Mihailo#5902
This could maybe be the problem


[06-Jan-20 03:41 AM] Mihailo#5902
```cpp
            info.push_back(Pair("startingpriority", e.GetPriority(e.GetHeight())));
            info.push_back(Pair("currentpriority", e.GetPriority(chainActive.Height())));```


[06-Jan-20 03:53 AM] Mihailo#5902
No, it seems that in mempool it is set to 0.


[06-Jan-20 03:54 AM] Mihailo#5902
So it probably goes through another part of code where it gets 0 priority.


[06-Jan-20 03:54 AM] Mihailo#5902
I have set it to high priority on two places AcceptToMemoryPool() in main.cpp and in CreateNewBlock() in miner.cpp


[06-Jan-20 04:11 AM] Mihailo#5902
Figured it out. My bug 😦 😦 😦 I wanted to put highest priority after all the regular calcs for priority are made, but I set it little bit to late 😛 (in miner.cpp)
```cpp
            // Priority is sum(valuein * age) / modified_txsize
            unsigned int nTxSize = ::GetSerializeSize(tx, SER_NETWORK, PROTOCOL_VERSION);
            dPriority = tx.ComputePriority(dPriority, nTxSize);
            
            uint256 hash = tx.GetHash();
  --->>>    mempool.ApplyDeltas(hash, dPriority, nTotalIn);

            CFeeRate feeRate(nTotalIn-tx.GetValueOut(), nTxSize);

  --->>>    if (tx.IsPriorityCC()) dPriority=1e16;```


[06-Jan-20 04:14 AM] Mihailo#5902
@jl777c Don't tell anyone 😂 😂


[06-Jan-20 04:14 AM] jl777c#5810
i wont


[06-Jan-20 04:20 AM] Mihailo#5902
Ok, so I think I'm gonna finally start on doing pegs validation. I have set txfee to 0 and make priority for those CC txs so this should work. I'll test it on the way...


[06-Jan-20 01:50 PM] Alright#0419
let me know when validation is ready for testing @Mihailo

{Reactions}
👍 

[11-Jan-20 07:47 AM] sergipcm#2275
have pegs using btc or erc20 gateways been used/tested so far?


[11-Jan-20 09:01 AM] gcharang#6833
no. pegs module's validation code is under development right now. testing will be after it is ready


[11-Jan-20 09:05 AM] sergipcm#2275
thanks, I see that right now only 1 coin can be used to peg


[11-Jan-20 09:06 AM] sergipcm#2275
not sure if initially its intended to have only 1 coin per peg or you will already release 2+ coins support


[11-Jan-20 09:06 AM] sergipcm#2275
and iterate later


[11-Jan-20 09:10 AM] gcharang#6833
there will be only one stable coin per smart chain (the smart chain's native coin is the stable coin). the stable coin itself can be pegged to any asset with a reliable price feed
but it can be backed by multiple cryptos at the same time


[11-Jan-20 10:13 AM] sergipcm#2275
as far as  I understood Peg is a token handled using price module


[11-Jan-20 10:15 AM] jl777c#5810
it can also be a native coin


[11-Jan-20 10:16 AM] sergipcm#2275
right, but how can a Peg handle deposit of different coins? Is not documented yet? https://developers.komodoplatform.com/basic-docs/antara/antara-api/pegs.html#introduction


[11-Jan-20 10:16 AM] gcharang#6833
<https://developers.komodoplatform.com/basic-docs/antara/antara-api/pegs.html#associated-modules>
in the "Gateways module" section


[11-Jan-20 10:18 AM] gcharang#6833
the cryptocurrencies that back the peg are tokens created using the Gateways
the prices module gives the price of the stable coin(which ever one it might be pagged to) wrt the backing cryptos


[11-Jan-20 10:18 AM] sergipcm#2275
ok so it supports any gateway supported token


[11-Jan-20 10:19 AM] gcharang#6833
yes, any "gateway supported token" can back the peg


[11-Jan-20 10:22 AM] sergipcm#2275
thats cool


[11-Jan-20 10:23 AM] sergipcm#2275
are gateways already in production?


[11-Jan-20 10:25 AM] sergipcm#2275
should have sense to have NN's acting as gateways signatory nodes


[11-Jan-20 11:03 AM] sergipcm#2275
sounds that only with gateways + prices feeds in place pegs can be more or less accomplished. Both gateways and prices could be achieved with support of NN's


[11-Jan-20 11:11 AM] SHossain#0007
gateways and importgateway is being refactored by Mihailo currently


[11-Jan-20 11:12 AM] SHossain#0007
not in production properly


[11-Jan-20 11:13 AM] SHossain#0007
there will be some multisig signing nodes for 7of13


[11-Jan-20 06:35 PM] sergipcm#2275
what's ETA for prod readiness?


[13-Jan-20 04:10 AM] Mihailo#5902
@sergipcm You can have multiple coins backing the native coin using pegs. Each coin that is used for backing gets its token and gateway on the chain, and you deposit those coins using gateways and get the correct token. Then you use those tokens to fund the account and issue native coins to yourself.


[13-Jan-20 06:39 AM] sergipcm#2275
@Mihailo that's great, I'm asking about the gateways to get btc-forks onboard and possibly erc20, even not sure those will be supported initially on gateways


[13-Jan-20 06:40 AM] sergipcm#2275
its quite clear how gateways work, but its not clear to me which network of honest nodes will be doing the multisig


[13-Jan-20 06:40 AM] sergipcm#2275
and as far as I know, that is needed to have all the rest working fine


[13-Jan-20 06:41 AM] Mihailo#5902
All btc protocol coins are supported with gateways. Ethereum based ar not.


[13-Jan-20 06:42 AM] Mihailo#5902
Multi sig will be done by some NN nodes so you can say they are trusted.


[13-Jan-20 06:42 AM] sergipcm#2275
and this "will" be done has a timing?


[13-Jan-20 06:44 AM] Mihailo#5902
I think we don't have the exact timing yet, but as pegs are in development/testing now as soon it passes initial tests I think there will be a test chain setup and after the main chain for at least EURK pegged coin but probably some others too.


[13-Jan-20 06:57 AM] sergipcm#2275
sounds good, I understand however that having gateways working and well tested is previous to issuing a pegged coin


[13-Jan-20 07:11 AM] Mihailo#5902
Yes. We hade nice amount of testing for gateways. But still as there were recent changes on gateways it will be neccessary to test it little bit more. But it will be done while testing how pegs work.


[13-Jan-20 08:17 AM] sergipcm#2275
nice so let me know where I can help with gateways testing


[13-Jan-20 08:17 AM] Alright#0419
validation ready for testing?


[14-Jan-20 05:39 AM] Mihailo#5902
@Alright Not yet (for Pegs).


[14-Jan-20 05:40 AM] Mihailo#5902
@jl777c I'm starting to get pissed off by this issue that happens from time to time:
```ERROR: mempool transaction missing input
komodod: miner.cpp:372: CBlockTemplate* CreateNewBlock(CPubKey, const CScript&, int32_t, bool): Assertion `"mempool transaction missing input" == 0' failed.
Aborted (core dumped)```


[14-Jan-20 05:40 AM] Mihailo#5902
I happens when I have oraclefeed started on two nodes, and I'm mining on some other node.


[14-Jan-20 05:40 AM] jl777c#5810
i havent changed the miner in a long time...


[14-Jan-20 05:40 AM] jl777c#5810
maybe dimxy would know


[14-Jan-20 05:42 AM] Mihailo#5902
I suppose it could be some problem with some mempool txs not getting mined and because txs depend on each other maybe when re adding txs some times it happens that some tx gets added before the depending one and maybe then this ahppen. Just wild guess...


[14-Jan-20 05:42 AM] Mihailo#5902
This was happening for a while now but I never got time to take a look at it.


[14-Jan-20 05:43 AM] Mihailo#5902
@dimxy have you had this kind of issue ever?


[14-Jan-20 05:47 AM] dimxy#2587
I had once this issue


[14-Jan-20 05:47 AM] Alright#0419
believe that is related to LABS changes


[14-Jan-20 05:47 AM] Alright#0419
something joker changed recently, don't understand it


[14-Jan-20 05:49 AM] dimxy#2587
@Mihailo are you running a PoS chain?


[14-Jan-20 05:49 AM] Mihailo#5902
No


[14-Jan-20 05:50 AM] Mihailo#5902
I'm running aPoW, but this was happening even before I started with aPoW


[14-Jan-20 05:51 AM] Alright#0419
could be coincidence, but I noticed that for the first time after some changes he made to miner for hard fork


[14-Jan-20 05:51 AM] Alright#0419
haven't been able to work out how it happens


[14-Jan-20 05:52 AM] Alright#0419
@Deleted User any insight?


[14-Jan-20 05:52 AM] Alright#0419
told me he'd be online today, maybe he's in a helpful mood 😂


[14-Jan-20 05:52 AM] Mihailo#5902
I also don't know the exact steps to reproduce, but I have oraclefeed running and it usually creates up to 4 txs per node, so 8 in total and the other node mines it and it could be that in those bunch of txs (that depend on each other in mempool) this happens


[14-Jan-20 05:53 AM] Alright#0419
spent a couple days trying to reliably reproduce it and came up with nothing


[14-Jan-20 05:53 AM] Alright#0419
seems random, couldn't work it out


[14-Jan-20 05:54 AM] Mihailo#5902
I could maybe tryi to print the mempool at the time this happens to see what is the state, maybe my guess is correct

{Reactions}
👍 

[14-Jan-20 05:55 AM] Alright#0419
can you make it happen consistently?


[14-Jan-20 05:56 AM] Alright#0419
I was seeing it on staking nodes on ac_staked chains, but couldn't force it to happen


[14-Jan-20 05:57 AM] dimxy#2587
I noticed yet another thing:
after a crash of komodod the address index becomes broken (GetTransaction begins to write errors for example)
This assert code in miner uses coins cache, maybe this is something about this


[14-Jan-20 06:03 AM] dimxy#2587
(after a crash errors appear in the log: `ERROR: myGetTransaction: txid mismatch on disk...`)


[14-Jan-20 06:04 AM] Mihailo#5902
```cpp
 // Read prev transaction
                    if (!view.HaveCoins(txin.prevout.hash))
                    {
                        // This should never happen; all transactions in the memory
                        // pool should connect to either transactions in the chain
                        // or other transactions in the memory pool.
                        if (!mempool.mapTx.count(txin.prevout.hash))
                        {
                            LogPrintf("ERROR: mempool transaction missing input\n");
                            if (fDebug) assert("mempool transaction missing input" == 0);```


[14-Jan-20 06:05 AM] Mihailo#5902
This basically happnes. It tries to check the input of a tx and it cannot find it. But because the input is another tx from mempool it could be that at some point of removing and readding txs from mempool the order of txs gets different...


[14-Jan-20 06:13 AM] dimxy#2587
I think it is good to add print of the current txid and referred txid.
Then after crash see if the prev tx was really spent or it was like data corruption


[14-Jan-20 06:16 AM] dimxy#2587
(I believe the mempool should be locked when a tx is added so no other tx could be removed at this moment)


[14-Jan-20 07:02 AM] Mihailo#5902
I've added the prints, but now can't reproduce it 😛

{Reactions}
😟 

[15-Jan-20 08:15 AM] Mihailo#5902
@jl777c At the moment the tx enters validation, is it in the mempool or not? I was sure it was not yet as it hasn't passed validation and after it passes it is added to mempool. But I have strange situation where I was using myIsutxo_spentinmempool() and it returned me true and the txid of the tx that is validated as spenttxid.


[15-Jan-20 08:18 AM] jl777c#5810
there are several places a tx is validated...


[15-Jan-20 08:18 AM] jl777c#5810
it is possible to have a tx that is in the mempool being validated and one that is not yet in the mempool being validated


[15-Jan-20 08:18 AM] jl777c#5810
the validation for entering mempool is not as strict


[15-Jan-20 08:18 AM] Mihailo#5902
Aha, so that is the thing.


[15-Jan-20 08:18 AM] jl777c#5810
actually there are 3 levels


[15-Jan-20 08:19 AM] jl777c#5810
mempool acceptance


[15-Jan-20 08:19 AM] jl777c#5810
processblock acceptance


[15-Jan-20 08:19 AM] Mihailo#5902
Ok, I have to change the way I checked for something


[15-Jan-20 08:19 AM] jl777c#5810
connectblock acceptance


[15-Jan-20 08:21 AM] Mihailo#5902
Basically, I was checking for previous account tx marker is it spent in mempool. If it is, it means there is another account tx that needs to be mined and then rejecting any new account txs until this one is confirmed. But now it rejected the new account tx as it returned that previous tx marker is spent by that new tx (myIsutxo_spentinmempool returned true)


[15-Jan-20 08:23 AM] jl777c#5810
i am glad you understand this!


[15-Jan-20 08:30 AM] Mihailo#5902
Ok, I resolved it just with checking the spenttxid if it is different then the tx being validated...


[16-Jan-20 05:32 AM] Mihailo#5902
@dimxy I found a problem in AddPegsInputs as if you try to add 0 amount it will not add any vins but it will return the amount of first utxo itterated:
```cpp
if ( total != 0 && maxinputs != 0 )
                    mtx.vin.push_back(CTxIn(txid,vout,CScript()));
                nValue = it->second.satoshis;
                totalinputs += nValue;
                n++;
                if ( (total > 0 && totalinputs >= total) || (maxinputs > 0 && n >= maxinputs) )
                    break;
```
I see the same is in AddTokenCCinputs and probably in others as we were copy/pasting from some CC initially.


[16-Jan-20 05:33 AM] Mihailo#5902
I discovered this as I made txfee to be 0 so when I was using AddPegsInputs with 0 to add funds for txfee I got an error because the change was big and there was no vin.


[16-Jan-20 05:33 AM] Mihailo#5902
You can check your CCs to see if there is a problem with this!


[16-Jan-20 05:33 AM] dimxy#2587
I believe this is by design, and is needed to get all available amout


[16-Jan-20 05:34 AM] Mihailo#5902
Maybe it is by design, but there is an error in desing as no vins are added in case total=0, but totalinputs will be incremented by first utxo and then it will break and return the value of totalinputs.


[16-Jan-20 05:35 AM] Mihailo#5902
So then when you compare the funds added by this function and the needed value it will give change, but there is nothing to create change from


[16-Jan-20 05:36 AM] Mihailo#5902
And in the end I got invalid tx!
`ERROR: CheckInputs(): 4be272bce18751e84869afce84d4677c88a962f9994d2229ecf94ca285598a6a value in (0.01002) < value out (1000.01) diff -999.99998000`
```error code: -26
error message:
16: bad-txns-in-belowout```


[16-Jan-20 05:39 AM] Mihailo#5902
I think that this part of code:
```cpp
                nValue = it->second.satoshis;
                totalinputs += nValue;
                n++;```
should get under the `if ( total != 0 && maxinputs != 0 )`. Just that


[16-Jan-20 05:40 AM] dimxy#2587
I think there is code which uses add...inputs with total==0 just to get the amount without adding utxos


[16-Jan-20 05:41 AM] dimxy#2587
(I use this in some cc to output Total amount on a cc address)😀


[16-Jan-20 05:41 AM] Mihailo#5902
Hmmm, you may be right. I remember something like this...


[16-Jan-20 05:42 AM] Mihailo#5902
Well, I'll have to check all CCs where I added possibility to work on 0 txfee if it will make a problem.

{Reactions}
👍 

[16-Jan-20 05:48 AM] Mihailo#5902
@dimxy tokenbalance rpc is working that way, calling AddTokenInputs with total 0 and maxinputs 0.

{Reactions}
👍 

[22-Jan-20 05:49 AM] Mihailo#5902
@dimxy I'm having a problem in pegs when having vout of tokens and change back to pegs tokens, it is failing on inputs != outputs:
```
TokenExactAmounts() found unequal token cc inputs=1900000 vs cc outputs=78949 for txid=18262b18ab6f898cbb75fb2c165f3c7232d8186008773f0285c24e11a1972d4c and this is not the create tx
CC Eval EVAL_TOKENS Invalid: tokens cc inputs != cc outputs spending tx d13eff6cac376a731ce2f0f63a60184fe011e84c5c868315a951170224b81cc8```


[22-Jan-20 05:49 AM] Mihailo#5902
So it is not seeing the vout of change back to pegs tokens address. I remember I had this problem before but cannot remember what was the solution?


[22-Jan-20 05:57 AM] dimxy#2587
Could you show the tx?


[22-Jan-20 05:58 AM] dimxy#2587
(as I remember you added a special case for pegs in the token cc)


[22-Jan-20 06:26 AM] Mihailo#5902
I can't remember if I added some special case for pegs in tokens


[22-Jan-20 06:27 AM] Mihailo#5902
This is vout for EVAL_TOKENS:
```
{
      "value": 0.00078949,
      "valueZat": 78949,
      "n": 2,
      "scriptPubKey": {
        "asm": "a22c8020477953ab4df8aa5829c40db01bcc466d9cd284f1a1617614d3cb1314665978558103120c008203000401 OP_CHECKCRYPTOCONDITION",
        "hex": "2ea22c8020477953ab4df8aa5829c40db01bcc466d9cd284f1a1617614d3cb1314665978558103120c008203000401cc",
        "reqSigs": 1,
        "type": "cryptocondition",
        "addresses": [
          "REwC15eWM1z7rTmxA4KuxsuryzmsxDmWQR"
        ]
      }
    },
```


[22-Jan-20 06:27 AM] Mihailo#5902
And this is change to EVAL_PEGS on tokens address:
```
{
      "value": 0.01821051,
      "valueZat": 1821051,
      "n": 4,
      "scriptPubKey": {
        "asm": "a22c8020b90feaac903fe5e428f3eeca0235fce57c8c29faf2ac6243702e1964e80abe3a81032214008203000401 OP_CHECKCRYPTOCONDITION",
        "hex": "2ea22c8020b90feaac903fe5e428f3eeca0235fce57c8c29faf2ac6243702e1964e80abe3a81032214008203000401cc",
        "reqSigs": 1,
        "type": "cryptocondition",
        "addresses": [
          "RBkPThYtGpTgfskhCgTok2sRSL1bWou6sU"
        ]
      }
    },
```


[22-Jan-20 06:27 AM] Mihailo#5902
In total they five 0.01900000


[22-Jan-20 06:27 AM] Mihailo#5902
But tokens doesn't seem to catch it


[22-Jan-20 06:28 AM] Mihailo#5902
@dimxy Oh, it could be my mistake. Let me check!


[22-Jan-20 06:33 AM] Mihailo#5902
Hmmm, I put one of the keys wrong but I still have a problem now with different amount.


[22-Jan-20 06:33 AM] Mihailo#5902
```TokenExactAmounts() found unequal token cc inputs=1900000 vs cc outputs=1820907 for txid=f0d57afb0eaa208f5fa44acc31b232f40cf6fa4498d8d48c091fcd3206d1cb35 and this is not the create tx
CC Eval EVAL_TOKENS Invalid: tokens cc inputs != cc outputs spending tx d13eff6cac376a731ce2f0f63a60184fe011e84c5c868315a951170224b81cc8
```


[22-Jan-20 06:34 AM] Mihailo#5902
Now it sees the change but doesnt see the tokens vout


[22-Jan-20 06:35 AM] Mihailo#5902
Ahhh, I have to put 2 keys I think. As one vout goes to pk1 and other vout goes to 1of2 from pk2 and pegspk.


[22-Jan-20 06:39 AM] Mihailo#5902
@dimxy I added 3 pubkeys and I made komodod crash 🙂


[22-Jan-20 06:39 AM] Mihailo#5902
```Thread 11 "zcash-httpworke" received signal SIGSEGV, Segmentation fault.
[Switching to Thread 0x7fffe6b7d700 (LWP 14234)]
0x00005555558cdb64 in IsTokensvout (goDeeper=goDeeper@entry=false, 
    checkPubkeys=checkPubkeys@entry=true, cp=cp@entry=0x7fffe6b79650, eval=eval@entry=0x7fffbc10bae0, 
    tx=..., v=v@entry=0, reftokenid=...) at cc/CCtokens.cpp:404
404                    testVouts.push_back( std::make_pair(MakeTokensCC1of2vout(evalCode1, tx.vout[v].nValue, voutPubkeys[0], pk), std::string("dual-eval1 pegscc cc1of2 pk[0] globalccpk")) ); 
(gdb) bt
#0  0x00005555558cdb64 in IsTokensvout (goDeeper=goDeeper@entry=false, 
    checkPubkeys=checkPubkeys@entry=true, cp=cp@entry=0x7fffe6b79650, eval=eval@entry=0x7fffbc10bae0, 
    tx=..., v=v@entry=0, reftokenid=...) at cc/CCtokens.cpp:404
#1  0x00005555558cbe3c in TokensExactAmounts (goDeeper=goDeeper@entry=true, 
    cp=cp@entry=0x555556988a00 <CCinfos+251680>, inputs=@0x7fffe6b79af8: 1900000, 
    outputs=@0x7fffe6b79af0: 0, eval=eval@entry=0x7fffbc10bae0, tx=..., reftokenid=...)
    at cc/CCtokens.cpp:563
#2  0x00005555558d1f50 in TokensValidate (cp=0x555556988a00 <CCinfos+251680>, eval=0x7fffbc10bae0, 
    tx=..., nIn=<optimized out>) at cc/CCtokens.cpp:84
#3  0x000055555561279e in ProcessCC (cp=cp@entry=0x555556988a00 <CCinfos+251680>, 
    eval=eval@entry=0x7fffbc10bae0, paramsNull=std::vector of length 0, capacity 0, ctx=..., 
    nIn=nIn@entry=7) at cc/CCutils.cpp:909
#4  0x00005555558979ff in Eval::Dispatch (this=0x7fffbc10bae0, cond=<optimized out>, txTo=..., nIn=7)
    at cc/eval.cpp:114
#5  0x0000555555898375 in RunCCEval (cond=0x7fffbc108570, tx=..., nIn=7) at cc/eval.cpp:41
```


[22-Jan-20 06:44 AM] dimxy#2587
oh,this is bad


[22-Jan-20 06:44 AM] dimxy#2587
should be fixed


[22-Jan-20 06:45 AM] Mihailo#5902
I solved it by removing pegs pk from pubkyes vector. I don't know why I was passing global pegs pk as it is compared in tokens with one of the keys so now it doesn't crash.


[22-Jan-20 06:45 AM] Mihailo#5902
But don't know why it crashed in first place


[22-Jan-20 06:46 AM] dimxy#2587
I'll find out this, np


[22-Jan-20 06:46 AM] Mihailo#5902
It crashed on this line
`                testVouts.push_back( std::make_pair(MakeTokensCC1of2vout(evalCode1, tx.vout[v].nValue, voutPubkeys[0], pk), std::string("dual-eval1 pegscc cc1of2 pk[0] globalccpk")) ); `

{Reactions}
👌 

[22-Jan-20 06:46 AM] Mihailo#5902
I added 3 keys, maybe that is the problem. As we had only two up to now I think.


[22-Jan-20 06:47 AM] jl777c#5810
probably good to generate error instead of crashing


[22-Jan-20 06:47 AM] Mihailo#5902
But it was segfault, so it was some problem with memory. We couldn't catch it.


[22-Jan-20 06:47 AM] Mihailo#5902
But some error checking could be done before, like number of keys or etc.


[22-Jan-20 06:51 AM] jl777c#5810
this is reproducible crash?


[22-Jan-20 06:51 AM] Mihailo#5902
Haven't tried it again as I removed one of the pubkeys. But I suppose if I put it again it would crash.


[22-Jan-20 06:52 AM] jl777c#5810
then it should be easy to find and fix. likely a buffer is overflowed with the too many pubkeys


[22-Jan-20 06:54 AM] dimxy#2587
seems it is in the code for pegs


[22-Jan-20 06:55 AM] Mihailo#5902
Yes, but just maybe it will crash even if you put 3 keys somwhere else.


[22-Jan-20 06:55 AM] Mihailo#5902
I'll check it out on my side just to finish this issue


[22-Jan-20 06:57 AM] dimxy#2587
if you can reproduce it, I think you might check evalCode1!=0, pk!=null, cp!=null


[22-Jan-20 06:58 AM] Mihailo#5902
One of the things that is strange is what could segfault on that line. As it didn't segfault on MakeTokensCC1of2vout as gdb whould show it in backtrace, and other things shouldn't segfault!


[22-Jan-20 06:59 AM] dimxy#2587
also check voutpubkeys vector not empty


[22-Jan-20 06:59 AM] Mihailo#5902
Ok, but that would segfault then in MakeTokensCC1of2vout and not on this line!


[22-Jan-20 07:00 AM] dimxy#2587
I think voutpubkeys size should be checked as not empty for this case too


[22-Jan-20 07:02 AM] dimxy#2587
maybe move this code under statement `if(voutpubkey,.size>=1 <=2) {  .. here... }`


[22-Jan-20 07:03 AM] dimxy#2587
the code accessing voutpubkeys[0], and if it is empty it should definitely fail


[22-Jan-20 07:06 AM] Mihailo#5902
Yes, that would be it I think


[22-Jan-20 07:07 AM] Mihailo#5902
But why it is empty 😛


[22-Jan-20 07:07 AM] Mihailo#5902
I put 3 keys 😉


[22-Jan-20 07:34 AM] Mihailo#5902
@dimxy I checked if voutpubkeys.size()>0 and it didnt crash. So I've put it in `if(voutpubkey,.size>=1 <=2) {  .. here... }` segment which already exists.

{Reactions}
👍 

[22-Jan-20 07:35 AM] dimxy#2587
it might have crashed on some other token utxos, not that one


[22-Jan-20 07:36 AM] Mihailo#5902
Well, only this pegs special case was out of the if, so others wouldn't crash I think. And now pegs will not either 😉


[22-Jan-20 07:36 AM] Mihailo#5902
I don't know why I put it out of that if!


[23-Jan-20 04:18 AM] Mihailo#5902
@dimxy @jl777c  @Alright I have caught the problem with the miner:
```Running KomodoMiner.tromp with 1 transactions in block (300 bytes)
cmp.1 mult.74564 ht.657 -> easy target
cmp.1 mult.74563 ht.657 -> easy target
cmp.1 mult.74564 ht.657 -> easy target
ERROR: ContextualCheckBlock: block height mismatch in coinbase
mempool:
  txid: 17b64de3fc78e8ce6816b72b80b7b11054a4bb78f131e65c4fefecaefc738a42
  txid: 0acb15fbacf775ee33d43255f8482c3aa5471effd374f939fb6abd70c3530b9e
tx 17b64de3fc78e8ce6816b72b80b7b11054a4bb78f131e65c4fefecaefc738a42, prevout 1172d65f1f62d47c8988f47d28e141390cb8d873d62c144938bc2b0fc99b3e03
ERROR: mempool transaction missing input
komodod: miner.cpp:379: CBlockTemplate* CreateNewBlock(CPubKey, const CScript&, int32_t, bool): Assertion `"mempool transaction missing input" == 0' failed.
Aborted (core dumped)
```


[23-Jan-20 04:19 AM] Mihailo#5902
So the txid 1172d65f1f62d47c8988f47d28e141390cb8d873d62c144938bc2b0fc99b3e03 was vin for 17b64de3fc78e8ce6816b72b80b7b11054a4bb78f131e65c4fefecaefc738a42, and 1172d65f1f62d47c8988f47d28e141390cb8d873d62c144938bc2b0fc99b3e03 is already mined and in the chain, so my theory falls apart.


[23-Jan-20 04:19 AM] Mihailo#5902
What is weird is that the miner is mining with 1 tx in block but there are 2 txs in mempool as you can see


[23-Jan-20 04:24 AM] Mihailo#5902
But when it crashed it broadcasted the block to other nodes so the problematic tx is in the chain:
```UpdateTip: new best=0a84e32e8e9cf5bb64f33ce0160ae0fd0f69c7581bb1229cce76fe3d3d070189  height=656  log2_work=15.197217  log2_stake=-inf  tx=1246  date=2020-01-23 12:13:43 progress=1.000000  cache=0.0MiB(21tx)
AddToWallet 17b64de3fc78e8ce6816b72b80b7b11054a4bb78f131e65c4fefecaefc738a42  update
```


[23-Jan-20 04:25 AM] Mihailo#5902
And the other one in mempool:
```UpdateTip: new best=0a84e32e8e9cf5bb64f33ce0160ae0fd0f69c7581bb1229cce76fe3d3d070189  height=656  log2_work=15.197217  log2_stake=-inf  tx=1246  date=2020-01-23 12:13:43 progress=1.000000  cache=0.0MiB(21tx)
AddToWallet 0acb15fbacf775ee33d43255f8482c3aa5471effd374f939fb6abd70c3530b9e  update
```


[23-Jan-20 04:28 AM] dimxy#2587
is this a usual tx or a peg import tx?


[23-Jan-20 04:28 AM] Mihailo#5902
These are usual txs, basically OraclesCC txs that are broadcasted from oraclefeed.


[23-Jan-20 04:28 AM] Mihailo#5902
Block data for KMD chain.


[23-Jan-20 04:37 AM] Mihailo#5902
Oracles data tx uses baton mechanism, a marker from previous tx so there could maybe be some problem.


[23-Jan-20 04:39 AM] Mihailo#5902
This issue happens rare so in previous itterations it was finind the prevout tx but at some point it cannot find it which is strange!


[23-Jan-20 04:48 AM] Mihailo#5902
It fails both this ifs and it should pass the first one as vin tx is alrady in chain!
```cpp
// Read prev transaction
                    if (!view.HaveCoins(txin.prevout.hash))
                    {
                        // This should never happen; all transactions in the memory
                        // pool should connect to either transactions in the chain
                        // or other transactions in the memory pool.
                        if (!mempool.mapTx.count(txin.prevout.hash))
                        {
                            fprintf(stderr,"tx %s, prevout %s\n",tx.GetHash().GetHex().c_str(),txin.prevout.hash.GetHex().c_str());
                            LogPrintf("ERROR: mempool transaction missing input\n");```


[23-Jan-20 04:50 AM] dimxy#2587
My guess is:
if the vin tx was in the chain but was not found in the coin cache and mempool too, the coin cache was corrupted (or was not updated with a tx) 
What is the vin tx 1172d65f1f62d47c8988f47d28e141390cb8d873d62c144938bc2b0fc99b3e03 ? Was it put into the cache?


[23-Jan-20 04:51 AM] Mihailo#5902
Yes that is vin tx. Basically this issue just happend at some point, but previous there was calls to this function and everything passed correctly. So my guess to is coins cache corruption.


[23-Jan-20 04:52 AM] Mihailo#5902
Evry time this happens `ERROR: ContextualCheckBlock: block height mismatch in coinbase` (this is related to prices) CreateNewBlock is called again and it was doing fine several times and then suddenly fails!


[23-Jan-20 04:54 AM] dimxy#2587
that vintx, what was it actually? is this prices coinbase?


[23-Jan-20 04:55 AM] Mihailo#5902
No, the vintx is another oraclesdata tx. And it was mined before and it says 3 confirmations in the chain


[23-Jan-20 04:56 AM] dimxy#2587
we might check what the tx it was and find maybe why it was not updated in the cache.


[23-Jan-20 04:57 AM] dimxy#2587
BTW block height mismatch in coinbase for prices might happen sometimes


[23-Jan-20 04:57 AM] dimxy#2587
this is the result of correction of price data surges (validation code rejects prices data oprets)


[23-Jan-20 04:58 AM] Mihailo#5902
It happens pretty often to me, but that is not the problem. Everything goes smooth. Even with that tx trying to be mined but at some random point it fails.


[23-Jan-20 04:59 AM] Mihailo#5902
Maybe the cache is updated every time it doesn't mine the block because of this prices problem and at some specific situation it gets corrupted. Or there is some race condition


[23-Jan-20 05:04 AM] Mihailo#5902
hmmm, I was able now to reproduce it every time 😛


[23-Jan-20 05:24 AM] jl777c#5810
being able to reproduce a bug is the first step to fixing it


[23-Jan-20 06:47 AM] Mihailo#5902
It failed on first thing in FetchCoins():
```cpp
CCoinsMap::const_iterator CCoinsViewCache::FetchCoins(const uint256 &txid) const {
    CCoinsMap::iterator it = cacheCoins.find(txid);
    if (it != cacheCoins.end())
        return it;```


[23-Jan-20 06:47 AM] Mihailo#5902
So I have to trace where the cache is updated, and to see why that tx is not in the cache.


[23-Jan-20 06:48 AM] Mihailo#5902
Anybody have some gudiance where to look for cache update?


[23-Jan-20 07:11 AM] jl777c#5810
coins.cpp? and main.cpp


[23-Jan-20 07:12 AM] Mihailo#5902
Looking now to try to se what happens after `ERROR: ContextualCheckBlock: block height mismatch in coinbase` and before `CreateNewBlock()` with the cache. Is it somewhere flushed or modified so that it can miss that tx.


[23-Jan-20 07:12 AM] jl777c#5810
not sure of the details


[23-Jan-20 07:21 AM] dimxy#2587
Your vin tx that was missed in the coin cache was not a coinbase, isn't it?


[23-Jan-20 07:21 AM] Mihailo#5902
No


[23-Jan-20 07:21 AM] Mihailo#5902
It was oraclesdata tx


[23-Jan-20 07:22 AM] jl777c#5810
maybe it doesnt get into the coins cache for some reason


[23-Jan-20 07:24 AM] Mihailo#5902
But it was in the cache in the previous try to mine the block. ContextualCheckBlock happens several times before it manages it to mine it succesfully


[23-Jan-20 07:25 AM] Mihailo#5902
```
aaaa55b054146ee85d449b40137d7f0c41dc88b5e0595e9fffb2a93c4c2879568100
bbbb55b054146ee85d449b40137d7f0c41dc88b5e0595e9fffb2a93c4c2879568100
cccc55b054146ee85d449b40137d7f0c41dc88b5e0595e9fffb2a93c4c2879568100
aaaa2d40f35f1c69d40802c60b6b11852e6763517b781ada764223d3786d83a0d908
bbbb2d40f35f1c69d40802c60b6b11852e6763517b781ada764223d3786d83a0d908
cccc2d40f35f1c69d40802c60b6b11852e6763517b781ada764223d3786d83a0d908
aaaa7dced6542eae558d6f70a50d68f21ae81234a950073b2d58a59055a914b7d27f
UpdateTip: new best=0d8871e3240951a7da0d55ed6cf994a7fb8e3f50ed60c6ea08010536f3833055  height=675  log2_work=15.209568  log2_stake=-inf  tx=1307  date=2020-01-23 14:56:45 progress=1.008969  cache=0.0MiB(65tx)
height.675
mempool:
06b4295e85b0f904bc28ca03fad87c046f1c000070951d007c0b0a00 <- Mineropret
Running KomodoMiner.tromp with 1 transactions in block (300 bytes)
mempool:
06b4295e85b0f904bc28ca03fad87c046f1c000070951d007c0b0a00 <- Mineropret
Running KomodoMiner.tromp with 1 transactions in block (300 bytes)
mempool:
06b4295e85b0f904bc28ca03fad87c046f1c000070951d007c0b0a00 <- Mineropret
Running KomodoMiner.tromp with 1 transactions in block (300 bytes)
ERROR: ContextualCheckBlock: block height mismatch in coinbase
mempool:
  txid: 7dced6542eae558d6f70a50d68f21ae81234a950073b2d58a59055a914b7d27f
  txid: 24bd6d685bd459a702bc7ddd8235d51b31b46c883852edca229db51d44cc10df
aaaa55b054146ee85d449b40137d7f0c41dc88b5e0595e9fffb2a93c4c2879568100
aaaa55b054146ee85d449b40137d7f0c41dc88b5e0595e9fffb2a93c4c2879568100
tx 7dced6542eae558d6f70a50d68f21ae81234a950073b2d58a59055a914b7d27f, prevout 55b054146ee85d449b40137d7f0c41dc88b5e0595e9fffb2a93c4c2879568100
ERROR: mempool transaction missing input
```
This is some of my prints, you can see cccc55b054... before that is in FetchCoins and it could find it, then there was ContextualCheckBlock error and then it returns aaaa55b054 that means it failed to find it...


[23-Jan-20 07:27 AM] Mihailo#5902
Oh sorry, it didn't fail ond finding it cache but on GetCoins next....
```cpp
CCoinsMap::const_iterator CCoinsViewCache::FetchCoins(const uint256 &txid) const {
    CCoinsMap::iterator it = cacheCoins.find(txid);
    if (it != cacheCoins.end())
        return it;
    std::cout << "aaaa" << txid.GetHex() << std::endl;
    CCoins tmp;
    if (!base->GetCoins(txid, tmp))
        return cacheCoins.end();
    std::cout << "bbbb" << txid.GetHex() << std::endl;```


[23-Jan-20 07:27 AM] Mihailo#5902
So it didn't print bbbb it means it returned on GetCoins


[23-Jan-20 07:34 AM] dimxy#2587
and this means it did not find the coins for the txid


[23-Jan-20 07:37 AM] dimxy#2587
my guess, it was a crush and the coins cache was not updated.
I saw similar for tx index - GetTransaction returned error after a crash: `txid mismatch on disk`.


[23-Jan-20 07:42 AM] dimxy#2587
As the tx is already in the chain and not in the coin cache, you won't find the reason for this now.
Maybe try to add logs to see why UpdateCoins() is bypassed but the block was added (as I can see, this happens in ConnectBlock function)- for future


[23-Jan-20 07:45 AM] Mihailo#5902
Well it is little bit strange. The block has been mined (height 675) but CreateNewBlock was called again as this print of mine is in CreateNewBlock. Maybe it is some race condition where the miner calling stuff haven't realised that the block is added and it tries again to create new block, and the something strange happens. Maybe if there is update of coins in ConnectBlock or AcceptBlock it is in the middle of it while this part of code is executed in parallel. Just my wild guess


[23-Jan-20 07:48 AM] dimxy#2587
I think this is normal if you run with setgenerate=-1 or at least not 1


[23-Jan-20 07:48 AM] Mihailo#5902
Yep, I'm doing setgenerate=6


[23-Jan-20 07:50 AM] dimxy#2587
also, coins cache is stored in the chainstate file. I think it should be restored on -reindex.
Maybe try to save the chain dir and try to -reindex? It would prove that in normal conditions the tx would get into the cache


[23-Jan-20 07:50 AM] jl777c#5810
if we prevent it from crashing, do things keep going?


[23-Jan-20 07:57 AM] dimxy#2587
this is a assertion crash, because the developer thought there was something wrong and it was not possible to continue


[23-Jan-20 08:00 AM] jl777c#5810
sometimes these asserts are a bit more aggressive than needed. is that the case here?


[23-Jan-20 08:04 AM] dimxy#2587
this is possible.
If it is a result of a crash I would add a message to the error suggesting restart with -reindex


[23-Jan-20 08:08 AM] jl777c#5810
certainly if a reindex fixes this, then that is the way to fix this and not remove asserts


[23-Jan-20 08:13 AM] Mihailo#5902
I can try to comment the assert and to see how it behaves but I think it is a big change and maybe in some other situation it could break something. On the other hand I'm curious to figure out why CreateNewBlock is called after the block is mined and the mempool stays unchanged. It smells on some race condition and if I prevent this maybe there will be no issue


[23-Jan-20 08:14 AM] jl777c#5810
yes, very danger to remove this assert. only for testing


[23-Jan-20 08:16 AM] dimxy#2587
it is good to find out if the cache incoherence was the result of race and fix it
I believe the cache must be coherent in any race conditions


[23-Jan-20 08:18 AM] dimxy#2587
or, if you could remember that this happened first time after a crash - I would vote for this version


[23-Jan-20 08:20 AM] Mihailo#5902
This is also interesting:
```
mempool:
  txid: 7dced6542eae558d6f70a50d68f21ae81234a950073b2d58a59055a914b7d27f
  txid: 24bd6d685bd459a702bc7ddd8235d51b31b46c883852edca229db51d44cc10df
...
...
UpdateTip: new best=0d8871e3240951a7da0d55ed6cf994a7fb8e3f50ed60c6ea08010536f3833055  height=675  log2_work=15.209568  log2_stake=-inf  tx=1307  date=2020-01-23 14:56:45 progress=1.008969  cache=0.0MiB(65tx)
height.675
mempool:
06b4295e85b0f904bc28ca03fad87c046f1c000070951d007c0b0a00 <- Mineropret
Running KomodoMiner.tromp with 1 transactions in block (300 bytes)
mempool:
06b4295e85b0f904bc28ca03fad87c046f1c000070951d007c0b0a00 <- Mineropret
Running KomodoMiner.tromp with 1 transactions in block (300 bytes)
mempool:
06b4295e85b0f904bc28ca03fad87c046f1c000070951d007c0b0a00 <- Mineropret
Running KomodoMiner.tromp with 1 transactions in block (300 bytes)
ERROR: ContextualCheckBlock: block height mismatch in coinbase
mempool:
  txid: 7dced6542eae558d6f70a50d68f21ae81234a950073b2d58a59055a914b7d27f
  txid: 24bd6d685bd459a702bc7ddd8235d51b31b46c883852edca229db51d44cc10df
```
Mempool was initially with 7dc and 24b, then the block 675 was mined, then the mempool had 06b and after ContextualCheckBlock error mempool was restored to 7dc 24b. I suppose one of miner threads continued to calc new block after other thread found the block and put it in the chain, after error the txs were returned to mempool and it tried again and the assert happened.


[23-Jan-20 08:24 AM] jl777c#5810
the mempool had a tx that is already confirmed in it?


[23-Jan-20 08:24 AM] jl777c#5810
if so we need clean out illegal tx from mempool


[23-Jan-20 08:25 AM] jl777c#5810
or at least the miner needs to do some validity checks before using contents of mempool


[23-Jan-20 08:27 AM] Mihailo#5902
It could be that the miner code is not aware that tx is confirmed and it added the txs again to mempool (but AcceptToMemoryPool should reject it). I have to see what is exactly going on!


[23-Jan-20 08:55 AM] jl777c#5810
yes, this is a serious bug


[23-Jan-20 09:03 AM] Mihailo#5902
It is also good to see if this is only Komodo bug or maybeon ZCash also...


[23-Jan-20 09:04 AM] jl777c#5810
pretty sure it is due to all the changes we made along the way


[23-Jan-20 09:04 AM] Mihailo#5902
Yeah, I think so too


[28-Jan-20 04:41 AM] Mihailo#5902
This thing with crashing on ContectualCheckBlock is definetely a race condition. For the first time I hade this error when it crashed:
```UpdateTip: new best=04a8acaf4a7168ce690e14f5e3dd5b808bd18504ebe0cbbe42c479e9b857ad88  height=851  log2_work=15.428033  log2_stake=-inf  tx=1862  date=2020-01-28 12:26:00 progress=1.005910  cache=0.0MiB(32tx)
height.851
ht.851: lag.54 9041.4867 USD, 6932.3880 GBP, 8211.5234 EUR, GBPUSD 1.304238, EURUSD 1.101073, EURGBP 0.844227 [-47]
ConnectBlock(): hashPrevBlock != view.GetBestBlock()
ERROR: ConnectBlock(): hashPrevBlock != view.GetBestBlock()
cmp.1 mult.48 ht.852 -> easy target
ERROR: ContextualCheckBlock: block height mismatch in coinbase
```


[28-Jan-20 04:45 AM] jl777c#5810
please describe the details to @Decker he is fixing some miner related race conditions and maybe his fixes will fix this


[28-Jan-20 04:57 AM] Mihailo#5902
Np.
@Decker, basically what I think is that the miner threads when a new block is found do not all start again and in some rare situation one of them has old mempool state and there the problem starts. You can see on this example:
```mempool:
  txid: 7dced6542eae558d6f70a50d68f21ae81234a950073b2d58a59055a914b7d27f
  txid: 24bd6d685bd459a702bc7ddd8235d51b31b46c883852edca229db51d44cc10df
...
...
UpdateTip: new best=0d8871e3240951a7da0d55ed6cf994a7fb8e3f50ed60c6ea08010536f3833055  height=675  log2_work=15.209568  log2_stake=-inf  tx=1307  date=2020-01-23 14:56:45 progress=1.008969  cache=0.0MiB(65tx)
height.675
mempool:
06b4295e85b0f904bc28ca03fad87c046f1c000070951d007c0b0a00 <- Mineropret
Running KomodoMiner.tromp with 1 transactions in block (300 bytes)
mempool:
06b4295e85b0f904bc28ca03fad87c046f1c000070951d007c0b0a00 <- Mineropret
Running KomodoMiner.tromp with 1 transactions in block (300 bytes)
mempool:
06b4295e85b0f904bc28ca03fad87c046f1c000070951d007c0b0a00 <- Mineropret
Running KomodoMiner.tromp with 1 transactions in block (300 bytes)
ERROR: ContextualCheckBlock: block height mismatch in coinbase
mempool:
  txid: 7dced6542eae558d6f70a50d68f21ae81234a950073b2d58a59055a914b7d27f
  txid: 24bd6d685bd459a702bc7ddd8235d51b31b46c883852edca229db51d44cc10df```


[28-Jan-20 04:59 AM] Mihailo#5902
Either that, or the `ERROR: ContextualCheckBlock: block height mismatch in coinbase` happend in a thread which is not notified that new block has been mined, so when this happens maybe it returns all the txs from the block in mempool, but because the inputs from some txs are already spent in the chain as new block has been accepted some of the checks fail and it exits on assert.


[28-Jan-20 05:00 AM] Mihailo#5902
But als todays finding points me that this is definetly race condition as I hade different error `ConnectBlock(): hashPrevBlock != view.GetBestBlock()`


[28-Jan-20 05:03 AM] jl777c#5810
are you able to make progress, or is this blocking things completely?


[28-Jan-20 05:04 AM] Mihailo#5902
No, it is not blocking me. I can return to pegs, but when it happend often to me I took a look to see if I can fix it in short time. But if somebody else is working on miner fixes then I won't waste my time on that too!


[28-Jan-20 05:05 AM] jl777c#5810
https://github.com/KomodoPlatform/komodo/pull/277 is a recent dev branch PR that fixes some deadlocks, maybe this will help in your case

{Embed}
https://github.com/KomodoPlatform/komodo/pull/277
fix hang / deadlock with wallet filter enabled and other patches b...
This PR should fix daemon hang / deadlock with wallet filter enabled, also it have some fixes / patches from various upstreams (BTC, ZEC):

code refactoring: move komodo internal structures update ...
https://images-ext-2.discordapp.net/external/RDvx2WIoH0iRzE_70DuHLDOM6rqONFcnMd4HT0XBnOI/%3Fs%3D400%26v%3D4/https/avatars2.githubusercontent.com/u/21276113


[28-Jan-20 05:21 AM] Mihailo#5902
I'm not sure this PR will influence this problem, but could be.
Just another info for @Decker is that this happens (I think) only when you use prices CC as this error `ERROR: ContextualCheckBlock: block height mismatch in coinbase` happens when trying to put prices info in a block.


[29-Jan-20 04:14 AM] steinsg8#0288
How is it possible that kyc isnt required for synthetix pegs? They even offer pegs to apple. Wtf.


[29-Jan-20 07:39 AM] gcharang#6833
kyc is required when blockchains have to interact with the fiat world. algorithmic peg doesn't have any relation to the fiat world except for the price data being fed to the chain

{Reactions}
👍 

[30-Jan-20 06:01 AM] Mylo#8306
@steinsg8 from what i read about synthetix via my trusty blogging partner, is that the pegs are created once you stake your SNX tokens.
e.g.
stake SNX, pull a peg against it in "apple" at the current rate.  your peg is just against the stock price pulled in by their price feeds.
some info here from ahmed my blogging partner:  https://hybriddex.com/2020/01/synthetix-dex-mintr-collateralized-trading/

{Embed}
https://hybriddex.com/2020/01/synthetix-dex-mintr-collateralized-trading/
Synthetix DEX & Mintr Collateralized Positions - Hybrid DEX
We review Synthetix DEX and Mintr. These are next generation trading options for crypto users to trade stocks & create collateralized positions.
https://images-ext-1.discordapp.net/external/tHC8GQuy7hl-uCaLv35kWZGNEDViJbgHwgETMsUxbcM/%3Ffit%3D1257%252C603%26ssl%3D1/https/i1.wp.com/hybriddex.com/wp-content/uploads/2020/01/synthetix-exchange-connected.png


[30-Jan-20 06:03 AM] Mylo#8306
jl777 and tonyl tested synthetic positions using KMD tech last year here, https://komodoplatform.com/tt2019-16-synthetic-positions-prices-blockchain-financial-instruments/

{Embed}
mylo
https://komodoplatform.com/tt2019-16-synthetic-positions-prices-blockchain-financial-instruments/
Tech Tuesday Development Update - 2019 Week 16: Synthetic Position...
Komodo Platform is starting a weekly briefing on the progress the Komodo Dev Team is making. It's called Tech Tuesday Update. Here's another update!
https://images-ext-2.discordapp.net/external/8XMvu7yonJg4inDzBZjwlnSf7vjp0DQ-ruYtMI10sZg/https/komodoplatform.com/wp-content/uploads/2019/08/tech-tuesday-banner-v2.jpg


[30-Jan-20 06:03 AM] Mylo#8306
same same, but different.


[30-Jan-20 11:04 AM] steinsg8#0288
I see, interesting,  thanks Mylo. I fear this area will not be grey for a while. But I guess there is nothing anyone can do.


[30-Jan-20 02:27 PM] polycryptoblog#1173
Yes, all it would take is reporting the asset to a regulatory body .  I doubt they issued it as a registered security ( the Apple derivative )


[06-Feb-20 02:10 AM] Mihailo#5902
Regarding pegs, I have finished initial iteration of validation and I will setup today the test chain for pegs. It will be EUR pegged coin backed by KMD. There will be gateway to deposit KMD into KMD tokens and then those tokens will be used to fund account after which you'll be able to get coins up to 80% of the value of deposit in EUR. Chain will be named EURKTEST and I'll write here when it is ready to start testing and chain params.
@jl777c @SHossain @TonyL  @Alright

{Reactions}
👀 (3) 👍 (6) 

[06-Feb-20 02:53 AM] jl777c#5810
great news!


[06-Feb-20 07:33 AM] Mihailo#5902 (pinned)
`EURKTEST chain is ready for test!!!`

Setup:
- use this repo and branch: https://github.com/Mixa84/komodo/tree/pegstest
- before building enable test mode: `export CONFIGURE_FLAGS=CPPFLAGS="-DTESTMODE -DTESTMODE_PRICES -DTESTMODE_PEGS"` (TESTMODE_PEGS is needed if you want to test liquidate so you can take more than 80% of deposit and not waitiong for price to drop to make 90% ratio)
- chain params:
```komodod -ac_name=EURKTEST -ac_cc=2 -ac_import=PEGSCC -ac_supply=1000000 -ac_end=1 -ac_reward=1 -ac_perc=0 -ac_cbopret=5 -ac_adaptivepow=6 -ac_prices="LTC" -debug=pegscc-2 -debug=importcoin -debug=cctokens -debug=gatewayscc -addnode=116.203.17.140 -addnode=116.203.17.141 -cczerotxfee=241,238,236 -printtoconsole=1 -earlytxid=07e85362e99ac2037de731fd41a5aa87a5d5f20d6acbf7c7465eef2109dc5a01```
- after build run the daemon and set your pubkey in launch params
- These are the txids for various CCs:
```Token: 0d4ec29786763e4cd5d83725d71347516d8deeb49f5e15edbbdba48dda6ce6e9
Oracle: 2b2b85665aeb96240a60f25390da2fa29eefd2034e64e32c5248fd3f8c0e7bf6
Gateway: 8aa5e6219cedecb8a4d63889b9b2cffeba427f81afdfd640690f2574b139561a
Peg: 07e85362e99ac2037de731fd41a5aa87a5d5f20d6acbf7c7465eef2109dc5a01```

{Embed}
https://github.com/Mixa84/komodo/tree/pegstest
Mixa84/komodo
Komodo. Contribute to Mixa84/komodo development by creating an account on GitHub.
https://images-ext-2.discordapp.net/external/5PP5Rc1dp6Lo2v8nwnTvQmRdaXpEf9xjHeMr0XyppBs/%3Fs%3D400%26v%3D4/https/avatars3.githubusercontent.com/u/39563265


[06-Feb-20 07:33 AM] Mihailo#5902
At first try basic things, deposit KMD to gateways and get KMD tokens (follow tutorial for gateways). Fund the account with tokens (pegsfund), and then get EURKTEST coins (pegsget). You can return issued coins with pegsclose to close account or you can redeem the tokens with pegsreedem if you have low ratio and you can redeem as much tokens to leave account on 80%. In the end if everything works, you can try liquidation of an another account which is in 90% or more debt (and the global ratio is above 60%).
`NOTE: you will need 10k satoshi of EURKTEST to be able to do gatewaysdeposit, I have setup the faucet and you will need a fresh address to do faucetget`
`NOTE2: use small amount of KMD for test as if we make a consensus change maybe we'll need to setup new chain and we'll not wait for all KMD funds to be withdrawn`

As soon you find some bugs or errors in behavior or math, please report it so we can start fixing pegs. I expect small errors, but it can be that there is also some serious bug!
@jl777c @SHossain @TonyL @Alright


[06-Feb-20 07:43 AM] jl777c#5810
@Sir Seven plz test

{Reactions}
👍 

[06-Feb-20 08:11 AM] Mihailo#5902
If anybody needs some help with any of the steps, please ping me and I'll try to assist ASAP.


[06-Feb-20 08:16 AM] Mihailo#5902
Pinned a message.


[06-Feb-20 09:02 AM] TonyL#3577
@smkhound is a huge pegsCC fan also as I know 🙂


[06-Feb-20 10:05 AM] Alright#0419
was blocktime meant to be set higher on this chain?


[06-Feb-20 10:10 AM] jl777c#5810
and why is it LTC? -ac_prices="LTC"


[06-Feb-20 10:10 AM] Mihailo#5902
Not sure, @jl777c mentioned that for prices CC chains it should be more than minute


[06-Feb-20 10:11 AM] Mihailo#5902
That was something to work with @dimxy changes as if you do not set any prices it did not put default prices, but it was fixed in the mean time.


[06-Feb-20 10:11 AM] Mihailo#5902
Did not test if it works so I left LTC to be fed by prices


[06-Feb-20 10:11 AM] Mihailo#5902
But doesn't use it at all


[06-Feb-20 10:11 AM] jl777c#5810
ok, just a bit strange


[06-Feb-20 10:12 AM] Alright#0419
every node on the network is hitting that api every block, yes?


[06-Feb-20 10:12 AM] Mihailo#5902
This is test chain, will remove it in next iteration


[06-Feb-20 10:12 AM] jl777c#5810
yes, blocktimes should be at least 2 minutes to avoid node being blocked by the external site


[06-Feb-20 10:13 AM] jl777c#5810
maybe 1 minute time is ok, but maybe it isnt, depends on the external site limits


[06-Feb-20 10:13 AM] Alright#0419
```
C ht.417 now.1581012788 htstamp.1581012761 1581012786 - pricebits[0] 1581012667 -> lags.121 -94 119
ContextualCheckBlock failed ht.417
bb563c5e2826cf05bac47d0429fa4a05871d0000e8372100bc6f0b00 <- Mineropret
C ht.417 now.1581012788 htstamp.1581012761 1581012786 - pricebits[0] 1581012667 -> lags.121 -94 119
ContextualCheckBlock failed ht.417
bb563c5e2826cf05bac47d0429fa4a05871d0000e8372100bc6f0b00 <- Mineropret
```

```
2020-02-06 18:13:08 ERROR: CheckTransaction(): invalid script data for coinbase time lock
2020-02-06 18:13:08 Running KomodoMiner.tromp with 3 transactions in block (2023 bytes)
2020-02-06 18:13:08 ERROR: CheckTransaction(): invalid script data for coinbase time lock
2020-02-06 18:13:08 Running KomodoMiner.tromp with 3 transactions in block (2023 bytes)
```
a lot of this while mining, I am mining blocks though


[06-Feb-20 10:21 AM] Mihailo#5902
Yes, this is standard message as I understand. It is trying to calc something as prices are put in coinbase and it cannot then it starts mining again.


[06-Feb-20 10:38 AM] Mihailo#5902
BTW mining won't give you anything much. It is zero txfee chain, but I noticed when mining  nodes have some balance.


[06-Feb-20 10:45 AM] jl777c#5810
txfees


[06-Feb-20 10:46 AM] Mihailo#5902
0 txfee on CC txs, but I had only them on chain


[06-Feb-20 10:47 AM] jl777c#5810
no normal tx?


[06-Feb-20 10:48 AM] Mihailo#5902
Very few, sent some funds to another address


[06-Feb-20 10:49 AM] jl777c#5810
is there a discrepancy between what was mined vs. total txfees?


[06-Feb-20 10:58 AM] Mihailo#5902
Not sure, have to check as I recently noticed that mining node which had 0 balance had some balance after mining


[06-Feb-20 11:14 AM] Mihailo#5902
I think some txfee is left somewhere as it gets 10k sat


[06-Feb-20 11:19 AM] Alright#0419
faucetget is making fees


[06-Feb-20 11:21 AM] Mihailo#5902
Yes, that one I saw


[06-Feb-20 11:46 AM] Alright#0419
this cczerotxfee thing, is intended to be used in production as well?


[06-Feb-20 11:51 AM] Alright#0419
need to be careful that gatewaysdeposit OP_RETURN won't exceed max script size. As it stands, if the tx to the multisig on source chain is large, it looks like it would result in funds getting stuck in multisig


[06-Feb-20 11:52 AM] Mihailo#5902
It should.


[06-Feb-20 11:52 AM] Mihailo#5902
Yes for gatewaysdeposit it should be with one vin, so if user have multiple vins it should consolidate first.


[06-Feb-20 11:52 AM] Mihailo#5902
The deposit on the external chain should be done with some dApp that will do that before depositing


[06-Feb-20 11:53 AM] Alright#0419
is it 100% necessary to have the full tx?


[06-Feb-20 11:53 AM] Alright#0419
in the opret I mean


[06-Feb-20 11:54 AM] Mihailo#5902
Yes, the hex and txproof


[06-Feb-20 11:54 AM] Alright#0419
what is it used for exactly?


[06-Feb-20 11:54 AM] Alright#0419
also, could you explain what txproof is?


[06-Feb-20 11:55 AM] Mihailo#5902
For checks


[06-Feb-20 11:55 AM] Mihailo#5902
Merkle tree and etc.


[06-Feb-20 11:55 AM] Alright#0419
Asking if it's at all possible to perform these checks with less data


[06-Feb-20 11:59 AM] Alright#0419
believe `cczerotxfee` will need tweaking if it's meant for production use, prioritized 0 fee transactions is asking for spam 😅


[06-Feb-20 12:31 PM] Mihailo#5902
Yes but it is only for configured CCs. So we put it on oracles gateways and pegs


[06-Feb-20 12:42 PM] Alright#0419
will show you why that's a bad idea in a bit 😉


[06-Feb-20 12:42 PM] Alright#0419
for gatewaysclaim, are the notarizations being faked right now?


[06-Feb-20 12:43 PM] Alright#0419
how many blocks required if so


[06-Feb-20 01:24 PM] Mihailo#5902
In testing we go on waiting for number of confirmations and that is 1 😛 But in production it should be notarization as a must. So after gatewaydeposit is notarized only then you can make claim


[06-Feb-20 01:25 PM] Mihailo#5902
BTW 👏 for @Alright for finding nice bug in GatewaysCC

{Reactions}
rum 

[06-Feb-20 02:39 PM] TonyL#3577
Chain sync stuck for me on:
```  "blocks": 204,
  "longestchain": 692,```

```UpdateTip: new best=003ac465102c02921e7f843cbad1f9d9bf247c2a09e7cad4e9326eda169f4b99  height=204  log2_work=13.771283  log2_stake=-inf  tx=542  date=2020-02-06 14:48:26 progress=0.294798  cache=0.1MiB(381tx)
height.204
pegscc txid=e812e418c489c67c29aa1eb217549b6e4a9de40d925940443f141327bf709a88, vout=1, nValue=1000
pegscc ERROR: invalid previous and current account comparisons!
CC Eval EVAL_IMPORTCOIN Invalid: PEGSCC-import-failure spending tx eae7eb3c9c760da485dff8317199ce73b10d000eacdb11d215b5f3ceb1e02ac6
InvalidChainFound: invalid block=00e6748cac0e5aa4d87ef673349f0a4c4aacbaaec29367e0d7adb50660bdf53e  height=205  log2_work=13.781462  log2_stake=-inf  date=2020-02-06 14:48:32
InvalidChainFound:  current best=003ac465102c02921e7f843cbad1f9d9bf247c2a09e7cad4e9326eda169f4b99  height=204  log2_work=13.771283  log2_stake=-inf  date=2020-02-06 14:48:26
ERROR: ConnectTip(): ConnectBlock 00e6748cac0e5aa4d87ef673349f0a4c4aacbaaec29367e0d7adb50660bdf53e failed
InvalidChainFound: invalid block=00e6748cac0e5aa4d87ef673349f0a4c4aacbaaec29367e0d7adb50660bdf53e  height=205  log2_work=13.781462  log2_stake=-inf  date=2020-02-06 14:48:32
InvalidChainFound:  current best=003ac465102c02921e7f843cbad1f9d9bf247c2a09e7cad4e9326eda169f4b99  height=204  log2_work=13.771283  log2_stake=-inf  date=2020-02-06 14:48:26```


[07-Feb-20 02:32 AM] jl777c#5810
@Mihailo you need to track the KMD txid/vout on the deposits, to prevent a double deposit


[07-Feb-20 04:45 AM] Alright#0419
@jl777c what do you think of making liquidations("red" type at least) part of the mining mechanism


[07-Feb-20 04:46 AM] jl777c#5810
what if the miner doesnt have enough stablecoins?


[07-Feb-20 04:46 AM] Alright#0419
have been thinking how best to try to prevent miner abuse(to get a edge in liquidations), and I think this makes sense


[07-Feb-20 04:46 AM] Alright#0419
make them?


[07-Feb-20 04:47 AM] jl777c#5810
so to liquidate, you need to become a miner?


[07-Feb-20 04:47 AM] jl777c#5810
i guess ultimately the miners will dominate the liquidations


[07-Feb-20 04:47 AM] Alright#0419
yes that's my point


[07-Feb-20 04:47 AM] Alright#0419
it's hard to prevent that so maybe it should just be a recognized part of it


[07-Feb-20 04:48 AM] Alright#0419
also might attract some hashrate


[07-Feb-20 04:49 AM] jl777c#5810
ok, i like it. at first and for small amounts, it can probably be CPU mined anyway and having miners doing the liquidating will be a good fit as liquidating is kind of like mining


[07-Feb-20 04:50 AM] jl777c#5810
@Mihailo the stakebox option for MCL already does this sort of thing of miners doing extra work


[07-Feb-20 04:54 AM] Alright#0419
I think a check that funds of liquidate must go to same pubkey as coinbase might suffice?


[07-Feb-20 04:54 AM] Alright#0419
not sure that's possible in CC validation, would need to be block validation


[07-Feb-20 04:55 AM] jl777c#5810
we have hooks in block validation time also


[07-Feb-20 04:55 AM] jl777c#5810
@dimxy has done this


[07-Feb-20 04:55 AM] Alright#0419
need to think, I think that could cause more issues


[07-Feb-20 04:56 AM] Alright#0419
if no miner had funds, the liquidate would never happen, no blocks


[07-Feb-20 04:56 AM] Alright#0419
with that last suggestion I mean


[07-Feb-20 04:56 AM] Alright#0419
although since it is basically free money, someone would do it


[07-Feb-20 04:56 AM] jl777c#5810
someone with funds can CPU mine, it is adaptivepow


[07-Feb-20 04:56 AM] Alright#0419
guess it makes sense


[07-Feb-20 04:58 AM] jl777c#5810
relying on the assumption that people like free money, is a pretty safe bet


[07-Feb-20 05:03 AM] Alright#0419
I think it's risky. There could be times where there are only a few nodes with enough funds to create the liquidation. If the hashrate is high enough for none of them to create a block, it will stall liquidations from happening


[07-Feb-20 05:03 AM] Alright#0419
maybe leave as is but we build a way for everyone to "abuse" it easily 😂


[07-Feb-20 05:06 AM] Alright#0419
so maybe default behavior of the miner should be 

accept liquidations to mempool as normal
check if node has enough funds to do it instead
if yes, replace it with it's own liquidation 
if no, mine normally


[07-Feb-20 05:06 AM] gcharang#6833
something like channels maybe? liqidators need to lock the amount and the coins can be used for liquidation only after one notarization. the earliest locked coins are given priority by consensus


[07-Feb-20 05:08 AM] jl777c#5810
with adaptivepow if there are no high hashrate miners with funds, someone with funds can CPU mine. not sure what the issue is


[07-Feb-20 05:09 AM] jl777c#5810
there are no block rewards, so liquidations are the blockrewards


[07-Feb-20 05:09 AM] Alright#0419
let's say I have an ASIC on the chain and no funds to liquidate. The nodes that do have funds have no chance of CPU mining


[07-Feb-20 05:09 AM] jl777c#5810
why not?


[07-Feb-20 05:09 AM] jl777c#5810
adaptivepow, did you forget?


[07-Feb-20 05:10 AM] Alright#0419
I am steadily making blocks 1 per minute at say 50ksol. apow will not kick in


[07-Feb-20 05:10 AM] Alright#0419
There is no shot of CPU mining unless I stop producing blocks steadily


[07-Feb-20 05:11 AM] gcharang#6833
but, how can a ASIC user with no funds produce a block if having funds is the requirement?


[07-Feb-20 05:11 AM] jl777c#5810
we cant require all blocks to have liquidations

{Reactions}
🤔 

[07-Feb-20 05:11 AM] jl777c#5810
```accept liquidations to mempool as normal
check if node has enough funds to do it instead
if yes, replace it with it's own liquidation 
if no, mine normally```


[07-Feb-20 05:11 AM] jl777c#5810
above seems good


[07-Feb-20 05:12 AM] jl777c#5810
or the miner can just submit liquidation tx that it can fund on a blocknotify


[07-Feb-20 05:12 AM] jl777c#5810
then that node would reject any other liquidation tx as it would be a double spend


[07-Feb-20 05:13 AM] jl777c#5810
so a miner would be mining all the liquidations it can do + whatever . other liquidations come in


[07-Feb-20 05:13 AM] Alright#0419
Yep, makes sense


[07-Feb-20 05:13 AM] Alright#0419
simpler


[07-Feb-20 05:14 AM] Alright#0419
need an auto-liquidate rpc or something along these lines


[07-Feb-20 05:14 AM] jl777c#5810
so no need to change anything, just recommend that miners have a blocknotify that invokes the autoliquidation rpc


[07-Feb-20 05:15 AM] Alright#0419
still might be possible to get my own liquidate into a miner's mempool before their blocknotify I think


[07-Feb-20 05:16 AM] Alright#0419
I need to look at the conditions for when exactly liquidate is first valid to know for sure


[07-Feb-20 05:16 AM] jl777c#5810
certainly . if you are always broadcasting from a highly connected node, you can win out on some . of the liquidations


[07-Feb-20 05:17 AM] jl777c#5810
and if this is a significant issue, some miner will make custom changes to purge/block such things


[07-Feb-20 05:17 AM] jl777c#5810
marketing . peoples were worried about not enough people liquidating to maintain the peg, but i think there wont be any shortage of liquidators


[07-Feb-20 05:18 AM] Alright#0419
so....
```
accept liquidations to mempool as normal
check if node has enough funds to do it instead
if yes, replace it with it's own liquidation 
if no, mine normally
```


[07-Feb-20 05:18 AM] Alright#0419
that is the optimization you can make, so we should give it to everyone


[07-Feb-20 05:18 AM] jl777c#5810
if it isnt too much work to do, yes, it should be done


[07-Feb-20 05:19 AM] Alright#0419
will check it out


[07-Feb-20 05:20 AM] Alright#0419
I think there are other optimizations a miner could do as well as a result of apow


[07-Feb-20 05:20 AM] Alright#0419
because they can choose mindiff of their next block?


[07-Feb-20 05:21 AM] Alright#0419
been a while since I played with apow, I'll just try everything I can think of, see how viable each is


[07-Feb-20 05:22 AM] jl777c#5810
the scenario of just a single ASIC miner vs CPU miners is maybe not so realistic for a popular chain


[07-Feb-20 06:28 AM] Mihailo#5902
I'm on the road currently. I'll read and respond everything tomorrow.


[07-Feb-20 06:34 AM] Alright#0419
@TonyL did you build that node with `export CONFIGURE_FLAGS=CPPFLAGS="-DTESTMODE -DTESTMODE_PRICES -DTESTMODE_PEGS"`?


[07-Feb-20 06:37 AM] TonyL#3577
Yep


[07-Feb-20 11:43 AM] dimxy#2587
BTW for prices chains blocktime is estimated to be at least 180 sec


[07-Feb-20 11:53 AM] dimxy#2587
> and why is it LTC? -ac_prices="LTC"
When I added my last changes to prices I was not aware that when -ac_prices param was omitted several default prices are still polled (that Mihailo used). I thought they were added only if -ac_prices param present. So I asked Mihailo to add at least one param like LTC to make it non-empty. I'll fix this to allow empty -ac_prices all the same.


[07-Feb-20 03:43 PM] TonyL#3577
`did you build that node with export CONFIGURE_FLAGS=CPPFLAGS="-DTESTMODE -DTESTMODE_PRICES -DTESTMODE_PEGS"?` just retried with ac folder deletion and rebuild to be 100% sure - same result


[07-Feb-20 04:22 PM] Mihailo#5902
sometimes if you export flags but the code was built when you build again it won't affect it. You must do `make clean` and then `zcutil\build.sh` @TonyL


[07-Feb-20 04:30 PM] Mihailo#5902
@TonyL I just see now the error you had. Tomorrow morning when I wake up I'll try to sync fresh node. You basically have validation problem, it is not the testmode flags.


[07-Feb-20 05:49 PM] Mylo#8306
if liquidations can be made into a turnkey solution or dockerized or a cottage industry of miningpool liquidations pops up, def no shortage of liquidation miners


[08-Feb-20 05:01 AM] Mihailo#5902
@TonyL I was able to sync fresh node on EURKTEST. Do you have latest code?


[08-Feb-20 05:02 AM] Mihailo#5902
I suppose you built it with those test flags. They could affect validation, as with `-DTESTMODE_PEGS` it allows for pegsget to take more than 80% so we can test liquidation easy...


[08-Feb-20 05:22 AM] Mihailo#5902
Regarding @Alright idea for liquidation mining. I also thought that it is a good idea when he told me. On the other hand, the most critical part of pegs is the liquidation, if it does not happen in right time it can become too late for it to happen. Liquidation is only profitable when account is between 90% and 100% (ofc below 95% it is most profitable as liquidators get 5.1% of what is left). If it goes 100% or more then it is over. As @jl777c said it is rare that no body will want free money, but if for example price drops too fast, maybe there won't be liquidations in time to prevent system going over 100%. I know the price used is 24h price, but if for some reason liquidations get stalled it will easily go over. So it is most important to make it easy and fast for it to happen.


[08-Feb-20 05:47 AM] jl777c#5810
yes, lets built it into the mining (as much as each miner is able to liquidate)


[08-Feb-20 05:50 AM] Mihailo#5902
Also one more concern. If somebody have large account (big deposit/debt), no body will be able to liquidate it. So we should consider partial liquidation or some way to prevent it for going above 100% ratio.


[08-Feb-20 06:09 AM] jl777c#5810
there isnt a way to do a partial liquidate?


[08-Feb-20 06:09 AM] jl777c#5810
maybe allow liquidating a single utxo and limit the maximum you can issue in a single utxo?


[08-Feb-20 06:15 AM] Mihailo#5902
In the initial plan we planed for whole liquidation. But I think we can make it partial. I wouldn't base it on utxo, as somebody could make one big utxo deposit so you couldn't liquidate it too.


[08-Feb-20 06:15 AM] jl777c#5810
however it is done, we need to be able to achieve partial liquidation


[08-Feb-20 06:15 AM] Mihailo#5902
Yep


[08-Feb-20 06:17 AM] TonyL#3577
@Mihailo I'm on 
```git log -1
commit 19b49b42f53b0900ed7ee47a5e1a4f617e0db1db (HEAD -> pegstest, origin/pegstest, origin/pegs)
Author: Mihailo Milenkovic <mihailo.milenkovic84@gmail.com>
Date:   Thu Feb 6 16:40:57 2020 +0100

    Fix```


[08-Feb-20 06:19 AM] Mihailo#5902
hmm, strange


[08-Feb-20 07:21 AM] Mihailo#5902
Lets try, clean build.
make clean
export ...
zcutil/build.sh


[09-Feb-20 02:05 AM] TonyL#3577
I even tried fresh reclones and etc - it's always stuck on height 204 on my side and all peers ban me then


[09-Feb-20 02:05 AM] TonyL#3577
@Sir Seven @smkhound is it work for you?


[09-Feb-20 02:09 AM] smkhound#7640
> I got sync and faucet using attached steps


[09-Feb-20 02:10 AM] smkhound#7640

{Attachments}
https://cdn.discordapp.com/attachments/564807360472940575/676006996964671498/PEGS_EURKTEST_GUIDE.txt


[09-Feb-20 02:10 AM] TonyL#3577
I see, maybe this machine is cursed now. Will try another one


[09-Feb-20 03:55 AM] Sir Seven#7158
`t's always stuck on height 204 on my side and all peers ban me then`
Stuck on block 193 for me, followed same steps smk posted above.


[09-Feb-20 03:56 AM] Sir Seven#7158
Are you running it on local node? Might be something with our connection.


[09-Feb-20 04:30 AM] Sir Seven#7158
Actually, my bad. Clean build saved the day.


[09-Feb-20 04:46 AM] TonyL#3577
Synced from another server without problems. Scary to imagine what cached on another one because I've tried clean folder and etc.


[10-Feb-20 12:58 AM] Mihailo#5902
@TonyL It could be that it didn't catch the export for your build. It is important to do the export and build on the same terminal, and also to do build with build.sh script. If you just do make it won't add test flags to Makefile.

{Reactions}
🙂 

[10-Feb-20 03:06 AM] Alright#0419
if you see recent stuff in debug.log banning peers, can likely be ignored. Just realized I was mining it on a node with wrong branch


[10-Feb-20 03:39 AM] Mihailo#5902
@jl777c SetCCtxids and SetCCunspents look just from the chain, they don't return txes from mempool?


[10-Feb-20 03:40 AM] jl777c#5810
correct, they use the addressindex DB which only does confirmed tx


[10-Feb-20 03:40 AM] Mihailo#5902
I'm trying to solve the problem with two gatewaysdeposits created at same time. But I shouldn't base consensus on mempool state, right?


[10-Feb-20 03:40 AM] jl777c#5810
mempool has no consensus guarantees


[10-Feb-20 03:41 AM] jl777c#5810
even confirmed could get reorged


[10-Feb-20 03:43 AM] Mihailo#5902
In this case, when gatewaysdeposit comes to validation, I need to reject it if the same gatewaysdeposit exists for that cointxid. For now it was checking it with CCCointxidExists() which basically used SetCCtxids to check if it exists (marker to cointxid). But this doesn't check mempool.


[10-Feb-20 03:47 AM] jl777c#5810
assuming cointxid is the external KMD txid based, this should be good and explains how double deposits were allowed


[10-Feb-20 03:47 AM] Mihailo#5902
Yes cointxid is external deposit txid.


[10-Feb-20 03:48 AM] Mihailo#5902
So the marker is sent to cctxidaddr of cointxid (this was your design from the beginning) and if marker exists then you cannot make another gatewaysdeposit for same external deposit. But if you make it twice before it gets mined, then both gets confirmed


[10-Feb-20 03:50 AM] jl777c#5810
i didnt intend to allow multiple deposits from the same txid, good we caught this


[10-Feb-20 03:51 AM] Mihailo#5902
Yes, Alright caught it from the first time he tried to use gateway 😛


[10-Feb-20 03:51 AM] Mihailo#5902
I'm thinking now how can this be solved without basing consensus rules on mempool...


[10-Feb-20 03:52 AM] jl777c#5810
what consensus rule depends on mempool?


[10-Feb-20 03:52 AM] Mihailo#5902
I mean for this, to not check if deposit tx exists in mempool so I reject it in validation.


[10-Feb-20 03:52 AM] jl777c#5810
also there is accepttomempool and block validation (which also puts all tx into the mempool)


[10-Feb-20 03:53 AM] jl777c#5810
so depending on the timeframe when it is being checked it is two different mempools


[10-Feb-20 03:54 AM] jl777c#5810
you can check mempool and reject it if it is already in the normal mempool, but that is not enough, the full block validation also needs to make it invalid, so the block is invalid if it includes a double deposit


[10-Feb-20 03:55 AM] Mihailo#5902
But wouldn't the block validation trigger this if I check mempool. It will put all txs from block in mempool and then validation will reject on of the deposits as two exists?


[10-Feb-20 03:57 AM] jl777c#5810
yes


[10-Feb-20 03:57 AM] jl777c#5810
so maybe we are ok, but only due to the trick of putting all the tx in a block into the mempool before validation


[10-Feb-20 03:58 AM] Mihailo#5902
So if I make check in validation if there is another deposit tx in mempool it should solve this problem. As for other scenarios where same deposit is in another block that is covered already.


[10-Feb-20 03:58 AM] Mihailo#5902
When block validation happens, would SetCCtxids catch also that new block? I think not as it is not yet put in DB!


[10-Feb-20 03:58 AM] Alright#0419
you can make them in separate blocks right now as well


[10-Feb-20 03:58 AM] Alright#0419
it's not just if they are in the same block, it's always


[10-Feb-20 03:58 AM] Mihailo#5902
@Alright, yes I fixed that


[10-Feb-20 03:59 AM] Alright#0419
👍


[10-Feb-20 04:00 AM] jl777c#5810
it wont be put into the DB until after it is validated

{Reactions}
👍 

[10-Feb-20 04:02 AM] Mihailo#5902
Ok, sorry for checking one more time but I may have used this check if tx exists in mempool in some other CC, so we can check in validation if tx exists in mempool? It is not so bad as the worst it can create a small fork for some nodes which will be resolved in a block or so...


[10-Feb-20 04:05 AM] Alright#0419
faucet does that


[10-Feb-20 04:05 AM] Alright#0419
oh sorry, not exactly but similar


[10-Feb-20 04:11 AM] Mihailo#5902
@Alright can you test with this code if double deposit is fixed? I have to setup new chain on new nodes and I suppose you have the setup already.
https://github.com/Mixa84/komodo/tree/pegs

{Embed}
https://github.com/Mixa84/komodo/tree/pegs
Mixa84/komodo
Komodo. Contribute to Mixa84/komodo development by creating an account on GitHub.
https://images-ext-2.discordapp.net/external/5PP5Rc1dp6Lo2v8nwnTvQmRdaXpEf9xjHeMr0XyppBs/%3Fs%3D400%26v%3D4/https/avatars3.githubusercontent.com/u/39563265


[10-Feb-20 04:12 AM] Mihailo#5902
This is my dev branch which I PR to pegstest, but to check it before I merge just use this branch.


[10-Feb-20 04:12 AM] Alright#0419
sure, hour or so maybe


[10-Feb-20 04:12 AM] Alright#0419
chain params?


[10-Feb-20 04:13 AM] Alright#0419
it's simple enough if you want to try it, if not just give me a bit of time. All you have to do is disable where it adds inputs and do them manually


[10-Feb-20 04:13 AM] Mihailo#5902
Ah, I think I must create it, as it needs new gateway because you couldn't sync current chain if fix works.


[10-Feb-20 04:13 AM] Alright#0419
so it results in different txids for sure I mean


[10-Feb-20 04:13 AM] Alright#0419
I think I'm the only one using this chain, may as well restart it


[10-Feb-20 04:14 AM] Mihailo#5902
I wouldn't want to do it on EURKTEST so I don't get it stuck


[10-Feb-20 04:14 AM] Mihailo#5902
Ok, so you have different chain. Then just restart it and use code from my branch


[10-Feb-20 04:15 AM] Alright#0419
not sure how to do the oracles


[10-Feb-20 04:15 AM] Alright#0419
oh I guess I'll try to follow that doc gcharang made


[10-Feb-20 04:16 AM] Mihailo#5902
No, if you  already have a chain with gateways setup then use that. Even don't need to restart it if it works now.


[10-Feb-20 04:33 AM] Alright#0419
I don't have a separate chain, when I tested that I basically just forked off of this chain on a few nodes


[10-Feb-20 04:33 AM] Mihailo#5902
Aha, ok


[10-Feb-20 04:33 AM] Mihailo#5902
That's good too.


[10-Feb-20 04:34 AM] Mihailo#5902
Never tought of doing that for testing 😛


[10-Feb-20 10:29 AM] Mihailo#5902
@jl777c So here is how it stands with double gatewaysdeposit:
- gatewaysdeposit is not spending any CC vouts so it is not triggering validation
- validation is triggered on claim and I verify also deposit tx in that validation
- in this way I cannot prevent creating double deposits even if I validate it in claim, the only thing that could happen is that it would block a cointxid to be claimed.

So my idea is to change deposit/claim architecture to just deposit which will give tokens in same tx (what was done in claim) and this will trigger validation and everything would be validated immediatelly. I can't remember why was initial flow made with deposit/claim?


[10-Feb-20 10:36 AM] jl777c#5810
we need to trigger validation, so definitely make the changes that are needed


[10-Feb-20 10:36 AM] jl777c#5810
it is a complex thing, dont worry about why we did it wrong, important thing is we realize it and fix it


[10-Feb-20 10:37 AM] Mihailo#5902
Ok, I just wanted to check if you remember why you did it like that. But chance was low that you remember that from almost 2 years ago 😉


[10-Feb-20 10:51 AM] jl777c#5810
no idea


[11-Feb-20 12:32 AM] Alright#0419
if there is no clear solution otherwise, can make the gateway send a CC vout to address by watching multisig on KMD then must spend this in gatewaysdeposit


[11-Feb-20 12:32 AM] Alright#0419
It's not a great solution though, as gateway doesn't currently monitor KMD


[11-Feb-20 12:34 AM] Mihailo#5902
We have a solution. That approach is ok, but it is fragile as it depends on oraclefeed monitoring the deposit address and then creating a tx. Lot of things can go wrong. So we'll make it like this, gatewaysdeposit will do all the stuff and that`s it. If something shows wrong for this, we can then check that solution.


[11-Feb-20 12:35 AM] Alright#0419
let me know if there is new code to test


[11-Feb-20 12:36 AM] Mihailo#5902
I will, I'll refactor gateways on my pegs branch and let you know when it is ready


[11-Feb-20 02:09 AM] Alright#0419
@Mihailo     

```
{
      "publisher": "02b75ee35d630cbe062f4cf525c10ac19eb21ba3b63d546d2b216cdf07ea207eb6",
      "baton": "",
      "batontxid": "0000000000000000000000000000000000000000000000000000000000000000",
      "lifetime": "4000.00000000",
      "funds": "3999.61840000",
      "datafee": "1.00000000"
    },
```
broke one of the oracles on EURKTEST


[11-Feb-20 02:10 AM] Alright#0419
also might have changed it's datafee to 1 coin, not sure if that's just cosmetic or not


[11-Feb-20 02:10 AM] Mihailo#5902
HOw did you break it?


[11-Feb-20 02:10 AM] Alright#0419
```
  "vout": [
    {
      "value": 0.00010000,
      "valueZat": 10000,
      "n": 0,
      "scriptPubKey": {
        "asm": "02f67b0e8c3ffd48522ce3644e03d2ef9ea22fda9053f2600a2496eb5a66852b2b OP_CHECKSIG",
        "hex": "2102f67b0e8c3ffd48522ce3644e03d2ef9ea22fda9053f2600a2496eb5a66852b2bac",
        "reqSigs": 1,
        "type": "pubkey",
        "addresses": [
          "RLr6VbFUqNi71FXG2qLL4BRwMWwHn8ckZ2"
        ]
      }
    },
    {
      "value": 0.00000000,
      "valueZat": 0,
      "n": 1,
      "scriptPubKey": {
        "asm": "OP_RETURN ec52f67b0e8c3ffd48522ce3644e03d2ef9ea22fda9053f2600a2496eb5a66852b2b2102b75ee35d630cbe062f4cf525c10ac19eb21ba3b63d546d2b216cdf07ea207eb600e1f50500000000",
        "hex": "6a4c4cec52f67b0e8c3ffd48522ce3644e03d2ef9ea22fda9053f2600a2496eb5a66852b2b2102b75ee35d630cbe062f4cf525c10ac19eb21ba3b63d546d2b216cdf07ea207eb600e1f50500000000",
        "type": "nulldata"
      }
    }
  ],
```


[11-Feb-20 02:10 AM] Alright#0419
just a tx like this


[11-Feb-20 02:11 AM] Alright#0419
opret is 'R' with it's pubkey


[11-Feb-20 02:11 AM] Mihailo#5902
So you did a register


[11-Feb-20 02:11 AM] Alright#0419
not a real one


[11-Feb-20 02:11 AM] Mihailo#5902
Ok


[11-Feb-20 02:11 AM] Mihailo#5902
And did you do fund first?


[11-Feb-20 02:12 AM] Alright#0419
no, that's it, that tx was normal vins, no CC vins


[11-Feb-20 02:12 AM] Mihailo#5902
I think the fix that we made to oracles was that only owner of the pubkey can register. So it could not be working


[11-Feb-20 02:12 AM] Alright#0419
no it's just the way it's checking I believe


[11-Feb-20 02:12 AM] Alright#0419
possible it's entirely cosmetic info with oraclesinfo, trying to work that out now


[11-Feb-20 02:13 AM] Mihailo#5902
It could be, let me check


[11-Feb-20 02:13 AM] Alright#0419
02b75ee35d630cbe062f4cf525c10ac19eb21ba3b63d546d2b216cdf07ea207eb6 check this node


[11-Feb-20 02:13 AM] Alright#0419
see if it's still pushing stuff to oracle just fine


[11-Feb-20 02:14 AM] Mihailo#5902
I think you fooled it, because you made a tx without speninding CC vin so it didn't trigger validation.


[11-Feb-20 02:14 AM] Mihailo#5902
And you sent a vout marker to baton address so it sees this register as latest one.


[11-Feb-20 02:14 AM] Mihailo#5902
I have to investigate more


[11-Feb-20 02:14 AM] Alright#0419
was just trying to break oraclesinfo, not sure if it broke anything else


[11-Feb-20 02:14 AM] Alright#0419
does look like that pubkey stopped posting to oracle though


[11-Feb-20 02:15 AM] Alright#0419
`acb2bc4c1c8944eab32e73ce2d35be3b89635a1f4048e3436ca58ff5e3d6ed29` this is tx that did it


[11-Feb-20 02:15 AM] Mihailo#5902
Ok


[11-Feb-20 02:15 AM] Alright#0419
whatever is looking at this tx could check that it has at least 1 CC vin I think


[11-Feb-20 02:16 AM] Alright#0419
otherwise, it's not a real register


[11-Feb-20 02:17 AM] Alright#0419
basically it's assuming that if a tx sent coins to the markerpubkey and it's OP_RETURN decodes to 'R', that it's a real register


[11-Feb-20 02:18 AM] Mihailo#5902
the info functions and searching for tx does not do complete validation. So this could be something that we must do, as you could put forge a tx which doesn't spend CC vin and this way put it in the chain and break stuff


[11-Feb-20 02:18 AM] Mihailo#5902
Another great find @Alright


[11-Feb-20 02:18 AM] Alright#0419
what is happening on that node?


[11-Feb-20 02:18 AM] Mihailo#5902
👏


[11-Feb-20 02:18 AM] Alright#0419
did it stop publishing?


[11-Feb-20 02:19 AM] Mihailo#5902
Not sure, because one of the nodes had komodod creashed. I don't have too much memory so they crash sometimes


[11-Feb-20 02:23 AM] Alright#0419
does change datafee, isn't just cosmetic


[11-Feb-20 02:33 AM] Mihailo#5902
publishing is broken


[11-Feb-20 02:33 AM] Alright#0419
yea I set it to -1


[11-Feb-20 02:33 AM] Alright#0419
network is banning that node


[11-Feb-20 02:38 AM] Mihailo#5902
This could be a problem in a lot of CCs. As usually when you want to find some tx you search for the marker. But we don't validate that tx completely when searching for it. So by creating a littlebit different tx which does not spend CC vout and does not trigger validation you can break entire system. @jl777c @dimxy


[11-Feb-20 02:41 AM] jl777c#5810
we need to audit all the validation to make sure we fix this, hopefully we can have a standardize validation library that can be used


[11-Feb-20 02:43 AM] Mihailo#5902
Yes, there was an initiative from @dimxy to make some common checks for all CCs


[11-Feb-20 02:43 AM] dimxy#2587
All cc provide IsSomethingVout functions, they should be used whenever we enumerating cc vouts. They should check it is a valid cc tx (But those functions might have bugs though)


[11-Feb-20 02:44 AM] Mihailo#5902
@dimxy, this is not a problem with vouts. It will pass as the tx did not spend any CC vout and none of the checking was done. So we must enforce validation of txs all the time


[11-Feb-20 02:56 AM] dimxy#2587
i believe a tx was sent that did not have cc vin and your cc accepted it, right?


[11-Feb-20 02:59 AM] dimxy#2587
we solved a similar problem in tokens a year ago. Now IsTokenVout loads the tx which vout is checked and ensures it is a valid cc tx (has cc vins and has proper cc input cc output balance)


[11-Feb-20 06:09 AM] stamphh#5923
Can I make a basket of different pegs? Like a world peg basket. Diversified with many different currencies. I don’t trust the dollar to store value. I wonder if something can store value relative to other things using algos.

{Reactions}
👍 (2) 

[11-Feb-20 10:12 PM] gcharang#6833
@stamphh that is definitely possible
basically, any asset(could be an index/basket) whose price can be calculated is available as the stable coin. It just needs a seperate chain. The peg on each chain can also be collateralised by multiple assets

Examples of what is possible: 
- a chain whose Native coin is pegged to a Fiat currency like EUR and backed by multiple cryptos like BTC, KMD, LTC etc 
- a chain whose Native coin is pegged to a basket that contains assets like fiat currencies, metals, stocks Ex: `(1/7)EUR + (2/7)USD + (1/7)GOLD + (1/7)AMZN + (2/7)TSLA` and can be backed by multiple  cryptos like BTC, KMD, LTC etc

{Reactions}
👏🏻 

[11-Feb-20 10:20 PM] B. Gültekin Çetiner#0626
That is great. I hope that several  examples of stable coins on real chains will be realized soon.

{Reactions}
💯 (2) 

[12-Feb-20 01:30 AM] Mylo#8306
@gcharang you come up with some great examples 🙏


[12-Feb-20 01:30 AM] Mylo#8306
https://twitter.com/imylomylo/status/1227524891739471877?s=21

{Embed}
iMyloMylo (@iMyloMylo)
https://twitter.com/imylomylo/status/1227524891739471877?s=21
a #blockchain whose native #stablecoin is pegged to a basket that contains assets like fiat currencies, #metals, #stocks (1/7)$EUR + (2/7)$USD + (1/7)#GOLD + (1/7)$AMZN + (2/7)$TSLA and can be backed by multiple  cryptos like $BTC,… https://t.co/YZAXFRmmhw via @iKomodoP2P
Twitter

{Reactions}
awthanks (2) 

[12-Feb-20 09:05 AM] polycryptoblog#1173
@B. Gültekin Çetiner  you need to get on some crypto shows to talk about Marmara credit loops,   It’s one of the most interesting but least known about projects in the ecosystem.   Definitely let us know when you do events and stuff we can help spread the word

{Reactions}
💯 

[15-Feb-20 10:43 AM] stamphh#5923
Can tokens like ETHBULL exist using pegs? https://www.binance.com/en/support/articles/360038933471

{Embed}
https://www.binance.com/en/support/articles/360038933471
Binance Lists FTX Leveraged Tokens: BULL, BEAR, ETHBULL & ETHBEAR
Fellow Binancians,
Binance will list FTX leveraged tokens BULL, BEAR, ETHBULL and ETHBEAR, and open trading for BULL/USDT, BULL/BUSD, BEAR/USDT, BEAR/BUSD, ETHBULL/USDT, ETHBULL/BUSD, ETHBEAR/USDT ...


[15-Feb-20 10:48 AM] jl777c#5810
you can peg it to the price of anything that has a price feed, and also can construct any synthetic price based on one or more pricefeeds

{Reactions}
💯 

[18-Feb-20 02:29 AM] jl777c#5810
@Mihailo we have a potential opportinity if we can create a TRY (turkish lira) based stablecoin. how extra much work would it be to have both EURK and TRYK available


[18-Feb-20 03:34 AM] Mihailo#5902
@jl777c No extra work, it is just a matter of chain setup. So creating another chain, with proper gateways for crypto wanted to back TRY and that's it.

But we still have issues to solve on pegs. The gateways deposit problem, and also we talked about it before but never agreed on solution, we have to have a way to interchange signers through time. So I want to refactor gatewaysbind to be two txes, one for gateways params and other for signer keys and always the latest one will be used (just like for oracles register). And when setting different set of signers that tx must be also signed by MofN same as withdraw, because it will transfer funds to new deposit address.


[18-Feb-20 03:53 AM] jl777c#5810
ok, the advantage of TRY is there are many in the turkish community who will help test things and we have contacts at high govt levels, so maybe we can switch to using TRYK for the test period with the next test chain. i also want to have the nist random oracle feed in the stablecoin chain. dimxy is working on that


[18-Feb-20 04:08 AM] Mihailo#5902
nist random?


[18-Feb-20 04:09 AM] jl777c#5810
yes, i asked for a chain with a DTO for https://beacon.nist.gov/home


[18-Feb-20 04:10 AM] jl777c#5810
this way we avoid the vuln from miners if you use the blockhash as a source of entropy


[18-Feb-20 04:18 AM] Mihailo#5902
Aha. And what entropy we use in oracle feed?


[18-Feb-20 04:20 AM] jl777c#5810
the nist is generating new entropy every minute using the process described at that url


[18-Feb-20 04:21 AM] jl777c#5810
once we have a blockchain with this entropy onchain (we will be the first!), then we can do any chance based outcomes without worry about it being attacked (short of the nist being compromised)


[18-Feb-20 04:21 AM] jl777c#5810
one simple CC that comes from this would be a lotto CC, which was not possible to do securely without a clean source of entropy


[18-Feb-20 04:22 AM] Mihailo#5902
Aha, ok. Got it. This will be used for any entropy necessary. Like for Dice, Channels, Loto, etc...


[18-Feb-20 04:25 AM] jl777c#5810
with a clean source of entropy, it becomes quite simple:
1. lottocreate <number of blocks>
2. people make payments to lotto <create txid>
3. after number of blocks passes, we now have a list of eligible lotto tickets (each payment made)

4. only the winner is allowed to spend the funds, can be split into N different spends to avoid spam attacks
4a. the winner would use the nist entropy of the final block, each pubkey would get a proportional chance to win


[18-Feb-20 04:28 AM] jl777c#5810
we would probably want to require notarization (or 100 blocks) before allowing 4. seems there is some room for attacker to fiddle with the eligible lotto tickets


[18-Feb-20 04:28 AM] jl777c#5810
anyway, the nist beacon will provide a much simpler problem for things like lotto CC to solve


[18-Feb-20 05:00 AM] Alright#0419
if you're waiting for notarizations, the notarization hash or momom data is a decent source of entropy


[18-Feb-20 05:00 AM] Alright#0419
this is pretty cool, didn't know this existed


[18-Feb-20 05:02 AM] Alright#0419
I like momom data as entropy as you can know for sure it's not being purposefully skewed by someone just by sending transactions yourself


[18-Feb-20 05:06 AM] jl777c#5810
yes, but notarization hash can be fiddled by any of the 13 signers, so it is best to use nist entropy


[18-Feb-20 05:06 AM] jl777c#5810
dealing with the reorging of the eligible tx before the notarization deadline seems to be the only issue


[18-Feb-20 05:10 AM] jl777c#5810
we need to have a cutoff which is set and only when that is locked down and cant be changed, to look at entropy


[18-Feb-20 05:11 AM] jl777c#5810
but even that, if an attacker keeps extending it until he gets a result he likes.... so we also need to require that all tx are made before a pre-cutoff. not sure, it just feels like there is always a way to fiddle with the set of eligible tx


[18-Feb-20 05:22 AM] Alright#0419
each notarization period after notarization comes in, all tickets are placed in random order.

So first period, we have 5 tickets abcde. We take first entropy after notarization and put these in order. so we now have edacb (random)

another 5 tickets happens within the next period, fghij. Next notarization comes in, we have edacbhgjif. (again random)

Next notarization comes in, we take the first entropy after it, and select a winner based on this order?


[18-Feb-20 05:23 AM] Alright#0419
should solve the issue of ticket pool changing, yes?


[18-Feb-20 05:24 AM] jl777c#5810
my concern is the attacker can change the eligible tx during the final notarization period, like ticket grinding, and reorging the chain to include the winning ticket. but they cant do this if it is like this:
tickets come in ... cutoff block reached ... notarization ... notarization ... next block choose entropy.


[18-Feb-20 05:25 AM] jl777c#5810
any ticket tx fiddling can only be done before the notarization, maybe the second notarization if they reorg the notarization tx itself


[18-Feb-20 05:25 AM] jl777c#5810
but the entropy used not known until after two notarizations past the cutoff, that seems to solve this


[18-Feb-20 05:26 AM] jl777c#5810
and even after 1 will make it quite difficult to do any sort of ticket grinding


[18-Feb-20 05:26 AM] Alright#0419
it would just need to be first notarization that includes cutoff block


[18-Feb-20 05:27 AM] jl777c#5810
ah, yes, that is simpler


[18-Feb-20 05:27 AM] jl777c#5810
tickets come in ... cutoff block reached ... notarization of cutoff block ... next block determines entropy.


[18-Feb-20 05:28 AM] Alright#0419
Ah no


[18-Feb-20 05:28 AM] jl777c#5810
but couldnt a 99% hashrate attacker reorg the notarization tx until it ends up in a block that is good for him?


[18-Feb-20 05:28 AM] Alright#0419
that notarization can be reorged out of the chain


[18-Feb-20 05:28 AM] jl777c#5810
yes, that is why i said two notarizations


[18-Feb-20 05:28 AM] Alright#0419
yea lol sorry, didn't understand


[18-Feb-20 05:28 AM] jl777c#5810
tickets come in ... cutoff block reached ... notarization of cutoff block ... notarization ... next block choose entropy.


[18-Feb-20 05:29 AM] Alright#0419
second is "notarization that includes notarization of cutoff block" but yes


[18-Feb-20 05:29 AM] Alright#0419
I think that is always the case anyway though


[18-Feb-20 05:29 AM] Alright#0419
just thinking out loud


[18-Feb-20 05:30 AM] jl777c#5810
ok, so we have a way of doing very large value lottos

{Reactions}
3040_kingpeepo (2) KMD 

[18-Feb-20 10:08 AM] jl777c#5810
@Mihailo doing pegsget of anything more than 7 gave an error, when i have 10 on deposit


[18-Feb-20 10:08 AM] jl777c#5810
seems an off by 1?


[18-Feb-20 10:10 AM] jl777c#5810
it was a bit of a pain, but by following the steps on https://docs.komodoplatform.com/basic-docs/antara/antara-api/pegs.html i was able to get 7 EURKTEST coins! i think freely trading EURK coins might get a bit of a premium just to avoid having to create them

{Embed}
https://docs.komodoplatform.com/basic-docs/antara/antara-api/pegs.html
Komodo Documentation
Documentation for developers building on the Komodo Platform
https://images-ext-2.discordapp.net/external/pQcpVLQgfWglPr7tkLLPNfnaXLp21V6nGaMQYJYPkho/https/docs.komodoplatform.com/Dev_Docs_Introduction_small.png


[18-Feb-20 10:11 AM] jl777c#5810
this is good as i have some models that predict that the pegged coin would be trading at a bit of a discount. hard to quantify both, but maybe they are approx the same and the market will trade around the 1:1 price


[18-Feb-20 10:14 AM] Mihailo#5902
@jl777c check what was the price of KMD at moment of deposit. You can take maximum 80% of value of the deposit in EURK.


[18-Feb-20 10:14 AM] jl777c#5810
of course!


[18-Feb-20 10:14 AM] Mihailo#5902
Also, I compiled this with TESTMODE_PEGS falg so you can take 100% of deposit.


[18-Feb-20 10:15 AM] Mihailo#5902
So we can test liquidate


[18-Feb-20 10:15 AM] jl777c#5810
yes, that makes sense now. the price of EUR is lower than price in USD!


[18-Feb-20 10:15 AM] Mihailo#5902
@jl777c Don't worry that is first mistake everyone made (even me that made it). I won't tell anyone if you don't 😂


[18-Feb-20 10:15 AM] jl777c#5810
thanks

{Reactions}
👍 

[18-Feb-20 10:16 AM] Mihailo#5902
Usually you will be able to take 8 of 10 which you deposited on 1$ price. But here is 100% limit for liquidation testing purposes


[18-Feb-20 10:18 AM] jl777c#5810
it wont let me liquidate me own account


[18-Feb-20 10:20 AM] jl777c#5810
and pegsredeem without amount says i need amount, with amount says cant redeem account when it is over 80%%


[18-Feb-20 11:23 AM] Mihailo#5902
Hmmm, maybe I made some wrong check in redeem. Basically you don't liquidate your own account, for that you use redeem. Why it isn't allowing redeem when it is more than 80% I'll check.


[18-Feb-20 11:26 AM] Mihailo#5902
Oh, sorry. Was confused at the moment. If you want to take the whole deposit out then you use close account. If you want to just take some of the deposit, then redeem allows you to take back the deposit until your account is in debt at 80% ratio. So redeem is for, so to say taking "excess amount of tokens" if you need/want them.


[18-Feb-20 11:28 AM] Mihailo#5902
So you deposited 100KMD (price is 1EUR=1 KMD), and you took 20EUR. Your account ratio is 20%, and if you need 50KMD back for some reason you can take it as it will leave your ratio at 40%. So you can take tokens until ratio is up to 80%.


[18-Feb-20 11:28 AM] Mihailo#5902
@jl777c


[18-Feb-20 11:28 AM] jl777c#5810
ok, so it all makes sense


[18-Feb-20 11:28 AM] Mihailo#5902
Yes, in the end everything makes sense 😛


[18-Feb-20 11:30 AM] Mihailo#5902
This is the flow after several iterations and refactors. It covers most of thing people would want. Probably something is missing but will figure it out in use!


[18-Feb-20 11:31 AM] jl777c#5810
is there a way to add more KMD to improve the ratio?


[18-Feb-20 11:31 AM] Mihailo#5902
pegsfund


[18-Feb-20 11:31 AM] jl777c#5810
oh, i can just call it again?


[18-Feb-20 11:31 AM] Mihailo#5902
Many times you want


[18-Feb-20 11:32 AM] jl777c#5810
so far, it seems it has enough functionality for pegged coin issuers to manage the coin supply


[18-Feb-20 12:05 PM] Mihailo#5902
I think so. It just needs polishing the little details (that can lead to some bigger refactor) so that there are no blocking of funds or some difficulties for  users.


[18-Feb-20 12:09 PM] Mihailo#5902
```pegsfund - deposit tokens (you can do it multiple times)
pegsget - get pegged coins - up to 80% of deposit value (you can do it multiple times)
pegsclose - get all deposit back by returning all debt in coins
pegsredeem - retrive part of deposit to leave account ratio max at 80%
pegsexchange - exchange coins for tokens without account (basically taking part of tokens from some other account but returning part of debt and by this action imroving the ratio of that account
pegsliquidate - cover the debt of another account and take the deposit of debt value plus ~5.1% more tokens (profit)```


[18-Feb-20 12:10 PM] Mihailo#5902
This is just short summary of funcionality!


[19-Feb-20 12:07 AM] TonyL#3577
@Mihailo Sir7 said there is some problem with oracles so pegsCC not possible to test at the moment. Is/was it the case?


[19-Feb-20 12:16 AM] jl777c#5810
it was fixed

{Reactions}
👍 

[19-Feb-20 12:29 AM] TonyL#3577
@Sir Seven ^^ you can continue with pegs tests

{Reactions}
👍 

[19-Feb-20 12:33 AM] Mihailo#5902
It was fixed yesterday, I'll check if it works now.


[19-Feb-20 12:34 AM] Mihailo#5902
Yes it works.


[19-Feb-20 12:35 AM] Mihailo#5902
Again, one reminder as this is initial test period, do not send huge amounts of funds to pegs I suggest to keep it below 1 KMD as it is not much to lose if there is a problem or so.


[19-Feb-20 04:20 AM] Audo#5667
Who could write cc-pegs / stablecoin update to our portal? We can proofread and edit the basic write-up.


[19-Feb-20 08:24 AM] Mihailo#5902
I'm swamped with dev stuff, so could not sit down and slowly write it. 😞


[19-Feb-20 08:25 AM] jl777c#5810
@gcharang should be able to write an update

{Reactions}
👍 

[19-Feb-20 08:26 AM] Mihailo#5902
I'll be available for any questions about pegs as long as I'm not sleeping or on the road.


[19-Feb-20 09:31 AM] Alright#0419
@Mihailo forgot to mention this, but I don't think the `cczerotxfee` prioritization is working properly


[19-Feb-20 09:36 AM] Mihailo#5902
It could be that something is wrong. What is happening?


[19-Feb-20 09:36 AM] Alright#0419
```
2020-02-19 17:36:11 ERROR: CScriptCheck(): f4e07b794eb485eaca07bbf2d1d4d312862c936dcf863674b15e35c5b9378d05:1 VerifySignature failed: Script evaluated without error but finished with a false/empty top stack element
2020-02-19 17:36:11 Misbehaving: 116.203.17.140:44186 (0 -> 100)
2020-02-19 17:36:11 InvalidChainFound: invalid block=0116f69a82520f72f539d6ca39fa107964d6175ca4eacabc2f5823a64e836832  height=194  log2_work=13.671099  log2_stake=-inf  date=2020-02-06 14:39:12
2020-02-19 17:36:11 InvalidChainFound:  current best=01b421f9559befe2760d0efbc5e7a5f75a64488ae64fb044de37cdd30fbceb04  height=193  log2_work=13.660553  log2_stake=-inf  date=2020-02-06 14:35:14
2020-02-19 17:36:11 ERROR: ConnectTip(): ConnectBlock 0116f69a82520f72f539d6ca39fa107964d6175ca4eacabc2f5823a64e836832 failed
2020-02-19 17:36:11 InvalidChainFound: invalid block=0116f69a82520f72f539d6ca39fa107964d6175ca4eacabc2f5823a64e836832  height=194  log2_work=13.671099  log2_stake=-inf  date=2020-02-06 14:39:12
2020-02-19 17:36:11 InvalidChainFound:  current best=01b421f9559befe2760d0efbc5e7a5f75a64488ae64fb044de37cdd30fbceb04  height=193  log2_work=13.660553  log2_stake=-inf  date=2020-02-06 14:35:14
```
can't fresh sync this chain with latest code


[19-Feb-20 09:37 AM] Mihailo#5902
On what branch?


[19-Feb-20 09:37 AM] Alright#0419
I think oracles CC is still paying txfees and even if you specifically make it with 0 fee, it's not prioritized


[19-Feb-20 09:37 AM] Mihailo#5902
You must use pegstest branch for EURKTEST


[19-Feb-20 09:37 AM] Mihailo#5902
As I already made some changes to gateway on pegs branch


[19-Feb-20 09:37 AM] Alright#0419
Ah sorry, forgot i had changed it to validation branch


[19-Feb-20 09:38 AM] Mihailo#5902
That to 😉


[19-Feb-20 09:39 AM] Alright#0419
fairly sure the prioritization issue exists on that branch as well


[19-Feb-20 09:55 AM] Mihailo#5902
It could be, I was monitoring zero txfee txes and the got 10e16 priority but at some point they started changing, didn't caught why


[19-Feb-20 10:43 AM] Alright#0419
@Mihailo when should zero fee thing be triggered? Only for txes that go through CC validation?


[19-Feb-20 10:44 AM] Alright#0419
```
      "deposit": 1000000000,
      "debt": 700000000,
      "ratio": "95.07%"
```
what is this a ratio of?


[19-Feb-20 10:46 AM] Alright#0419
ok here's a UX thing... I had a wallet that I previously made an account with, but I cannot find the `-pubkey=` I did it with.


[19-Feb-20 10:46 AM] Alright#0419
now my account is stuck in limbo unless I somehow find that pubkey


[19-Feb-20 10:54 AM] Mihailo#5902
Well, that is the user end problem. If you don't have privkey/pubkey nothing find that for you. We could maybe print tue pubkey in the account info if that is not security issue.


[19-Feb-20 10:54 AM] Alright#0419
I have privkey in my wallet somewhere among another 100 other keys


[19-Feb-20 10:54 AM] Mihailo#5902
But if you issued pegsaccountinfo and got the response it means you have the pubkey for that account in node.


[19-Feb-20 10:55 AM] Mihailo#5902
Check what is mypk.


[19-Feb-20 10:55 AM] Alright#0419
check where?


[19-Feb-20 10:56 AM] Alright#0419
Ah I see, let me check...


[19-Feb-20 11:12 AM] Alright#0419
Ok, will try to explain. I have two wallet.dats. I know I created an account on one of these. I don't know the `-pubkey=` I used at the time, but I know the privkey for it is in one of these wallet.dats. I start the node with `-pubkey=<new pk>` and do `pegsaccountinfo` and it shows nothing


[19-Feb-20 11:13 AM] jl777c#5810
just print the pubkey for the outstanding pegs accounts


[19-Feb-20 11:13 AM] jl777c#5810
from there you would need to search your wallet by doing validateaddress for that pubkeys address


[19-Feb-20 11:14 AM] jl777c#5810
seems its just a missing field in the display


[19-Feb-20 11:14 AM] Alright#0419
I am sure I can find it myself eventually, more just worried about UX for others


[19-Feb-20 11:17 AM] jl777c#5810
if you have two wallets, isnt it just a matter of doing two validateaddresses?


[19-Feb-20 11:18 AM] Alright#0419
found it by checking all KMD deposits


[19-Feb-20 11:18 AM] Alright#0419
I didn't know the address/pubkey I did it with, that was the issue


[19-Feb-20 11:18 AM] Alright#0419
I knew the pubkey was owned by one of these wallets, just didn't know the particular address


[19-Feb-20 11:29 AM] Alright#0419
```
komodo-cli -ac_name=EURKTEST pegsworstaccounts 07e85362e99ac2037de731fd41a5aa87a5d5f20d6acbf7c7465eef2109dc5a01
{
  "result": "success",
  "name": "pegsworstaccounts",
  "KMD": [
    {
      "accounttxid": "2fe220046fee55014ea4b9f2d9994277e37893e57f8b5d4f2c6d0ad2840f3ac0",
      "deposit": 1000000000,
      "debt": 700000000,
      "ratio": "93.83%"
    }
  ]
}
:~/mkmd/src$ komodo-cli -ac_name=EURKTEST pegsliquidate 07e85362e99ac2037de731fd41a5aa87a5d5f20d6acbf7c7465eef2109dc5a01 0d4ec29786763e4cd5d83725d71347516d8deeb49f5e15edbbdba48dda6ce6e9 2fe220046fee55014ea4b9f2d9994277e37893e57f8b5d4f2c6d0ad2840f3ac0
{
  "result": "error",
  "error": "cannot liquidate account to liquidate or invalid tx 2fe220046fee55014ea4b9f2d9994277e37893e57f8b5d4f2c6d0ad2840f3ac0\n"
}
```


[19-Feb-20 11:30 AM] Alright#0419
trying to liquidate someone else's account and getting this, have funds in the wallet to do it


[19-Feb-20 11:31 AM] Alright#0419
oh sorry, maybe not enough coins I think


[19-Feb-20 11:31 AM] Alright#0419
how much exactly is needed to liquidate that?


[19-Feb-20 11:32 AM] Sir Seven#7158
`"error": "cannot liquidate account to liquidate or invalid tx `
Same error when not enough funds on account.


[19-Feb-20 11:34 AM] Sir Seven#7158
One question here: how can i get my own accounttxid to liquidate, outside finding one in worstaccounts call?


[19-Feb-20 11:36 AM] Alright#0419
is it possible to setup a chain that uses KMD price, but test coins instead


[19-Feb-20 11:36 AM] Alright#0419
actually having to worry about how much I'm using is a bit limiting


[19-Feb-20 11:37 AM] Alright#0419
or someone give me a couple thousand KMD? :troll:

{Reactions}
troll_compadre 

[19-Feb-20 11:46 AM] Sir Seven#7158
` how can i get my own accounttxid to liquidate, outside finding one in worstaccounts call?`
Ok, accounthistory helps.


[19-Feb-20 12:03 PM] Sir Seven#7158
@Alright please try to liquidate:
```
{
      "accounttxid": "ccbacc377f27b487777d3a54b83cba6bb7abdc188565e73e0d39730469aeece6",
      "deposit": 999000,
      "debt": 730000,
      "ratio": "98.48%"
    }
```


[19-Feb-20 12:04 PM] Alright#0419
is there something strange about it in particular?


[19-Feb-20 12:04 PM] Alright#0419
I was in the process of setting a few up to try to break the liquidate validation, could I use this one for that?


[19-Feb-20 12:05 PM] Sir Seven#7158
Sure. I couln't break it, heh.


[19-Feb-20 12:06 PM] Sir Seven#7158
`is there something strange about it in particular?`
Just standard account in red zone.


[19-Feb-20 12:06 PM] Alright#0419
how much should be needed to liquidate that?


[19-Feb-20 12:08 PM] Sir Seven#7158
~0.01 KMD.


[19-Feb-20 12:10 PM] Alright#0419
don't understand this yet, is giving me same error as if I don't have enough. ```
  "tokenid": "0d4ec29786763e4cd5d83725d71347516d8deeb49f5e15edbbdba48dda6ce6e9",
  "balance": 100000000
```


[19-Feb-20 12:10 PM] Alright#0419
I need to read over this code a few more times, don't fully understand the flow of things yet


[19-Feb-20 12:11 PM] Alright#0419
assembling gatewaysdeposit command is making me want to die each time I need do it, want to script that first before I do much else


[19-Feb-20 01:04 PM] Mihailo#5902
@Sir Seven You cannot liquidate your own account. For that you have pegsclose (to return the coins you got and take back the deposit) or pegsredeem to take out as much deposit as you want up to having account at ratio 80%


[19-Feb-20 01:05 PM] Sir Seven#7158
Just was checking if it works as intended. )


[19-Feb-20 01:05 PM] Mihailo#5902
@Alright, don't assemble gatewaysdeposit manually. You have TUI for that. I think the latest Komodo-cctools-python of TonyL repo.


[19-Feb-20 01:07 PM] Mihailo#5902
@Alright BTW for liquidating account you need EURKTEST coins, not KMD tokens. KMD tokens you use to fund your account, then you can take EURKTEST coins and with those coins you can do whatever you want, and also liquidate other accounts.


[19-Feb-20 01:08 PM] Alright#0419
how much should I need for the one Sir Seven just posted above


[19-Feb-20 01:09 PM] Mihailo#5902
The whole debt amount - 730000sats


[19-Feb-20 01:10 PM] Alright#0419
I have that much, do they need to be in -pubkey address?


[19-Feb-20 01:10 PM] Mihailo#5902
Yes, they need to be in pubkey address


[19-Feb-20 01:10 PM] Mihailo#5902
As rpc uses AddNormalInputs which take funds from mypk


[19-Feb-20 01:10 PM] Alright#0419
AddNormalInputs will take it from any address in wallet


[19-Feb-20 01:10 PM] Alright#0419
AddNormalInputs2 is for mypk address only


[19-Feb-20 01:11 PM] Mihailo#5902
Then maybe you don't even need to have it in pubkey address. But what error are you getting?


[19-Feb-20 01:13 PM] Alright#0419
```
komodo-cli -ac_name=EURKTEST pegsliquidate 07e85362e99ac2037de731fd41a5aa87a5d5f20d6acbf7c7465eef2109dc5a01 0d4ec29786763e4cd5d83725d71347516d8deeb49f5e15edbbdba48dda6ce6e9 ccbacc377f27b487777d3a54b83cba6bb7abdc188565e73e0d39730469aeece6
{
  "result": "error",
  "error": "cannot liquidate account to liquidate or invalid tx ccbacc377f27b487777d3a54b83cba6bb7abdc188565e73e0d39730469aeece6\n"
}
```


[19-Feb-20 01:13 PM] Alright#0419
```
komodo-cli -ac_name=EURKTEST getbalance
0.19993000
```


[19-Feb-20 01:13 PM] Mihailo#5902
Just a sec, that must be a typo in error text


[19-Feb-20 01:14 PM] Mihailo#5902
```cpp
if (myIsutxo_spent(ignoretxid,liquidatetxid,0))
        CCERR_RESULT("pegscc",CCLOG_ERROR, stream << "cannot liquidate account to liquidate or invalid tx " << liquidatetxid.GetHex());```


[19-Feb-20 01:14 PM] Mihailo#5902
So the liquidatetxid is already spent I think.


[19-Feb-20 01:15 PM] Mihailo#5902
The account tx is the last tx done on that account. It always changes whenever you do something.


[19-Feb-20 01:15 PM] Mihailo#5902
So try to do `pegsworstaccounts` and liquidate the txid you get from worstaccounts!


[19-Feb-20 01:15 PM] Alright#0419
that is the txid


[19-Feb-20 01:16 PM] Mihailo#5902
Let me check


[19-Feb-20 01:16 PM] Alright#0419
```
    {
      "accounttxid": "ccbacc377f27b487777d3a54b83cba6bb7abdc188565e73e0d39730469aeece6",
      "deposit": 999000,
      "debt": 730000,
      "ratio": "102.08%"
    }
```


[19-Feb-20 01:16 PM] Alright#0419
komodo-cli -ac_name=EURKTEST pegsliquidate 07e85362e99ac2037de731fd41a5aa87a5d5f20d6acbf7c7465eef2109dc5a01 0d4ec29786763e4cd5d83725d71347516d8deeb49f5e15edbbdba48dda6ce6e9 **ccbacc377f27b487777d3a54b83cba6bb7abdc188565e73e0d39730469aeece6**


[19-Feb-20 01:18 PM] Mihailo#5902
I don't have account on my current node, let me find some tokens


[19-Feb-20 01:19 PM] Mihailo#5902
Can you send some tokens so I don't have to do gatewaysdeposit


[19-Feb-20 01:20 PM] Alright#0419
yes


[19-Feb-20 01:20 PM] Mihailo#5902
I need lets say 130000 tokens


[19-Feb-20 01:20 PM] Alright#0419
where


[19-Feb-20 01:20 PM] Alright#0419
is it possible to create a chain that uses KMD price and say MORTY coins for gateway?


[19-Feb-20 01:21 PM] Mihailo#5902
Sorry launched with wrong pubkey


[19-Feb-20 01:21 PM] Mihailo#5902
I have account


[19-Feb-20 01:22 PM] Mihailo#5902
Ok, so there is some error.


[19-Feb-20 01:22 PM] Mihailo#5902
I'll have to check in the morning!


[19-Feb-20 01:23 PM] Mihailo#5902
BTW, as nobody is liquidating on of the accounts went over 100% 😂


[19-Feb-20 01:23 PM] Mihailo#5902
This should not be the case when it is live, as soon it reaches 90% someone will liquidate and take the profit 😉


[19-Feb-20 01:23 PM] Alright#0419
I tried it when it was under 100%, I don't think that is what was causing the issue


[19-Feb-20 01:23 PM] Mihailo#5902
No, just pointing on interesting stuff.


[19-Feb-20 01:24 PM] Mihailo#5902
It is not the issue


[19-Feb-20 01:24 PM] Alright#0419
could you please setup a chain with worthless coins


[19-Feb-20 01:25 PM] Mihailo#5902
I can, but I usually used KMD as I think everybody can spare some < 1 KMD. Again don't use big amounts!!!


[19-Feb-20 01:26 PM] Alright#0419
don't typically have KMD nodes running in my dev env, is quite a hassle for me the way it's setup right now


[19-Feb-20 01:27 PM] Mihailo#5902
This check for spent is some copy/paste from some other function, below I have again checking for spent utxo but different one. So I will remove it and push the fix to try.


[19-Feb-20 01:28 PM] Alright#0419
what is the status of multi deposit/claim bug?


[19-Feb-20 01:28 PM] Mihailo#5902
Pushed. Try now!


[19-Feb-20 01:29 PM] Mihailo#5902
Not yet solved. I was working on something for channelsCC


[19-Feb-20 01:29 PM] Alright#0419
ok, please don't liquidate that anyone, want to use it to test liquidate validation


[19-Feb-20 01:29 PM] Mihailo#5902
I won't


[19-Feb-20 01:30 PM] Alright#0419
I tried to do a claim from a deposit I made a few days ago and it was giving me an error about momom


[19-Feb-20 01:30 PM] Alright#0419
I assumed this was something to do with a fix for multi deposit/claim, but if it's not, seems a bug


[19-Feb-20 01:31 PM] Alright#0419
ok rpc works now, thank you


[19-Feb-20 01:31 PM] Alright#0419
```
    {
      "value": -0.00075859,
      "valueZat": -75859,
      "n": 4,
      "scriptPubKey": {
        "asm": "a22c8020dbf51310272c7b820822c473831413820c04f75ea295ad9eead23d2a557038dd81032210008203000401 OP_CHECKCRYPTOCONDITION",
        "hex": "2ea22c8020dbf51310272c7b820822c473831413820c04f75ea295ad9eead23d2a557038dd81032210008203000401cc",
        "reqSigs": 1,
        "type": "cryptocondition",
        "addresses": [
          "RHG4K84bPP9h9KKqvpYbUzocaZ3LSUHxLa"
        ]
      }
    },
```
though


[19-Feb-20 01:31 PM] Alright#0419
assuming that's because it's >100%


[19-Feb-20 01:32 PM] Mihailo#5902
Maybe it was giving you error that it cant find txid in merkleroot or something like that...


[19-Feb-20 01:32 PM] Alright#0419
yes


[19-Feb-20 01:32 PM] Mihailo#5902
Yes could be! And basically that needs to be solved - the minus vout.


[19-Feb-20 01:33 PM] Mihailo#5902
That error you got on gateway is basically missing block data for tx you gave. Oracles didn't work for some time so maybe it missed your block.


[19-Feb-20 01:33 PM] Alright#0419
that's a bit worrisome 😅


[19-Feb-20 01:34 PM] Alright#0419
if oracle is somehow down for some time, should publish all data from when it was down when it comes back up


[19-Feb-20 01:34 PM] Mihailo#5902
Yes it is. But there is something to be developed for that, so even if block data is missed oraclefedd will retrive it and post it.


[19-Feb-20 01:35 PM] Mihailo#5902
Something like that. This is alpha test of these stuff, and all of missing features/bugs should be reported and we should find solutions/fixes for them.


[19-Feb-20 01:37 PM] Alright#0419
does the oracles dapp just post block data as it receives each block?


[19-Feb-20 01:38 PM] Mihailo#5902
It fetches the block data from KMD (or whatever the chain is setup for gateway) and posts block data 10 blocks behind current one and it is always 10 blocks behind.


[19-Feb-20 01:39 PM] Mihailo#5902
That also needs to be configured by parameter as not all chains are the same.


[19-Feb-20 01:39 PM] Mihailo#5902
Going to sleep now, some flu is trying to break me!


[20-Feb-20 11:50 AM] Sir Seven#7158
Trying to create new account with pegsexchange, getting error:
```
error code: -26
error message:
16: mandatory-script-verify-flag-failed (Script evaluated without error but finished with a false/empty top stack element)
```
Full log:
https://paste.ubuntu.com/p/PtC6QFxTrR/

I'm not sure if there are just no "yellow zone" accounts to pay. Hm.


[20-Feb-20 11:58 AM] Alright#0419
stdout or debuglog should have prints when you try to send it @Sir Seven


[20-Feb-20 12:02 PM] Mihailo#5902
How do you mean new account with pegsexchange?


[20-Feb-20 12:02 PM] Mihailo#5902
Pegsexchange is to change coins for tokens if you do not have account


[20-Feb-20 12:04 PM] Mihailo#5902
But it seems there is a problem in validation


[20-Feb-20 12:04 PM] Sir Seven#7158
Exactly, no account on set pubkey.


[20-Feb-20 12:04 PM] Sir Seven#7158
@Alright debug.log has no errors/warnings and stdout is above.


[20-Feb-20 12:09 PM] Alright#0419
stdout of komodod


[20-Feb-20 12:14 PM] Alright#0419
There most likely was something printed to stdout, but now you've spent one of this txes inputs, I can't resend to find what it was


[20-Feb-20 12:15 PM] Alright#0419
try replicating what you did and seeing if it fails again, post raw hex here


[20-Feb-20 12:16 PM] Sir Seven#7158
My bad, misunderstood you.
```
pegscc txid=2fe220046fee55014ea4b9f2d9994277e37893e57f8b5d4f2c6d0ad2840f3ac0, vout=1, nValue=1000
cctokens DecodeTokenOpRet() incorrect evalcode in tokens opret
cctokens DecodeTokenOpRet() incorrect evalcode in tokens opret
CC Eval EVAL_PEGS Invalid: invalid previous and current account comparisons! spending tx 2fe220046fee55014ea4b9f2d9994277e37893e57f8b5d4f2c6d0ad2840f3ac0
ERROR: CScriptCheck(): 0f2e28501f7d5e9c0acfafe5d898ccd29e7d3c7cf6ec791b721772862569352a:0 VerifySignature failed: Script evaluated without error but finished with a false/empty top stack element
ERROR: AcceptToMemoryPool: BUG! PLEASE REPORT THIS! ConnectInputs failed against MANDATORY but not STANDARD flags 0f2e28501f7d5e9c0acfafe5d898ccd29e7d3c7cf6ec791b721772862569352a
```


[20-Feb-20 12:17 PM] Sir Seven#7158
HEX is in paste above.


[20-Feb-20 12:18 PM] Mihailo#5902
Ok,I'll check it out


[20-Feb-20 02:09 PM] Alright#0419
@Sir Seven have you gotten any gatewayswithdraw or pegsredeem transactions to work properly?


[20-Feb-20 02:11 PM] Sir Seven#7158
Pegsredeem worked fine for me, yet to check gatewayswithdraw.


[20-Feb-20 02:11 PM] Alright#0419
Having a very hard time understanding what exactly pegsredeem does


[20-Feb-20 02:12 PM] Alright#0419
Could you help me?


[20-Feb-20 02:13 PM] Alright#0419
Also failing to understand how to do gatewayswithdraw, my assumption was that i just needed KMD tokens in mypk(i do), but I'm getting 
```
{
  "result": "error",
  "error": "withdraw amount is not possible, deposit balance is lower than the amount! 10000000 0\n"
}
```


[20-Feb-20 02:17 PM] Alright#0419
the thing that is confusing me about pegsredeem is that none of it's inputs are normal native coins, my understanding after reading the tut/comments was that it was there to convert native EURKTEST coins back into KMD tokens


[20-Feb-20 05:27 PM] Alright#0419
also confused about the difference between pegsget and pegsredeem, they seem to accomplish the same thing to me


[20-Feb-20 05:28 PM] Alright#0419
Ah derp, pegsget is for receiving native coins, pegsredeem for tokens


[20-Feb-20 05:42 PM] Alright#0419
If someone directly sends me native coins, what are the steps to get back real KMD? 

if someone directly send me KMD tokens, what are the steps to get back real KMD?


[20-Feb-20 05:43 PM] Alright#0419
I am trying to do `pegsexchange` on a node that does not have a pegs account. The node has a balance of native coins and no balance of KMD tokens. 
```
CC Eval EVAL_PEGS Invalid: cannot exchange coins from account as it will leave the account in the red zone! spending tx 2fe220046fee55014ea4b9f2d9994277e37893e57f8b5d4f2c6d0ad2840f3ac0
```


[20-Feb-20 06:36 PM] Alright#0419
```
komodo-cli -ac_name=EURKTEST getbalance
100000.19985000
```
Alright is gateway now


[20-Feb-20 08:58 PM] Alright#0419
good chance I just crashed some nodes with that missing input assert


[20-Feb-20 09:06 PM] Alright#0419
nabbed the tokens too using similar method 
```
komodo-cli -ac_name=EURKTEST tokenbalance 0d4ec29786763e4cd5d83725d71347516d8deeb49f5e15edbbdba48dda6ce6e9
{
  "result": "success",
  "CCaddress": "RJMsDeN8rGb9CDsJyyqrSPXGNXaFhF33dY",
  "tokenid": "0d4ec29786763e4cd5d83725d71347516d8deeb49f5e15edbbdba48dda6ce6e9",
  "balance": 49998881000000
}
```


[13-Mar-20 02:33 AM] Mylo#8306
www.coindesk.com/defi-leader-makerdao-weighs-emergency-shutdown-following-eth-price-drop


[13-Mar-20 02:34 AM] Mylo#8306
https://www.coindesk.com/defi-leader-makerdao-weighs-emergency-shutdown-following-eth-price-drop

{Embed}
https://www.coindesk.com/defi-leader-makerdao-weighs-emergency-shutdown-following-eth-price-drop
DeFi Leader MakerDAO Weighs Emergency Shutdown Following ETH Price ...
A large drop in the price of ether is testing the feasibility of Ethereum's entire system of lending and borrowing.
https://images-ext-2.discordapp.net/external/9h88j-5Cqj6AxtSj_acVMnZ8uehmgxPjXninVGH-lh8/https/www.coindesk.com/wp-content/uploads/2020/03/shutterstock_199607951-1200x628.jpg


[23-Apr-20 08:08 PM] B. Gültekin Çetiner#0626
Is EURKTEST chain running now? What are the parameters?


[23-Apr-20 08:15 PM] B. Gültekin Çetiner#0626
I found it. https://docs.komodoplatform.com/basic-docs/antara/antara-tutorials/pegs-module-user-tutorial.html#connect-and-sync-to-usdktest-and-kmd

{Embed}
https://docs.komodoplatform.com/basic-docs/antara/antara-tutorials/pegs-module-user-tutorial.html
Komodo Documentation
Documentation for developers building on the Komodo Platform
https://images-ext-2.discordapp.net/external/pQcpVLQgfWglPr7tkLLPNfnaXLp21V6nGaMQYJYPkho/https/docs.komodoplatform.com/Dev_Docs_Introduction_small.png


[24-Apr-20 12:17 AM] Alright#0419
likely no chain running, ask @Mihailo


[24-Apr-20 07:35 AM] B. Gültekin Çetiner#0626
Yes. You are right. No Chain running now.


[24-Apr-20 07:37 AM] B. Gültekin Çetiner#0626
Btw, where are the prices coming from? I setup now I can see BTC_USD, BTC_GBP and BTC_EUR prices even when there is only my node on the Chain.


[24-Apr-20 07:39 AM] Mihailo#5902
Hi @B. Gültekin Çetiner, currently EURKTEST chain is not running as we are making some major refactor of Antara(CC) and as PegsCC isn't finished and those changes are gonna affect Pegs I just stopped the nodes for the chain.

{Reactions}
👍 

[24-Apr-20 07:40 AM] Mihailo#5902
The prices are fed currently from CoinDesk. But it won't be one place in the end probably several.


[24-Apr-20 07:42 AM] B. Gültekin Çetiner#0626
How are they added? Does it need fork when there is a new place to get prices from? Or is it easy to add a new gateway address? I assume they are called gateways.


[24-Apr-20 07:43 AM] Mihailo#5902
And they are fed decentralized with trustless (I think that's the term) oracles. It means that all nodes feed the price and there is consensus made on it so can't be influenced with one rouge node.


[24-Apr-20 07:43 AM] B. Gültekin Çetiner#0626
Good.


[24-Apr-20 07:44 AM] Mihailo#5902
Currently coindesk is hardcoded in the code so definitely hardfork when it is changed, but not sure about how it is going to be done in the end. The prices are @jl777c master work, and @dimxy done also some work on it so you can ask them for details. I can help you with anything regarding Pegs (stablecoin) module.


[24-Apr-20 07:48 AM] B. Gültekin Çetiner#0626
I am preparing requirements document for MCL version 2. As you know, it is real credit creation. Due to volatility of crypto, we are considering to add stablecoin though it was not decided yet. If we decide to add, we will certainly need several stable coins including TRYK of course.


[24-Apr-20 07:49 AM] Mihailo#5902
I can explain you how this stablecoin mechanism works. But also I have to note that it is not done yet, and I'm not sure on the timeline how much before it can be used in production.


[24-Apr-20 07:51 AM] B. Gültekin Çetiner#0626
We have time for Version 2 anyway. If we decide, I think there must be some stable coins ready when the coding for Version 2 starts.


[24-Apr-20 07:53 AM] B. Gültekin Çetiner#0626
> I can explain you how this stablecoin mechanism works. production.
@Mihailo  
I would be happy. I started reading but a simple explanation would be good.


[24-Apr-20 07:55 AM] Mihailo#5902
I'll try to do it as simple as I can. But I noticed it is hard to grasp it from the first time, it was hard to me too until I thought about it enough.


[24-Apr-20 07:56 AM] B. Gültekin Çetiner#0626
I am actually interested in integrating stable coins with Marmara. If that will be very complex I will modify the requirements without adding them.


[24-Apr-20 07:58 AM] Mihailo#5902
Well, I'm not so familiar what you did on Marmara, but basically with PegsCC you get a chain with coin which is peged (bound) to some value (that has price it can be fed) like fiat (USD,EUR,GBP, TRY...), gold, oil, stocks ....


[24-Apr-20 07:58 AM] Mihailo#5902
I suppose you could use that as base for Marmara needs.


[24-Apr-20 08:04 AM] B. Gültekin Çetiner#0626
I think you know post-dated cheques. Think you issue a post-dated cheque with a value of 1000 USD and date of 24 April 2022. I will take that cheque in return of goods and services. I ask you to have a 20 % collateralisation as blockage amount. That blockage amount might be in stable coins if possible. We need to lock 200 USD in a fund and use it when deeming on 24th April 2022.


[24-Apr-20 08:05 AM] B. Gültekin Çetiner#0626
If we don’t use stable coins as collaterals, we will leave that process to TRUST based third parties, notary nodes.


[24-Apr-20 08:07 AM] Mihailo#5902
And what happens with collateralization when check is deemed or not deemed?


[24-Apr-20 08:10 AM] B. Gültekin Çetiner#0626
If check is not deemed, we will have other nonredemption processes. It is a TRUST based mechanism.


[24-Apr-20 08:11 AM] B. Gültekin Çetiner#0626
We have avalists with MCL as locked in credit Loops.


[24-Apr-20 08:12 AM] B. Gültekin Çetiner#0626
The whole process will be controlled by a Trustful notary node. That has highest responsibility.


[24-Apr-20 08:16 AM] B. Gültekin Çetiner#0626
Of course, this is only when issuing credits with a trustful mechanism. The Chain will still have trustless mode (Version 1) with 💯 collateralisation where there is no problem of nonredemption with of course only MCL. When Fiat credits are on the scene, the 100% collateralisation is not guaranteed.


[28-Apr-20 10:22 PM] gcharang#6833
> How are they added? Does it need fork when there is a new place to get prices from?
@B. Gültekin Çetiner as mihailo said, it is in development and subject to change, but for reference, see <https://developers.komodoplatform.com/basic-docs/antara/antara-setup/antara-customizations.html#ac-feeds>
ac_feeds , ac_cbopret , ac_prices , ac_stocks in the same page


[13-May-20 08:25 AM] Wilmerga#4202
Hi! 
Noob here. I was wondering if a local currency project could be done using this module at some point, for example by creating a token pegged to a developing country's currency using USDC as collateral.
Also, is there any benefit to being the provider of collateral? I fail to see the incentive to provide collateral.
Thanks and sorry if this should be directed somewhere else!


[13-May-20 09:03 AM] polycryptoblog#1173
The use of collateral is what triggers the token/coin ( it could be either, depending how you do it ) issuance.     Think of it like a self-issued secured line of credit.  A couple reasons why people would use this,  hedging against price volatility ,   To be able to more smoothly deal with merchants.    It is the base for More advanced cases such as synthetic assets and derivatives .

{Reactions}
👍 

[13-May-20 09:08 AM] Mihailo#5902
@Wilmerga If you create a coin that is pegged to that country currency then you done nothing because as the currency of the country devolves so will the price of coin. Basically pegs module is used to peg (bind) to a price of something like fiat currency, stocks, gold, silver, oil .... Anything that has its price which could be fed to the chain. Usually people would like to bound it to price of something that is as stable as it can get (I mean in global catastrophes everythin can lose significant amount on price).
So in your example you would create a coin that is pegged to price of example gold and you could name it as the name of country currency and in that way try to create a digital country currency that doesn't depend on goverment of the country but it depends on gold.

{Reactions}
👍 (2) 

[13-May-20 09:21 AM] Wilmerga#4202
Thank you both! I think I get it now! A


[20-Jun-20 06:46 AM] phm87#7395
How can we know if 2 cc are compatible? Is there a table of cc incompatibilities? Is it possible to use cc_peg and ac_notary on the same chain?


[20-Jun-20 01:01 PM] phm87#7395
Another question: is the doc from @Mihailo still up to date? https://github.com/Mixa84/komodo/wiki/Pegs-CC

{Embed}
https://github.com/Mixa84/komodo/wiki/Pegs-CC
Mixa84/komodo
Komodo. Contribute to Mixa84/komodo development by creating an account on GitHub.
https://images-ext-2.discordapp.net/external/5PP5Rc1dp6Lo2v8nwnTvQmRdaXpEf9xjHeMr0XyppBs/%3Fs%3D400%26v%3D4/https/avatars3.githubusercontent.com/u/39563265


[21-Jun-20 04:02 AM] Mihailo#5902
@phm87 I'm bot familiar with -ac_notary atm and I'm not sure it is a CC module. But usually mixing two CCs require some development changes. In pegs CC you get regular coins so they could be used in any CC like normal coins.


[21-Jun-20 04:03 AM] Mihailo#5902
PegsCC are still in development and not sure how uo to date the document is as we are changing some core stuff in CC and I expect changes on PegsCC side. 
So far I think you can follow the document to try out pegs...


[21-Jun-20 04:06 AM] phm87#7395
Thank you

{Reactions}
👍 

[27-Jul-20 11:29 PM] Hassaan#5627
Hi, I've been reading the documentation on pegs and I'm a bit confused on the yellow and red zone liquidation. How exactly are accounts liquidated to keep the value of the smart chain stable ?


[27-Jul-20 11:43 PM] Hassaan#5627
cc @blocsmith @Laotsuit


[28-Jul-20 12:02 AM] Mylo#8306
https://discord.com/channels/412898016371015680/564807360472940575/675001037777797120 might help.
search "in: cc-pegs liquid" and flick a couple of pages, there is old discussion about the mechanism.

{Reactions}
👍 

[24-Aug-20 08:28 AM] siu#3920
hi guys, how is the Pegs cc tech doing?


[24-Aug-20 08:29 AM] siu#3920
i have been away for a lot of time... wondering how possible is it right now to deploy a pegged chain.


[25-Aug-20 09:11 AM] Mihailo#5902
Nothing much have been changed on PegsCC as it is waiting to get its turn for CCv2 modifications.


[27-Aug-20 08:18 AM] siu#3920
ok, thanks.


[03-Feb-21 01:33 AM] Mylo#8306
regarding pegs, here is the 2021 roadmap for the KAVA project fyi https://medium.com/kava-labs/kava-2021-roadmap-91f839a0907b

{Embed}
https://medium.com/kava-labs/kava-2021-roadmap-91f839a0907b
Kava 2021 Roadmap
The Kava DeFi platform is coming out the gates swinging in 2021 with a feature packed product roadmap including…
https://images-ext-1.discordapp.net/external/sS5r_N9m79DPU_t3Ma15H9Krky0dgf1FZm2NXVnhffY/https/miro.medium.com/max/1200/1%2A_4Oy7XBb8orpwzxAPU6ujQ.jpeg


[29-Mar-21 02:19 PM] Roger#1320
Hi we are looking for developers to work on a atomicdex komodo based project. can you point me in the right direction?


==============================================================
Exported 3,208 message(s)
==============================================================
