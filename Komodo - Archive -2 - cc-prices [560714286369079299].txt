==============================================================
Guild: Komodo
Channel: Archive -2 / cc-prices
Topic: ./komodod -ac_cbopret=7 -ac_prices="LTC, BCHABC, XMR, IOTA, ZEC, WAVES, LSK, DCR, RVN, DASH, XEM, BTS, ICX, HOT, STEEM, ENJ, STRAT" -pubkey=<yourpubkey> -ac_name=REKT0 -ac_cclib=prices -ac_cc=10777 -ac_reward=3000000000 -ac_supply=120000000 -ac_pubkey=039433dc3749aece1bd568f374a45da3b0bc6856990d7da3cd175399577940a775 -ac_perc=77777 -ac_blocktime=600 -addnode=5.9.102.210 &
==============================================================

[27-Mar-19 11:40 PM] jl777c#5810
./makeprices to create the .so for prices dapp
cc/games/prices starts a very simple game, it isnt complete yet, but I thought I would explain what it is about
there is a reference node based on -ac_pubkey which is posting special reference tx with the price of BTC/USD by using the dapp
all other nodes also run the dapp and you can change the betsize with ^ or /, and change the price premium with + or -


[27-Mar-19 11:40 PM] jl777c#5810
every 10 seconds your node will make a bet of betsize with the adjusted BTC/USD price


[27-Mar-19 11:41 PM] jl777c#5810
these bets will then be compared to a future blocks reference prices to determine the winner(s). for now i set it to 3 blocks gap, so if you can predict BTC/USD prices half hour ahead, you will win more often than not


[27-Mar-19 11:43 PM] jl777c#5810
just a simple example of bet (lock) and settle based on external data, though i still need to get the settle part working


[27-Mar-19 11:44 PM] jl777c#5810
while it is in games CC and thus supports the rogue game rpc calls, most of them dont really apply, as this is an always running game

{Reactions}
treasure 

[28-Mar-19 01:47 AM] siu#3920
So binary options in the blockchain is born?


[28-Mar-19 02:56 AM] jl777c#5810
it is more a contest among all participants to see who is the most accurate (without going all crazy with protections against miners cheating and having a trusted reference price source). Still not sure how to determine payouts. I have a block full of predictions.


[28-Mar-19 02:56 AM] jl777c#5810
I am wondering if to aggregate by pubkey and choose the pubkey with the most accurate prediction, or just find the single bet that was most accurate


[28-Mar-19 02:57 AM] jl777c#5810
there will be many reference points, so maybe the closest to each one wins...


[28-Mar-19 02:59 AM] jl777c#5810
many ways to do this and it is just a proof of concept, so I think I will just do a simple aggregation of the reference and then find the closest to make a winner take all for that block. the way the dapp works is that you are making a new bet every 10 seconds, so it shouldnt be a disaster even if you dont win in a specific block


[28-Mar-19 10:14 AM] TonyL#3577
Looks like super interesting gambling. 
Is it testable already? üòÉ


[28-Mar-19 10:23 AM] jl777c#5810
oh, i switched from this to a fully decentralized trustless price oracle

{Reactions}
üëå üî• (2) 

[28-Mar-19 10:23 AM] jl777c#5810
which turns out is nearly impossible and nobody else has it, other than maybe amoveo

{Reactions}
5684_Peepo_Goteem 

[28-Mar-19 10:23 AM] jl777c#5810
currently testing that, but still it has some known edge cases i need to fix


[28-Mar-19 03:13 PM] jl777c#5810
fixed all the known issues: https://github.com/jl777/komodo/blob/jl777/src/komodo_gateway.h#L1550

{Embed}
https://github.com/jl777/komodo/blob/jl777/src/komodo_gateway.h
jl777/komodo
Komodo. Contribute to jl777/komodo development by creating an account on GitHub.
https://images-ext-1.discordapp.net/external/ZluS_vPUp--Ma1oFnNdhU0YaB0OEwzwGFNPA2N_uSAk/%3Fs%3D400%26v%3D4/https/avatars2.githubusercontent.com/u/5962559


[28-Mar-19 03:13 PM] jl777c#5810
now I can make a real money game using BTCUSD prices


[28-Mar-19 03:13 PM] jl777c#5810
so will be switching back to prices game

{Reactions}
üëç (3) 

[29-Mar-19 10:33 AM] jl777c#5810
added 32 currencies https://www.ecb.europa.eu/stats/policy_and_exchange_rates/euro_reference_exchange_rates/html/index.en.html and 18 cryptos to the price feed, so far it validated the first block with all 50 new prices on all 7 nodes

{Embed}
https://www.ecb.europa.eu/stats/policy_and_exchange_rates/euro_reference_exchange_rates/html/index.en.html
Euro foreign exchange reference rates
The euro foreign exchange reference rates (also known as the ECB reference rates) are published by the ECB at around 16:00 CET. Reference rates for all the official currencies of non-euro area Member States of the European Union and world currencies with the most liquid activ...
https://images-ext-1.discordapp.net/external/yh3rxzF3uha2KnUeykyFJuCQlyHi6CE3XD2lwjSva58/https/www.ecb.europa.eu/shared/img/socialmedia/ecb-social-default.png

{Reactions}
üöÄ (2) 

[29-Mar-19 10:36 AM] jl777c#5810
ok, got a error when price got clamped


[29-Mar-19 11:00 AM] TonyL#3577
Built and synced, started `prices` - not totally understood what to do next üòÉ It not response on ^ / + - presses


[29-Mar-19 11:00 AM] TonyL#3577
```BTC/USD 4110.6200 -&gt; Betsize 0.87500000 (^ / to change) &amp;&amp; 4110.6200 Net 0.0% [+ - to change]```


[29-Mar-19 11:01 AM] TonyL#3577
Then it printed prices update as I understand

{Attachments}
https://cdn.discordapp.com/attachments/560714286369079299/561248563909230602/unknown.png


[29-Mar-19 11:36 AM] jl777c#5810
i am still debugging consensus

{Reactions}
üëå 

[29-Mar-19 11:36 AM] jl777c#5810
and you need coins to bet


[29-Mar-19 11:37 AM] TonyL#3577
I mined few blocks


[29-Mar-19 11:38 AM] jl777c#5810
now we have a trustless feed, i will change the gameplay totall


[29-Mar-19 11:38 AM] jl777c#5810
can you sync to the PRICES chain? 337 blocks


[29-Mar-19 11:38 AM] jl777c#5810
just pushed fix


[29-Mar-19 11:40 AM] jl777c#5810
a TUI for prices will be totally different, even though it is in games CC now


[29-Mar-19 11:41 AM] TonyL#3577
```  "balance": 2.00000000,
  "blocks": 337,
  "longestchain": 338,
```


[29-Mar-19 11:41 AM] TonyL#3577
Maybe after latest change I can't grab last block, updating


[29-Mar-19 11:42 AM] jl777c#5810
it was a hardforking change


[29-Mar-19 11:57 AM] TonyL#3577
```saplinght.61 tipht.336 blockht.337 cmp.1
ht.338: t1553884594 lag.1200 4116.9317 USD, 3168.2671 GBP, 3668.8942 EUR htstamp.0 [1553884594]
couldnt get pricebits for 337
```
Hmm stucking on 336


[29-Mar-19 12:02 PM] jl777c#5810
yes, fixing


[29-Mar-19 12:04 PM] jl777c#5810
pushed fix


[29-Mar-19 12:06 PM] jl777c#5810
there was a bug in determining if a price was within tolerance


[29-Mar-19 12:06 PM] jl777c#5810
with all the cryptos, there are now occasional >1% changes


[29-Mar-19 12:07 PM] jl777c#5810
a few other edge cases too, so now just need to see what happens with a 1% clamped block when the real price is beyond the 1%. online nodes should accept it, worst case if they reject it, they should get stuck for a bit and then rejoin the main chain when a new block arrives


[29-Mar-19 12:10 PM] jl777c#5810
if there is no valid miner making good blocks, the chain will stall. that is the one different with the trustless oracle. if things are not right, it will just stop


[29-Mar-19 12:12 PM] jl777c#5810
now that the raw prices are coming in, the next layer is adding consensus prices based on the raw prices. due to the required delay for using the prices for settlement of money results, I plan to use the prior days blocks to generate the consensus price. Once we have that, it should be slower to adjust, but could be relied upon to be non-manipulated


[29-Mar-19 12:14 PM] jl777c#5810
however, the nature of removing any manipulation requires a majority consensus (within an epsilon factor) starting from a deterministic random starting point in a rotating buffer. so as you can see, the price output wont be very smooth at all


[29-Mar-19 12:15 PM] jl777c#5810
so I think we will need a third layer of smoothed consensus prices, which can finally be used for settlements block by block. it should behave as approx a daily SMA


[29-Mar-19 12:16 PM] jl777c#5810
which means when making a bet the context is the current price, the prior days smoothed price, so there will be a fair amount of inertia to the price. I guess having something that displays the prices would be very good to have


[29-Mar-19 12:17 PM] TonyL#3577
```i.4/55 17408 vs 0 -> newprice.17233 out of tolerance maxflag.-1
vs prev maxflag.-1 cmp error
saplinght.61 tipht.336 blockht.337 cmp.1
ht.338: t1553884594 lag.2407 4116.9317 USD, 3168.2671 GBP, 3668.8942 EUR htstamp.0 [1553884594]
couldnt get pricebits for 337
saplinght.61 tipht.336 blockht.338 cmp.1
ht.339: t1553885422 lag.1585 4119.6650 USD, 3170.3706 GBP, 3671.3301 EUR htstamp.0 [1553885422]
couldnt get pricebits for 338
```
Hmm same on my side, maybe not cleaned something


[29-Mar-19 12:18 PM] jl777c#5810
reconsiderblock


[29-Mar-19 12:18 PM] jl777c#5810
it got marked as invalid. just resync


[29-Mar-19 12:21 PM] TonyL#3577
```root@tony-P65-Creator-8RF:~/latest_jl777/komodo/src# ./komodo-cli -ac_name=PRICES getblockhash 336
002a3a999cab7b89f7f6db5c4eb79f0ca71469083278152e52786b419df78db8
root@tony-P65-Creator-8RF:~/latest_jl777/komodo/src# ./komodo-cli -ac_name=PRICES reconsiderblock 002a3a999cab7b89f7f6db5c4eb79f0ca71469083278152e52786b419df78db8
\ht.337: t1553883615 lag.3598 4110.6983 USD, 3163.4701 GBP, 3663.3393 EUR htstamp.1553882432 [1183]
ht.338: t1553884594 lag.2619 4116.9317 USD, 3168.2671 GBP, 3668.8942 EUR htstamp.1553883630 [964]
i.4/55 17408 vs 0 -> newprice.17233 out of tolerance maxflag.-1
vs prev maxflag.-1 cmp error
ContextualCheckBlock failed ht.338
```
On 337 now


[29-Mar-19 12:24 PM] jl777c#5810
pushed fix


[29-Mar-19 12:30 PM] TonyL#3577
```  "blocks": 340,
  "longestchain": 340,
```


[29-Mar-19 12:32 PM] jl777c#5810
fix worked!


[29-Mar-19 12:36 PM] TonyL#3577
```  "blocks": 343,
  "longestchain": 0,
  "timeoffset": 0,
  "tiptime": 1553887881,
  "connections": 0,
```
Hmm I've started mining and now I'm on fork üòÇ


[29-Mar-19 12:37 PM] jl777c#5810
i need to update all the nodes


[29-Mar-19 12:37 PM] jl777c#5810
you might have the chaintip


[29-Mar-19 12:38 PM] TonyL#3577
Have miner dream laptop with 12 threads CPU and 1070 gpu üòÇ


[29-Mar-19 12:39 PM] TonyL#3577
I synced back with your nodes and not mine now


[29-Mar-19 12:40 PM] jl777c#5810
342 now


[29-Mar-19 12:40 PM] TonyL#3577
```  "balance": 0.99990000,
  "blocks": 342,
  "longestchain": 342,
```


[29-Mar-19 12:40 PM] TonyL#3577
Yup


[29-Mar-19 12:40 PM] TonyL#3577
It looks like I gambled on one coin


[29-Mar-19 12:41 PM] TonyL#3577
Started `./prices` without args once


[29-Mar-19 12:41 PM] jl777c#5810
running different hardfork versions is sure way to split a chain


[29-Mar-19 12:41 PM] jl777c#5810
now all my nodes are in sync


[29-Mar-19 12:41 PM] TonyL#3577
`  "connections": 4,` rised from 2 to 4


[29-Mar-19 12:47 PM] TonyL#3577
Started `prices`, pressed some buttons and get quite strange percentage:
```BTC/USD 4116.3183 -> Betsize 0.76562500 (^ / to change) && 4112.2020 Net 184467440737095520.0% [+ - to change]
```


[29-Mar-19 12:52 PM] TonyL#3577
If my betsize reducing - it's not good? üòÉ


[29-Mar-19 12:53 PM] jl777c#5810
it is your bet


[29-Mar-19 12:53 PM] jl777c#5810
the net seems to have overflowed.


[29-Mar-19 12:53 PM] jl777c#5810
entire prices dapp will change no need to test


[29-Mar-19 12:53 PM] TonyL#3577
Ok, I see


[29-Mar-19 12:54 PM] TonyL#3577
`  "balance": 0.00653288,` üò¶ üòÇ


[29-Mar-19 12:54 PM] TonyL#3577
payment for excessive curiosity


[29-Mar-19 12:56 PM] jl777c#5810
there is no way to collect on winning bets yet


[29-Mar-19 12:56 PM] jl777c#5810
havent even determined what it means to win a bet


[29-Mar-19 12:56 PM] jl777c#5810
so prices dapp testing is indeed a bit early

{Reactions}
üëç 

[29-Mar-19 12:59 PM] jl777c#5810
still having sync issues, need to fix a few more consensus bugs


[29-Mar-19 01:32 PM] jl777c#5810
5 blocks and all nodes are still in sync for me


[29-Mar-19 01:36 PM] TonyL#3577
```git log -1
commit d605780e576e1f1952c8158cb693003a73559d26 (HEAD -> jl777, origin/jl777)
Author: jl777 <jameslee777@yahoo.com>
Date:   Fri Mar 29 09:04:39 2019 -1100

    +print
```

```low 0 vs h17582 l17233 tolerance.1000000
ht.337 i.4/55 17408 vs 0 -> newprice.17233 out of tolerance maxflag.-2
vs prev maxflag.-2 cmp error
saplinght.61 tipht.336 blockht.337 cmp.1
ht.338: t1553884594 lag.7084 4116.9317 USD, 3168.2671 GBP, 3668.8942 EUR htstamp.0 [1553884594]
couldnt get pricebits for 337
saplinght.61 tipht.336 blockht.338 cmp.1
ht.339: t1553885422 lag.6259 4119.6650 USD, 3170.3706 GBP, 3671.3301 EUR htstamp.0 [1553885422]
couldnt get pricebits for 338
saplinght.61 tipht.336 blockht.339 cmp.1
ht.340: t1553886653 lag.5028 4118.0733 USD, 3166.8519 GBP, 3671.7936 EUR htstamp.0 [1553886653]
couldnt get pricebits for 339
...
```


[29-Mar-19 01:36 PM] TonyL#3577
I'm not so lucky hmm (stuck on 336 on fresh sync)


[29-Mar-19 02:19 PM] jl777c#5810
couldnt get pricebits for 339
that seems some fatal error. once it happens need to restart


[29-Mar-19 02:20 PM] jl777c#5810
are you mining?


[29-Mar-19 02:20 PM] jl777c#5810
if so, wait till in sync to start mining


[29-Mar-19 02:26 PM] TonyL#3577
Nope, starting daemon without mining


[29-Mar-19 02:26 PM] jl777c#5810
low 0 vs h17582 l17233 tolerance.1000000
ht.337 i.4/55 17408 vs 0 -> newprice.17233 out of tolerance maxflag.-2
the 0 prices are not good...


[02-Apr-19 12:17 AM] jl777c#5810
only one node missed one price change during todays giant revaluation across the board. it is a very rare case, but it got hit and pretty sure I can make it better. just restarting made it sync up though, so i think it isnt so bad as it is, but might as well make it handle even very volatile conditions. after that I  think it is open for price attack testing. the code should just make any node that mines invalid prices to go off on its own fork, so as long as there is one honest miner, the chain will continue to advance. that is the theory


[02-Apr-19 03:02 AM] gcharang#6833
just started a node with latest jl777 branch
chain is stuck at 333 (getinfo.blocks is 333)
daemon prints: https://pastebin.com/W1vBGjXe

{Embed}
https://pastebin.com/W1vBGjXe
ht.332: lag.322460 4104.7717 USD, 3150.4205 GBP, 3656.1160 EUR, GB...
https://images-ext-1.discordapp.net/external/lZwHlcJYEP_-CeL744a7RSWVnhrIifPJgiIcmKkDuJY/https/pastebin.com/i/facebook.png


[02-Apr-19 03:07 AM] jl777c#5810
yes, similar to build.sh, you need to run it 3 times


[02-Apr-19 03:08 AM] jl777c#5810
initial data is inconsistent due to early blocks changes


[02-Apr-19 03:08 AM] jl777c#5810
just stop and start komodod, 3 times till it syncs


[02-Apr-19 03:08 AM] jl777c#5810
though I am in the process of adding to it so it might not be stable for a bit


[02-Apr-19 03:10 AM] jl777c#5810
I will post when it syncs from scratch and is relatively stable


[02-Apr-19 03:50 AM] gcharang#6833
Got it


[02-Apr-19 06:47 AM] jl777c#5810
@gcharang ok, it is syncing to existing chain from scratch now (with the 3 restarts). still working on rpc calls,but the next level consensus code is active. I havent verified it stays in sync yet, so still experimental status. there is even a prices rpc call that returns most recent prices, but the prices logic is still being worked on for the second two prices of each block


[02-Apr-19 08:03 AM] gcharang#6833
thank you, will keep that in mind while experimenting


[02-Apr-19 10:24 AM] jl777c#5810
@TonyL PRICES chain now has prices rpc working. it shows the specified number of samples and 3 prices per sample: mined, correlated, smoothed


[02-Apr-19 10:25 AM] jl777c#5810
would be cool to see a chart with all three overlaid each other, and maybe even the actual realtime price too

{Reactions}
üëç 

[02-Apr-19 12:38 PM] SHossain#0007
```
./komodo-cli -ac_name=PRICES getinfo
Maximum number of retries exceeded!
Maximum number of retries exceeded!
{
  "version": 2001526,
  "protocolversion": 170007,
  "KMDversion": "0.3.3b",
  "notarized": 0,
  "prevMoMheight": 0,
  "notarizedhash": "0000000000000000000000000000000000000000000000000000000000000000",
  "notarizedtxid": "0000000000000000000000000000000000000000000000000000000000000000",
  "notarizedtxid_height": "mempool",
  "KMDnotarized_height": 0,
  "notarized_confirms": 0,
  "walletversion": 60000,
  "balance": 0.00000000,
  "blocks": 337,
  "longestchain": 958,
  "timeoffset": 0,
  "tiptime": 1553883630,
  "connections": 1,
  "proxy": "",
  "difficulty": 67.70543159998006,
  "testnet": false,
  "keypoololdest": 1554233732,
  "keypoolsize": 101,
  "paytxfee": 0.00000000,
  "relayfee": 0.00000100,
  "errors": "",
  "CCid": 10456,
  "name": "PRICES",
  "sapling": 61,
  "p2pport": 20502,
  "rpcport": 20503,
  "magic": 1898775002,
  "premine": 1000000,
  "reward": "100000000",
  "halving": "0",
  "decay": "0",
  "endsubsidy": "0",
  "notarypay": "0",
  "commission": 1
}
```


[02-Apr-19 12:38 PM] SHossain#0007
stuck on block 337


[02-Apr-19 12:39 PM] SHossain#0007
latest jl777 branch


[02-Apr-19 12:49 PM] jl777c#5810
when I say you need to stop and start 3 times, I mean like with build.sh. first 2 times get stuck


[02-Apr-19 12:50 PM] SHossain#0007
understood. thanks


[02-Apr-19 12:52 PM] SHossain#0007
`ht.958: lag.2888 4758.1382 USD, 3629.2986 GBP, 4250.4259 EUR, GBPUSD 1.311035, EURUSD 1.119450, EURGBP 0.853867 [195]`
synced fully


[02-Apr-19 01:23 PM] jl777c#5810
prices is the only rpc for now


[02-Apr-19 01:23 PM] jl777c#5810
displays all the prices for all the pricefeeds


[02-Apr-19 01:39 PM] SHossain#0007
they are being updated in a regular interval


[02-Apr-19 01:50 PM] jl777c#5810
you can even mine


[02-Apr-19 01:51 PM] jl777c#5810
each miner puts prices into coinbase


[02-Apr-19 01:52 PM] SHossain#0007
mined 3 blocks üòÉ


[02-Apr-19 04:06 PM] TonyL#3577
@jl777c This call should show prices? 
```./komodo-cli -ac_name=PRICES cclib prices 17
error: couldn't connect to server: EOF reached (code 1)
(make sure server is running and you are connecting to the correct RPC port)
[1]+  Segmentation fault      (core dumped) ./komodod -ac_cbopret=1 -ac_name=PRICES -ac_cclib=prices -ac_cc=10456 -ac_reward=100000000 -ac_supply=1000000 -ac_pubkey=03cedeb0180ff8b9a7668e40e85d592119da2f939e28a26a968a8a4b5a4cf35cad -ac_perc=1 -ac_blocktime=600 -addnode=5.9.102.210```
https://paste.ubuntu.com/p/grXZKNnC5y/


[03-Apr-19 12:37 AM] jl777c#5810
not cclib


[03-Apr-19 12:37 AM] jl777c#5810
just prices 17


[03-Apr-19 12:37 AM] jl777c#5810
though it is bad form to be crashing, i will fix that later


[03-Apr-19 12:55 AM] TonyL#3577
Oh right, there is no `prices` method in cclib. But crash is not gentle way to say about it aha :)
Got the samples. Is samples amount depth some fixed number and it will shift or it will just stack each other until inifinity?


[03-Apr-19 12:58 AM] jl777c#5810
first entry is most recent


[03-Apr-19 12:58 AM] jl777c#5810
you pass in the number of samples you want


[03-Apr-19 12:59 AM] TonyL#3577
ü§¶  I thought 17 some magic number


[03-Apr-19 12:59 AM] TonyL#3577
Got it now


[03-Apr-19 01:02 AM] TonyL#3577
Omg why so many üòÖ

{Attachments}
https://cdn.discordapp.com/attachments/560714286369079299/562909755761491968/PythonVisLandscape.png


[03-Apr-19 02:56 AM] TonyL#3577
http://159.69.45.70:8050/ made super basic POC. It grabbing one price data only (from 3) and with fixed depth.
Have an other widescale and urgent task ongoing atm. Will polish this oracle visualisation server asap


[03-Apr-19 02:58 AM] jl777c#5810
ok. no rush. I synced FSM branch with current jl777, about to make changes for new coinbase format that will break existing ac_cbopret chains


[03-Apr-19 02:58 AM] jl777c#5810
now the prices layer seems reasonably stable, i will start on the next step. but the prices dapp is still not in the next cycle as I need a bit more infrastructure in place


[03-Apr-19 03:00 AM] jl777c#5810
which of the three prices is that site showing?


[03-Apr-19 03:00 AM] TonyL#3577
Great! These data viz frameworks are very user-friendly so took only 1 hour for some working example. I think if work on it few days - it's possible to make very cool interactive web-plots


[03-Apr-19 03:00 AM] TonyL#3577
First one


[03-Apr-19 03:01 AM] jl777c#5810
I really want to see the second and third one overlaid at the same scaling

{Reactions}
üëå 

[03-Apr-19 03:01 AM] jl777c#5810
and the timescale seems very short, need at least a days worth


[03-Apr-19 03:01 AM] TonyL#3577
Let me try, shouldn't take much time


[03-Apr-19 03:03 AM] TonyL#3577
I'm taking only 10 timestamps in this demo-version so thats why so short timescale


[03-Apr-19 03:05 AM] jl777c#5810
144 for a day


[03-Apr-19 03:06 AM] jl777c#5810
my calcs are based on prior 2 days + 7 data points


[03-Apr-19 03:06 AM] jl777c#5810
so around 300


[03-Apr-19 03:08 AM] TonyL#3577 (pinned)
http://kmd.money:8050/ hah more interesting now


[03-Apr-19 03:08 AM] TonyL#3577
Working on 3 prices displaying


[03-Apr-19 03:09 AM] SHossain#0007

{Attachments}
https://cdn.discordapp.com/attachments/560714286369079299/562941743583068161/Screenshot_from_2019-04-03_11-09-19.png


[03-Apr-19 03:10 AM] TonyL#3577
Oh yes, it's displaying scientific notation as Œº


[03-Apr-19 03:10 AM] TonyL#3577
Will fix it later


[03-Apr-19 03:14 AM] jl777c#5810
yes looks much more meaningful! and eventually when you have time to get external website data for historical and overlay that so we can see how close it is


[03-Apr-19 03:15 AM] jl777c#5810
would be nice to have KMDBTC instead of some forex things


[03-Apr-19 03:15 AM] TonyL#3577
Im just showing data for all pairnames which getting from prices call


[03-Apr-19 03:16 AM] jl777c#5810
aha! i missed the new ones. needed refresh


[03-Apr-19 03:16 AM] jl777c#5810
ok. that is good


[03-Apr-19 03:16 AM] TonyL#3577
Can show only KMDBTC, BTCUSD


[03-Apr-19 03:16 AM] TonyL#3577
These forex pairs seems not very interesting


[03-Apr-19 03:17 AM] jl777c#5810
leave it as it is. all data is best

{Reactions}
üëå 

[03-Apr-19 03:17 AM] jl777c#5810
it seems fast enough


[03-Apr-19 03:22 AM] jl777c#5810
and the forex prices are not realtime, but rather the daily price fix done by ECB


[03-Apr-19 03:39 AM] TonyL#3577
Displaying 3 prices now


[03-Apr-19 03:40 AM] TonyL#3577
trace 0 - first price, trace 1 - second price, trace 3 - third price (from top to bottom in prices rpc call output)


[03-Apr-19 03:41 AM] gcharang#6833
Pinned a message.


[03-Apr-19 03:45 AM] TonyL#3577
I think I made it static for now (list loading once when I'm starting the server)

At the moment I'm making CSV from prices output and displaying it from this file - will make a simple script now which refreshing this CSV each minute let's say so will be possible to get more actual data on page refresh


[03-Apr-19 03:46 AM] TonyL#3577
So will separate data evaluating and data displaying parts  - now it messed together


[03-Apr-19 03:48 AM] TonyL#3577
https://github.com/tonymorony/komodo_cryptoconditions_tui/blob/master/prices_visualization_server.py graphdisplaying "server"
https://github.com/tonymorony/komodo_cryptoconditions_tui/blob/master/lib/visualization_lib.py - data evaluator (making prices.csv from prices RPC call )

{Embed}
https://github.com/tonymorony/komodo_cryptoconditions_tui/blob/master/prices_visualization_server.py
tonymorony/komodo_cryptoconditions_tui
Terminal user interfaces for Komodo CryptoConditions smart-contracts - tonymorony/komodo_cryptoconditions_tui
https://images-ext-2.discordapp.net/external/IULxymVak7WPV8PZwfkPCOyLSBf6KKjfvRL8wa24Vjc/%3Fs%3D400%26v%3D4/https/avatars1.githubusercontent.com/u/24797699

{Embed}
https://github.com/tonymorony/komodo_cryptoconditions_tui/blob/master/lib/visualization_lib.py
tonymorony/komodo_cryptoconditions_tui
Terminal user interfaces for Komodo CryptoConditions smart-contracts - tonymorony/komodo_cryptoconditions_tui
https://images-ext-2.discordapp.net/external/IULxymVak7WPV8PZwfkPCOyLSBf6KKjfvRL8wa24Vjc/%3Fs%3D400%26v%3D4/https/avatars1.githubusercontent.com/u/24797699


[03-Apr-19 03:51 AM] jl777c#5810
thanks this makes it clear the smoother is not so good. will update it in FSM

{Reactions}
üëç 

[03-Apr-19 04:05 AM] TonyL#3577
http://kmd.money:8050/ hehe

{Reactions}
shexy (2) 

[03-Apr-19 04:05 AM] TonyL#3577
Bought a lot of domains this year on the off-chance


[03-Apr-19 04:07 AM] SHossain#0007
i'm not good with market data analysis. was wondering what are the opposite direction lines in the middle

{Attachments}
https://cdn.discordapp.com/attachments/560714286369079299/562956231371915265/Screenshot_from_2019-04-03_12-06-10.png


[03-Apr-19 04:07 AM] SHossain#0007
trace 1 and trace 2 is trouching the ground


[03-Apr-19 04:07 AM] jl777c#5810
it is just a plot of the raw data, the orange is 51% correlated data


[03-Apr-19 04:07 AM] jl777c#5810
randomly selected within past day, so can be any price


[03-Apr-19 04:08 AM] jl777c#5810
ignore green line, it is supposed to be smooth, but bugs


[03-Apr-19 04:08 AM] jl777c#5810
it is first time i see the greenline

{Reactions}
‚úÖ 

[03-Apr-19 04:09 AM] jl777c#5810
@TonyL i made new version (still in jl777) plz update so I can see the (hopefully) better data

{Reactions}
üëå 

[03-Apr-19 04:10 AM] jl777c#5810
@SHossain the problem is that the trustless oracles allow anybody to mine a block and as long as it is within 1% of previous block and a nodes local data, it is accepted


[03-Apr-19 04:10 AM] jl777c#5810
still it is possible for a miner to consistently bias the price by up to 1%, maybe a bit more


[03-Apr-19 04:10 AM] jl777c#5810
and if we are allowing leverage even a 0.5% biasing of price will skew the results of a 100x leveraged bet


[03-Apr-19 04:11 AM] jl777c#5810
so....


[03-Apr-19 04:11 AM] jl777c#5810
we need to randomize the price that is actually used. while the blue line by miners looks actually quite good, there were no attackers during this period


[03-Apr-19 04:13 AM] jl777c#5810
the algo is to use a deterministic random starting point within the past day. starting from that point if there are 51% of the prior days prices that are within 3% of the starting price, the correlated price is the starting price. I tried to smooth the correlated data but as we can see from the orange it isnt very smooth at all. and the green data is not any better, so I need to restart from the very raw data and see what it looks like. that is what the current version does


[03-Apr-19 04:14 AM] jl777c#5810
I am hoping the orange becomes a lot more randomized, but the green to be somewhat smoothed


[03-Apr-19 04:15 AM] jl777c#5810
though thinking about it, the orange is actually not so bad considering the constraints it is under


[03-Apr-19 04:16 AM] TonyL#3577
Cleaned too much, still rebuilding


[03-Apr-19 04:21 AM] TonyL#3577
```  "blocks": 1049,
  "longestchain": 0,
  "timeoffset": 0,
  "tiptime": 1554288626,
  "connections": 3,
```
Is 1049 latest block atm ?


[03-Apr-19 04:22 AM] TonyL#3577
```ht.1050 i.4/55 17462 vs 0 -> newprice.17287 out of tolerance maxflag.-2
4970.4467 3770.5610 4418.9408 1.7462 1.4771 3.6258 65.3700 1.3320 52.4160 0.9995 1.4122 111.3660 5.5483 7.8498 4.0816 6.6337 22.9937 14220.0000 6.6648 8.6111 287.2142 0.7678 19.1046 31.7500 122.4107 14.1300 3.8604 1.3551 3.8350 68.7531 1136.3839 4.2516 6.7200 9.3230 0.8928 2.5150 337.2600 164.7800 527.3200 140.7600 0.7231 263.8394 0.1482 146.0200 6.3080 0.1202 4.1170 48.1461 0.1455 0.8770 0.0027 0.9980 0.3171 2.3230  oldprices.1050
4973.9700 3776.3624 4423.0780 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000  newprices.1050
vs prev maxflag.0 cmp error
saplinght.61 tipht.1049 blockht.1050 cmp.1
ht.1051: lag.702 4971.7683 USD, 3774.6908 GBP, 4421.1201 EUR, GBPUSD 1.317133, EURUSD 1.124549, EURGBP 0.853786 [185]
couldnt get pricebits for 1050
saplinght.61 tipht.1049 blockht.1051 cmp.1
```


[03-Apr-19 04:23 AM] TonyL#3577
Tried few restarts - not helped @jl777c


[03-Apr-19 04:23 AM] TonyL#3577
0.0000 looks suspicious


[03-Apr-19 04:26 AM] jl777c#5810
oh, sorry I removed too much code


[03-Apr-19 04:26 AM] jl777c#5810
updating FSM

{Reactions}
üëç 

[03-Apr-19 04:28 AM] jl777c#5810
fixed and updated FSM


[03-Apr-19 04:29 AM] TonyL#3577
Ok, switching to FSM


[03-Apr-19 04:51 AM] jl777c#5810
once the algo is settled, all three prices for each block will stay the same, but with the change all the prices changed


[03-Apr-19 04:56 AM] TonyL#3577
@jl777c updated http://kmd.money:8050/


[03-Apr-19 04:58 AM] SHossain#0007
not loading for me


[03-Apr-19 04:58 AM] TonyL#3577
green line looks more like the truth now


[03-Apr-19 04:58 AM] TonyL#3577
Hmm I wonder DNS not propogated everywhere yet


[03-Apr-19 04:58 AM] SHossain#0007
ah...just did


[03-Apr-19 04:58 AM] TonyL#3577
http://159.69.45.70:8050 should work


[03-Apr-19 04:59 AM] SHossain#0007
yes


[03-Apr-19 04:59 AM] SHossain#0007

{Attachments}
https://cdn.discordapp.com/attachments/560714286369079299/562969356103843852/Screenshot_from_2019-04-03_12-59-00.png


[03-Apr-19 05:02 AM] SHossain#0007
the green line is better


[03-Apr-19 07:43 AM] jl777c#5810
yes, it is immune from minority of attackers continuously messing with prices and the one day delay will provide for relatively smooth portfolio results


[03-Apr-19 06:15 PM] TonyL#3577
Website isn't static now. If there is any new information from prices call - updating graphs on page refresh in browser or pairs switch


[03-Apr-19 09:44 PM] TonyL#3577
Graph updating fine since changed - so assume it's working fine


[03-Apr-19 11:20 PM] jl777c#5810
yes looks good


[07-Apr-19 05:40 AM] siu#3920
which branch is better to test this?


[07-Apr-19 05:40 AM] siu#3920
oh i see, FSM


[07-Apr-19 05:44 AM] SHossain#0007
you need to run the chain 3 times before it starts completely. so, start the chain and stop it for 3 times


[07-Apr-19 05:56 AM] siu#3920
ok


[07-Apr-19 06:54 AM] jl777c#5810
actually PRICES chain is deprecated


[07-Apr-19 06:54 AM] jl777c#5810
REKT0 is the new chain

{Reactions}
üòÜ 

[07-Apr-19 08:19 AM] siu#3920
ahh, i knew something was not right, i had restarted it 4 times already and it still got stuck in block 340


[07-Apr-19 08:20 AM] siu#3920
so what are the parameters for REKTO?


[07-Apr-19 08:21 AM] jl777c#5810
update channel info


[07-Apr-19 08:27 AM] siu#3920
thanks


[07-Apr-19 08:28 AM] siu#3920
and this one needs to be restarted several times for it to run?


[07-Apr-19 08:31 AM] jl777c#5810
no, it should sync without problem


[07-Apr-19 08:35 AM] SHossain#0007
@siu forget my last message. i wasn't aware of this new chain.


[07-Apr-19 08:39 AM] siu#3920
no worries


[07-Apr-19 08:39 AM] siu#3920
i see some pricefeeds printing format like this: ```{
    "name": "ENJBTC",
    "prices": [
      [
        3.007e-05,
        2.99e-05,
        3.056e-05
      ]
```


[07-Apr-19 08:43 AM] jl777c#5810
are you using jq?


[07-Apr-19 08:50 AM] siu#3920
yes


[07-Apr-19 08:53 AM] jl777c#5810
plz ask jq why it does that


[12-Apr-19 04:24 AM] jl777c#5810
in recent days all my REKT0 nodes are staying in sync. I just caught an edge case  of an edge case that really only can happen if right during initial sync, you end up missing a price move. since you just started, there is no history to compare recent volatility. it detected this and refused to accept the block. then a few minutes later it was able to see a price that is close to what it rejected and it changed its mind. previously rejected is now accepted and it reached sync


[12-Apr-19 04:29 AM] jl777c#5810
to make this more of an edge case, that node was a mining node and it has gone on its own fork


[12-Apr-19 04:30 AM] jl777c#5810
it is actually 1 block ahead. but it lost all its peers


[12-Apr-19 04:44 AM] jl777c#5810
but now the chain is on some small forks, it should resolve when the nodes propagate the blocks. investigating

{Reactions}
üëå 

[12-Apr-19 01:25 PM] jl777c#5810
added some edge case handling code, the chain is back to being in sync mining on 7 nodes on a 10 node network now


[12-Apr-19 01:26 PM] jl777c#5810
also added -ac_stocks= to the commandline that allows to add any stock supported by iex https://api.iextrading.com/1.0/tops/last?symbols=SNAP,fb,AIG
it is quite a large list, seems basically any major stock will be supported.


[13-Apr-19 03:30 AM] grewalsatinder#9653
which branch should I compile to test price CC ?


[13-Apr-19 03:31 AM] grewalsatinder#9653
also, has anybody tested it on mac?


[13-Apr-19 03:33 AM] jl777c#5810
jl777 branch


[13-Apr-19 03:33 AM] jl777c#5810
though FSM is pretty recent and should work too


[13-Apr-19 03:34 AM] grewalsatinder#9653
cool üëç


[13-Apr-19 03:34 AM] grewalsatinder#9653
attempting to compile jl777 branch on mac


[13-Apr-19 03:34 AM] grewalsatinder#9653
I still think it will fail


[13-Apr-19 03:35 AM] grewalsatinder#9653
will build it on Linux vm too


[13-Apr-19 03:36 AM] grewalsatinder#9653
I see this CC's API isn't documented yet on developers portal


[13-Apr-19 03:45 AM] grewalsatinder#9653
yep, compile failed on mac as expected.


[13-Apr-19 03:45 AM] grewalsatinder#9653
will try on linux


[13-Apr-19 03:45 AM] jl777c#5810
how did it fail, i was able to build on osx


[13-Apr-19 03:57 AM] grewalsatinder#9653
may be then I missed a step in between ü§î 
do I need to execute anything before `./zcutil/build.sh -j$(nproc)` ?


[13-Apr-19 03:58 AM] grewalsatinder#9653
```/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/sys/ucred.h:94:2: error: '_Atomic' does not name a type
  _Atomic u_long          cr_ref;  /* reference count */
  ^~~~~~~
...failed gcc.compile.c++ bin.v2/libs/thread/build/gcc-darwin-6.5.0/release/link-static/threadapi-pthread/threading-multi/pthread/thread.o...
...skipped <pbin.v2/libs/thread/build/gcc-darwin-6.5.0/release/link-static/threadapi-pthread/threading-multi>libboost_thread.a(clean) for lack of <pbin.v2/libs/thread/build/gcc-darwin-6.5.0/release/link-static/threadapi-pthread/threading-multi>pthread/thread.o...
...skipped <pbin.v2/libs/thread/build/gcc-darwin-6.5.0/release/link-static/threadapi-pthread/threading-multi>libboost_thread.a for lack of <pbin.v2/libs/thread/build/gcc-darwin-6.5.0/release/link-static/threadapi-pthread/threading-multi>pthread/thread.o...
...skipped <pstage/lib>libboost_thread.a for lack of <pbin.v2/libs/thread/build/gcc-darwin-6.5.0/release/link-static/threadapi-pthread/threading-multi>libboost_thread.a...
...failed updating 2 targets...
...skipped 6 targets...
...updated 114 targets...
make: *** [/Users/satinder/jl777/komodo/depends/work/build/x86_64-apple-darwin18.5.0/boost/1_66_0-191550d0b34/./.stamp_built] Error 1
SatindeldenBook:komodo satinder$ ```


[13-Apr-19 03:58 AM] grewalsatinder#9653
gonna give another try


[13-Apr-19 04:08 AM] jl777c#5810
maybe it is better to use the build-mac.sh script?


[13-Apr-19 04:08 AM] grewalsatinder#9653
tried that, same result. attempting fresh build


[13-Apr-19 04:09 AM] jl777c#5810
make clean


[13-Apr-19 04:09 AM] jl777c#5810
build-mac.sh


[13-Apr-19 04:09 AM] jl777c#5810
worked for m


[13-Apr-19 04:09 AM] jl777c#5810
me


[13-Apr-19 04:10 AM] grewalsatinder#9653
nice! thanks for confirmed working steps. hope mine works too


[13-Apr-19 04:33 AM] grewalsatinder#9653
@jl777c can you please tell me what gcc/g++ version you are using?


[13-Apr-19 04:36 AM] grewalsatinder#9653
I have g++-6, and it's giving me this error:
```/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/sys/ucred.h:94:2: error: '_Atomic' does not name a type
  _Atomic u_long          cr_ref;  /* reference count */
  ^~~~~~~
```


[13-Apr-19 04:36 AM] grewalsatinder#9653
trying to solve it now


[13-Apr-19 04:37 AM] jl777c#5810
it says LLVM version 9


[13-Apr-19 04:37 AM] jl777c#5810
not sure it matches the gcc version


[13-Apr-19 07:10 AM] siu#3920
@jl777c so prices is a whole chain in itself? Meaning,  there could be specific data feed chains instead of specific data oracles wkthin a xhain?


[13-Apr-19 07:12 AM] jl777c#5810
yes, it goes into the coinbase opreturn


[13-Apr-19 07:13 AM] jl777c#5810
so you could make a cluster of price chains and cover thousands of pricefeeds and then use SPV servers to get the data


[13-Apr-19 08:01 AM] siu#3920
üëÄ üëÄ


[13-Apr-19 08:03 AM] jl777c#5810
with iex support, all their supported stocks can get a trustless oracle


[13-Apr-19 11:47 PM] TonyL#3577
No crashes of my node so far after last update


[14-Apr-19 12:35 AM] jl777c#5810
more importantly it seems all nodes are still in sync

{Reactions}
üëç 

[14-Apr-19 10:06 PM] Mylo#8306
just ran `./makeprices`
```
root@prices:~/komodo/src/cc# ./makeprices 
pricescc.so
In file included from ../wallet/walletdb.h:25:0,
                 from ../cc/../wallet/wallet.h:38,
                 from ../cc/CCinclude.h:48,
                 from cclib.cpp:24:
../wallet/db.h:36:10: fatal error: db_cxx.h: No such file or directory
 #include <db_cxx.h>
          ^~~~~~~~~~
compilation terminated.

```

{Reactions}
üòÇ 

[14-Apr-19 10:06 PM] Mylo#8306
missing dependency, what is db_cxx?


[14-Apr-19 10:07 PM] Mylo#8306
db4?


[14-Apr-19 10:07 PM] Mylo#8306
fresh machine btw


[14-Apr-19 10:17 PM] TonyL#3577
@Mylo BerkleyDB is needed I wonder


[14-Apr-19 10:17 PM] TonyL#3577
Try to install some libdb package, like a  `libdb4.8++-dev`


[14-Apr-19 10:21 PM] Deleted User#0000
tyhe fix for that is to hardcode the path to that file.


[14-Apr-19 10:22 PM] Deleted User#0000
its alkready ther


[14-Apr-19 10:22 PM] Deleted User#0000
but the make file cant see it... Ive hard coded that and reverted it about 100 times in LABS to fix compile issues over the last few months


[14-Apr-19 10:34 PM] Mylo#8306
thanks & thanks


[14-Apr-19 10:47 PM] jl777c#5810
makeprices is not needed for the REKT0 chain, it is using coinbase and built in CC


[14-Apr-19 11:02 PM] Mylo#8306
ok thanks, i'll ask REKT0 questions in #cc-pegs later this afternoon, have to go out for a few hours soon.


[14-Apr-19 11:03 PM] jl777c#5810
REKT0 is the trustless oracle chain


[14-Apr-19 11:03 PM] jl777c#5810
cc-pegs is a usecase of REKT0


[14-Apr-19 11:03 PM] jl777c#5810
ask REKT0 questions here

{Reactions}
üëå 

[18-Apr-19 10:37 AM] Alright#0419
https://github.com/jl777/komodo/blob/4096d8edf2f430cfa42c129f6e03e0cbe9cbd31f/src/komodo_gateway.h#L1622

Is this vital for syncing? Should it not sync a block if it prints this for that block?

{Embed}
https://github.com/jl777/komodo/blob/4096d8edf2f430cfa42c129f6e03e0cbe9cbd31f/src/komodo_gateway.h
jl777/komodo
Komodo. Contribute to jl777/komodo development by creating an account on GitHub.
https://images-ext-1.discordapp.net/external/ZluS_vPUp--Ma1oFnNdhU0YaB0OEwzwGFNPA2N_uSAk/%3Fs%3D400%26v%3D4/https/avatars2.githubusercontent.com/u/5962559


[18-Apr-19 10:37 AM] Alright#0419
can't figure out the difference here between my two nodes


[18-Apr-19 10:37 AM] Alright#0419
is there price CC specific dependencies?


[18-Apr-19 10:37 AM] Alright#0419
Now it syncs üò´


[18-Apr-19 10:38 AM] Alright#0419
didn't change anything, just had to delete data dir 3 times and kept trying to resync from scratch


[18-Apr-19 10:45 AM] jl777c#5810
yes that is critical


[18-Apr-19 11:13 AM] Alright#0419
I can't seem to reproduce that not syncing issue, but it seemed to get a couple blocks past that then fail


[18-Apr-19 11:13 AM] Alright#0419
really didn't change anything, just kept deleting data dir and resyncing


[18-Apr-19 11:14 AM] Alright#0419
now can't get the errors to happen again


[18-Apr-19 11:18 AM] jl777c#5810
it could be HDD issues. where the block data is made available before it is all there


[18-Apr-19 11:48 AM] TonyL#3577
Could somebody please send some `REKT0` to `RG7p5MCbGK72jkDrVJBzEufPfNBRJZuawY` ?


[18-Apr-19 11:50 AM] jl777c#5810
sent a few

{Reactions}
üôå 

[18-Apr-19 11:52 AM] TonyL#3577
Really "a few" üòÇ


[18-Apr-19 12:12 PM] TonyL#3577
```./komodo-cli -ac_name=REKT0 pricesbet 100 100 "BTC_USD, 1"
{
  "hex": "0400008085202f8901d776711c095f4f3e043168f91c8eb1365b27a99e69684627c757b72853391a1c010000006b483045022100f7148da33e458546aeb0575a15c537d397979b76de38bcb1bd1331dbaaf7e9c202203be92d4b2cf6953e17ec2a5c8765b6326330da99fbde1f3c006d8e96b999c01c01210378f914fd9c9437a807769733c5a30d0454c9215a5fe28d0d9970c9cc92d5c121ffffffff061027000000000000302ea22c802055224048096b3f022f37f918f8993ddce4149721235635ebd212a896fbf5146e8103120c008203000401cc214e000000000000302ea22c80203ee64ec5f134da404710d306dcd9ca54a0139b3c4827b43a988fc6316e6c2a688103120c008203000401cc6300000000000000302ea22c80203ee64ec5f134da404710d306dcd9ca54a0139b3c4827b43a988fc6316e6c2a688103120c008203000401cc10270000000000002321039894cb054c0032e99e65e715b03799607aa91212a16648d391b6fa2cc52ed0cfac4c7c7910f35a000023210378f914fd9c9437a807769733c5a30d0454c9215a5fe28d0d9970c9cc92d5c121ac0000000000000000626a4c5fed42210378f914fd9c9437a807769733c5a30d0454c9215a5fe28d0d9970c9cc92d5c121d608000064000000000000006400a0ead6467a0000000201000108000000000000000000000000000000000000000000000000000000000000000000000000eb0800000000000000000000000000",
  "txid": "ede2d5157de56ffca0d398e1752665a7e3f346a38e87c637ae58e71615cd83be",
  "result": "success"
}
```
Opened first long position.
Just realised that amount describing in satoshis
```./komodo-cli -ac_name=REKT0 pricesinfo ede2d5157de56ffca0d398e1752665a7e3f346a38e87c637ae58e71615cd83be
{
  "rekt": 0,
  "batontxid": "ede2d5157de56ffca0d398e1752665a7e3f346a38e87c637ae58e71615cd83be",
  "profits": 0.00000100,
  "costbasis": 0.00000000,
  "positionsize": 0.00000100,
  "addedbets": 0.00000000,
  "leverage": 100,
  "firstheight": 2262,
  "firstprice": 5251.74500000,
  "height": 2262
}
```


[18-Apr-19 12:13 PM] jl777c#5810
this is not right. costbasis should never be 0


[18-Apr-19 12:13 PM] jl777c#5810
also what was the initial bet ,it isnt listed


[18-Apr-19 12:14 PM] jl777c#5810
the amount should be in coins


[18-Apr-19 12:14 PM] jl777c#5810
and it should display current price so we can see how it is calculating profits


[18-Apr-19 12:16 PM] TonyL#3577
`also what was the initial bet ,it isnt listed`

I wonder initial bet is possible to calculate as `  "positionsize": 0.00000100,` minus `  "addedbets": 0.00000000,`


[18-Apr-19 12:18 PM] TonyL#3577
Opened bigger position (as `./komodo-cli -ac_name=REKT0 pricesbet 1000000000 100 "BTC_USD, 1"` - so amount is definetly in satoshies atm) :
```./komodo-cli -ac_name=REKT0 pricesinfo 2ee89156dfbf0fd2815cecb682368bf46908287f7b5422f9922e287f23e5c245
{
  "rekt": 0,
  "batontxid": "2ee89156dfbf0fd2815cecb682368bf46908287f7b5422f9922e287f23e5c245",
  "profits": 10.00000000,
  "costbasis": 0.00000000,
  "positionsize": 10.00000000,
  "addedbets": 0.00000000,
  "leverage": 100,
  "firstheight": 2263,
  "firstprice": 5248.68830000,
  "height": 2263
}
```
Still `costbasis` is 0 and I can't see the price on which I'll rekt. But from good news - `firstprice` moved


[18-Apr-19 12:26 PM] jl777c#5810
of positionsize is the initial bet!


[18-Apr-19 12:26 PM] jl777c#5810
the profits is due to the leverage


[18-Apr-19 12:26 PM] jl777c#5810
and the costbasis is broken. it should never be 0, it should be the maxprice of first 24hrs


[18-Apr-19 12:27 PM] TonyL#3577
`  "profits": 10.00000000,` - not sure why it's same as positionsize, maybe just not counting at all atm üòÉ


[18-Apr-19 12:28 PM] TonyL#3577
`of positionsize is the initial bet!` position size is initial bet + all pricesaddfunding as I understand


[18-Apr-19 12:29 PM] TonyL#3577
`"addedbets": 0.00000000, `  is sum of all `pricesaddfunding`


[18-Apr-19 12:29 PM] jl777c#5810
no


[18-Apr-19 12:29 PM] jl777c#5810
initial bet determines the position size


[18-Apr-19 12:29 PM] jl777c#5810
the costbasis should be the 5248.68830000 not 0


[18-Apr-19 12:30 PM] jl777c#5810
it basically says that if BTC was 0 when you bought it and you bet 10, you have profits of 10


[18-Apr-19 12:30 PM] TonyL#3577
Ah, so added funding just should change my leverage


[18-Apr-19 12:30 PM] TonyL#3577
Same as on bitmex


[18-Apr-19 12:30 PM] jl777c#5810
but even that is wrong as you have 100x leverage, so you should be up 1000 if cost was 0


[18-Apr-19 12:30 PM] jl777c#5810
added funding gives you more protection from being rekt


[18-Apr-19 12:31 PM] TonyL#3577
Yes, my rektprice is moving by morefunding and leverage actually decreasing


[18-Apr-19 12:31 PM] jl777c#5810
with 100x leverage a 1% drop will wipeout the bet


[18-Apr-19 12:31 PM] TonyL#3577
Yup


[18-Apr-19 12:31 PM] jl777c#5810
but the leverage is fixed


[18-Apr-19 12:32 PM] jl777c#5810
the total amount just prevents you from being rekt


[18-Apr-19 12:32 PM] jl777c#5810
if there is enough


[18-Apr-19 12:32 PM] jl777c#5810
so if the price goes down by 0.9%, then you have a loss of 9


[18-Apr-19 12:32 PM] jl777c#5810
0.1% more and you are rekt (maybe we put a bit of cushion there so 0.05% more and you are rekt)


[18-Apr-19 12:33 PM] jl777c#5810
but if you add another 10, then you can avoid being rekt for another 1% drop


[18-Apr-19 12:34 PM] jl777c#5810
so the bugs so far are costbasis is 0, leverage not used when calculating profits, bet amount is in satoshis instead of coins


[18-Apr-19 12:36 PM] TonyL#3577
Yup


[18-Apr-19 12:39 PM] TonyL#3577
Hmm are `leverage 0` and `leverage 1` should be something different? 
Other words: am I understan correct that with leverage 0 I should be able to open position without leverage and 1 is leverage which doubling my bet?


[18-Apr-19 12:40 PM] jl777c#5810
no


[18-Apr-19 12:40 PM] TonyL#3577
Just thought that leverage starts to count from `2` but was able to open position with `0` leverage so confused


[18-Apr-19 12:40 PM] jl777c#5810
leverage 0 should not be allowed


[18-Apr-19 12:40 PM] TonyL#3577
```/komodo-cli -ac_name=REKT0 pricesinfo 48194bab8d377a7fa0e62d5e908474dae906675395753f09969d4c4bea4a7518
{
  "rekt": 0,
  "batontxid": "48194bab8d377a7fa0e62d5e908474dae906675395753f09969d4c4bea4a7518",
  "profits": 10.00000000,
  "costbasis": 0.00000000,
  "positionsize": 10.00000000,
  "addedbets": 0.00000000,
  "leverage": 0,
  "firstheight": 2264,
  "firstprice": 5243.83219931,
  "height": 2264
}
```


[18-Apr-19 12:40 PM] TonyL#3577
Aha, so one more


[18-Apr-19 12:40 PM] jl777c#5810
the profit formula is leverage * profit


[18-Apr-19 12:40 PM] jl777c#5810
so if leverage is 0 you wont ever have profits


[18-Apr-19 12:41 PM] TonyL#3577
Yes, 1 should be without leverage and from 2 starting leverage, thats what I thought


[18-Apr-19 12:41 PM] jl777c#5810
profit calc is based on percentage difference between current price and costbasis


[18-Apr-19 12:44 PM] TonyL#3577
Updated list :)
so the bugs so far are: `costbasis is 0, leverage not used when calculating profits, bet amount is in satoshis instead of coins, possible to create position with 0 leverage`


[18-Apr-19 12:44 PM] TonyL#3577
Ah, and current price not displaying


[18-Apr-19 12:45 PM] dimxy#2587
there is a check for leverage in the code, mayb it does nt cover 0


[18-Apr-19 12:47 PM] dimxy#2587
about costbasis 
my understanding was that we can set costbasis after 24h when smoothed value might be calculated
was not sure what to set  to it before 24h
plus I now do not allow set costbasis before 24h pased from the bet height


[18-Apr-19 12:47 PM] jl777c#5810
not the permanent costbasis, but the temporary one


[18-Apr-19 12:48 PM] jl777c#5810
we need to be able to see the profit calculations before 24hrs


[18-Apr-19 12:48 PM] jl777c#5810
so the costbasis is always updated each block,until it is made permanent with a costbasis tx


[18-Apr-19 12:49 PM] dimxy#2587
probably we need to output that its permanent or not?


[18-Apr-19 12:54 PM] jl777c#5810
yes


[18-Apr-19 12:54 PM] jl777c#5810
can list the costbasis txid if it has one


[18-Apr-19 12:54 PM] jl777c#5810
so if it doesnt, then it is temp

{Reactions}
üëå 

[18-Apr-19 12:54 PM] jl777c#5810
i think it will be exciting to see the profit calc change each block

{Reactions}
üíØ 

[18-Apr-19 12:55 PM] TonyL#3577
Or rekt üòÇ


[18-Apr-19 12:55 PM] dimxy#2587
about value formatting: 
we usually output coins in coins and tokens in satoshis. Here we re working with coins, maybe thats why satoshi were converted to coins?


[18-Apr-19 12:56 PM] jl777c#5810
the number was not converted to coins


[18-Apr-19 12:56 PM] jl777c#5810
100 bet became 0.00000010


[18-Apr-19 12:56 PM] jl777c#5810
instead of 100.0


[18-Apr-19 12:56 PM] jl777c#5810
oh, and we also need to add betting with tokens


[18-Apr-19 12:56 PM] TonyL#3577
```./komodo-cli -ac_name=REKT0 pricesbet 1000000000 100 "BTC_USD, 1"```
creating position with `  "positionsize": 10.00000000,`


[18-Apr-19 12:57 PM] jl777c#5810
so an optional parameter or different rpc for token betting


[18-Apr-19 12:57 PM] jl777c#5810
./komodo-cli -ac_name=REKT0 pricesbet 1000000000 100 "BTC_USD, 1" <tokenid>


[18-Apr-19 12:58 PM] jl777c#5810
that would bet a billion tokens


[18-Apr-19 12:59 PM] dimxy#2587
so probably better to accept  amount as coins not satoshis (for coins case)?


[18-Apr-19 01:00 PM] jl777c#5810
for coins in floating point, for tokens in satoshis


[18-Apr-19 01:00 PM] jl777c#5810
i think that makes sense


[18-Apr-19 01:00 PM] jl777c#5810
using one or two rpc calls


[18-Apr-19 01:49 PM] dimxy#2587
seems leverage  always deserialized as 0 from opreturn
no, it's deserialized okay


[18-Apr-19 03:24 PM] dimxy#2587
I changed profits calculations to double arithmetic. The existed variant caused overflow and loss of value.
updated the code in my repo

{Reactions}
üëå 

[18-Apr-19 03:33 PM] TonyL#3577
Updating


[18-Apr-19 04:59 PM] TonyL#3577
Looks better now:
```{
  "rekt": 0,
  "batontxid": "5eb325f7db5c4a65a943470fe757c9316bbfa32f3c29a2b49d549c074619e422",
  "profits": 100.00000000,
  "costbasis": 5302.05820000,
  "positionsize": 100.00000000,
  "addedbets": 0.00000000,
  "leverage": 1,
  "firstheight": 2292,
  "firstprice": 5302.05820000,
  "height": 2292
}
```


[18-Apr-19 05:00 PM] TonyL#3577
And getting error on 0 leverage attempt:
```./komodo-cli -ac_name=REKT0 pricesbet 100 0 "BTC_USD, 1"
error code: -1
error message:
invalid leverage
```


[18-Apr-19 11:02 PM] jl777c#5810
@dimxy, for display doubles is fine, but in consensus code it is non-deterministic so uint64_t will need to be used


[18-Apr-19 11:03 PM] jl777c#5810
what part of the equation overflowed and what is the current price that leads to profits of 100? that is 100% profit


[18-Apr-19 11:03 PM] jl777c#5810
did you not subtract 1 from the currentprice/costbasis ?


[18-Apr-19 11:05 PM] dimxy#2587
this expression seems overflows when price=526272990000
((price * SATOSHIDEN) / costbasis) - SATOSHIDEN


[18-Apr-19 11:06 PM] dimxy#2587
for the second, actually now it calculates not profits/loss but closing price:
 return(positionsize + addedbets + profits);


[18-Apr-19 11:07 PM] dimxy#2587
we might return just profits instead


[18-Apr-19 11:08 PM] jl777c#5810
"profits" should be just the profits


[18-Apr-19 11:08 PM] jl777c#5810
return(positionsize + addedbets + profits);
that would be "equity"


[18-Apr-19 11:08 PM] jl777c#5810
and the current price needs to be in the JSON


[18-Apr-19 11:11 PM] jl777c#5810
((price * SATOSHIDEN) / costbasis) - SATOSHIDEN ->

(((price/10000) * SATOSHIDEN) / (costbasis/10000)) - SATOSHIDEN


[18-Apr-19 11:11 PM] jl777c#5810
and actually instead of using 10000, use komodo_pricemult(ind)

{Reactions}
üëç 

[18-Apr-19 11:12 PM] jl777c#5810
the komodo_pricemult() is what to multiply the 32bit price to an 8 decimals satoshis based number

{Reactions}
üëå 

[18-Apr-19 11:13 PM] jl777c#5810
for BTC/USD it only has 4 decimals precision, so it is multiplied by 10000


[18-Apr-19 11:13 PM] jl777c#5810
for crypto prices it is already at 8 decimals precision, so multiplied by 1


[18-Apr-19 11:13 PM] jl777c#5810
for forex currencies it is in 2 decimals, so multiplied by 1000000


[18-Apr-19 11:14 PM] jl777c#5810
by reversing this scaling, it should always end up with something that fits in a uint32_t and that wont ever overflow


[18-Apr-19 11:14 PM] jl777c#5810
i think around 4000.0000 it overflows the 64 bits when multiplied by 100 mil


[18-Apr-19 11:17 PM] dimxy#2587
yes 526272990000* 100,000,000 =  52 604 650 000 000 000 000   
and max int64                                           =         9 223 372 036 854 770 000


[18-Apr-19 11:17 PM] jl777c#5810
by dividing by 10000 we should be good for at least a few years before BTC price overflow


[18-Apr-19 11:18 PM] dimxy#2587
ok


[18-Apr-19 11:20 PM] dimxy#2587
Another issue might be with temp costbasis value:
actually how I calculate it now, it appears equal to firstprice value


[18-Apr-19 11:26 PM] jl777c#5810
for long position, maximum price since the position was opened


[18-Apr-19 11:26 PM] jl777c#5810
for short position, minimum price

{Reactions}
üëå 

[18-Apr-19 11:30 PM] jl777c#5810
if the price is continuing to go up, the the costbasis will be too and the profit is 0. this prevents using future knowlege of the 24 hr delay to gain instant profit


[18-Apr-19 11:34 PM] dimxy#2587
yes seems now I got this:
while we do not reach 24h for the proper costbasis calculation we should use max/min just for the available period < 24h


[18-Apr-19 11:35 PM] jl777c#5810
yes and the real cost basis is the last value at DAYWINDOW after the position is opened


[18-Apr-19 11:36 PM] jl777c#5810
regardless of when the costbasis tx is issued. so once it is DAYWINDOW, then the cost basis doesnt change


[18-Apr-19 11:36 PM] jl777c#5810
but still during the first day, high leverage positions are watched very carefully and maybe more funds added


[18-Apr-19 11:37 PM] jl777c#5810
which is good for the system as this is opposite of proper trading. you cut your losses short and ride your winners. but this looking at changing costbasis and equity, people cant help but put more money into losing positions


[18-Apr-19 11:39 PM] jl777c#5810
we do need to have actual traders use the system to see how things work at high margin, especially how much bankroll is needed.


[18-Apr-19 11:40 PM] jl777c#5810
in case there isnt enough funds, i think we just socialize things and prorate the payouts by the total equity in the system


[18-Apr-19 11:41 PM] jl777c#5810
we also need ways for equity to be able to be injected into the system, probably via some otherwise illegal synthetic "DONATION"


[18-Apr-19 11:41 PM] jl777c#5810
so many unspecified details to fill in to make a working system


[18-Apr-19 11:41 PM] jl777c#5810
but before getting sucked into all this, the pull request for the assets crosschain is needed


[18-Apr-19 11:42 PM] dimxy#2587
BTW for this kind of costbasis calculation I think we always would report zero or losses for time<24?
as costbasis always >= price for long and backwards for shorts


[18-Apr-19 11:46 PM] dimxy#2587
(for assets migration there is a tasks to do: get to a unified burn tx and import tx structure with coda and gateways import as those tx are shared)


[18-Apr-19 11:53 PM] jl777c#5810
but what if the price drops?


[18-Apr-19 11:53 PM] jl777c#5810
oh, yes, 0 profits or losses


[18-Apr-19 11:54 PM] jl777c#5810
that is fine, after all the first hours of the 24hr delay can be easily predicted as the history that will be used is already known


[18-Apr-19 11:54 PM] jl777c#5810
the best traders will start the 24hrs with a 0 loss position


[18-Apr-19 11:55 PM] jl777c#5810
lets get tony what he needs to make progress and you can finish the PR


[18-Apr-19 11:55 PM] jl777c#5810
other PR are waiting for your PR to be done first

{Reactions}
üëå 

[19-Apr-19 01:30 AM] dimxy#2587
I use komodo_getprice to get  correlated and smoothed price (and take them in [1] and [2] offsets of returned buffer)
I see it returns values with the lowest 4 digits filled with non-zero:
  "lastprice": 5262.82240206,


[19-Apr-19 01:30 AM] dimxy#2587
"lastprice": 5262.86241241,


[19-Apr-19 01:40 AM] jl777c#5810
yes, only the smoothed price should be used for costbasis calcs


[19-Apr-19 01:41 AM] jl777c#5810
it does get some fractional data, but overflow is not a good thing so we need to sacrifice them, it is a bit of false precision anyway


[19-Apr-19 01:48 AM] dimxy#2587
oh yes, it is from smoothed calculations


[19-Apr-19 01:49 AM] jl777c#5810
correlated shouldnt have any extra precision


[19-Apr-19 02:31 AM] jl777c#5810
@Mihailo @TonyL for REKT1 I want to make it a sidechain for BET, that will allow us to test it even without tokens betting support. Also it will test sidechains with real money at stake. I am hoping to integrate the snapshot payments CC -ac_script so the fees are blockchain enforced to go to coin hodlers, but i guess it is only for the BET that is deposited and converted to REKT1


[19-Apr-19 02:33 AM] jl777c#5810
so REKT1 will be combined testing of sidechain gateways CC, prices CC and snapshot payments CC and will create what i think is one of the first fully automated money making system that distributes automatically to the stakeholders


[19-Apr-19 02:40 AM] Mihailo#5902
@jl777c What should be the setup for side chains, we talked that there should be minimal funds on side chain and minimal mining reward so that it does not influence the number of coins?


[19-Apr-19 02:43 AM] jl777c#5810
yes, -ac_end=1 would be required, if not set then it should abort at startup


[19-Apr-19 02:43 AM] jl777c#5810
-ac_supply must also be 0


[19-Apr-19 02:44 AM] jl777c#5810
it also needs -earlytxid so if that is not set, also startshutdown


[19-Apr-19 02:45 AM] Mihailo#5902
Ok, didn't know about -ac_end...


[19-Apr-19 02:45 AM] jl777c#5810
there will be a small number of coins generated still due to magic calcs for testing and issuing the initial tx


[19-Apr-19 02:46 AM] Mihailo#5902
Yes, we need some coins for initial bind tx. But don't forget also for oracle publishers!


[19-Apr-19 02:46 AM] jl777c#5810
i heard it said that there are a "ridiculous number of -ac options"


[19-Apr-19 02:46 AM] jl777c#5810
yes, i think around 10 coins will be issued


[19-Apr-19 02:46 AM] Mihailo#5902
Well, now when I look komodo_globals.h, maybe it is true üòÑ


[19-Apr-19 02:46 AM] jl777c#5810
which wont be any issue for any chain other than BTC


[19-Apr-19 02:47 AM] Mihailo#5902
So what does ac_end do?


[19-Apr-19 02:47 AM] jl777c#5810
for such chains, we just need to rely on chain creator to burn any excess after all is in place, though having to pay 0,0001 BTC per tx changes the "tx are basically free" concept


[19-Apr-19 02:47 AM] jl777c#5810
ac_end stops mining rewards at that height


[19-Apr-19 02:47 AM] Mihailo#5902
Aha


[19-Apr-19 02:47 AM] Mihailo#5902
So where does the txfee go?


[19-Apr-19 02:47 AM] jl777c#5810
miners


[19-Apr-19 02:48 AM] Mihailo#5902
To the miners, they have just txfee?


[19-Apr-19 02:48 AM] jl777c#5810
yes


[19-Apr-19 02:48 AM] Mihailo#5902
Ok


[19-Apr-19 02:48 AM] jl777c#5810
which for BTC sidechain might actually get some decent hashrate


[19-Apr-19 02:48 AM] jl777c#5810
50 cents per tx...


[19-Apr-19 02:48 AM] Mihailo#5902
So when everything is set, the oraclepublishers should never get out of funds. They will be miners and publishers?


[19-Apr-19 02:49 AM] Mihailo#5902
Or if there are other miners, then they can get out of funds?


[19-Apr-19 02:49 AM] jl777c#5810
yes its true


[19-Apr-19 02:49 AM] jl777c#5810
i guess a BTC sidechain might need some special rules


[19-Apr-19 02:49 AM] jl777c#5810
lets not do it!


[19-Apr-19 02:50 AM] jl777c#5810
BTC would be via token only, then none of it is lost to txfees


[19-Apr-19 02:50 AM] jl777c#5810
KMD sidechain, is ok as chain creator can just fund the oracles with enough KMD to pay for the txfees


[19-Apr-19 02:50 AM] jl777c#5810
0.1 KMD per day?


[19-Apr-19 02:50 AM] Mihailo#5902
Depending on how much publishers there is.


[19-Apr-19 02:50 AM] jl777c#5810
oh, we would want to collect the rewards from the deposits


[19-Apr-19 02:51 AM] jl777c#5810
so that is some additional oraclefeed thing to do later. consolidating utxo and collecting rewards


[19-Apr-19 02:51 AM] jl777c#5810
the former useful for all gateways


[19-Apr-19 02:52 AM] Mihailo#5902
In case of lets say 10 publishers. 1440*10ksat * 10 publishers= 1.4 KMD per day if my calc is right


[19-Apr-19 02:53 AM] Mihailo#5902
0.14 per publisher per day


[19-Apr-19 02:53 AM] jl777c#5810
we dont need all to be publishing every block


[19-Apr-19 02:53 AM] Mihailo#5902
we need at least n/2 to have publishing


[19-Apr-19 02:54 AM] Mihailo#5902
But to be sure it is working it must be more (if some is down)


[19-Apr-19 02:54 AM] jl777c#5810
i guess it is a cost we need to pay. 500 KMD per year


[19-Apr-19 02:54 AM] jl777c#5810
so if 100,000 is deposited, it will be from rewards. ok, that works assuming we can collecte the msig rewards


[19-Apr-19 02:55 AM] Mihailo#5902
The msig should basically pay it self, the marker for msig is spent on last markdonetx for tx fee.


[19-Apr-19 02:56 AM] Mihailo#5902
On withdraw it is created and spent in every sign tx and then spent for txfee in markdone.


[19-Apr-19 02:58 AM] Mihailo#5902
Deposit tx in case of sidechains does not have any markers and txfee either as it is import tx.


[19-Apr-19 02:59 AM] Mihailo#5902
So it is selfcontained system. The only cost is the tx fee of withdraw and msig signing.


[19-Apr-19 03:00 AM] jl777c#5810
oracles seems the main cost


[19-Apr-19 03:00 AM] jl777c#5810
maybe we make it so that the oracles tx on the sidechain are free?


[19-Apr-19 03:02 AM] Mihailo#5902
Yeah, that is the cost of maintaining the system


[19-Apr-19 03:02 AM] jl777c#5810
i think @blackjok8r made some free tx possible in the miners for notarization, but if ( KOMODO_SIDECHAIN != 0 && valid oracletx )


[19-Apr-19 03:03 AM] jl777c#5810
then the miners will mine oracle txid without txfee, or if some txfee is needed for the CC logic, some really small amount


[19-Apr-19 03:36 AM] Mihailo#5902
So to summarize ac params, beside ac_import, ac_end=1 and ac_supply=0 should be set, anything else that should exit the daemon if not set?


[19-Apr-19 03:39 AM] jl777c#5810
ac_perc needs to be 0 too


[19-Apr-19 03:40 AM] jl777c#5810
we need to test to make sure only txfees go to miners


[19-Apr-19 03:42 AM] Mihailo#5902
So the ac_perc should also be added to shutdown condition or is already added somewhere?


[19-Apr-19 03:43 AM] jl777c#5810
should be added, there is no special detect for sidechain shutdown conditions, you are writing the first


[19-Apr-19 03:43 AM] jl777c#5810
the ac options setting is really not so complex, there are just so many of them

{Reactions}
üëç 

[19-Apr-19 03:48 AM] TonyL#3577
```./komodo-cli -ac_name=REKT0 pricesinfo 15e0df4e9a45cf202557e589d106056f8583926f4fa093d2f39bd67783953ef4
{
  "rekt": 0,
  "batontxid": "15e0df4e9a45cf202557e589d106056f8583926f4fa093d2f39bd67783953ef4",
  "profits": 0.00000000,
  "costbasis": 5263.45900000,
  "positionsize": 1.00000000,
  "equity": 1.00000000,
  "addedbets": 0.00000000,
  "leverage": 100,
  "firstheight": 2349,
  "firstprice": 5293.97990000,
  "lastprice": 5263.45900000,
  "height": 2350
}
```


[19-Apr-19 03:49 AM] jl777c#5810
costbasis print is wrong


[19-Apr-19 03:49 AM] TonyL#3577
From which moment `rekt` start to display and am I understand correct that it's a liquidation price?


[19-Apr-19 03:49 AM] jl777c#5810
costbasis has to be at least 5293.97990000 as that was the open price


[19-Apr-19 03:50 AM] jl777c#5810
so there is at least a 5263.45900000/5293.97990000 - 1 percentage loss


[19-Apr-19 03:51 AM] jl777c#5810
-0.5765208893219 % loss but at 100x leverage that is 57.6% loss of equity


[19-Apr-19 03:51 AM] jl777c#5810
rekt would be if you go below 10% of (positionsize + addedbets)


[19-Apr-19 03:52 AM] TonyL#3577
`  "profits": 0.00000000,`  should be profits kinda -57.6 on this point?


[19-Apr-19 03:52 AM] jl777c#5810
-0.576 of 1


[19-Apr-19 03:52 AM] TonyL#3577
Oh this bet is 1 yes, thought it's 100


[19-Apr-19 03:53 AM] TonyL#3577
`rekt would be if you go below 10% of (positionsize + addedbets)` yup, but it's definetly not 0


[19-Apr-19 03:53 AM] jl777c#5810
my code had it at 0, but with the chance to add funds, it seems better to add some buffer zone to rekt positions even with some profit so we boost the blockchain bankroll


[19-Apr-19 03:54 AM] jl777c#5810
if you lose 90%, basically it is rekt anyway


[19-Apr-19 03:54 AM] TonyL#3577
~50%  of positions with levarage for example 777 (any very high leverage) will be rekt in 1 block


[19-Apr-19 03:55 AM] TonyL#3577
Hmm my daemon hanged


[19-Apr-19 03:56 AM] jl777c#5810
we are planning to only allow rekt to happen after 24hours, so you can be panicking for a day


[19-Apr-19 03:57 AM] TonyL#3577
Ah, so technically I might be rekt in one minute but in fact position will be opened 24 hours?


[19-Apr-19 03:57 AM] jl777c#5810
not sure yet


[19-Apr-19 03:58 AM] jl777c#5810
it might give too much of an advantage


[19-Apr-19 03:58 AM] jl777c#5810
we might make it so that if a position is rekt after the costbasis is establishedm then it is rekt


[19-Apr-19 03:58 AM] TonyL#3577
Hmm, if you rekt - you rekt and position liquidated. Not sure if it can work diffent way


[19-Apr-19 03:58 AM] jl777c#5810
at 777x margin a 0.15% move in the wrong direction will wipe it out


[19-Apr-19 03:59 AM] jl777c#5810
yes, ok, @dimxy, make it so


[19-Apr-19 03:59 AM] TonyL#3577
Otherwise you can play with additionalfunding and never be rekt


[19-Apr-19 03:59 AM] jl777c#5810
if a position is rekt, even without costbasis tx, it can be rekt


[19-Apr-19 03:59 AM] TonyL#3577
Just need big pockets and mathematically correct risk managament and will win in 100% of cases I think (in case of 24h immune to rekt)


[19-Apr-19 04:04 AM] TonyL#3577
```root      5116  0.0  0.0   4628   880 pts/11   S    12:54   0:00 sh -c wget -q "https://api.binance.com/api/v1/ticker/price?symbol=LTCBTC" -O bnbprice``` this thing seems to hang


[19-Apr-19 04:05 AM] TonyL#3577
Or just not stopped correctly (my daemon hanged and I killed its process)


[19-Apr-19 04:07 AM] jl777c#5810
yes, what I proposed first did not have any thorough risk management analysis. i think once it comes together we can see how exactly it works and tweak things till it wont be bankruptable


[19-Apr-19 04:07 AM] jl777c#5810
with bitmex they charge a fee on the entire leveraged amount, so the max leverage cant be more than 100x


[19-Apr-19 04:07 AM] jl777c#5810
and they liquidate before it goes to 0 equity


[19-Apr-19 04:07 AM] jl777c#5810
i want to charge less, but still have it so the overall bankroll will be growing over time


[19-Apr-19 04:08 AM] jl777c#5810
just not needed to be 22,000 BTC in a year


[19-Apr-19 04:08 AM] TonyL#3577
BTC 2200 more probable that 22000 atm üòÉ


[19-Apr-19 04:10 AM] jl777c#5810
I mean the bitmex insurance fund that is funded by the rekt


[19-Apr-19 04:10 AM] jl777c#5810
that doesnt even count the trading fees


[19-Apr-19 04:11 AM] jl777c#5810
bitmex insurance fund up to 22000 BTC ,iguess in 3 years


[19-Apr-19 04:11 AM] TonyL#3577
Not sure why daemon hanged (it should be not deadlock because was no loading on CPU)
In logs have only socket connection error (not sure what produce it):
```2019-04-19 10:44:30 socket recv error Connection reset by peer (104)
2019-04-19 10:44:35 receive version message: /MagicBean:2.0.15rc2/: version 170007, blocks=2350, us=159.69.45.70:42217, peer=16
2019-04-19 10:46:29 connect() to 217.182.203.106:42217 failed after select(): Connection refused (111)
2019-04-19 10:49:43 socket recv error Connection reset by peer (104)
2019-04-19 10:50:32 connect() to 78.47.196.146:42217 failed after select(): Connection refused (111)
2019-04-19 10:50:39 connect() to 52.65.58.103:42217 failed after select(): Connection refused (111)
2019-04-19 10:51:01 connect() to 185.64.105.111:42217 failed after select(): No route to host (113)
2019-04-19 10:52:37 connect() to 178.128.25.203:42217 failed after select(): Connection refused (111)
2019-04-19 10:53:41 connect() to [2a04:2180:0:2::29]:42217 failed after select(): Permission denied (13)
2019-04-19 10:54:33 connect() to 139.99.121.200:42217 failed after select(): Connection refused (111)
2019-04-19 10:55:52 connect() to 159.65.134.48:42217 failed after select(): Connection refused (111)
2019-04-19 10:56:21 connect() to 95.213.238.98:42217 failed after select(): Connection refused (111)
2019-04-19 10:56:44 connect() to 217.182.203.106:42217 failed after select(): Connection refused (111)
```


[19-Apr-19 04:12 AM] jl777c#5810
the price feed code is being worked on, if it is occasional dont worry about it for now

{Reactions}
üëå 

[19-Apr-19 04:15 AM] TonyL#3577
So for now: 
`costbasis print is wrong`
`rekt price showing as 0`
`profits showing as 0`


[19-Apr-19 04:16 AM] TonyL#3577
Aha, found one more


[19-Apr-19 04:16 AM] jl777c#5810
seems costbasis calc is wrong


[19-Apr-19 04:17 AM] TonyL#3577
Tried to add funding:
`./komodo-cli -ac_name=REKT0 pricesaddfunding 15e0df4e9a45cf202557e589d106056f8583926f4fa093d2f39bd67783953ef4 1`


[19-Apr-19 04:17 AM] TonyL#3577
```{
  "rekt": 0,
  "batontxid": "bfc041193a11b34b8de01d83dd328e894b212ed62f2478f8a8612427a137eb44",
  "profits": 0.00000000,
  "costbasis": 5263.37140000,
  "positionsize": 1.00000000,
  "equity": 1.00000001,
  "addedbets": 0.00000001,
  "leverage": 100,
  "firstheight": 2349,
  "firstprice": 5293.97990000,
  "lastprice": 5263.37140000,
  "height": 2351
}
```


[19-Apr-19 04:17 AM] TonyL#3577
It's added 1 satoshi


[19-Apr-19 04:18 AM] TonyL#3577
So `positionsize` is `intialbetsize`, `equity` is `initialbetsize` + `addedbets`


[19-Apr-19 04:18 AM] jl777c#5810
+ profit


[19-Apr-19 04:18 AM] TonyL#3577
Maybe rename`positionsize` to `initialbetsize` ? It's quite confusing


[19-Apr-19 04:18 AM] jl777c#5810
well the initial bet is the size of the position


[19-Apr-19 04:19 AM] TonyL#3577
But there is added funding


[19-Apr-19 04:19 AM] jl777c#5810
it might be that we cant allow funds to be added and maintain risk management


[19-Apr-19 04:19 AM] TonyL#3577
Which actually enlarging your position


[19-Apr-19 04:19 AM] jl777c#5810
no


[19-Apr-19 04:19 AM] jl777c#5810
the definition i am using is the position is what the leverage applies to


[19-Apr-19 04:20 AM] jl777c#5810
otherwise if you have a 50% loss and addfunding 50% is lost immediate


[19-Apr-19 04:20 AM] jl777c#5810
i think there is a possible attack...


[19-Apr-19 04:20 AM] TonyL#3577
Ok, so ` "addedbets"` should be `addedmargin` maybe


[19-Apr-19 04:20 AM] jl777c#5810
make a small bet at 777 leverage


[19-Apr-19 04:21 AM] jl777c#5810
as it goes negative add enough margin to prevent being rekt


[19-Apr-19 04:21 AM] jl777c#5810
if on average you add less than 777x small bet size, you end up ahead


[19-Apr-19 04:21 AM] jl777c#5810
so i think the rekt percentage should change based on leverage


[19-Apr-19 04:22 AM] jl777c#5810
at no leverage you are not rekt till negative


[19-Apr-19 04:22 AM] jl777c#5810
at high leverage you are rekt at something higher, like 30%?


[19-Apr-19 04:22 AM] jl777c#5810
not sure need some modeling on this


[19-Apr-19 04:22 AM] TonyL#3577
Bitmex connecting margin to rektprice - when you adding more margin to position your rektprice moving


[19-Apr-19 04:23 AM] TonyL#3577
quite clearly for trader in such case


[19-Apr-19 04:23 AM] TonyL#3577
You can also take back some (or all) added margin if your position stands good


[19-Apr-19 04:24 AM] TonyL#3577
So for now: 
```costbasis print is wrong
rekt price showing as 0
profits showing as 0
priceaddfunding add funding in satoshis```
@dimxy


[19-Apr-19 04:28 AM] jl777c#5810
ok, lets change it to work more like bitmex


[19-Apr-19 04:29 AM] TonyL#3577
Maybe I just not understood current clue so far with costbasis


[19-Apr-19 04:30 AM] jl777c#5810
the big issue is that we use the 24hour average


[19-Apr-19 04:31 AM] jl777c#5810
that means if the mined price is significantly above the smoothed price, a price rise for the next 24hrs is already baked in


[19-Apr-19 04:31 AM] jl777c#5810
it cant help but go up


[19-Apr-19 04:31 AM] jl777c#5810
so we cant let bettors use future knowledge. any such future knowledge, leveraged and bankroll is gone


[19-Apr-19 04:31 AM] TonyL#3577
Attacks vectors on oracle stops us to use realtime price?


[19-Apr-19 04:32 AM] jl777c#5810
the chain will stop if the oracle is someone stopped


[19-Apr-19 04:32 AM] jl777c#5810
but yes, we cant use the mined price due to the 2% attack


[19-Apr-19 04:32 AM] jl777c#5810
miner would just need to bias price 1% higher, place a bet, then bias -1%, to get a 2% swing, which under leverage is enormous


[19-Apr-19 04:33 AM] jl777c#5810
so we do the prior 24hr 51% correlation using a deterministic random. that means a miner can bias it +/-1% but wont know which block (if any) it will be used in and much less likely if it is a biased price


[19-Apr-19 04:34 AM] jl777c#5810
so we get the correlated price, but that is literally a random price from the prior day that just happened to be correlated with a majority of prices


[19-Apr-19 04:34 AM] TonyL#3577
https://www.bitmex.com/app/index/.BXBT maybe use such index - so to move price 1% you have to move it on all exchanges

{Embed}
https://www.bitmex.com/app/index/.BXBT
.BXBT: Minutely Bitcoin Price Index - BitMEX
BitMEX is the world's most advanced P2P crypto-products trading platform and API. Trade with up to 100x leverage with only Bitcoin as collateral.
https://images-ext-2.discordapp.net/external/t5mPdJY2NGAAVEO2ncZLxGT5DkkG6WzYUeg8_ZKhCJs/https/www.bitmex.com/img/bitmex-logo-alt.png


[19-Apr-19 04:34 AM] jl777c#5810
but it is not useful for trading due to this choppiness


[19-Apr-19 04:34 AM] jl777c#5810
but the miner can submit a +/-1% price


[19-Apr-19 04:35 AM] jl777c#5810
doesnt matter the source


[19-Apr-19 04:35 AM] TonyL#3577
Ah, submit into oracle


[19-Apr-19 04:35 AM] jl777c#5810
so the average of the prior 24hrs is the trustless price feed


[19-Apr-19 04:35 AM] jl777c#5810
but this has 24hrs of future knowledge that hasnt been incorporated yet


[19-Apr-19 04:35 AM] jl777c#5810
so....


[19-Apr-19 04:35 AM] jl777c#5810
the cost basis needs to be based on the max value of the pricefeed for 24hrs


[19-Apr-19 04:37 AM] jl777c#5810
so that is the thinking behind the costbasis changing during the first 24hrs


[19-Apr-19 04:48 AM] dimxy#2587
Now profits is 0 as costbasis=lastprice


[19-Apr-19 04:55 AM] jl777c#5810
it shouldnt always be the last price


[19-Apr-19 04:55 AM] jl777c#5810
only if lastprice is the MAX


[19-Apr-19 04:55 AM] jl777c#5810
otherwise there would be a loss


[19-Apr-19 04:57 AM] dimxy#2587
Firstheight block was skipped for calc
Maybe for the blocks after , the lastprice is max indeed


[19-Apr-19 07:40 AM] Mihailo#5902
@jl777c we cannot set ac_supply to 0 as we need initial funds to setup gateway and fund oracle publishers. So what should be the limit?


[19-Apr-19 08:45 AM] jl777c#5810
the magic calculation will provide some coins


[19-Apr-19 08:45 AM] jl777c#5810
around 10


[19-Apr-19 08:45 AM] jl777c#5810
even with supply of 0


[19-Apr-19 10:38 AM] Alright#0419
Could someone give me steps for properly building daemon for prices? I did the same process I was using for dilithium, and `cclibinfo` still shows me rogue rpcs


[19-Apr-19 10:40 AM] jl777c#5810
prices CC is built in


[19-Apr-19 10:40 AM] jl777c#5810
doesnt use libcc


[19-Apr-19 10:43 AM] Alright#0419
`-ac_cclib=prices` threw me off


[19-Apr-19 10:43 AM] Alright#0419
Are the rpcs mentioned in comments in prices.cpp not implemented yet?


[19-Apr-19 10:44 AM] Alright#0419
`pricesbet` or `pricesaddfunding` for example


[19-Apr-19 10:44 AM] Alright#0419
method not found


[19-Apr-19 10:44 AM] jl777c#5810
it is in dimxy repo


[19-Apr-19 10:44 AM] Alright#0419
Ahhh ok was trying FSM


[19-Apr-19 10:44 AM] Alright#0419
your FSM that is


[19-Apr-19 10:45 AM] jl777c#5810
bug fixed versiom with rpc not merged yet


[19-Apr-19 10:45 AM] Alright#0419
I see he's working on it right now


[19-Apr-19 10:45 AM] Alright#0419
his prices-rpc branch


[19-Apr-19 10:46 AM] Alright#0419
@dimxy sorry to bother, but could you ping me when I can test that?


[19-Apr-19 10:57 AM] dimxy#2587
I just pushed corrections for pricesinfo (costbasis calculations)
https://github.com/dimxy/komodo/tree/prices-rpc


[19-Apr-19 11:02 AM] gcharang#6833
https://github.com/jl777/komodo/blob/jl777/src/cc/makeprices#L2
does this file exist because `prices` was going to be dynamic before, but now it has been made core ?

{Embed}
https://github.com/jl777/komodo/blob/jl777/src/cc/makeprices
jl777/komodo
Komodo. Contribute to jl777/komodo development by creating an account on GitHub.
https://images-ext-1.discordapp.net/external/ZluS_vPUp--Ma1oFnNdhU0YaB0OEwzwGFNPA2N_uSAk/%3Fs%3D400%26v%3D4/https/avatars2.githubusercontent.com/u/5962559


[19-Apr-19 11:04 AM] jl777c#5810
correct


[19-Apr-19 11:04 AM] jl777c#5810
i should remove the prices libcc, but been to busy with other things

{Reactions}
üëç 

[19-Apr-19 12:52 PM] TonyL#3577
In last update something strange happened:

```./komodo-cli -ac_name=REKT0 help | grep prices
prices maxsamples
pricesaddress [pubkey]
pricesinfo fundingtxid
priceslist
```

```./komodo-cli -ac_name=REKT0 pricesbet 100 1 "BTC_USD, 1"
error code: -32601
error message:
Method not found
```


[19-Apr-19 12:53 PM] TonyL#3577
Ahh, something strange happened in my head


[19-Apr-19 12:53 PM] TonyL#3577
I've updated FSM instead of dimxy repo


[19-Apr-19 01:01 PM] TonyL#3577
```./komodo-cli -ac_name=REKT0 pricesinfo d06c1bbcfe57798beefbcefa53dac7cba161d97d17bd9a1261c24664bd820627
prices_costbasis() no costbasis txid found
prices_syntheticprice i=0 price=0 value=1 depth=0
prices_syntheticprice pricedata[0]=6681694276141253617 pricedata[1]=527510830000 pricedata[2]=526687601586
pricestack[depth=1]=4
prices_syntheticprice i=1 price=0 value=1 depth=1
pricestack[depth=0]=527510830000
prices_syntheticprice price=527510830000 den=1
prices_syntheticprofits() minmax costbasis=527510830000 price=527510830000
prices_syntheticprofits() test value1 (price/PRICES_NORMFACTOR * SATOSHIDEN)=5275108300000000
prices_syntheticprofits() test value2 (price/PRICES_NORMFACTOR * SATOSHIDEN)/costbasis=10000
prices_syntheticprofits() fract profits=0
prices_syntheticprofits() val profits=0
{
  "rekt": 0,
  "batontxid": "d06c1bbcfe57798beefbcefa53dac7cba161d97d17bd9a1261c24664bd820627",
  "profits": 0.00000000,
  "costbasis": 5275.10830000,
  "positionsize": 1.00000000,
  "equity": 1.00000000,
  "addedbets": 0.00000000,
  "leverage": 100,
  "firstheight": 2393,
  "firstprice": 5275.10830000,
  "lastprice": 5275.10830000,
  "height": 2393
}
```


[19-Apr-19 01:02 PM] TonyL#3577
Now waiting for lastprice move to track costbasis


[19-Apr-19 01:17 PM] TonyL#3577
```{
  "rekt": 0,
  "batontxid": "d06c1bbcfe57798beefbcefa53dac7cba161d97d17bd9a1261c24664bd820627",
  "profits": 0.00000000,
  "costbasis": 5287.80670000,
  "positionsize": 1.00000000,
  "equity": 1.00000000,
  "addedbets": 0.00000000,
  "leverage": 100,
  "firstheight": 2393,
  "firstprice": 5275.10830000,
  "lastprice": 5287.80670000,
  "height": 2394
}
``` costbasis moved with lastprice


[19-Apr-19 01:18 PM] jl777c#5810
good!


[19-Apr-19 01:18 PM] jl777c#5810
so now there should be a loss if ever the price is lower


[19-Apr-19 01:19 PM] TonyL#3577
I wonder it should be a profit now because it's long and last price (and costbasis) is > than firstprice


[19-Apr-19 01:20 PM] jl777c#5810
no the costbasis is what you paid for


[19-Apr-19 01:20 PM] jl777c#5810
remember the "cant use future info" rule


[19-Apr-19 01:20 PM] jl777c#5810
so the price you paid for it wont be known for 24 hours


[19-Apr-19 01:20 PM] jl777c#5810
if you paid the same price as it is now, 0 profits


[19-Apr-19 01:20 PM] TonyL#3577
Aha, so game will actually start in 24hours


[19-Apr-19 01:20 PM] jl777c#5810
for the first 24hrs the best you can do is breakeven


[19-Apr-19 01:20 PM] jl777c#5810
you can get rekt within 24 hours like you suggested, when that is implemented


[19-Apr-19 01:21 PM] jl777c#5810
so there is the game of how much will you put into the position before the 24hrs


[19-Apr-19 01:21 PM] TonyL#3577
Finally almost collected  in head puzzle how it works


[19-Apr-19 01:21 PM] TonyL#3577
Will price from which I start be fixed automatically in 24 hours?


[19-Apr-19 01:21 PM] jl777c#5810
yes, after 24 hours there is the costbasis that is permanent


[19-Apr-19 01:22 PM] jl777c#5810
if you can make a strategy that wins more than random chance, that is a bug


[19-Apr-19 01:22 PM] TonyL#3577
Hmm, some "blocks_until_costbasis_fixed" timer might be very helpful imo


[19-Apr-19 01:23 PM] TonyL#3577
`if you can make a strategy that wins more than random chance, that is a bug` - have to make timemachine for it I think


[19-Apr-19 01:24 PM] jl777c#5810
then we are good and it is a matter to tune the monetization, rekt percentages, limits on addingfunds?


[19-Apr-19 01:24 PM] jl777c#5810
stuff like that


[19-Apr-19 01:25 PM] TonyL#3577
So for now I have to open few positions and wait 24 hours to see what will happen.

Maybe we can make some "temporary testing" version in which lock will happen in a few minutes to not wait 1 day to test rekt/profit claim cases?


[19-Apr-19 01:25 PM] jl777c#5810
ok, good idea to have a version that locks costbasis in 3 blocks to allow for fast testing


[19-Apr-19 01:26 PM] TonyL#3577
`then we are good and it is a matter to tune the monetization, rekt percentages, limits on addingfunds?` - I tried only longs and only with BTC_USD pair so far


[19-Apr-19 01:26 PM] TonyL#3577
So have to check what happens in case of shorts and create some indexes/synthetic pairs


[19-Apr-19 01:27 PM] jl777c#5810
true, there could well be bugs in the synthetic construction, which needs to also be displayed in the JSON


[19-Apr-19 01:28 PM] jl777c#5810
it seems this is coming together pretty fast

{Reactions}
üöÄ 

[19-Apr-19 01:28 PM] jl777c#5810
once the basics are working, we can add token betting


[19-Apr-19 01:28 PM] TonyL#3577
And some interface hehe üòÉ


[19-Apr-19 01:29 PM] jl777c#5810
that too, but now you understand the game, i think you will have some good ideas for it

{Reactions}
üëç 

[19-Apr-19 01:30 PM] jl777c#5810
oh, i think i know how to compensate for people adding funds


[19-Apr-19 01:30 PM] jl777c#5810
the more you add, the higher the rekt liquidation percentage is


[19-Apr-19 01:30 PM] jl777c#5810
at some point it wont help even to add more funds


[19-Apr-19 01:31 PM] jl777c#5810
this needs to be tuned a bit, but we can cancel out whatever advantage comes from being able to bail out bad positions with a lot of funds


[19-Apr-19 01:31 PM] TonyL#3577
Just realized what is missing in `pricesinfo` - construction which I used on bet / trading pair


[19-Apr-19 01:31 PM] jl777c#5810
yes, the synthetic it represent


[19-Apr-19 01:33 PM] jl777c#5810
if normally -90% and you are rekt, if you addfunds equal to the initial bet, then maybe -80% and you are rekt


[19-Apr-19 01:33 PM] jl777c#5810
add another and it is -70%


[19-Apr-19 01:33 PM] jl777c#5810
maybe not a linear thing, but that type of effect


[19-Apr-19 01:34 PM] jl777c#5810
so where the additional money you put at risk, it shouldnt change the odds to much, more a double or nothing proposition


[19-Apr-19 01:34 PM] jl777c#5810
as you play this, think about where the rekt percentage would need to be for you to not add more funds


[19-Apr-19 01:34 PM] jl777c#5810
probably we could model this mathematically... but i dont know how


[19-Apr-19 01:34 PM] TonyL#3577
Who will have control over "rekted" funds?


[19-Apr-19 01:35 PM] jl777c#5810
the blockchain


[19-Apr-19 01:35 PM] jl777c#5810
it is where winners are paid from


[19-Apr-19 01:36 PM] jl777c#5810
so as more and more people lose, bigger and bigger bets can be made


[19-Apr-19 01:36 PM] TonyL#3577
Aha, so have to design it the way in which it's not drained


[19-Apr-19 01:36 PM] TonyL#3577
If it drained = game over üòÉ


[19-Apr-19 01:36 PM] jl777c#5810
speaking of which, we need to be able to see globally how much has been bet and how much is at risk


[19-Apr-19 01:36 PM] jl777c#5810
blockchain deaded


[19-Apr-19 01:36 PM] jl777c#5810
well the game on the chain


[19-Apr-19 01:36 PM] jl777c#5810
somebody would need to give it CPR by adding funds


[19-Apr-19 01:37 PM] TonyL#3577
I think that chain coins will be "utility" more for such game


[19-Apr-19 01:38 PM] TonyL#3577
Some external assets peged to this coin and reflected on game chain will act as a value holders


[19-Apr-19 01:38 PM] TonyL#3577
Because if there is a risk of dead chain - unlikely there are reasons to have this chain coin itself value


[19-Apr-19 01:39 PM] jl777c#5810
unless the chain is a sidechain


[19-Apr-19 01:39 PM] TonyL#3577
Yeah, thats what I'm thinking about üòÉ


[19-Apr-19 01:39 PM] jl777c#5810
that already has value


[19-Apr-19 01:39 PM] jl777c#5810
that is why I want it to be a BET sidechain


[19-Apr-19 01:39 PM] jl777c#5810
REKT0, REKT1, REKT2,... ,might all get bankrupted


[19-Apr-19 01:40 PM] jl777c#5810
but as we tune it we will get the right formula


[19-Apr-19 01:40 PM] TonyL#3577
It's very interesting concept - instead of  many coins  creation with unclear value proect some valuable assets on it and use some chains as utility only


[19-Apr-19 01:41 PM] jl777c#5810
the real BET chain is the store of value


[19-Apr-19 01:41 PM] jl777c#5810
these sidechains are experimental chains that once we tune it so it is fair but not going to bankrupt itself, then maybe the majority of BET will move to that instance of the sidechain


[19-Apr-19 01:42 PM] jl777c#5810
even if the game is bankrupted, the BET coins are won by someone, who can just redeem to BET and deposit in the next REKTi chain


[19-Apr-19 01:42 PM] TonyL#3577
We can setup `BET` <-> `BET Token on REKT chain` gateways maybe


[19-Apr-19 01:42 PM] jorian#4555
üëÄ i read BET


[19-Apr-19 01:43 PM] jl777c#5810
simpler just to have a sidechain


[19-Apr-19 01:43 PM] jl777c#5810
also, this combines with the payments CC snapshot address that will collect the betting fees, so the holders of the REKT get the payouts whenever there is enough fees to fund a snapshot

{Reactions}
üí™ 

[19-Apr-19 01:44 PM] jl777c#5810
at that point, then most all the BET should move into the sidechain


[19-Apr-19 01:45 PM] jl777c#5810
once there is a self-sustaining game, the BET becomes a totally automated money making machine


[19-Apr-19 01:46 PM] TonyL#3577
Autonomous financial markets - very futuristc üòÉ


[19-Apr-19 01:47 PM] TonyL#3577
I have a bit of a mundane question: how to open short?


[19-Apr-19 01:47 PM] TonyL#3577
Ah, maybe minus before leverage


[19-Apr-19 01:48 PM] TonyL#3577
`"BTC_USD, 1"` - also am I understand correct that 1 means amount of pairs I've used?


[19-Apr-19 01:48 PM] jl777c#5810
negative leverage


[19-Apr-19 01:48 PM] jl777c#5810
you need a weight to push the top of stack into the accumulator


[19-Apr-19 01:48 PM] jl777c#5810
"BTC_USD, 1, BTC_EUR, 2"


[19-Apr-19 01:49 PM] jl777c#5810
that would weigh BTC_EUR price double that of BTC_USD


[19-Apr-19 01:49 PM] TonyL#3577
I see


[19-Apr-19 01:49 PM] jl777c#5810
"BTC_USD, USD_JPY, *, 1, BTC_EUR, 2"


[19-Apr-19 01:49 PM] jl777c#5810
that would weigh BTC_EUR price double that of BTC_JPY


[19-Apr-19 01:50 PM] jl777c#5810
it is just like a calculator, push push, operator


[19-Apr-19 01:50 PM] jl777c#5810
i specified the language i think pretty clearly


[19-Apr-19 01:51 PM] TonyL#3577
Yes, readed between lines


[19-Apr-19 01:51 PM] TonyL#3577
You specificed moment about negative leverage as well


[19-Apr-19 01:51 PM] TonyL#3577
Will re-read carefully again


[19-Apr-19 01:52 PM] TonyL#3577
```./komodo-cli -ac_name=REKT0 pricesinfo 909291ca7715b14d502899012c8fe797230091deae3ae47c08626657f8a02ba7
prices_costbasis() no costbasis txid found
prices_syntheticprice i=0 price=0 value=1 depth=0
prices_syntheticprice pricedata[0]=6681708887619939909 pricedata[1]=528601170000 pricedata[2]=526776816620
pricestack[depth=1]=4
prices_syntheticprice i=1 price=0 value=1 depth=1
pricestack[depth=0]=526776816620
prices_syntheticprice price=526776816620 den=1
prices_syntheticprofits() minmax costbasis=526776810000 price=526776810000
prices_syntheticprofits() test value1 (price/PRICES_NORMFACTOR * SATOSHIDEN)=5267768100000000
prices_syntheticprofits() test value2 (price/PRICES_NORMFACTOR * SATOSHIDEN)/costbasis=10000
prices_syntheticprofits() fract profits=0
prices_syntheticprofits() val profits=0
{
  "rekt": 0,
  "batontxid": "909291ca7715b14d502899012c8fe797230091deae3ae47c08626657f8a02ba7",
  "profits": 0.00000000,
  "costbasis": 5267.76810000,
  "positionsize": 1.00000000,
  "equity": 1.00000000,
  "addedbets": 0.00000000,
  "leverage": -100,
  "firstheight": 2397,
  "firstprice": 5267.76816620,
  "lastprice": 5267.76810000,
  "height": 2397
}
```


[19-Apr-19 01:52 PM] TonyL#3577
Opened short, leverage showing negative as it supposed to but not sure if it works or not because profits not displaying yet


[19-Apr-19 01:53 PM] jl777c#5810
this one becomes profitable if the price drops


[19-Apr-19 01:54 PM] Alright#0419
https://github.com/jl777/komodo/blob/ad480a67dde0913827af21d16c5e5f575d165cd4/src/main.cpp#L1178
why is this referred to as coinbase-timelock?

{Embed}
https://github.com/jl777/komodo/blob/ad480a67dde0913827af21d16c5e5f575d165cd4/src/main.cpp
jl777/komodo
Komodo. Contribute to jl777/komodo development by creating an account on GitHub.
https://images-ext-1.discordapp.net/external/ZluS_vPUp--Ma1oFnNdhU0YaB0OEwzwGFNPA2N_uSAk/%3Fs%3D400%26v%3D4/https/avatars2.githubusercontent.com/u/5962559


[19-Apr-19 01:54 PM] Alright#0419
just a typo in the print or is there some kind of time locking involved here?


[19-Apr-19 01:56 PM] jl777c#5810
i added it to the VRSC coinbase timelock validation function


[19-Apr-19 01:57 PM] jl777c#5810
it is a misnomer, but i assume anybody looking at such error messages will look at the source to figure things out


[19-Apr-19 02:01 PM] TonyL#3577
`./komodo-cli -ac_name=REKT0 pricesbet 1 100 "BTC_USD, USD_JPY, *, 1, BTC_EUR, 2"` made a bet with synthetic exactly as your example :)
```{
  "rekt": 0,
  "batontxid": "5008a7fe6d33e3dba4f2eba359aee0ffecce86b56174bd2852e28d1b089eb220",
  "profits": 0.00000000,
  "costbasis": 3485.03080000,
  "positionsize": 1.00000000,
  "equity": 1.00000000,
  "addedbets": 0.00000000,
  "leverage": 100,
  "firstheight": 2398,
  "firstprice": 3485.03087079,
  "lastprice": 3485.03080000,
  "height": 2398
}
```


[19-Apr-19 02:04 PM] jl777c#5810
not sure the cost is right, there might be a bug in the synthetic


[19-Apr-19 02:04 PM] jl777c#5810
to debug this, split the synthetic into each component part


[19-Apr-19 02:04 PM] jl777c#5810
BTC_JPY should be a very big number, maybe it overflowed...


[19-Apr-19 02:07 PM] TonyL#3577
Am I understand correct that `"BTC_USD, USD_JPY, *, 1, BTC_EUR, 2"` =  0,3333333(3)* (BTC/JPY) + 0,666666(6) * (BTC/EUR) ?


[19-Apr-19 02:07 PM] jl777c#5810
yes, should be


[19-Apr-19 02:08 PM] jl777c#5810
1 BTC_JPY + 2 BTC_EUR / 3


[19-Apr-19 02:09 PM] TonyL#3577
Why `1 BTC_JPY` - isnt weights sum should be equal 1 ?


[19-Apr-19 02:10 PM] jl777c#5810
1+2/3


[19-Apr-19 02:11 PM] jl777c#5810
1+2 == 3


[19-Apr-19 02:11 PM] jl777c#5810
3/3 == 1


[19-Apr-19 02:11 PM] TonyL#3577
1 + 2/3 = 5/3 != 1


[19-Apr-19 02:11 PM] jl777c#5810
and my method actually doesnt lose any precision until the last /3


[19-Apr-19 02:11 PM] jl777c#5810
(1+2)/3


[19-Apr-19 02:12 PM] TonyL#3577
reliability weights normalizing to 1 (sum of weights should be equal 1)


[19-Apr-19 02:12 PM] jl777c#5810
as long as denominator equals sum of weights, it is the same


[19-Apr-19 02:12 PM] jl777c#5810
doing integer math, you cant use fractions


[19-Apr-19 02:12 PM] TonyL#3577
Ah, maybe you meant: (1 BTC_JPY + 2 BTC_EUR) / 3


[19-Apr-19 02:13 PM] jl777c#5810
yes


[19-Apr-19 02:13 PM] TonyL#3577
I see üòÉ


[19-Apr-19 02:13 PM] jl777c#5810
what we need is a getprice rpc call


[19-Apr-19 02:13 PM] jl777c#5810
where you can pass in a synthetic string


[19-Apr-19 02:13 PM] jl777c#5810
and height


[19-Apr-19 02:14 PM] jl777c#5810
i assume you are keeping track of all the things we need so you can let dimxy know

{Reactions}
üëå üëç 

[19-Apr-19 02:16 PM] Alright#0419
I think maybe that check is happening on all coinbase op_returns?


[19-Apr-19 02:16 PM] Alright#0419
regardless of ac_prices or not


[19-Apr-19 02:16 PM] Alright#0419
maybe not, didn't test it, but looks that way


[19-Apr-19 02:16 PM] jl777c#5810
of course


[19-Apr-19 02:16 PM] jl777c#5810
that is what the code says


[19-Apr-19 02:16 PM] TonyL#3577
Things which we need so far:
1) Test mode with price lock after 3 blocks instead of 24 hours
2) Synthetic print in `pricesinfo`
3)  getprice rpc call where you can pass in a synthetic string and height and get price
4) "blocks_until_costbasis_lock" indicator in `pricesinfo`
@dimxy

{Reactions}
üëç 

[19-Apr-19 02:16 PM] jl777c#5810
did you look at ContextualCheckCoinbaseTransaction


[19-Apr-19 02:18 PM] Alright#0419
no, sorry, I see it now


[19-Apr-19 02:18 PM] Alright#0419
where I should have been looking in the first place >.<


[20-Apr-19 12:28 AM] dimxy#2587
@TonyL  did you downloaded my last prices update (I corrected the costbasis calculation - seems  the prints above indicate there are no the last changes)?


[20-Apr-19 02:02 AM] TonyL#3577
@dimxy yes, costbasis in prints following last price


[20-Apr-19 02:02 AM] jl777c#5810
always? it should be MAX of all prices during 24hrs


[20-Apr-19 02:18 AM] TonyL#3577
Let me track more carefully to see if it MAX or follow on declines


[20-Apr-19 02:37 AM] dimxy#2587
No, the last changes are probably there.
The issue with this call /komodo-cli -ac_name=REKT0 pricesinfo 909291ca7715b14d502899012c8fe797230091deae3ae47c08626657f8a02ba7
was that the sample size was actually only 1 block == 2397. So obviously costbasis == lastprice in this case.
I can see the difference with the firstprice value. It is because firstprice is calculated differently from the costbasis and lastprice, with no minmax calculation, just the smoothed value.


[20-Apr-19 03:13 AM] TonyL#3577
```./komodo-cli -ac_name=REKT0 pricesinfo 909291ca7715b14d502899012c8fe797230091deae3ae47c08626657f8a02ba7
{
  "rekt": 0,
  "batontxid": "909291ca7715b14d502899012c8fe797230091deae3ae47c08626657f8a02ba7",
  "profits": 1586419989.47820000,
  "costbasis": 5222.06330000,
  "positionsize": 1.00000000,
  "equity": 1586419990.47820000,
  "addedbets": 0.00000000,
  "leverage": -100,
  "firstheight": 2397,
  "firstprice": 5267.76816620,
  "lastprice": 5267.09330000,
  "height": 2484
}
```
Yep, it's definetly not a ` it should be MAX of all prices during 24hrs` atm


[20-Apr-19 03:13 AM] TonyL#3577
And not match `lastprices` atm as well hmm


[20-Apr-19 03:14 AM] TonyL#3577
I'm on this commit:
```git log -1
commit 500ce685197e621320e96a0b9c88848e3ab6191c (HEAD -> prices-rpc, origin/prices-rpc)
Author: dimxy <dimxy@komodoplatform.com>
Date:   Fri Apr 19 22:51:49 2019 +0500

    corr calc profits refheight
```


[20-Apr-19 03:16 AM] TonyL#3577
```./komodo-cli -ac_name=REKT0 prices 1
{
  "firstheight": 2193,
  "timestamps": [
    1555754038
  ],
  "pricefeeds": [
    {
      "name": "BTC_USD",
      "prices": [
        [
          5337.28500000,
          5285.30320000,
          5272.87894827
        ]
```


[20-Apr-19 03:17 AM] TonyL#3577
Atm `lastprice` and `costbasis` in this position not matching any of values from last prices


[20-Apr-19 03:22 AM] dimxy#2587
firstprice is the smoothed value from the firstheight block=2397
costbasis is the min (if lev < ) of correlated and smoothed  valuues from the period from firstheight till the height which is passed as pricesinfo param 
(and if its is omitted then lastblock) or 24h  - whatever first


[20-Apr-19 03:38 AM] jl777c#5810
if negative leverage, it is the MIN[]


[20-Apr-19 03:50 AM] TonyL#3577
Negative leverage bets profit if price is falling, positive leverage if rising


[20-Apr-19 03:51 AM] TonyL#3577
So profits calculation should be different too for negative leverage (if it the same now)


[20-Apr-19 03:51 AM] jl777c#5810
profits calc multiplies by leverage


[20-Apr-19 03:51 AM] jl777c#5810
so if it would have made money as a long trade, it loses as a short


[20-Apr-19 05:15 AM] Andersen#8337
Profit and loss in LONG and SHORT non linear in bitmex , due  all contracts  settlement in BTC .  And you can choose isolated margin or cross (all in).


[20-Apr-19 05:15 AM] Andersen#8337
https://www.bitmex.com/app/exchangeGuide

{Embed}
https://www.bitmex.com/app/exchangeGuide
Exchange Guide - BitMEX
BitMEX is the world's most advanced P2P crypto-products trading platform and API. Trade with up to 100x leverage with only Bitcoin as collateral.
https://images-ext-2.discordapp.net/external/t5mPdJY2NGAAVEO2ncZLxGT5DkkG6WzYUeg8_ZKhCJs/https/www.bitmex.com/img/bitmex-logo-alt.png


[20-Apr-19 05:16 AM] Andersen#8337
In Deribit its always cross - but user can regulate leverage by  order value  - up to 100x


[20-Apr-19 05:17 AM] Andersen#8337
In bitmex when user go to SHORT  - he is in synthetic fiat $


[20-Apr-19 02:17 PM] TonyL#3577
prototyping in progress üòÉ

{Attachments}
https://cdn.discordapp.com/attachments/560714286369079299/569270564628201492/unknown.png


[20-Apr-19 02:20 PM] TonyL#3577
Plan to make some comfy to use constructor for synthetic but not  decided yet how it should looks like - maybe set of dropdowns (up to 3 symbols to choose and operators to choose )


[20-Apr-19 02:28 PM] TonyL#3577
On "Active positions" tab will be table with active positions with option to add funding


[20-Apr-19 02:28 PM] Alright#0419
:shexy:

{Reactions}
shexy (2) 

[20-Apr-19 02:28 PM] Alright#0419
I don't quite understand it yet


[20-Apr-19 02:28 PM] Alright#0419
but :shexy: nonetheless


[20-Apr-19 02:38 PM] TonyL#3577
At the moment `priceslist` returns list of all bets on chain what is not very useful. I think it will be great if there will be separation between pending and finished bets and also `mypriceslist` to get list of user bets (similar to rogue)
[@jl777c @dimxy]

{Reactions}
üëå 

[20-Apr-19 02:42 PM] TonyL#3577
`I don't quite understand it yet` - same so far because need to wait 24 hours to start game üòÉ


[20-Apr-19 02:43 PM] TonyL#3577
Oh, btw 24 hours passed since my yesterdays positions opening


[20-Apr-19 02:44 PM] TonyL#3577
``` ./komodo-cli -ac_name=REKT0 pricesinfo 15e0df4e9a45cf202557e589d106056f8583926f4fa093d2f39bd67783953ef4
{
  "rekt": 1,
  "rektfee": 200000,
  "rektheight": 2484,
  "batontxid": "bfc041193a11b34b8de01d83dd328e894b212ed62f2478f8a8612427a137eb44",
  "profits": -1.12000000,
  "costbasis": 5332.32660000,
  "positionsize": 1.00000000,
  "equity": -0.11999999,
  "addedbets": 0.00000001,
  "leverage": 100,
  "firstheight": 2349,
  "firstprice": 5293.97990000,
  "lastprice": 5272.73100000,
  "height": 2563
}
```
Looks like I'm rekt on long üòÉ
Not sure why loss on profits more that positionsize because I added only 1 satoshi to `addedbets`


[20-Apr-19 02:46 PM] TonyL#3577
Something not ok with short:
```
./komodo-cli -ac_name=REKT0 pricesinfo 909291ca7715b14d502899012c8fe797230091deae3ae47c08626657f8a02ba7
{
  "rekt": 0,
  "batontxid": "909291ca7715b14d502899012c8fe797230091deae3ae47c08626657f8a02ba7",
  "profits": 2361183240.15360000,
  "costbasis": 5222.06330000,
  "positionsize": 1.00000000,
  "equity": 2361183241.15360000,
  "addedbets": 0.00000000,
  "leverage": -100,
  "firstheight": 2397,
  "firstprice": 5267.76816620,
  "lastprice": 5288.91170000,
  "height": 2565
}
```


[20-Apr-19 02:47 PM] TonyL#3577
`  "profits": 2361183240.15360000,` - looks like overflow and looks like I can became very very rich if try to close it

{Reactions}
üòÇ 

[20-Apr-19 05:58 PM] TonyL#3577
Yay, first position opened via browser üòÇ
Will display tables with active and closed positions when there will be some mechanism to filter it (if needed can scan vin/vouts for each)

{Attachments}
https://cdn.discordapp.com/attachments/560714286369079299/569326061280559123/unknown.png


[20-Apr-19 10:56 PM] jl777c#5810
the short position profit looks reasonable, but maybe it is off by 1


[20-Apr-19 11:11 PM] TonyL#3577
Ah, it's in satoshis, not coins


[20-Apr-19 11:11 PM] TonyL#3577
If in satoshis it might be fine


[20-Apr-19 11:16 PM] TonyL#3577
But I should be in loss in this short, not profit - last price is higher than both firstprice and cost basis


[20-Apr-19 11:17 PM] TonyL#3577
So not sure why it looks reasonable tbh


[20-Apr-19 11:19 PM] TonyL#3577
If costbasis representing my position its less than 1% profit so shohld be not more than 100% profit with 100 leverage


[20-Apr-19 11:24 PM] jl777c#5810
sorry i meant the long position


[20-Apr-19 11:27 PM] TonyL#3577
Rekt on long looks reasonable yup


[20-Apr-19 11:30 PM] jl777c#5810
it is down by about 1.2%, so it is indeed rekt and without any rekt miners it was able to live past its death. but for such positions, it would be able to be rekt using the first block that it was rekt and shouldnt be able to be cashed out


[20-Apr-19 11:30 PM] jl777c#5810
however if it goes back into profit before someone rekts it, then i guess a cashout would be possible


[20-Apr-19 11:32 PM] TonyL#3577
Aha, so some "rektbot" scanner is needed


[20-Apr-19 11:33 PM] TonyL#3577
Like a anybody can initiate rekt for someone position if `rekt: 1` but only opener can initiate close not into rekt?


[20-Apr-19 11:34 PM] TonyL#3577
If needed I can start simple scanner which will check positions for "rekt 1" and close it


[20-Apr-19 11:48 PM] jl777c#5810
only people that want to earn money from generating rekt transactions should be scanning

{Reactions}
üëå 

[21-Apr-19 12:45 AM] dimxy#2587
I corrected issue with this call
./komodo-cli -ac_name=REKT0 pricesinfo 909291ca7715b14d502899012c8fe797230091deae3ae47c08626657f8a02ba7
(I was not an overflow but incorrect cast of the operands to unsigned) - in my repo


[21-Apr-19 12:50 AM] jl777c#5810
this is why i like to use int64_t instead of uint64_t


[21-Apr-19 12:50 AM] jl777c#5810
one less bit of capacity but avoids all these type of issues


[21-Apr-19 12:52 AM] dimxy#2587
not the first time I saw this,
sometimes txfee is uint64_t and strange results might be if to calculate in64_t amount - uint64_t txfee üòÄ


[21-Apr-19 01:04 AM] TonyL#3577
Oh made scanner for priceslist, but it's crashing now on position which I created with leverage 0


[21-Apr-19 01:04 AM] TonyL#3577
```./komodo-cli -ac_name=REKT0 pricesinfo 48194bab8d377a7fa0e62d5e908474dae906675395753f09969d4c4bea4a7518
prices_costbasis() no costbasis txid found
prices_syntheticprice i=0 price=0 value=1 depth=0
prices_syntheticprice pricedata[0]=6681315026233878571 pricedata[1]=524941330000 pricedata[2]=524383219931
pricestack[depth=1]=139700403146728
prices_syntheticprice i=1 price=0 value=1 depth=1
pricestack[depth=0]=524383219931
prices_syntheticprice price=524383219931 den=1
prices_syntheticprofits() unchanged costbasis=0 price=524383210000 leverage=0
prices_syntheticprofits() test value1 (price/PRICES_NORMFACTOR * SATOSHIDEN)=5243832100000000
prices_syntheticprofits() test value2 (price/PRICES_NORMFACTOR * SATOSHIDEN)/costbasis=error: couldn't connect to server: EOF reached (code 1)
(make sure server is running and you are connecting to the correct RPC port)
[1]+  Floating point exception(core dumped) ```


[21-Apr-19 01:04 AM] TonyL#3577
In general can add exception for this txid on scanner side


[21-Apr-19 01:05 AM] TonyL#3577
Because it's not possible now to create positions with zero leverage and it's very unique one üòÉ


[21-Apr-19 01:10 AM] TonyL#3577
```./komodo-cli -ac_name=REKT0 pricesinfo 909291ca7715b14d502899012c8fe797230091deae3ae47c08626657f8a02ba7
{
  "rekt": 1,
  "rektfee": 200000,
  "rektheight": 2493,
  "batontxid": "909291ca7715b14d502899012c8fe797230091deae3ae47c08626657f8a02ba7",
  "profits": -1.01000000,
  "costbasis": 5222.06330000,
  "positionsize": 1.00000000,
  "equity": -0.01000000,
  "addedbets": 0.00000000,
  "leverage": -100,
  "firstheight": 2397,
  "firstprice": 5267.76816620,
  "lastprice": 5274.89310000,
  "height": 2623
}
```


[21-Apr-19 01:10 AM] TonyL#3577
Short is rekt on latest üëç


[21-Apr-19 01:13 AM] jl777c#5810
so you made both a long and short position and both got rekt!


[21-Apr-19 01:14 AM] TonyL#3577
With leverage 100 it was  easy quest to get rekt


[21-Apr-19 01:15 AM] dimxy#2587
I already did a check for zero-division but seems there is yet  another case
updated the code


[21-Apr-19 01:23 AM] TonyL#3577
Very raw positions displayer üòÉ (displaying all positions on chain atm)

{Attachments}
https://cdn.discordapp.com/attachments/560714286369079299/569437972118896670/unknown.png


[21-Apr-19 01:25 AM] TonyL#3577
No positions with positive profit at all so far

{Attachments}
https://cdn.discordapp.com/attachments/560714286369079299/569438477146521612/unknown.png


[21-Apr-19 01:26 AM] TonyL#3577
With test mode will able to test it propertlly


[21-Apr-19 01:28 AM] TonyL#3577
Have to add "Close position" and "Add funding" features to this table and interface will be quite ugly but feature complete actually (for current RPC calls) and all other will be just UI/UX enchancement


[21-Apr-19 01:32 AM] TonyL#3577
Table content saving to local CSV file  and reading from there - so this CSV user will able to reuse lets say if needed open in Excel


[22-Apr-19 02:22 PM] TonyL#3577
@dimxy not sure if you still working on it - went ahead and picked version with `mypriceslist` call üòÉ . Returning empty list on my side

{Attachments}
https://cdn.discordapp.com/attachments/560714286369079299/569996500503887912/unknown.png


[22-Apr-19 08:14 PM] dimxy#2587
@TonyL mypriceslist filters out txns with -pubkey param in the oprets
Did you use the same -pubkey param while calling mypubkeylist  as the one that created bets?


[22-Apr-19 08:36 PM] TonyL#3577
@dimxy yes, I opened few bets from this node with same pubkey set before and after update


[22-Apr-19 11:43 PM] dimxy#2587
@TonyL   I added some debug logging to output pubkeys in oprets and from -pubkey

{Reactions}
üëç 

[23-Apr-19 04:00 AM] TonyL#3577
Aha, according to debug logging one position opened from this node: https://paste.ubuntu.com/p/Gb4dCxKNM4/ (but I'm on fork now and some yesterdays positions not included into it)


[23-Apr-19 04:00 AM] TonyL#3577
So list seems to work correct, will try to open more now

{Reactions}
üëç 

[23-Apr-19 04:03 AM] TonyL#3577
New opened position was added to mypositionslist:
```[
  "02d161b021fbeebd2257db135ab2463f0da4887377a9ea0526a4fa5807bc897a",
  "1f0b824781052355029f1a59d8047679eb1a0237368fc92c1c2a4d28deea0eba"
]
```


[23-Apr-19 04:05 AM] TonyL#3577
@dimxy What is correct way to make daemon with TESTMODE?


[23-Apr-19 04:06 AM] dimxy#2587
I added  
export CONFIGURE_FLAGS='CPPFLAGS=-DTESTMODE' 
to .profile


[23-Apr-19 04:07 AM] dimxy#2587
and  full rebuild with make clean


[23-Apr-19 04:07 AM] TonyL#3577
Oh, it's same flag which using for gateways and channels, got it


[23-Apr-19 04:08 AM] dimxy#2587
yes,
we might change it if any conflicts


[23-Apr-19 04:16 AM] TonyL#3577
```{
  "rekt": 0,
  "batontxid": "02d161b021fbeebd2257db135ab2463f0da4887377a9ea0526a4fa5807bc897a",
  "profits": -0.00020000,
  "costbasis": 5292.43850000,
  "positionsize": 1.00000000,
  "equity": 0.99980000,
  "addedbets": 0.00000000,
  "leverage": 1,
  "firstheight": 2826,
  "firstprice": 5292.43855034,
  "lastprice": 5291.89610000,
  "height": 2923,
  "test_daywindow": 3
}
```

  "test_daywindow": 3  - was added üëç


[23-Apr-19 04:18 AM] TonyL#3577
@dimxy Could you please add synthetic to pricesinfo ouput when you have time?

{Reactions}
üëå 

[23-Apr-19 04:23 AM] TonyL#3577
```./komodo-cli -ac_name=REKT0 prices 725
error code: -8
error message:
daywindow is too small
```


[23-Apr-19 04:24 AM] TonyL#3577
```./komodo-cli -ac_name=REKT0 prices 1
error code: -8
error message:
daywindow is too small
```


[23-Apr-19 04:24 AM] TonyL#3577
Looks like I can't get prices at all with such flag


[23-Apr-19 04:32 AM] dimxy#2587
aha, checking...


[23-Apr-19 04:34 AM] dimxy#2587
yes there is day_window >= 7 limit,
I think I can adjust my test windows to this?


[23-Apr-19 04:37 AM] TonyL#3577
`  "test_daywindow": 3` - in general is 3 a blocks amount?


[23-Apr-19 04:41 AM] dimxy#2587
yes block num (I remember  3 was the requirement for test window)

{Reactions}
üëç 

[23-Apr-19 04:48 AM] dimxy#2587
updated the repo for win=7

{Reactions}
üëç 

[23-Apr-19 04:55 AM] TonyL#3577
@dimxy There are some conflicts in latest updates:
```~/dimxy_repo/komodo# git pull
Auto-merging src/wallet/rpcwallet.cpp
CONFLICT (content): Merge conflict in src/wallet/rpcwallet.cpp
Auto-merging src/rpc/server.h
CONFLICT (content): Merge conflict in src/rpc/server.h
Auto-merging src/rpc/server.cpp
Auto-merging src/komodo_gateway.h
Auto-merging src/komodo_defs.h
CONFLICT (content): Merge conflict in src/komodo_defs.h
Auto-merging src/cc/prices.cpp
CONFLICT (content): Merge conflict in src/cc/prices.cpp
Auto-merging src/cc/CCinclude.h
CONFLICT (content): Merge conflict in src/cc/CCinclude.h
Automatic merge failed; fix conflicts and then commit the result.
```


[23-Apr-19 04:58 AM] dimxy#2587
I did rebase recently onto FSM


[23-Apr-19 04:58 AM] dimxy#2587
I suggest pull to a new repo, sorry


[23-Apr-19 05:05 AM] TonyL#3577
Sure, can I do something from my side? Not a git ninja at all üòÉ


[23-Apr-19 05:07 AM] dimxy#2587
clone my repo to a new directory and rebuild (or just remove old dir)

{Reactions}
üëå 

[23-Apr-19 05:07 AM] TonyL#3577
Got it

{Reactions}
üëç 

[23-Apr-19 05:43 AM] TonyL#3577
`prices` call working now and can see `"test_daywindow": 7` in pricesinfo


[23-Apr-19 06:07 AM] TonyL#3577
Switched table to `mypriceslist`, selector seems work - a little left üòÉ

{Attachments}
https://cdn.discordapp.com/attachments/560714286369079299/570234214436438019/unknown.png


[23-Apr-19 07:28 AM] TonyL#3577
Closed one position - as expected it showing now in `mypriceslist closed` and not showing in `mypriceslist open`


[23-Apr-19 07:48 AM] TonyL#3577
https://paste.ubuntu.com/p/32YYcqPkrw/ not totally understand how it works, but after costbasis fixing `profit` changing  (costbasis value remains the same)


[23-Apr-19 07:51 AM] TonyL#3577
Looks like before `pricessetcostbasis` field `profit` reflects some not correct value and after this call it became correct


[23-Apr-19 11:51 AM] dimxy#2587
before  pricessetcostbasis call, a temp costbasis is used which is calculated with another algorithm ('minmax')


[23-Apr-19 11:54 AM] jl777c#5810
the minmax needs to be used for the pricessetcostbasis call also!


[23-Apr-19 11:54 AM] jl777c#5810
there should be no sudden change in costbasis


[23-Apr-19 11:54 AM] jl777c#5810
and the same should be used for permanent as the minmax


[23-Apr-19 11:58 AM] dimxy#2587
yes, however for the permanent costbasis it is calculated as max (or min) value for the single point at 24h
and for temp costbasis (before 24h) it is additionally calculated as max (or min) for the point for the total period  for firstheight to refheight!


[23-Apr-19 11:59 AM] dimxy#2587
that is why the difference might be


[23-Apr-19 11:59 AM] dimxy#2587
(or this needs to be corrected?)


[23-Apr-19 12:00 PM] jl777c#5810
it needs to be corrected


[23-Apr-19 12:01 PM] jl777c#5810
the permanent costbasis should be the max (or min) for entire first 24 hour period


[23-Apr-19 12:01 PM] jl777c#5810
regardless of when the tx is actually made


[23-Apr-19 12:06 PM] TonyL#3577
I'm still not understand clear purpose of `pricessetcostbasis` call. By design - should it be done by trader or some automated tool? Why this basis cost can't be set automatically after bet "maturing" ?


[23-Apr-19 12:07 PM] jl777c#5810
who sets it?


[23-Apr-19 12:07 PM] jl777c#5810
it is an "event" the passage of 24hrs


[23-Apr-19 12:07 PM] jl777c#5810
so an incentivized tx is use to have users "mine" it


[23-Apr-19 12:08 PM] TonyL#3577
There is a RPC call `pricessetcostbasis bettxid` which I have to execute and broadcast transaction for it before execution of `pricescashout bettxid`


[23-Apr-19 12:08 PM] jl777c#5810
yes, initial design required a costbasis set before cashout is allowed


[23-Apr-19 12:09 PM] TonyL#3577
Aha, so in app when user click "cashout" I just can broadcast `pricessetcostbasis` and `pricescashout`


[23-Apr-19 12:10 PM] TonyL#3577
And user will see only pricescashout output


[23-Apr-19 12:11 PM] TonyL#3577
Ok, so just need some maturity flag to make cashout button active only for positions for which possible to call `pricessetcostbasis`


[23-Apr-19 12:12 PM] jl777c#5810
yes the one doing cashout can do a costbasis first


[23-Apr-19 12:12 PM] jl777c#5810
one there are miners for this, it shouldnt be an issue


[23-Apr-19 12:49 PM] dimxy#2587
again about costbasis.

{Attachments}
https://cdn.discordapp.com/attachments/560714286369079299/570335375831072813/unknown.png


[23-Apr-19 12:51 PM] jl777c#5810
the max value is only for the greenline


[23-Apr-19 12:51 PM] jl777c#5810
the min value is only for the greenline


[23-Apr-19 01:18 PM] dimxy#2587
So costbasis is the max of smoothed values
And what about cashout price value?

{Attachments}
https://cdn.discordapp.com/attachments/560714286369079299/570342717532536853/unknown.png


[23-Apr-19 01:25 PM] dimxy#2587
if I want to cashout at t=T2 
it seems logical if the cashout price value is calculated by a similar way as costbasis (that is, as the max for the following 24h?)
(the value V2 on the screen is how the cashout price is calculated now)


[23-Apr-19 01:33 PM] jl777c#5810
no, the cashout price is the smoothed price at the current height


[23-Apr-19 01:33 PM] jl777c#5810
i guess prior block value


[23-Apr-19 01:34 PM] jl777c#5810
the costbasis is the max, the cashout is the current value


[23-Apr-19 01:34 PM] jl777c#5810
this is the house edge and compensates for the fee being on just the amount bet, instead of leveraged amount, which is in some cases 100x lower fee


[23-Apr-19 01:36 PM] jl777c#5810
cashout must use the realtime price


[23-Apr-19 01:36 PM] jl777c#5810
so there is no waiting, it closes the position and it uses just the smoothed price


[23-Apr-19 01:38 PM] jl777c#5810
so costbasis is recalculated during first 24 hours using max (or min) of smoothed price and the permanent one is just the last value

{Reactions}
üëå 

[23-Apr-19 01:39 PM] jl777c#5810
current price is always the current price and that is used for cashout


[23-Apr-19 01:40 PM] jl777c#5810
for rekt, ANY height can be used. I think we need a special case to allow rekt of a position before 24hrs without a permanent costbasis


[23-Apr-19 01:40 PM] jl777c#5810
or maybe we can actually get rid of the costbasis tx, it seems like the appendix. a tx without any known reason


[23-Apr-19 01:41 PM] jl777c#5810
i think allowing  position to be rekt during first 24 hours deprecates the costbasis tx and we just need to calculate it all the time for cashout and rekt

{Reactions}
üëå 

[23-Apr-19 01:42 PM] jl777c#5810
the early rekt compensates for bettors being able to add funding


[23-Apr-19 01:42 PM] jl777c#5810
the 24 hours prevents any future knowledge to be used when making the bet


[23-Apr-19 01:43 PM] jl777c#5810
the percentage of equity that means rekt would need to change from 10% to higher values if funds are added. just not sure what algo to use to adjust it


[23-Apr-19 01:43 PM] jl777c#5810
if we dont do that, bettors can just add 10x the value to avoid any chance of being rekt


[23-Apr-19 01:44 PM] jl777c#5810
what we want to do is tune it so that adding more funds might reduce the rekt chance in the short term, but doesnt change it much at all in the long term


[23-Apr-19 01:44 PM] jl777c#5810
so the adding funds should be equivalent to having made a bigger bet, i guess at a lower margin


[23-Apr-19 01:45 PM] jl777c#5810
open to suggestions


[23-Apr-19 01:45 PM] jl777c#5810
once we see the costbasis and profits at leverage, i think we can see how addfunds affects specific positions


[23-Apr-19 01:45 PM] jl777c#5810
it might be we have to remove the ability to be able to add funds


[23-Apr-19 01:46 PM] jl777c#5810
oh, maybe adding funds adjusts the cost basis so it is a bit more preferential, but it increases leverage?


[23-Apr-19 01:47 PM] jl777c#5810
double the funds, then doubles the leverage. i think the odds of rekt are pretty much the same


[23-Apr-19 01:47 PM] jl777c#5810
if this checks out, then leverage is the specified leverage * (total funds/positionsize)


[23-Apr-19 01:48 PM] jl777c#5810
it does complicate things quite a bit though if leverage is different at different heights


[23-Apr-19 01:49 PM] jl777c#5810
it might even need a bit of a delay to help save the losing position. anyway, I think you guys can see the tradeoffs and the goal, so hopefully a good solution will emerge


[23-Apr-19 02:06 PM] dimxy#2587
ok, I need to review this more carefullyüòÄ 
I can see that who bets should understand he would deal not with real values but with math processed values (more like betting on trends, not short time changes)


[23-Apr-19 02:10 PM] TonyL#3577
Betting on trend is possible when leverage is small, because with high leverage your position might be liquidated super fast and trend forming quite long. 
Usually high leverage positions (like a 100x) aimed to minute candles gambling


[23-Apr-19 02:11 PM] TonyL#3577
So if you bet with high leverage you should be able to close your position on the next price change, otherwise it have not much sense imo


[23-Apr-19 02:17 PM] TonyL#3577
With leverage below level x25 you can monitor it, carefully protect by margin adding or close by stop and your close target might be in few weeks or months, but high leverage it's pure gambling with some apofenia usually where you mostly aiming to "double or nothing" in a few minutes


[23-Apr-19 02:23 PM] jl777c#5810
for such betting needs, there is dice


[23-Apr-19 02:23 PM] jl777c#5810
prices CC is for non-minute by minute tradings


[23-Apr-19 02:24 PM] TonyL#3577
But there is a 777 max leverage üòÉ


[23-Apr-19 02:24 PM] jl777c#5810
somebody has to finance the payouts for the other leverages

{Reactions}
üòÇ 

[23-Apr-19 02:24 PM] jl777c#5810
i think due to min/max any high leverage will indeed be very rare to payout, but when it does it is a crazy big amount


[23-Apr-19 02:25 PM] jl777c#5810
so we do need to have ways to see total exposure of all the bets


[23-Apr-19 02:25 PM] jl777c#5810
and then maybe to limit maxleverage*position side to be within some reasonable limits

{Reactions}
üëç 

[23-Apr-19 02:26 PM] TonyL#3577

{Attachments}
https://cdn.discordapp.com/attachments/560714286369079299/570359867999649826/777-online-slots.png


[23-Apr-19 02:26 PM] TonyL#3577
777 leverage ^^  üòÉ


[23-Apr-19 03:13 PM] TonyL#3577
Playing with `pricesaddfunding` at the moment. Was able to add 1 coin 3 times, but on forth I got error with blank message and no daemon prints:
```./komodo-cli -ac_name=REKT0 pricesaddfunding 02d161b021fbeebd2257db135ab2463f0da4887377a9ea0526a4fa5807bc897a 1
prices_batontxid() added amount=100000000
prices_batontxid() added amount=100000000
prices_batontxid() added amount=100000000
{
  "hex": "0400008085202f89029a0341e85025ec929e9c40d5eff60d9759208d4c3a430c3b0dc7b930336727490400000049483045022100dc61b42f24782421bfdff5603d2bb1e440de4f10fd34cf96cffb1982a107a3ce022063d0d6f32fa6f3d661bdfc8dcf68dd3497cec9617afc22abf2827e66667f282201ffffffffa28c6176da057057be84cfa6cbff9d25b2e511aaa4aa25cdbec45927c5e40290000000007b4c79a276a072a26ba067a5658021029fe332bce5ccc040c8a13ef5a4664ae841a7b5d3ee6c3ada144c1f3f9b4e1186814042de381d60c1bdc46efea179988eac9222e4c466ace2e5d050fecaf944e9815c4b2bbc1cbd186f1fd56d733bc4f9d7f00ff8431b19b8f4033ea1e71dae774f70a100af038001eda10001ffffffff041027000000000000302ea22c8020e3878d662c6e70069aff63095bf1ce79e7c24eebfb87e2d3e398314e84e09ba38103120c008203000401cc00e1f50500000000302ea22c80203ee64ec5f134da404710d306dcd9ca54a0139b3c4827b43a988fc6316e6c2a688103120c008203000401cc10c0a537160000002321029fe332bce5ccc040c8a13ef5a4664ae841a7b5d3ee6c3ada144c1f3f9b4e1186ac00000000000000004f6a4c4ced417a89bc0758faa42605eaa9777388a40d3f46b25a13db5722bdeefb21b061d10221029fe332bce5ccc040c8a13ef5a4664ae841a7b5d3ee6c3ada144c1f3f9b4e118600e1f5050000000000000000c90b00000000000000000000000000",
  "txid": "291279986c61e374f43579b9f3e8d7871038a4daa5aa33d061dd4ffb2245acb8",
  "result": "success"
}
```


[23-Apr-19 03:13 PM] TonyL#3577
```./komodo-cli -ac_name=REKT0 sendrawtransaction 0400008085202f89029a0341e85025ec929e9c40d5eff60d9759208d4c3a430c3b0dc7b930336727490400000049483045022100dc61b42f24782421bfdff5603d2bb1e440de4f10fd34cf96cffb1982a107a3ce022063d0d6f32fa6f3d661bdfc8dcf68dd3497cec9617afc22abf2827e66667f282201ffffffffa28c6176da057057be84cfa6cbff9d25b2e511aaa4aa25cdbec45927c5e40290000000007b4c79a276a072a26ba067a5658021029fe332bce5ccc040c8a13ef5a4664ae841a7b5d3ee6c3ada144c1f3f9b4e1186814042de381d60c1bdc46efea179988eac9222e4c466ace2e5d050fecaf944e9815c4b2bbc1cbd186f1fd56d733bc4f9d7f00ff8431b19b8f4033ea1e71dae774f70a100af038001eda10001ffffffff041027000000000000302ea22c8020e3878d662c6e70069aff63095bf1ce79e7c24eebfb87e2d3e398314e84e09ba38103120c008203000401cc00e1f50500000000302ea22c80203ee64ec5f134da404710d306dcd9ca54a0139b3c4827b43a988fc6316e6c2a688103120c008203000401cc10c0a537160000002321029fe332bce5ccc040c8a13ef5a4664ae841a7b5d3ee6c3ada144c1f3f9b4e1186ac00000000000000004f6a4c4ced417a89bc0758faa42605eaa9777388a40d3f46b25a13db5722bdeefb21b061d10221029fe332bce5ccc040c8a13ef5a4664ae841a7b5d3ee6c3ada144c1f3f9b4e118600e1f5050000000000000000c90b00000000000000000000000000

error code: -25
error message:
```


[23-Apr-19 03:18 PM] TonyL#3577
Hmm probably it's consensus problems, my bets creation transactions stuck in mempool, have `"connections": 1` and such ```2019-04-23 22:14:29 connect() to [2a04:2180:0:2::29]:42217 failed after select(): Permission denied (13)
2019-04-23 22:15:35 connect() to [64:ff9b::3441:3a67]:42217 failed after select(): Connection refused (111)
2019-04-23 22:15:47 connect() to [64:ff9b::4e2f:c492]:42217 failed after select(): Connection refused (111)
2019-04-23 22:16:47 connect() to 185.64.105.111:42217 failed after select(): No route to host (113)
2019-04-23 22:16:59 connect() to 159.65.134.48:42217 failed after select(): Connection refused (111)
2019-04-23 22:17:08 connect() to [64:ff9b::5fd5:ee62]:42217 failed after select(): Connection refused (111)
``` prints in debug.log


[23-Apr-19 10:43 PM] jl777c#5810
it could be that with different versions with different validations, there are consensus conflicts


[23-Apr-19 10:44 PM] jl777c#5810
maybe it is good for now to just always allow CC tx, eg. validation returns true but just have error messages instead of returning false


[23-Apr-19 10:44 PM] jl777c#5810
when all the new tx are working without error messages, then we spawn a new chain with all the validation active


[23-Apr-19 11:00 PM] dimxy#2587
I ve already guessed about just loggingüòÄ


[24-Apr-19 12:49 AM] dimxy#2587
I found  what validation error was with that txn  02d161b021fbeebd2257db135ab2463f0da4887377a9ea0526a4fa5807bc897a .
Actually I implemented a validation rule when bettx is checked if its normal inputs are really signed with the pubkey in the opret.
The idea was not to allow to do bets for others.
But if a wallet has several privkeys it might cause this rule violation.
Is this check useful?
(I think I need also to check this also at the creation of bet txns to prevent validation errors, if to do this at all. And the problem is we cannot add normal vins for the specified pk, AddNormalinputs func always adds vins for any available privkey in the wallet)


[24-Apr-19 12:52 AM] jl777c#5810
maybe change to adding just inputs from the same -pubkey?


[24-Apr-19 12:55 AM] dimxy#2587
for this we need to change AddNormalinputs (currently it does not use the pubkey param)


[24-Apr-19 12:57 AM] jl777c#5810
yes, maybe make an optional parameter that allows this


[24-Apr-19 12:58 AM] jl777c#5810
or maybe we dont care who is funding things?


[24-Apr-19 01:05 AM] dimxy#2587
ok, maybe for now it is okay to postpone this issue.
And I had the similar one for tokens: in token creation tx there is also a pubkey who created it. I thought it is good to check if token creation txn's normal inputs are really signed with the pk in the opret (to be able to trust that the token is really created with this pubkey)


[24-Apr-19 01:21 AM] jl777c#5810
the pubkey in the opreturn signifies who owns it


[24-Apr-19 01:22 AM] jl777c#5810
it seems ok to create a token on behalf of someone else


[24-Apr-19 01:42 AM] dimxy#2587
ok,
(but I thought it could be a way of cheating with tokens. As tokens are issued with some pubkey token users should trust this pubkey. So they probably want to be sure that the token was really issued with this pk. What if someone tries to create a fake token and puts in the opret a well-known pk which everybody trusts?)


[24-Apr-19 01:43 AM] jl777c#5810
but then wouldnt the token be owned by that trusted pubkey?


[24-Apr-19 01:43 AM] jl777c#5810
maybe make sure at least one vin is signed by the same pubkey?


[24-Apr-19 01:49 AM] dimxy#2587
yes, if at least one input is signed with the pubkey it would prove the ownership.


[24-Apr-19 07:38 AM] TonyL#3577
Technically the web-interface works now - have graph, showing balance, possible to open position, displaying opened postions with possibility to add leverage or cashout and also possible to check closed positions history
Only problem is that it's super ugly now üòÉ


[24-Apr-19 07:44 AM] dimxy#2587
I'reviewing the notes from prices.cpp. It states:
 'In order to allow finding the right costbasis, for long bets the maximum price between the correlated and smoothed price is needed over the first day after the bet. For short bets, the minimum price is needed.'
So this is going to be corrected (as we discussed earlier that costbasis is max (or min) for only green line for 24h)?

{Reactions}
ü§ï 

[24-Apr-19 08:29 AM] jl777c#5810
change the notes


[24-Apr-19 08:29 AM] jl777c#5810
only use smoothed prices


[24-Apr-19 08:59 AM] dimxy#2587
I'm thinking about adding funds to bets.
To calculate profits for a bet (without any added funds) at some moment we need a costbasis which is actually price value for the moment of position opening (calculated with some algo). Plus we need a price at this given moment. So profits(loss) = position*(price-costbasis)/costbasis*leverage
What if the bettor added some funds? Actually it means the bettor continues to believe in the price's trend.
But as he added funds later, for this addition profits/loss would be at lower proportion (it would allow to save from rekt).
So why not to calculate its own costbasis for added fund, just at the height when the fund was added? 
And the leverage should be the same, the bettor cannot change it (otherwise it would be just a new bet)

Example:
init position=1000, lev=10, costbasis=100, at some moment price=90 (the price decrease was linear)
at this moment profits=1000*10*(90-100)/100 = -1000 (complete loss)
if a fund of 1000 was added in the middle of the period, its costbasis = 95
for the added funds for the same moment profits = 1000 * 10 (90-95)/95 = -526
total profits = -1526
but total bet now = 2000, so we are not rekt!


[24-Apr-19 09:10 AM] TonyL#3577
`So why not to calculate its own costbasis for added fund, just at the height when the fund was added? ` - so added funds will be like a positions inside position which accumulating to single rekt price 
Imo there should be clear formula for rektprice movment depends of margin (aka funding) adding/taking. (added margin is single accumulated number actually) - such separation on each added funding looks like a over complication.
After position opening rekt price (price when position will be liquidated) is X, when added leverage liquadtion price is X1, when added more - liquidation price is X2


[24-Apr-19 09:10 AM] TonyL#3577
Clue is to find correct formula for liqudation price calculation depends of margin amount


[24-Apr-19 09:15 AM] TonyL#3577
Init position=1000, lev=10, costbasis 100: your liqudation price is ~90 (10% spike = 100% loss with 10x leverage)
Let's say 100 funds added to position, now you have 1100 as position amount (your funds placed into position) and initial 9000 as leveraged funds (funds added as margin so werent leveraged), so now actual leverage is less (not 1000/9000 but 1100/9000) and rekt price is moving


[24-Apr-19 09:17 AM] TonyL#3577
Marginal trading working approx like this in my understanding


[24-Apr-19 09:24 AM] dimxy#2587
yes for your example I calculated the liquidation price = 89,5
that is what adding funds allows to achieve - to add cover from losses.


[24-Apr-19 09:37 AM] jl777c#5810
yes, clearly it needs to be a deterministic formula. I think what you describe is certainly better than my initial version


[24-Apr-19 09:38 AM] jl777c#5810
maybe we can model it with a few examples and see how it works, if it seems reasonable, implement it and try it out


[24-Apr-19 09:39 AM] jl777c#5810
or if it is easy to implement it, just implement it and see if it allows for any way to cheat or have some system that can make money more than 50% of the time. We assume that price predictions without future knowledge is a 50% accuracy thing to do

{Reactions}
üëç 

[24-Apr-19 10:10 AM] TonyL#3577
http://18.219.69.40:777/ made kinda open demo of trading interface üòÉ 
So anybody can place bet for my wallet (if you will try - please use not huge amounts to not drain it fast)
Synthetic input just like a `BTC_USD, 1` and etc, without `"`


[24-Apr-19 10:12 AM] jl777c#5810
why is redline strange?


[24-Apr-19 10:13 AM] TonyL#3577
It's connected to dimxy repo daemon


[24-Apr-19 10:13 AM] TonyL#3577
Graphs part I not touched at all


[24-Apr-19 10:13 AM] TonyL#3577
But it looks totally different from http://159.69.45.70:8050/ which connected to jl777


[24-Apr-19 10:14 AM] jl777c#5810
yes, that is what I am saying.


[24-Apr-19 10:14 AM] jl777c#5810
greenline seems wrong


[24-Apr-19 10:14 AM] TonyL#3577
Orange fluctuate very little also


[24-Apr-19 10:15 AM] jl777c#5810
it makes it a much more realtime signal. maybe it is some test version i made. whatever it is, maybe we consider using that mode?


[24-Apr-19 10:16 AM] TonyL#3577
Lines on this graph http://18.219.69.40:777/ looks adequate, not sure what is the difference in calculations


[24-Apr-19 10:18 AM] jl777c#5810
it is in the smooth function call


[24-Apr-19 10:20 AM] jl777c#5810
oh, maybe it is due to DAYWINDOW 7

{Reactions}
üíØ 

[24-Apr-19 10:20 AM] jl777c#5810
that makes it a one hour delay


[24-Apr-19 10:20 AM] jl777c#5810
this opens up 2% attack


[24-Apr-19 10:22 AM] TonyL#3577
Most probably - it's daemon with DAYWINDOW 7, yes


[24-Apr-19 10:26 AM] jl777c#5810
that explains it


[24-Apr-19 10:26 AM] jl777c#5810
redline needs to be shifted by DAYWINDOW


[24-Apr-19 10:26 AM] jl777c#5810
or not displayed if it is so short


[24-Apr-19 10:27 AM] TonyL#3577
Aha, I see - it shifting same 24 hours what have no sense with such daemon


[24-Apr-19 10:29 AM] TonyL#3577
http://18.219.69.40:777/ - changed shift to 1 hour


[24-Apr-19 10:29 AM] TonyL#3577
Difference is visible only with zoom now, so can just not display it in this mode


[24-Apr-19 10:35 AM] jl777c#5810
agreed


[24-Apr-19 12:08 PM] dimxy#2587
What I am still concerned with is how to get the cashout price.
it was suggested to use the smoothed price at the cashout moment for it.
But smoothed price is calculated as 24h-period-averaged value and it is actually correlated to raw price at 24h ago point. 
So at the cashout moment the actual raw price might be high, but we may get it it as low just because it was also low 24h ago.


[24-Apr-19 12:09 PM] jl777c#5810
it is the average value of DAYWINDOW


[24-Apr-19 12:09 PM] jl777c#5810
it is correlated to the average value, so maybe 12 hours ago if it is a steady increase/decline


[24-Apr-19 12:10 PM] jl777c#5810
since we calculate the costbasis from the smoothed, what is wrong with using smoothed for cashout?


[24-Apr-19 12:11 PM] jl777c#5810
for longer term positions, it wont really matter that much


[24-Apr-19 12:21 PM] dimxy#2587
ok, I'll make changes and let's see what we get as profits/losses and compare it with the chart


[25-Apr-19 12:28 AM] jl777c#5810
is it my imagination or is this getting almost ready for public testing?


[25-Apr-19 12:29 AM] jl777c#5810
we can start testing before all the validations as getting user feedback is likely an important factor that will take time and can be done in parallel with validation


[25-Apr-19 12:46 AM] dimxy#2587
yes, I'm finishing the lastest changes for added bets and  making the validation less strict
and  hope it is ready for testing


[25-Apr-19 05:25 AM] Markus#5464
@jl777c how does the whole concept look like? will u be able to bet on any crypto either going up or down? will u pay with that crypto u bet on and get paid in that crypto or will there be a standard coin/token used?


[25-Apr-19 05:36 AM] jl777c#5810
for now you bet in the native coin, but we plan to add token betting


[25-Apr-19 05:37 AM] jl777c#5810
with token betting you could then bet the supported gateways CC coins


[25-Apr-19 05:37 AM] jl777c#5810
you can bet long or short, with margin for any synthetic you can construct out of the prices at http://159.69.45.70:8050/


[25-Apr-19 06:43 AM] jl777c#5810
@dimxy you will need to have some global exposure based limiting of positionsize leverage


[25-Apr-19 06:43 AM] jl777c#5810
it wont be possible to be exact but you should be able to deterministically calculate the total amount of bets that are possible to accept in a given block


[25-Apr-19 06:44 AM] jl777c#5810
then using that to approve/reject bets during validation


[25-Apr-19 06:44 AM] jl777c#5810
this way, we can avoid the system being bankrupted no matter what and if people want to allow more bets, additional funds need to be able to be added to the global balance


[25-Apr-19 06:57 AM] dimxy#2587
so it probably should take into account existing bets and  total bankroll  amount and set some bet limit to protect bankroll to go negative?


[25-Apr-19 06:58 AM] jl777c#5810
yes


[25-Apr-19 06:58 AM] jl777c#5810
so at first only small bets would be able to do maxleverage


[25-Apr-19 06:59 AM] jl777c#5810
but as people get rekt the bankroll gets bigger and people can bet more and more


[25-Apr-19 06:59 AM] jl777c#5810
I want to make a REKT as a sidechain for BET, and then have the profits go to snapshot payments CC


[25-Apr-19 07:48 AM] Markus#5464
Will there be a explorer or so for open positions/rekt contracts/closed positions?


[25-Apr-19 07:51 AM] TonyL#3577
I'm working on demo interface (http://18.219.69.40:777/)


[25-Apr-19 07:51 AM] TonyL#3577
So it's not hard to get lists of open/closed positions now and I think that somebody will make beauty explorer


[25-Apr-19 07:57 AM] jl777c#5810
@Markus i forgot to mention that anybody can rekt any open position eligible to be rekt and collect a fee. sort of like mining


[25-Apr-19 08:15 AM] TonyL#3577
First person who will implement rekt mining pool (which will not mine coins but rekt positions) should be monopolist for some time üòÉ


[25-Apr-19 10:57 AM] TonyL#3577
```./komodo-cli -ac_name=REKT0 pricesbet 1 1 "BTC_USD, !"
parsed synthetic: BTC_USD ! 
opcode=1 opstr=BTC_USD need=0 depth=0
depth++=1
opcode=8192 opstr=! need=1 depth=0
depth++=1
prices_syntheticvec() depth.1 not empty
{
  "result": "error",
  "error": "invalid synthetic"
}
```
How to propertly use `!` (not) operator?  
Thought it should open USD_BTC position


[25-Apr-19 10:58 AM] TonyL#3577
```./komodo-cli -ac_name=REKT0 pricesbet 1 1 "BTC_USD, JPY_USD, !"
parsed synthetic: BTC_USD JPY_USD ! 
opcode=1 opstr=BTC_USD need=0 depth=0
depth++=1
prices_syntheticvec() incorrect opcode=JPY_USD
{
  "result": "error",
  "error": "invalid synthetic"
}
```
Or this one ^^ ( planned as BTC_JPY )


[25-Apr-19 10:59 AM] TonyL#3577
With second one it's clear (`prices_syntheticvec() incorrect opcode=JPY_USD`)


[25-Apr-19 11:03 AM] TonyL#3577
Aha, weights are mandatory now
`./komodo-cli -ac_name=REKT0 pricesbet 1 1 "BTC_USD, 1, STRAT_BTC, 1"`  for two tickers only transaction generating option

Have also no luck so far with ```* /  ! ``` symbols usage


[25-Apr-19 11:05 AM] jl777c#5810
* and / need 2 values in stack


[25-Apr-19 11:06 AM] jl777c#5810
! consumes 1


[25-Apr-19 11:06 AM] jl777c#5810
there needs to be 0 at the end


[25-Apr-19 11:06 AM] jl777c#5810
"BTC_USD, !, 1"


[25-Apr-19 11:06 AM] jl777c#5810
should be USD/BTC


[25-Apr-19 11:07 AM] TonyL#3577
```./komodo-cli -ac_name=REKT0 pricesbet 1 1 "BTC_USD, !, 1"
bash: !,: event not found```


[25-Apr-19 11:11 AM] TonyL#3577
```./komodo-cli -ac_name=REKT0 pricesbet 1 1 "BTC_USD, \!, 1"
parsed synthetic: BTC_USD \! 1 
opcode=1 opstr=BTC_USD need=0 depth=0
depth++=1
prices_syntheticvec() incorrect opcode=\!
{
  "result": "error",
  "error": "invalid synthetic"
}
```
and not parsing when I'm screening


[25-Apr-19 11:13 AM] jl777c#5810
maybe use %2? not sure the ascii value for !


[25-Apr-19 11:15 AM] TonyL#3577
For `!` ASCII code should be 33


[25-Apr-19 11:16 AM] jl777c#5810
%21


[25-Apr-19 11:17 AM] TonyL#3577
```./komodo-cli -ac_name=REKT0 pricesbet 1 1 "BTC_USD, %21, 1"
parsed synthetic: BTC_USD %21 1 
opcode=1 opstr=BTC_USD need=0 depth=0
depth++=1
prices_syntheticvec() incorrect opcode=%21
{
  "result": "error",
  "error": "invalid synthetic"
}
```


[25-Apr-19 11:17 AM] jl777c#5810
no idea


[25-Apr-19 11:17 AM] jl777c#5810
i guess special chars need some special handling? or maybe it isnt parsing right at all?


[25-Apr-19 11:19 AM] jl777c#5810
bugs for dimxy to fix


[25-Apr-19 11:19 AM] TonyL#3577
https://github.com/dimxy/komodo/blob/prices-rpc/src/cc/prices.cpp#L464 - yes I think some special handling is needed here becasue I cant see way how to pass exactly `!`

{Embed}
https://github.com/dimxy/komodo/blob/prices-rpc/src/cc/prices.cpp
dimxy/komodo
Komodo. Contribute to dimxy/komodo development by creating an account on GitHub.
https://images-ext-2.discordapp.net/external/FG7_8N0jtCftKtsAk7K5U05eeO1dpQWPnEQ9A5NQLBI/%3Fs%3D400%26v%3D4/https/avatars0.githubusercontent.com/u/21120539


[25-Apr-19 11:20 AM] TonyL#3577
`!` is special reserved unix symbol, can pass `\!`


[25-Apr-19 11:22 AM] jl777c#5810
maybe we can change it to a different symbol


[25-Apr-19 11:22 AM] TonyL#3577
I propose very pythonic `not` üòÉ


[25-Apr-19 11:23 AM] jl777c#5810
"inv"

{Reactions}
üëç 

[25-Apr-19 11:23 AM] jl777c#5810
do * and / work?


[25-Apr-19 11:24 AM] TonyL#3577
Can't find combination to make it work


[25-Apr-19 11:24 AM] TonyL#3577
```./komodo-cli -ac_name=REKT0 pricesbet 1 1 "BTC_USD, 1, *, STRAT_BTC, 1"
parsed synthetic: BTC_USD 1 * STRAT_BTC 1 
opcode=1 opstr=BTC_USD need=0 depth=0
depth++=1
opcode=2049 opstr=1 need=1 depth=0
prices_syntheticvec() incorrect not enough operands for opcode=*
{
  "result": "error",
  "error": "invalid synthetic"
}
```


[25-Apr-19 11:25 AM] jl777c#5810
* needs 2 on the stack


[25-Apr-19 11:25 AM] jl777c#5810
"BTC_USD, USD_JPY, *, 1"


[25-Apr-19 11:25 AM] TonyL#3577
Ah, I see. I 've tried to use as in algebra (A*B)


[25-Apr-19 11:25 AM] jl777c#5810
like an HP calculator


[25-Apr-19 11:25 AM] jl777c#5810
forth rpn


[25-Apr-19 11:26 AM] TonyL#3577
` ./komodo-cli -ac_name=REKT0 pricesbet 1 1 "BTC_USD, STRAT_BTC, *, 1"` this option worked


[25-Apr-19 11:26 AM] jl777c#5810
* and / take 2 items on the top of stack


[25-Apr-19 11:26 AM] jl777c#5810
at the end there must be 0


[25-Apr-19 11:27 AM] jl777c#5810
,nnn adds the top of stack to the accumulator


[25-Apr-19 11:29 AM] TonyL#3577
```./komodo-cli -ac_name=REKT0 pricesbet 1 1 "BTC_USD, STRAT_BTC, *, 1"```
was expected STRAT/USD price
And it works correct!
```
./komodo-cli -ac_name=REKT0 pricesinfo 3c585d062a616524db0476ea9809ef1d7873d6f05a5e3d8090d65e57fed175c2
{
  "rekt": 0,
  "batontxid": "3c585d062a616524db0476ea9809ef1d7873d6f05a5e3d8090d65e57fed175c2",
  "profits": 0.00000000,
  "costbasis": 0.94510000,
  "positionsize": 1.00000000,
  "equity": 1.00000000,
  "addedbets": 0.00000000,
  "leverage": 1,
  "firstheight": 3250,
  "firstprice": 0.94514612,
  "lastprice": 0.94510000,
  "height": 3250,
  "test_daywindow": 7
}
```


[25-Apr-19 11:37 AM] TonyL#3577
```./komodo-cli -ac_name=REKT0 pricesbet 1 1 "BTC_USD, STRAT_BTC, /, 1"```
```{
  "rekt": 0,
  "batontxid": "4869ff2e9414a5a6b0ca9f1dcea69b6122a3dbb36874dbcb1042d05dc10ca317",
  "profits": 0.00000000,
  "costbasis": 10572439.63450000,
  "positionsize": 1.00000000,
  "equity": 1.00000000,
  "addedbets": 0.00000000,
  "leverage": 1,
  "firstheight": 3250,
  "firstprice": 10572439.63458409,
  "lastprice": 10572439.63450000,
  "height": 3250,
  "test_daywindow": 7
}
```

Not sure how to get such price, it not seems correct

By my calculations it should be:
BTC_USD * BTC_STRAT = ~5500 * ~5800 = ~32352000


[25-Apr-19 11:58 AM] jl777c#5810
overflow?


[25-Apr-19 11:58 AM] jl777c#5810
seems like bugs


[25-Apr-19 02:05 PM] Smedley#8094
Will the bankroll be generated through a premine? Also if gateways cc is used how will the bankroll be generated?


[25-Apr-19 02:24 PM] jl777c#5810
bankroll will need to be funded if it is a sidechain


[25-Apr-19 02:24 PM] jl777c#5810
if it is a standalone chain then there can be a premine, but then you arent betting anything with known value


[25-Apr-19 08:34 PM] TonyL#3577
Daemon on dimxy repo got out sync tonight, tried to resync without luck:
```ht.3271: lag.22670 5508.6767 USD, 4270.6457 GBP, 4948.1853 EUR, GBPUSD 1.289893, EURUSD 1.113272, EURGBP 0.863073 [502]
CC Eval EVAL_PRICES Invalid: incorrect vout to spend spending tx 4869ff2e9414a5a6b0ca9f1dcea69b6122a3dbb36874dbcb1042d05dc10ca317
CC Eval EVAL_PRICES Invalid: incorrect vout to spend spending tx d94b64c5b63c885939c5412164c5c6b715ff3a3fd44a8db93403002f54497221
CC Eval EVAL_PRICES Invalid: incorrect vout to spend spending tx d94b64c5b63c885939c5412164c5c6b715ff3a3fd44a8db93403002f54497221
```
```  "blocks": 3270,
  "longestchain": 3313,
```


[25-Apr-19 10:54 PM] jl777c#5810
CC Eval EVAL_PRICES Invalid: incorrect vout to spend spending tx 4869ff2e9414a5a6b0ca9f1dcea69b6122a3dbb36874dbcb1042d05dc10ca317
all validation needs to be disabled until it is merged into my repo and I update all my nodes


[26-Apr-19 12:10 AM] dimxy#2587
I've reviewed all validation once more (updated my repo). Might need to use reconsiderblock to force sync


[26-Apr-19 12:14 AM] jl777c#5810
the issue is that my nodes are not running with any validation, so if the validation on your nodes reject any tx it will fork


[26-Apr-19 12:15 AM] dimxy#2587
yes as TonyL use my repo with faulty validation he might need to  force resync after updating


[26-Apr-19 12:15 AM] jl777c#5810
aha, ok, that works too


[26-Apr-19 12:15 AM] dimxy#2587
Now priceinfo output is like this:
./komodo-cli -ac_name=REKT0 pricesinfo de6327969f7357f69d800e9eefa5fae707cac178852f5d383fba55cf615471fe
{
  "status": "open",
  "rekt": 0,
  "batontxid": "7a1600158ad706da4f79d6cccaa5ea43130039412332dab4adb4759deff89548",
  "bets": [
    {
      "positionsize": 0.11111000,
      "profits": -0.00036666,
      "costbasis": 5461.77130000,
      "firstheight": 3270
    },
    {
      "positionsize": 0.30300000,
      "profits": -0.00003030,
      "costbasis": 5444.09860000,
      "firstheight": 3331
    }
  ],
  "leverage": 1,
  "TotalPositionSize": 0.41411000,
  "TotalProfits": -0.00039696,
  "equity": 0.41371304,
  "LastPrice": 5443.76890000,
  "LastHeight": 3335
}
-----------------
So it outputs an array with inital bet and subsequent additions
and totals after it


[26-Apr-19 12:18 AM] jl777c#5810
if you are allowing more funds to be added, but each is treated as an independent bet? with the 24hrs scanning for MAX costbasis


[26-Apr-19 12:18 AM] jl777c#5810
otherwise future knowledge is being used with the addition of funds


[26-Apr-19 12:25 AM] dimxy#2587
For a new added bet I calculate a new costbasis beginning from the block where the bet was added and for 24h  (as max value)


[26-Apr-19 12:26 AM] jl777c#5810
i see, so it cant affect the overall success rate, other than by starting fresh it adds more equity so can move an existing positon away from the rekt percentage


[26-Apr-19 12:36 AM] dimxy#2587
yes, if for example I bet on price grow but it constantly went down, then by adding more funds I might delay the rekt


[26-Apr-19 12:36 AM] jl777c#5810
i think as long as future knowledge isnt able to be used the system will be fine


[26-Apr-19 12:36 AM] jl777c#5810
and adding more funds to a bad position is usually a bad thing


[26-Apr-19 07:17 AM] TonyL#3577
Is `pricessetcostbasis` should apply to all "subbets"? Otherwords - should I wait for all subbets to mature to fix costbasis? And what to do if pricessetcostbasis was set already


[26-Apr-19 07:19 AM] dimxy#2587
I believe we have deprecated pricessetcostbasis for now


[26-Apr-19 07:19 AM] TonyL#3577
Oh, ok great


[26-Apr-19 07:20 AM] dimxy#2587
I just scan the chain from the first height and calc the costbasis. When 24h passed I stop and use the latest value


[26-Apr-19 07:21 AM] TonyL#3577
Are these changes in some new branch?


[26-Apr-19 07:22 AM] dimxy#2587
yes, in myrepo, the branch is the same prices-rpc


[26-Apr-19 07:22 AM] TonyL#3577
https://github.com/dimxy/komodo/tree/prices-rpc I can see commits only from 3 days ago

{Embed}
https://github.com/dimxy/komodo/tree/prices-rpc
dimxy/komodo
Komodo. Contribute to dimxy/komodo development by creating an account on GitHub.
https://images-ext-2.discordapp.net/external/FG7_8N0jtCftKtsAk7K5U05eeO1dpQWPnEQ9A5NQLBI/%3Fs%3D400%26v%3D4/https/avatars0.githubusercontent.com/u/21120539


[26-Apr-19 07:22 AM] dimxy#2587
ah, sorry I pushed only to my private

{Reactions}
üëç 

[26-Apr-19 07:23 AM] dimxy#2587
updated


[26-Apr-19 07:28 AM] jl777c#5810
each deposit has a different costbasis?


[26-Apr-19 07:28 AM] jl777c#5810
i think it has to


[26-Apr-19 07:37 AM] TonyL#3577
```ht.2993: lag.234875 5587.0917 USD, 4318.4810 GBP, 4976.0928 EUR, GBPUSD 1.293763, EURUSD 1.122787, EURGBP 0.867846 [98]
height.2993
ht.2994: lag.234336 5593.7617 USD, 4323.6364 GBP, 4982.0334 EUR, GBPUSD 1.293763, EURUSD 1.122787, EURGBP 0.867846 [414]
PricesValidate() funcId=A ValidatebetTx = false bettx normal inputs not signed with pubkey in opret
out 1 vs 0 isValid
CC Eval EVAL_PRICES Invalid: bettx normal inputs not signed with pubkey in opret spending tx 02d161b021fbeebd2257db135ab2463f0da4887377a9ea0526a4fa5807bc897a
ht.2995: lag.233427 5589.2217 USD, 4320.1274 GBP, 4977.9900 EUR, GBPUSD 1.293763, EURUSD 1.122787, EURGBP 0.867846 [879]
couldnt get pricebits for 2994
saplinght.61 tipht.2993 blockht.2995 cmp.1
```


[26-Apr-19 07:37 AM] TonyL#3577
Now getting such print on sync


[26-Apr-19 07:38 AM] dimxy#2587
well and sync stops? (it might be just logging)


[26-Apr-19 07:38 AM] TonyL#3577
Yes, it stops


[26-Apr-19 07:38 AM] TonyL#3577
```  "blocks": 2993,
  "longestchain": 3368,
```


[26-Apr-19 07:44 AM] jl777c#5810
CC Eval EVAL_PRICES Invalid: bettx normal inputs not signed with pubkey in opret spending tx 02d161b021fbeebd2257db135ab2463f0da4887377a9ea0526a4fa5807bc897a
that is validation rejection


[26-Apr-19 07:45 AM] dimxy#2587
yes, I'm clearing


[26-Apr-19 07:51 AM] dimxy#2587
I checked resync from scratch - seems now it validates ok (updated the repo)


[26-Apr-19 07:51 AM] TonyL#3577
Rebuilding


[26-Apr-19 07:55 AM] dimxy#2587
I see how Forex works: if I made a position  then later I can add more to it at the price active at this new moment. A position now consists of two.
So I think when we 're adding another funding we 're doing somewhat similar?


[26-Apr-19 07:56 AM] TonyL#3577
Synced now:
```  "blocks": 3370,
  "longestchain": 3370,
  "timeoffset": 0,
  "tiptime": 1556290001,
  "connections": 1,
```


[26-Apr-19 07:57 AM] TonyL#3577
`I see how Forex works: if I made a position  then later I can add more to it at the price active at this new moment. A position now consists of two.` - trading on Bitmex let's say working different way - you can add margin to position (funds without leverage) so your leverage decreasing and rekt price moving


[26-Apr-19 07:57 AM] TonyL#3577
Never traded Forex to compare


[26-Apr-19 07:59 AM] TonyL#3577
```./komodo-cli -ac_name=REKT0 getpeerinfo
[
  {
    "id": 9,
    "addr": "5.9.253.195:42217",
```
Have only 1 peer


[26-Apr-19 08:00 AM] dimxy#2587
could be like Bitmex, need to decide how we want to do it


[26-Apr-19 08:02 AM] TonyL#3577
Would be great to have some fintech-ninja advisor


[26-Apr-19 08:04 AM] TonyL#3577
Because even in Bittmex model which looks simplier than a lot of parallel bets - there are some limits for added margin, and possible to take it back on some points when your position stands good. And these values should be calculated


[26-Apr-19 08:21 AM] jl777c#5810
i think like forex is good


[26-Apr-19 08:21 AM] jl777c#5810
a lot more forex traders than bitmex traders

{Reactions}
üíØ 

[26-Apr-19 08:21 AM] jl777c#5810
a LOT


[26-Apr-19 08:34 AM] TonyL#3577
Yeah very true, for example legal/illegal forex brokers kinda in almost every building in Russia, but never saw Bitmex brokers üòÉ

{Reactions}
üòÄ 

[26-Apr-19 10:45 AM] dimxy#2587
Actually Bitmex like Forex allows adding more orders to a position (combining same orders to one position).
And Bitmex also indeed allows to add or remove margin to a position changing its leverage by this


[26-Apr-19 10:54 AM] TonyL#3577
`Actually Bitmex like Forex allows adding more orders to a position` just realised that it's a same thing which we have now üòÉ


[26-Apr-19 10:56 AM] TonyL#3577
Imo it'll be super clear for trader if display "synthetic on which bet was made", "average positon price", "position rekt price" for total position


[26-Apr-19 10:57 AM] TonyL#3577
` "average positon price", "position rekt price"` these things possible to calculate on interface side


[26-Apr-19 11:00 AM] dimxy#2587
well I can calculate this on the server side


[26-Apr-19 11:01 AM] TonyL#3577
```average position price = (position1size * position1price + position2size * position2price + ... + positionNsize * positionNsize) / all_positions_sizes_sum```


[26-Apr-19 11:02 AM] TonyL#3577
Should be something like this if my arithmetic correct (by positon1, position2 I mean sub-positions inside position for which we calculating average price)


[26-Apr-19 11:07 AM] TonyL#3577
Am I understand correct that now position can be counted as rekt when `-profit` = `TotalPositionSize` ?


[26-Apr-19 11:10 AM] TonyL#3577
Ah found it in comments ```    if synthetic value + amount goes negative, then anybody can rekt it to collect a rektfee```


[26-Apr-19 11:11 AM] TonyL#3577
So from your side should be not hard to display rekt price


[26-Apr-19 11:14 AM] dimxy#2587
yes I noticed Forex calculates average price in a similar way - as weighed by position sizes.
I consider rekt when  (totalbets + totalprofts) < 0 
(and I also see that it might when it reaches some percentage)


[26-Apr-19 11:16 AM] TonyL#3577
Just for player it's not clear what to track with such condition (when losses equal positon side), but when player see price on which his position will be liquidated he starting to track price


[26-Apr-19 11:17 AM] TonyL#3577
Price X on which losses will exceed the position size is predetermined so clue is only print it


[26-Apr-19 11:19 AM] dimxy#2587
yes  I will add it


[26-Apr-19 11:19 AM] TonyL#3577
Cool! I'll be able to show rekt price line on graph when player select active positon


[26-Apr-19 11:20 AM] TonyL#3577
Hmm just realized that would be great to make tool which will make graphs dynamically for "non-standart" synthetics


[26-Apr-19 11:21 AM] TonyL#3577
Let's say player made some USDBTCBTC/JPYKMDSTRAT position and want to check dynamics graph for this synthetic price


[26-Apr-19 11:21 AM] TonyL#3577
Should help with debug as well, will try to make it


[26-Apr-19 11:23 AM] jl777c#5810
I think we should allow rekt before equity goes negative


[26-Apr-19 01:51 PM] dimxy#2587
As I understand it, Bitmex calls the price when all the margin is spent on  the loss (becomes == 0) as 'Bankruptcy Price'
And they set Liquidation price as some fraction from the Bankruptcy Price allowing to collect some value to the Insurance Fund. 
This fraction depends on leverage (more the leverage less the fraction) So for leverage = 1 they would have Liquidation price as 50%


[29-Apr-19 12:12 AM] dimxy#2587
@TonyL  I added the average costbasis and liqudation price  to the pricesinfo.
The liquidation price is now calculated when equity drops to 0 (but it could be easily changed to some percentage like 10%)

{Reactions}
üî• 

[29-Apr-19 05:38 AM] TonyL#3577
Can see both: 
```./komodo-cli -ac_name=REKT0 pricesinfo 03ead12093697be1fd0d5801e7adf711f0b79ea6380959f82d6b19c98f23488f
{
  "status": "open",
  "rekt": 0,
  "batontxid": "03ead12093697be1fd0d5801e7adf711f0b79ea6380959f82d6b19c98f23488f",
  "costbasis": 5232.78460000,
  "bets": [
    {
      "positionsize": 1.00000000,
      "profits": 0.01220000,
      "costbasis": 5232.78460000,
      "firstheight": 3391
    }
  ],
  "leverage": 2,
  "TotalPositionSize": 1.00000000,
  "TotalProfits": 0.01220000,
  "equity": 1.01220000,
  "LastPrice": 5264.96790000,
  "LastHeight": 3751,
  "LiquidationPrice": 2616.39230000
}
```


[29-Apr-19 05:41 AM] TonyL#3577
Would be great to display synthetic, also there was an issue with `!` (not found the way to use it) and operator  `/` created position with suspicious price. @dimxy is it fine if I open issues in your repo? (so it'll be easier to track issues on github than in chat )


[29-Apr-19 06:09 AM] dimxy#2587
yes I remember about  the synthetic
I need to either store it in the opret or write a function which would reverse parsed vector.
It's  okey to open issues in my repo, of course

{Reactions}
üëå 

[29-Apr-19 07:46 AM] dimxy#2587
if you had bash errors when using '!' operator, I managed to get it work by escaping and quoting:
./komodo-cli -ac_name=REKT0 pricesbet  0.000666 1 "BTC_USD,"\\!",1"


[29-Apr-19 07:54 AM] TonyL#3577
Oh, quotes and escaping.
```./komodo-cli -ac_name=REKT0 pricesbet  0.000666 1 "BTC_USD,"\!",1"
parsed synthetic: BTC_USD ! 1 ```
 That works, thanks!


[29-Apr-19 10:02 AM] dimxy#2587
when I calculate average costbasis,
I could lose precision or get into overflow for either BTC_USD or BTC_USD,!
seems it is time to switch into bignum lib like mini-gmp (which is already used)


[29-Apr-19 10:09 AM] jl777c#5810
yes


[29-Apr-19 10:09 AM] jl777c#5810
that is the simplest solution. blackjok8r had to do that for snapshot calcs

{Reactions}
üëç 

[29-Apr-19 10:16 AM] TonyL#3577
Yep, price for `"BTC_USD,"\!",1"` seems not correct
```
 ./komodo-cli -ac_name=REKT0 pricesinfo 921cbb915c988e850a0dab8aef5315a6ade5b1b52c8e40b51b9e42fe968217fa
{
  "status": "open",
  "rekt": 0,
  "batontxid": "921cbb915c988e850a0dab8aef5315a6ade5b1b52c8e40b51b9e42fe968217fa",
  "costbasis": 0.00010000,
  "bets": [
    {
      "positionsize": 1.00000000,
      "profits": 0.00000000,
      "costbasis": 0.00010000,
      "firstheight": 3751
    }
  ],
  "leverage": 1,
  "TotalPositionSize": 1.00000000,
  "TotalProfits": 0.00000000,
  "equity": 1.00000000,
  "LastPrice": 0.00010000,
  "LastHeight": 3765,
  "LiquidationPrice": 0.00000000
}
```


[29-Apr-19 10:16 AM] TonyL#3577
Should be something like 0.00019.... with current btc price but rounded  to 0.0001


[29-Apr-19 10:29 AM] dimxy#2587
yes,
I temporarily tried to use floating point to solve this - you may update from my repo
but next time willswitch to an integer lib with no int64 limits


[29-Apr-19 12:04 PM] TonyL#3577
Yes, price looks like true on latest:
```
 ./komodo-cli -ac_name=REKT0 pricesinfo 921cbb915c988e850a0dab8aef5315a6ade5b1b52c8e40b51b9e42fe968217fa
{
  "status": "open",
  "rekt": 0,
  "batontxid": "921cbb915c988e850a0dab8aef5315a6ade5b1b52c8e40b51b9e42fe968217fa",
  "costbasis": 0.00018992,
  "bets": [
    {
      "positionsize": 1.00000000,
      "profits": -0.47350000,
      "costbasis": 0.00018992,
      "firstheight": 3751
    }
  ],
  "leverage": 1,
  "TotalPositionSize": 1.00000000,
  "TotalProfits": -0.47350000,
  "equity": 0.52650000,
  "LastPrice": 0.00018968,
  "LastHeight": 3822,
  "LiquidationPrice": 0.00000000
}
```
But not sure how it's possible to lose 47% on USD_BTC position so fast with leverage 1


[29-Apr-19 12:05 PM] TonyL#3577
Maybe it's because first one was calculated not correct


[29-Apr-19 12:05 PM] TonyL#3577
```prices_syntheticprofits() fractional profits=-47350000
prices_syntheticprofits() profits=-47350000
prices_syntheticprice i=0 price=0 value=1 depth=0
prices_syntheticprice warning: errcode in switch=-1
prices_syntheticprice den==0 return err=-11
error getting synthetic price at height.3823
prices_scanchain() prices_syntheticprofits returned -1, breaking```


[29-Apr-19 12:06 PM] TonyL#3577
And getting some `errcode in switch=-1` error on this pricesinfo call in stdout


[29-Apr-19 12:07 PM] TonyL#3577
Have to try to resync from scratch maybe


[29-Apr-19 12:07 PM] dimxy#2587
this error is okay - it means the end of the chain is reached.
I'm checking profits calculation...

{Reactions}
üëå 

[29-Apr-19 12:15 PM] TonyL#3577
```./komodo-cli -ac_name=REKT0 pricesinfo e123e5cd42a2942d24a3ac9e89cef3d8c7cadf493ae7bff9db8027e16f6f5c53
{
  "status": "open",
  "rekt": 0,
  "batontxid": "e123e5cd42a2942d24a3ac9e89cef3d8c7cadf493ae7bff9db8027e16f6f5c53",
  "costbasis": 9.06956919,
  "bets": [
    {
      "positionsize": 77.00000000,
      "profits": -21.93730000,
      "costbasis": 5495.17917034,
      "firstheight": 3213
    }
  ],
  "leverage": 7,
  "TotalPositionSize": 77.00000000,
  "TotalProfits": -21.93730000,
  "equity": 55.06270000,
  "LastPrice": 5272.03282206,
  "LastHeight": 3822,
  "LiquidationPrice": 7.77391645
}
```
LiqudationPrice looks not correct - but this position was opened before than liquadation price was added


[29-Apr-19 12:17 PM] TonyL#3577
Oh such LiqudationPrice should be because of not-correct costbasis `  "costbasis": 9.06956919,`


[29-Apr-19 12:19 PM] TonyL#3577
Negative costbasis:
```./komodo-cli -ac_name=REKT0 pricesinfo d4e6ce577a8dc970ebbfadef9c8f984c648844ce7542310c78fcea6f332a479b
{
  "status": "open",
  "rekt": 0,
  "batontxid": "d4e6ce577a8dc970ebbfadef9c8f984c648844ce7542310c78fcea6f332a479b",
  "costbasis": -38.84405177,
  "bets": [
    {
      "positionsize": 11.00000000,
      "profits": -1.34310000,
      "costbasis": 5495.17917034,
      "firstheight": 3213
    }
  ],
  "leverage": 3,
  "TotalPositionSize": 11.00000000,
  "TotalProfits": -1.34310000,
  "equity": 9.65690000,
  "LastPrice": 5272.03282206,
  "LastHeight": 3822,
  "LiquidationPrice": -25.89603452
}
```
If my positon will be liquidated only at -25 price - I'm all in! üòÉ


[29-Apr-19 12:56 PM] dimxy#2587
both overflow and loss of precision within int64 limits in the cases above
I really need  to switch to gmp lib


[29-Apr-19 01:08 PM] dimxy#2587
I temporarily switched all calculations to floating point.
So now the values should b approximately as they are supposed to be


[29-Apr-19 01:17 PM] dimxy#2587
this ./komodo-cli -ac_name=REKT0 pricesinfo e123e5cd42a2942d24a3ac9e89cef3d8c7cadf493ae7bff9db8027e16f6f5c53 really shows big loss  almost 30%
I believe because of leverage=7


[29-Apr-19 02:38 PM] TonyL#3577
Oh yes, just calculated, it's about -4% BTC spike so 4 * 7 ~28%


[29-Apr-19 03:12 PM] TonyL#3577
```I temporarily switched all calculations to floating point.
So now the values should b approximately as they are supposed to be``` - yep, on latest costbasis looks fine now on all bets


[29-Apr-19 10:20 PM] TonyL#3577
To make  graphs for "non-standart prices" and other stuff I'm making  python library which counting prices independent on client side. Main idea is possibility to operate with accessory displaying things by single prices call output evaluation to custom (not presented in pricesoutput) datasets which can be used as Python list or as CSV file let's say.

(prices call with depth 1)
```
print(visualization_lib.count_stack(rpc_connection, ["BTC_USD", "KMD_BTC", "*", 1], "1"))
 [0.938448574, 1.01312870023, 0.9942287837837783]
```

and for `./komodo-cli -ac_name=REKT0 pricesbet 1 1 "BTC_USD, KMD_BTC, *, 1"` position: 
```
...
  "LastPrice": 0.99388133,
...
}
```

Looks like it works fine - but not support many things yet. For now it possible to create "non-standart" price dataset for single stack with * or / operator.
! - will not be implemented. Instead made support of mirror pairs: e.g. USD_BTC will grab 1/BTC_USD prices


[29-Apr-19 11:35 PM] dimxy#2587
BTW  one of my tasks is the development of a rpc call which would allow to convert a non-existing pair like  KMD_JPY into a set of existing pairs "USD_JPY, USD_KMD, /,1".  This is to be done yet.

{Reactions}
üî• (2) 

[29-Apr-19 11:36 PM] TonyL#3577
POC graph üòÉ (KMD/USD actually)

{Attachments}
https://cdn.discordapp.com/attachments/560714286369079299/572672599138631680/unknown.png

{Reactions}
üëç 

[29-Apr-19 11:38 PM] dimxy#2587
looks like correct quote


[29-Apr-19 11:39 PM] TonyL#3577
Such convertion would be great, at the moment I'm just grabbing all pairs names from prices output then checking if X_Y pair presists, if not checking if Y_X presists, if also not - saying user that luck not on his side today üòÉ (https://github.com/tonymorony/komodo_cryptoconditions_tui/blob/master/lib/visualization_lib.py#L127)

{Embed}
https://github.com/tonymorony/komodo_cryptoconditions_tui/blob/master/lib/visualization_lib.py
tonymorony/komodo_cryptoconditions_tui
Terminal user interfaces for Komodo CryptoConditions smart-contracts - tonymorony/komodo_cryptoconditions_tui
https://images-ext-2.discordapp.net/external/IULxymVak7WPV8PZwfkPCOyLSBf6KKjfvRL8wa24Vjc/%3Fs%3D400%26v%3D4/https/avatars1.githubusercontent.com/u/24797699


[29-Apr-19 11:56 PM] jl777c#5810
very cool that the correlated price for synthetic price works as normal


[30-Apr-19 10:30 AM] dimxy#2587
@TonyL I switched to a big number library

{Reactions}
üëç 

[30-Apr-19 12:21 PM] TonyL#3577
@dimxy now something is wrong in my positions (totalrpofits and equity end with lastprice round part)

{Attachments}
https://cdn.discordapp.com/attachments/560714286369079299/572865102014054422/unknown.png


[30-Apr-19 12:21 PM] TonyL#3577
Eg: ```./komodo-cli -ac_name=REKT0 pricesinfo e123e5cd42a2942d24a3ac9e89cef3d8c7cadf493ae7bff9db8027e16f6f5c53``` or ```./komodo-cli -ac_name=REKT0 pricesinfo 03ead12093697be1fd0d5801e7adf711f0b79ea6380959f82d6b19c98f23488f```

{Reactions}
üëå 

[30-Apr-19 01:11 PM] dimxy#2587
I believe now it is betterüòÄ


[30-Apr-19 01:19 PM] TonyL#3577
Oh yes, looks more intetesting now üòÉ

{Attachments}
https://cdn.discordapp.com/attachments/560714286369079299/572879624455979018/unknown.png


[30-Apr-19 01:20 PM] jl777c#5810
why are they all losses?


[30-Apr-19 01:21 PM] TonyL#3577
All these bets longs and markets not  good these days


[30-Apr-19 01:21 PM] jl777c#5810
ok, so not a bug, just bad trading


[30-Apr-19 01:21 PM] TonyL#3577
Yes, I think so - will open now more both shorts and longs to be sure


[30-Apr-19 01:24 PM] TonyL#3577
Opened two positions with same amount and in same block with -10 and +10 leverage - so will be easy to trackdown how things behave atm


[30-Apr-19 01:29 PM] jl777c#5810
also make some crazy type of synthetic


[30-Apr-19 01:37 PM] TonyL#3577
```./komodo-cli -ac_name=REKT0 pricesbet 77 10 "BTC_USD, KMD_BTC, *, 1, STRAT_BTC, BCHABC_BTC, /, 5"``` Is it crazy enough?


[30-Apr-19 01:48 PM] dimxy#2587
crazy synthetics  would not work yet, 
I need to change calculations  to big num  in some more places


[30-Apr-19 01:52 PM] jl777c#5810
thats not so crazy, i was thinking more like a weighted index of 20


[30-Apr-19 01:52 PM] jl777c#5810
differnet prices


[30-Apr-19 01:57 PM] TonyL#3577
Quite interesting: long and short opened on same block

{Attachments}
https://cdn.discordapp.com/attachments/560714286369079299/572889191239647232/unknown.png


[30-Apr-19 01:57 PM] TonyL#3577
```./komodo-cli -ac_name=REKT0 pricesinfo 479768e996797b66eac8b362f356cb984c07c8d5ec15a22070edc2368c40b184
{
  "status": "open",
  "rekt": 0,
  "batontxid": "479768e996797b66eac8b362f356cb984c07c8d5ec15a22070edc2368c40b184",
  "costbasis": 5260.80807379,
  "bets": [
    {
      "positionsize": 77.00000000,
      "profits": 0.00000000,
      "costbasis": 5260.80807379,
      "firstheight": 3979
    }
  ],
  "leverage": 10,
  "TotalPositionSize": 77.00000000,
  "TotalProfits": 0.00000000,
  "equity": 77.00000000,
  "LastPrice": 5260.80807379,
  "LastHeight": 3981,
  "LiquidationPrice": 4734.72726642
}```


[30-Apr-19 01:57 PM] TonyL#3577
```./komodo-cli -ac_name=REKT0 pricesinfo 4e8232174b3289677fbd75cb5fa9629aa4b1210d54345ba6add3cbf9496fa3b0
{
  "status": "open",
  "rekt": 0,
  "batontxid": "4e8232174b3289677fbd75cb5fa9629aa4b1210d54345ba6add3cbf9496fa3b0",
  "costbasis": 5260.06156758,
  "bets": [
    {
      "positionsize": 77.00000000,
      "profits": -0.10927070,
      "costbasis": 5260.06156758,
      "firstheight": 3979
    }
  ],
  "leverage": -10,
  "TotalPositionSize": 77.00000000,
  "TotalProfits": -0.10927070,
  "equity": 76.89072930,
  "LastPrice": 5260.80807379,
  "LastHeight": 3981,
  "LiquidationPrice": 5786.06772433
}
```


[30-Apr-19 01:58 PM] TonyL#3577
Costbasis not equal to LastPrice for short now by some reason


[30-Apr-19 01:59 PM] TonyL#3577
```"firstheight": 3979
"LastHeight": 3981,``` but only two blocks since I've opened these positions


[30-Apr-19 02:00 PM] jl777c#5810
short costbasis is the min


[30-Apr-19 02:00 PM] jl777c#5810
long costbasis is the max

{Reactions}
üëç 

[30-Apr-19 02:01 PM] TonyL#3577
hmm profits for short started to calculate but for long not


[30-Apr-19 02:02 PM] jl777c#5810
no profits on long side


[30-Apr-19 02:02 PM] TonyL#3577
Ah, for long costbasis still equal LastPrice, not quite understand how it's calculating


[30-Apr-19 02:03 PM] TonyL#3577
How for diametrical positions one can be in profit and other not in minus


[30-Apr-19 02:03 PM] TonyL#3577
If I've opened -10 and +10 positions at same block: if one is -0.1 I expect other to be +0.1


[30-Apr-19 02:04 PM] dimxy#2587
BTW  firstheight isnt the block where the tx is mined but equals to chaintip at the moment when the tx is created.
Maybe it is better to change it to actually mined block?


[30-Apr-19 02:05 PM] TonyL#3577
I checked `getrawtransaction 1` for these two bets and block is same for both (so profits should be equal to 0 in total I wonder): ```  "height": 3980,
  "confirmations": 5,
  "rawconfirmations": 5,
```


[30-Apr-19 02:06 PM] dimxy#2587
yes but the firstehight is 3979


[30-Apr-19 02:06 PM] dimxy#2587
I think the correct is 3980


[30-Apr-19 02:06 PM] jl777c#5810
if you do the min vs max logic, there is no assurance at all that it will be symmetric


[30-Apr-19 02:08 PM] TonyL#3577
Symmetrical positions with 2 stacks synthetic behave the same atm (short started to show some negative profits, long staying at 0)

{Attachments}
https://cdn.discordapp.com/attachments/560714286369079299/572892068330995723/unknown.png


[30-Apr-19 02:08 PM] TonyL#3577
Hmm, have to find formula, now not understand  clear how it's calculating


[30-Apr-19 02:13 PM] TonyL#3577
`min vs max logic` shouldn't it calculate as fixed costbasis vs current price?


[30-Apr-19 02:15 PM] jl777c#5810
costbasis changes every block (maybe) for first 24hrs


[30-Apr-19 02:15 PM] dimxy#2587
I calculate it as max price for longs
Or min for shorts for the period to 24h


[30-Apr-19 02:17 PM] TonyL#3577
Aha, so this logic using before costbasis is fixed on some point (24 hours or 7 blocks in test mode)


[30-Apr-19 02:19 PM] TonyL#3577
So let's say: I opened long when price was on 1000, it's spike to 1500 at hour 10, on 24th hour price down back to 1000
My costbasis fixing now.  Will it be like I'm opened long on 1500 but current price is 1000 so I'm in -33% loss?


[30-Apr-19 02:21 PM] jl777c#5810
yes!


[30-Apr-19 02:21 PM] jl777c#5810
but you can leverage it 100x or more and make up for the losses


[30-Apr-19 02:23 PM] TonyL#3577
Aha, so at first it's actually just some "replay" before real data start


[30-Apr-19 02:23 PM] TonyL#3577
Will be omegalul to be rekt during replay üòÇ


[30-Apr-19 02:23 PM] jl777c#5810
well i think you wanted to be able to be rekt during the first 24hrs


[30-Apr-19 02:24 PM] TonyL#3577
Oh, I've just understood system wrong before I think


[30-Apr-19 02:24 PM] jl777c#5810
we cant have future knowledge being used for the bets


[30-Apr-19 02:25 PM] TonyL#3577
Accept bets which apriori rekt by historical data It's like a accept bets on score 3-1 in football match on the next day when it finished with 0-0 score


[30-Apr-19 02:25 PM] jl777c#5810
since the greenline takes 24 hrs backwards, it is contaminated with future knowledge over the next 24hrs


[30-Apr-19 02:25 PM] jl777c#5810
but in exchange for this, you are only charge fee on the amount bet, not the leveraged amount


[30-Apr-19 06:53 PM] TonyL#3577

{Attachments}
https://cdn.discordapp.com/attachments/560714286369079299/572963784445132824/prices_builder.mp4


[30-Apr-19 06:57 PM] TonyL#3577
Connected custom prices builder with current interface prototype. Library creating local CSV prices files (on first load app scanning "usergraphs" folder to fill usergraphs dropdown) so it's work quite fast


[30-Apr-19 07:03 PM] TonyL#3577
Multistacks support is next on this interface roadmap


[01-May-19 01:04 AM] dimxy#2587
added support for big numbers for synthetic prices, now  \*\*\*, ///, **/  operations should work without overflow
(But need to test each operator yet)

{Reactions}
üî• 

[01-May-19 01:22 AM] Mylo#8306
@TonyL what was the ruble price at 57seconds?


[01-May-19 01:24 AM] Mylo#8306
what was it showing 0.012.  i coudn't follow what it was displaying the synthetic price of.


[01-May-19 01:24 AM] Mylo#8306
ps looks awesome - is it easy to install, jl777/jl777 & tui?


[01-May-19 02:57 AM] TonyL#3577
@Mylo  it was `USD/RUB * KMD/BTC` price - RUB is russian ruble yup


[01-May-19 02:59 AM] TonyL#3577 (pinned)
`ps looks awesome - is it easy to install, jl777/jl777 & tui?` - thanks üòÉ yeah, at the moment it's working with dimxy repo and things not merged in komodo repos because it's in actively debugging stage
This webapp need few more pip deps but in general steps are just: 
start REKT0 chain, start `python3 prices_app_v2.py` and interface by default availiable on 777 port


[01-May-19 03:03 AM] TonyL#3577
@dimxy Great! Not totally understood yet how these operators work, will re-read it's description and test when wake-up


[01-May-19 03:06 AM] TonyL#3577
Or maybe understood: so by default all operators multiplying and we can choose which ones we want to flip by `/`


[01-May-19 03:08 AM] TonyL#3577
Am I understand correct that `///` operator for A/B, A/B, A/B actually will do multiplying B/A * B/A * B/A  and `***` operator for  A/B, A/B, A/B will do A/B * A/B * A/B ?


[01-May-19 03:45 AM] dimxy#2587
/// *** etc requires 3 operands


[01-May-19 03:50 AM] TonyL#3577
Aha, but between 3 operands possible to put 2 infix operators 
So actually `A/B, A/B, A/B, ///` is something like a `1 / (A/B) * 1 / (A/B) * 1 / (A/B)` ?


[01-May-19 03:52 AM] jl777c#5810
yes

{Reactions}
üëå 

[01-May-19 03:52 AM] jl777c#5810
a / flips


[01-May-19 03:53 AM] jl777c#5810
it works as a/b fractions


[01-May-19 03:54 AM] TonyL#3577
Great, thanks!  So understood correct üëå


[01-May-19 03:54 AM] Mylo#8306
Pinned a message.


[01-May-19 03:59 AM] TonyL#3577
Thanks for pin @Mylo
Just fyi: http://kmd.money:8050/ site which displaying only prices using separate python file atm (`prices_visualization_server.py`)
Will update TUIs repo README asap (maybe have to rebrand it in naming to not TUI but some library/tools üòÉ)


[01-May-19 04:00 AM] Mylo#8306
call it prices-in-a-box üòõ

{Reactions}
üòÖ 

[01-May-19 04:00 AM] TonyL#3577
I thought about naming like a `pyguana`


[01-May-19 04:00 AM] TonyL#3577
Python + iguans komodos thematics


[01-May-19 04:01 AM] Mylo#8306
"monitor" as in monitor lizard and monitor prices


[01-May-19 04:01 AM] TonyL#3577
Oh, I'm about naming for whole repo with TUIs included üòÉ

{Reactions}
üòÖ 

[01-May-19 04:02 AM] TonyL#3577
Just don't want to devide it on pieces because libs with RPCs usage have demonstrational purpose mostly


[01-May-19 04:03 AM] TonyL#3577
pyguana-in-a-box 
^^ looks like a good compromise


[01-May-19 04:03 AM] TonyL#3577
üòÉ


[01-May-19 04:10 AM] Mylo#8306
haha.   yeah, when i have time i'll add it to komodo-in-a-box.   <---- was started because of #cc-prices 
this tech needs to be easy to install so ppl can start getting their hands on it in quicker time from dev -> engineeering/testing -> products


[01-May-19 04:10 AM] Mylo#8306
check out https://gist.github.com/imylomylo/d78d1b9fe6fd72ccf60f34329b56922f

{Embed}
https://gist.github.com/imylomylo/d78d1b9fe6fd72ccf60f34329b56922f
komodo-in-a-box management interface download & run
komodo-in-a-box management interface download & run - komodo-in-a-box.management-interface.md
https://images-ext-2.discordapp.net/external/Giz-m4wzAWrLCD-Iwf0ZSbwKPBk4UChopj2JoKLF0Yo/%3Fs%3D400%26v%3D4/https/avatars3.githubusercontent.com/u/19399102


[01-May-19 04:11 AM] Mylo#8306
install scripts & vids demonstrating.
next week or two, prices when it gets merged into somethign a bit more stbale


[01-May-19 04:11 AM] Mylo#8306
*stable


[01-May-19 04:54 AM] TonyL#3577
I can make multiplatform onefile portable executable for prices webapp same as for rogue, it's just too early stage of everything atm


[01-May-19 04:55 AM] TonyL#3577
Will try to start in-a-box on my side tomorrow :)

{Reactions}
üòÅ 

[01-May-19 08:07 AM] dimxy#2587
added source synthetic expression to pricesinfo  
` "expression": "BTC_USD, KMD_BTC, *, 1, STRAT_BTC, BCHABC_BTC, /, 5") `

{Reactions}
üî• 

[01-May-19 08:10 AM] dimxy#2587
Maybe it is good to try to calculate a reduced expression, like \"BTC_EUR, BTC_USD, /, 1\"  is  actually \"USD_EUR, 1\" ?


[01-May-19 08:15 AM] jl777c#5810
it wont be exact, but it could be arbitraged as over time it should average the same


[01-May-19 08:43 AM] dimxy#2587
so it might be misleading for the user as he might think it is a real  currency pair?


[01-May-19 08:43 AM] jl777c#5810
displaying the synthetic solves that, plus it is the user that created it

{Reactions}
üëå 

[01-May-19 01:57 PM] TonyL#3577
Full expression in such form is great - quite easy for current interface code to build custom graph now on position selection üòÉ


[01-May-19 02:02 PM] TonyL#3577
```./komodo-cli -ac_name=REKT0 pricesbet 10 10 "BTC_USD, USD_RUB, KMD_BTC, ***, 1"```
and ```./komodo-cli -ac_name=REKT0 pricesbet 10 10 "BTC_USD, USD_RUB, KMD_BTC, ///, 1"```
worked fine


[01-May-19 02:03 PM] TonyL#3577
But no luck when using one or two slash in operator @dimxy 

```./komodo-cli -ac_name=REKT0 pricesbet 10 10 "BTC_USD, USD_RUB, KMD_BTC, */*, 1"
parsed synthetic: BTC_USD USD_RUB KMD_BTC */* 1 
opcode=1 opstr=BTC_USD need=0 depth=0
depth++=1
opcode=7 opstr=USD_RUB need=0 depth=1
depth++=2
opcode=36 opstr=KMD_BTC need=0 depth=2
depth++=3
prices_syntheticvec() incorrect opcode=*/*
PricesBet() firstprice=94871412066806
{
  "result": "error",
  "error": "invalid synthetic"
}
```


[01-May-19 02:18 PM] TonyL#3577
Ah, current min/max system is sharp
10+ times difference in profits on yesterdays "symmetrical" placed BTC_USD short and long

{Attachments}
https://cdn.discordapp.com/attachments/560714286369079299/573257025585283093/unknown.png


[01-May-19 02:21 PM] TonyL#3577
In general almost everything in loss. I intuitively feel that this min/max system might be very not correct somewhere in root but can't clearly understand/explain yet where

{Attachments}
https://cdn.discordapp.com/attachments/560714286369079299/573257706287136804/unknown.png


[01-May-19 03:19 PM] TonyL#3577
Rebranded a little TUIs repo:
https://github.com/tonymorony/komodo-cctools-python

{Embed}
https://github.com/tonymorony/komodo-cctools-python
tonymorony/komodo-cctools-python
Python libs and interfaces for Komodo cryptoconditions consensus modules - tonymorony/komodo-cctools-python
https://images-ext-1.discordapp.net/external/Holp9AfaeFvGp5-FK21tFWPUG6Vhnnx7aN2SJk6LnTA/https/repository-images.githubusercontent.com/151382224/5007df00-6c99-11e9-8f36-dfd6d7e8d715

{Reactions}
üëç 

[01-May-19 03:19 PM] TonyL#3577
Great, komodo dragon on link-preview working! üòÉ

{Reactions}
üòõ 

[01-May-19 05:50 PM] TonyL#3577
Aha, so 3 symbols operators are only `*//, **/, *** and ///`
Understood now clue why it's enough - if I need to flip first I can just put it to third position and use `**/`, so it was a false alarm regards not working operators. It working - just have to carefully test if price calculating correct for all of them


[01-May-19 05:52 PM] TonyL#3577
Added synthetic to tables - now they looks alive üòÉ

{Attachments}
https://cdn.discordapp.com/attachments/560714286369079299/573310740870463506/unknown.png


[01-May-19 10:13 PM] TonyL#3577
@dimxy tested same pairs for four 3 symbols operators:
https://paste.ubuntu.com/p/6Zwbztf7v4/
2 operators `(/// and **/)` worked as I expceted, other two `(*** and *//)` not. My expectations and calls/results can be found in paste above


[01-May-19 10:21 PM] TonyL#3577
Also thats how I rotated pairs (in case if I missunderstood something and thats why my calculations are wrong):

{Attachments}
https://cdn.discordapp.com/attachments/560714286369079299/573378596165517332/IMG_20190502_122120.jpg


[01-May-19 11:00 PM] dimxy#2587
I'll try to check these expressions with trinary operators too. Could be calculations errors after conversion to big numbers


[01-May-19 11:49 PM] dimxy#2587
corrected *** and *// calculations, thanks for the research!

{Reactions}
üî• 

[02-May-19 01:16 AM] TonyL#3577
Great, now all 4 matching expectations :)
Next in testing plan are some "crazy syntethics"

{Reactions}
üëç 

[02-May-19 01:29 AM] TonyL#3577
@dimxy In general what is the expected limitation on stacks amount in bet synthetic?


[02-May-19 01:30 AM] jl777c#5810
there is no limit to the accumulator


[02-May-19 01:30 AM] jl777c#5810
other than the overall length limit of opreturn


[02-May-19 01:30 AM] TonyL#3577
Oh I see, thats great


[02-May-19 01:30 AM] jl777c#5810
the weight field puts the product of the weight and top of stack to the accumulator


[02-May-19 01:30 AM] TonyL#3577
Can make indexes even like a CMC top100


[02-May-19 01:31 AM] jl777c#5810
yes, maybe not all 100 due to not being on binance or lack of opreturn space


[02-May-19 01:32 AM] TonyL#3577
I think there is enough tech to make thing similar to ICONOMI but better and more transparent


[02-May-19 01:32 AM] jl777c#5810
what does iconomi do?


[02-May-19 01:34 AM] TonyL#3577
They made platform for crypto portfolios creation/management - DAAs managers creating and manage portfolios, users can buy portfolio index, managers getting part of users revenue


[02-May-19 01:35 AM] jl777c#5810
what about losses?


[02-May-19 01:36 AM] TonyL#3577
In case of losses just index becoming cheaper
ICO back from 2016, was my first cryptoinvestment - but not the best one so sold üòÉ


[02-May-19 01:36 AM] jl777c#5810
not sure how to give creator of a synthetic any percentage...


[02-May-19 01:37 AM] jl777c#5810
seems like "why would people pay percentage of profits for a portfolio construction" ?


[02-May-19 01:38 AM] TonyL#3577
It's a thingy from classic investment funds - "management fee" and so on


[02-May-19 01:38 AM] TonyL#3577
And usually it's not only construction but rebalancing also


[02-May-19 01:38 AM] jl777c#5810
oh, rebalancing! ok then, take my 10%


[02-May-19 01:38 AM] TonyL#3577
üòÉ


[02-May-19 01:40 AM] TonyL#3577
Markowitz and modern-Markowitz things not working well on such amateur market imo because everything too corelated each other so I think these guys using "blind monkey" rebalancing approach


[02-May-19 01:41 AM] jl777c#5810
the bling monkey. forgot about that one


[02-May-19 01:41 AM] jl777c#5810
we can put various stocks to the DTO to allow better hedging


[02-May-19 01:41 AM] TonyL#3577
Oh it supposed to be "blind"


[02-May-19 01:41 AM] TonyL#3577
It's from experiment when monkey smashing typing machine


[02-May-19 01:41 AM] jl777c#5810
but being able to use negative margin allows for perfect hedging


[02-May-19 01:41 AM] TonyL#3577
And in some cases it might be word as output


[02-May-19 01:42 AM] jl777c#5810
yes, darts thrown at the newspaper listings of stock

{Reactions}
üíØ 

[02-May-19 01:43 AM] TonyL#3577
I modeled portfolios last year - random guess in porfolio constructing usually perform at least not worse as some models


[02-May-19 01:44 AM] TonyL#3577
Especially when everything corellated üòÉ


[02-May-19 01:45 AM] TonyL#3577
But interesting direction might be some "trader profile" and "trading stats", with possibility to compete in tournaments and some Etoro-like trader following / trades copying


[02-May-19 01:45 AM] TonyL#3577
Social trading they call it


[02-May-19 01:46 AM] jl777c#5810
can track performance of pubkey


[02-May-19 01:46 AM] jl777c#5810
and just copy what they do


[02-May-19 01:47 AM] TonyL#3577
Aha, just need interface for it


[02-May-19 01:47 AM] TonyL#3577
To find the best üòÉ


[02-May-19 01:48 AM] jl777c#5810
it sounds like things are mostly working?


[02-May-19 01:49 AM] jl777c#5810
maybe it is time to make a sidechain for BET with some stocks and more cryptos. then people can bet with real funds


[02-May-19 01:49 AM] jl777c#5810
I can fund it with some BET to get things started


[02-May-19 01:49 AM] dimxy#2587
tokens support is to be added yet


[02-May-19 01:49 AM] dimxy#2587
plus we turned off the validation


[02-May-19 01:49 AM] jl777c#5810
yes and global risk management, but based on the min/max, it seems we might be ok on the risk side


[02-May-19 01:50 AM] jl777c#5810
yes, so for the new chain, validation enabled, after adding whatever other validations


[02-May-19 01:50 AM] TonyL#3577
It looks like casino all the time in plus atm üòÉ

{Reactions}
üëç 

[02-May-19 01:50 AM] jl777c#5810
the DTO is going steady on all the nodes, for almost a month after last fix


[02-May-19 01:51 AM] jl777c#5810
just one lucky bet at 100x margin will eat the profits from a lot of other bets


[02-May-19 01:52 AM] dimxy#2587
BTW we dd not check much cashout and rekt. Interesting what would happen to the fund


[02-May-19 01:53 AM] jl777c#5810
ok, lets check those things and if there is a way to limit betsize*leverage based on global funds


[02-May-19 01:53 AM] TonyL#3577
Oh yes, I tested cashout few times and it worked fine. But never rekted my bets


[02-May-19 01:53 AM] jl777c#5810
the way it would work if someone wins more than available capital, they can cashout all that is left


[02-May-19 01:54 AM] jl777c#5810
then any other positions wont be able to cashout until we get enough rekt


[02-May-19 01:54 AM] jl777c#5810
maybe that is ok, it socializes the losses and it should only be an issue at the start


[02-May-19 01:54 AM] jl777c#5810
unless someone is able to consistently beat the blockchain


[02-May-19 01:59 AM] jl777c#5810
making it a sidechain will let us test sidechains at the same time and we can bet with real value before tokens support


[02-May-19 01:59 AM] TonyL#3577
Closed position with negative profit, waiting to be mined


[02-May-19 01:59 AM] jl777c#5810
we do need to make sure we are monetizing for the BET address on cashout/rekt


[02-May-19 02:00 AM] TonyL#3577
How to find current fund address?


[02-May-19 02:00 AM] jl777c#5810
did we remove the costbasis tx? it seemed there was no need for it


[02-May-19 02:01 AM] jl777c#5810
RGsW... in prices.cpp file at the end of comments

{Reactions}
üëå 

[02-May-19 02:02 AM] TonyL#3577
Vouts of this cashout (c7da3682f9dcd49dc8a0c5863883f7ee05584e26f3a65e38e601041b7e5a37ba):
```  "vout": [
    {
      "value": 56.49469980,
      "valueZat": 5649469980,
      "n": 0,
      "scriptPubKey": {
        "asm": "029fe332bce5ccc040c8a13ef5a4664ae841a7b5d3ee6c3ada144c1f3f9b4e1186 OP_CHECKSIG",
        "hex": "21029fe332bce5ccc040c8a13ef5a4664ae841a7b5d3ee6c3ada144c1f3f9b4e1186ac",
        "reqSigs": 1,
        "type": "pubkey",
        "addresses": [
          "RBryyraWbHNLtxv8xY7BoUCgXjEsFU7aPb"
        ]
      }
    },
    {
      "value": 40.02030020,
      "valueZat": 4002030020,
      "n": 1,
      "scriptPubKey": {
        "asm": "a22c80203ee64ec5f134da404710d306dcd9ca54a0139b3c4827b43a988fc6316e6c2a688103120c008203000401 OP_CHECKCRYPTOCONDITION",
        "hex": "2ea22c80203ee64ec5f134da404710d306dcd9ca54a0139b3c4827b43a988fc6316e6c2a688103120c008203000401cc",
        "reqSigs": 1,
        "type": "cryptocondition",
        "addresses": [
          "RAL5Vh8NXmFqEKJRKrk1KjKaUckK7mM1iS"
        ]
      }
    },
```


[02-May-19 02:03 AM] TonyL#3577
RBryyraWbHNLtxv8xY7BoUCgXjEsFU7aPb it's my address ```"value": 56.49469980,``` and it's correct equity amount


[02-May-19 02:03 AM] TonyL#3577
But these 40 - I'm not sure where it's gone. And position size was 77 coins


[02-May-19 02:03 AM] jl777c#5810
monetization needs to be added and this gives BET coin a direct revenue stream


[02-May-19 02:03 AM] TonyL#3577
`did we remove the costbasis tx? it seemed there was no need for it` - I did cashout without costbasis tx so I think it's deprecated

{Reactions}
üëå 

[02-May-19 02:04 AM] jl777c#5810
lets make sure it is totally removed and not allowed


[02-May-19 02:05 AM] TonyL#3577
```./komodo-cli -ac_name=REKT0 pricessetcostbasis bfc1ed09d48406ed251a914ff253b0733abff7ff5e89a624160d290e0f9d15ad
{
  "result": "error",
  "error": "deprecated"
}
```


[02-May-19 02:07 AM] jl777c#5810
good


[02-May-19 02:07 AM] dimxy#2587
`But these 40 - I'm not sure where it's gone`
the change I suppose


[02-May-19 02:07 AM] jl777c#5810
so just adding the monetization to rekt seems what is needed.


[02-May-19 02:08 AM] TonyL#3577
``` ./komodo-cli -ac_name=REKT0 pricesbet 77.7 777 "BTC_USD, 1"``` let's get rekt


[02-May-19 02:08 AM] jl777c#5810
the equity was in global address not as a specific utxo, just credits against the global funds


[02-May-19 02:08 AM] jl777c#5810
for cashout, i guess it should be allowed to collect less than the equity amount if there arent enough funds left


[02-May-19 02:09 AM] jl777c#5810
i would think maxleverage would need to be capped to lower amounts, until the global funds are adequate


[02-May-19 02:11 AM] TonyL#3577
We can make some "risk-management" formula for fund.
Like a not to risk more than 1% of fund with approximation that bettors have 0% ROI against us


[02-May-19 02:12 AM] jl777c#5810
ok


[02-May-19 02:15 AM] TonyL#3577
Just an idea of some determenistic level defense. Because bettors can use bankroll-management, strategies with ->inf variance like a many many steps martingale, some arbitrage maybe and autonomous fund looks very defenseless


[02-May-19 02:19 AM] TonyL#3577
It looks like I'm receiving equity correctly on cashout in case of both negative and positive profits, waiting for rekt


[02-May-19 03:18 PM] TonyL#3577
@dimxy looks like something is broken for new bets in latest updates. I'm using daemon built with DTEST mode flag. 
Profit not starting to calculate and looks like it's because last price not moving now at all. For example:
```
./komodo-cli -ac_name=REKT0 pricesinfo 22319bd052e7c63b21e290e1bf6b0d56eefd7e04b4e3f7946f9a3b6341d4a3c9
{
  "status": "open",
  "rekt": 0,
  "expression": "BTC_USD, 1",
  "reduced": "BTC_USD, 1",
  "batontxid": "22319bd052e7c63b21e290e1bf6b0d56eefd7e04b4e3f7946f9a3b6341d4a3c9",
  "costbasis": 5425.36451655,
  "bets": [
    {
      "positionsize": 77.70000000,
      "profits": 0.00000000,
      "costbasis": 5425.36451655,
      "firstheight": 4209
    }
  ],
  "leverage": 777,
  "TotalPositionSize": 77.70000000,
  "TotalProfits": 0.00000000,
  "equity": 77.70000000,
  "LastPrice": 5425.36451655,
  "LastHeight": 4278,
  "LiquidationPrice": 5418.38206544
}
```


[02-May-19 03:19 PM] TonyL#3577
Or:
```./komodo-cli -ac_name=REKT0 pricesinfo b1acadc833f92400d0a2f0f5efc19a3fa16ac55badc52892c3168585a1dcb59c
{
  "status": "open",
  "rekt": 0,
  "expression": "BTC_USD, KMD_BTC, USD_RUB, **/, 1",
  "reduced": "KMD_USD, RUB_USD, *, 1",
  "batontxid": "b1acadc833f92400d0a2f0f5efc19a3fa16ac55badc52892c3168585a1dcb59c",
  "costbasis": 0.01528985,
  "bets": [
    {
      "positionsize": 10.00000000,
      "profits": 0.00000000,
      "costbasis": 0.01528985,
      "firstheight": 4182
    }
  ],
  "leverage": 10,
  "TotalPositionSize": 10.00000000,
  "TotalProfits": 0.00000000,
  "equity": 10.00000000,
  "LastPrice": 0.01528985,
  "LastHeight": 4278,
  "LiquidationPrice": 0.01376087
}
```


[02-May-19 03:21 PM] TonyL#3577
I updated this morning and it grabbed commits which added `reduced`, but it worked same way on yesterdays commits


[02-May-19 10:12 PM] dimxy#2587
I removed test costbasis calc  as we deprecated the costbasis tx.
Seems you need this to check profit calculations? 
Ok I willl add testmode for the costbasis


[02-May-19 10:16 PM] TonyL#3577
Oh yes, I wanted to test rekt bet actually


[02-May-19 10:26 PM] dimxy#2587
And last time when TESTMODE was active it actually changed DAY_WINDOW and it looked not so good on the chart.
I think now it is better for testing to change just costbasis calculation  period to 7 blocks but for DAY_WINDOW to set it as it is now 24h


[02-May-19 10:50 PM] dimxy#2587
and there might be  implications for this test costbasis now as we now do not use costbasis tx fixing the costbasis value:
so if a position was closed in test mode but you later recompile with no testmode, the cosybasis and profits calculations will be updated and incorrect for such positions
(updated the repo with testmode)


[02-May-19 11:17 PM] TonyL#3577

{Attachments}
https://cdn.discordapp.com/attachments/560714286369079299/573754963373719552/unknown.png


[02-May-19 11:17 PM] TonyL#3577

{Attachments}
https://cdn.discordapp.com/attachments/560714286369079299/573755056973938689/unknown.png


[02-May-19 11:18 PM] TonyL#3577

{Attachments}
https://cdn.discordapp.com/attachments/560714286369079299/573755123021643787/unknown.png


[02-May-19 11:18 PM] TonyL#3577
I'm rich whoooho


[02-May-19 11:19 PM] TonyL#3577
```{
  "status": "open",
  "rekt": 0,
  "expression": "BTC_USD, 1",
  "reduced": "BTC_USD, 1",
  "batontxid": "e19b1e12259efe3a37864deab312c4eabdbb1e8422c42bbde381ced43d3ebe69",
  "costbasis": 5402.05559655,
  "costbasis_test_period": 7,
  "bets": [
    {
      "positionsize": 77.70000000,
      "profits": 499.93591032,
      "costbasis": 5402.05559655,
      "firstheight": 4204
    }
  ],
  "leverage": 777,
  "TotalPositionSize": 77.70000000,
  "TotalProfits": 499.93591032,
  "equity": 577.63591032,
  "LastPrice": 5446.78896896,
  "LastHeight": 4324,
  "LiquidationPrice": 5395.10314405
}
```
Looks like no luck with rekt this time


[02-May-19 11:21 PM] dimxy#2587
I was able to rekt with negative leverage -777 for BTS_USD (at it was growing  yesterday)


[02-May-19 11:26 PM] TonyL#3577
It looks like I'm super lucky because my costbasis is 5402 and LiquidationPrice just 7 dollars beyond


[02-May-19 11:27 PM] TonyL#3577
It's just a miracle to not touch this mark


[02-May-19 11:40 PM] dimxy#2587
for leverage 777 it is okay, isn't it?


[02-May-19 11:57 PM] TonyL#3577
This spread between costbasis and LiquidationPrice is fine for sure


[03-May-19 12:02 AM] TonyL#3577
Just in average somewhere around 776 bets from 777 should be rekt üòÇ


[03-May-19 02:29 AM] TonyL#3577
@dimxy Tried simple multistack synthetic price: https://paste.ubuntu.com/p/TSVJbpv59Z/ (I just copypasted same stack 8 times)
Expected ~400k * 8 (400k + 400k + 400k ...) but it looks like price calculated as one stack price only


[03-May-19 02:32 AM] dimxy#2587
okay, checking...


[03-May-19 02:40 AM] dimxy#2587
I believe this is by design  as synthetic  price is actually a weighed  index: 
```(price1 * weight1  + price2* weight2 +...) / (weight1+weight2+...)```


[03-May-19 02:48 AM] TonyL#3577
1*A + 1*A + 1*A + 1*A + 1*A + 1*A + 1*A + 1*A = 8*A  I wonder


[03-May-19 02:49 AM] TonyL#3577
Ah if indexes normalized on 1 each is 1/8


[03-May-19 02:49 AM] jl777c#5810
8*A/8


[03-May-19 02:50 AM] TonyL#3577
My bad, sry


[03-May-19 02:50 AM] TonyL#3577
So it seems to work correct üòÉ


[07-May-19 12:11 AM] dimxy#2587
Now we need to implement  some risk management strategy to prevent bankruptcy.
Do we have a technique in mind?
should we for example calculate probabilistic data, like expected values to take into account?


[07-May-19 12:24 AM] TonyL#3577
I think for now we can take some number just from head and then calibrate (start from assumtion that on range contract "playing" 50/50 with players) and not accept bet if winnings exceed 1% of CC bankroll


[07-May-19 12:24 AM] TonyL#3577
Also not accept new bets maybe if active ones cannot be settled with current bankroll and such assumption


[07-May-19 12:26 AM] TonyL#3577
So in case of 50/50 desired formula is `bet_expected_value = bet_amount * loss_probability + bet_amount * won_probability = bet_amount * 0.5 + bet_amount * 0.5 = bet_amount`


[07-May-19 12:28 AM] TonyL#3577
But not sure how it's possible to prevent creation of 100 same bets of 1% in same block


[07-May-19 12:30 AM] TonyL#3577
Maybe more cunning mechanism is needed - like a deviding/spread of CC bankroll between different markets 
Lets say 25% of CC bankroll can be used on cryptomarkets bets only, 25% on forex pairs, 25% on stocks, 25% on combined - something like that


[07-May-19 12:35 AM] TonyL#3577
Player with enough bankroll can drain now whole CC bankroll by one bet if he is lucky enough (or have some additional insider information / advantage over the house)
Thinking on very hypotetical situations when in CC bankroll few million USD lets say and to manipulate market 10000 USD needed for example


[07-May-19 12:35 AM] TonyL#3577
So one such "attack" on some low liquidity pair will drain whole bankroll


[07-May-19 12:36 AM] jl777c#5810
it seems needed to only allow betting on high liquidity pairs


[07-May-19 12:36 AM] jl777c#5810
or limit leverage to very small amount for low liquidity


[07-May-19 12:36 AM] TonyL#3577
Maybe separate tiers


[07-May-19 12:37 AM] TonyL#3577
First tier markets - bankroll in game 100x, second tier markets - bankroll in game 1x


[07-May-19 12:37 AM] TonyL#3577
Tier depends of volumes


[07-May-19 12:37 AM] jl777c#5810
for start maybe we just allow bets on first tier markets


[07-May-19 12:37 AM] jl777c#5810
we can then see how it actually works with real money at stake


[07-May-19 12:38 AM] TonyL#3577
Thats what bookmakers do actually - on NBA match I can bet 100k USD without problems because it's deeply analyzed and hardly to maniplulate (buy match lets say) but on some low league in same bookmaker my limit can be 100 usd


[07-May-19 12:38 AM] jl777c#5810
then iterate, adding lower and lower volume things as we see how things work


[07-May-19 12:39 AM] jl777c#5810
so globally, if we have the total exposure calculation, we can scale the maxbet/leverage allowed based on that and the tier of the synthetic, initially only dealing with first tiers to simplify


[07-May-19 12:40 AM] TonyL#3577
Problem is that in "centralized" world KYC handling this maxbet issue - security depts trying to make process of multiaccounting as hard as possible but in such decentralized thing if you want to place `100x * maxbet` you just need script which create 100 wallets


[07-May-19 12:42 AM] TonyL#3577
It's super intetesting what happens when real money will be at stake


[07-May-19 12:52 AM] dimxy#2587
so the simplest case is to calculate the current volume for  this kind of synthetic (and maybe totally for those pairs which form the synthetic) and allow a bet for no more than for example 1% from it. 
Plus we need a way to define  tiers (it is some amount scale hard coded in the cc)


[07-May-19 12:56 AM] jl777c#5810
what you can do is cancel out all the positive vs negative positions for each coin


[07-May-19 12:56 AM] jl777c#5810
the net exposure is the sum of exposure of each coin


[07-May-19 12:56 AM] jl777c#5810
meaning, a long XYZ/BTC vs short ZBC/BTC cancel out


[07-May-19 12:57 AM] jl777c#5810
also long ZYX/BTC and long BTC/ABC also cancel out the BTC exposure


[07-May-19 12:57 AM] jl777c#5810
we would need to have a requirement that all bets must be for a A/B synthetic


[07-May-19 12:58 AM] jl777c#5810
then this net balancing can be done and typically a good percentage of positions cancel out other positions


[07-May-19 01:32 AM] TonyL#3577
I tested some positons with different coeffetients multiply stacks - price looks believable. Just thinking maybe for debugging/testing it might be helpful to see somewhere intermediate calculations results (price of each stack, coeff for each stack)


[07-May-19 01:41 AM] dimxy#2587
yes I already output most if them, maybe should mark them better  in debug


[07-May-19 01:43 AM] jl777c#5810
this is idea based on what tony said to me


[07-May-19 01:43 AM] jl777c#5810
we can dramatically limit system risk, by selling the positions to other players


[07-May-19 01:44 AM] jl777c#5810
delta neutral portfolio is the balancing concept


[07-May-19 01:44 AM] jl777c#5810
a delta neutral portfolio doesnt care if the price goes up or down as all positions are hedged


[07-May-19 01:45 AM] jl777c#5810
of course we cant practically achieve 100% delta neutrality... however we can push things to come close to it


[07-May-19 01:45 AM] jl777c#5810
so, lets imagine we add the ability for all existing positions to have their opposite bet listed


[07-May-19 01:46 AM] jl777c#5810
covering the opposite position would be offered at some discount, or we charge a bigger premium to create an initial position


[07-May-19 01:47 AM] jl777c#5810
the house edge can simply be the 24hr min/max, so the initial position and covered position will have different costbasis and this difference is the house profit margin


[07-May-19 01:48 AM] jl777c#5810
maybe this allows us to offer covering an existing position without any fee


[07-May-19 01:48 AM] jl777c#5810
and we charge something like a 1% fee to create a new position


[07-May-19 01:49 AM] jl777c#5810
this then creates an "orderbook" of unbalanced bets that people can choose to make, it should be displayed in the reversed form so people can just see what bet they can make without a fee, they still need the deposit of course


[07-May-19 01:50 AM] jl777c#5810
a complication is that as funds are added, it seems such adding of funds creates the opposite orderbook entry for the amount of new funds


[07-May-19 01:51 AM] jl777c#5810
with this, we can see the total exposure is the sum of the unfilled "orderbook"


[07-May-19 01:51 AM] jl777c#5810
and that due to not needing a fee, people will naturally tend to balance the portfolio over creating a new position


[07-May-19 01:52 AM] jl777c#5810
with such a total exposure that is constantly reduced with the opposite orderbook, we can then cap the amount of new positions allowed, ie. once the max net exposure is reached, no new positions are allowed, only bets that reduce the exposure via opposite orderbook


[07-May-19 01:54 AM] jl777c#5810
please explore this avenue of a balancing opposite orderbook. make it 10x easier to balance an existing position that creating a new one, and more expensive too


[07-May-19 01:55 AM] jl777c#5810
@TonyL @dimxy does this make sense?


[07-May-19 01:56 AM] jl777c#5810
for example, creating a new position can be limited to 10x leverage, but that can be matched by a 100x leverage using 10% of funds. if it gets rekt, then the original amount is available for the opposite orderbook again


[07-May-19 01:56 AM] jl777c#5810
maybe 5x leverage is the max for creating a new position, not sure what is best


[07-May-19 01:57 AM] jl777c#5810
enough to offer a unique value, not too much so that the system gets capital. As soon as a position is fully balanced, then the system is guaranteed to gain some amount of winnings as both sides cannot win at the same time, one of them will usually get rekt or at least have balancing losses


[07-May-19 01:59 AM] jl777c#5810
this reduces the risk management problem (very hard in the abstract) to more of an incentivized ordermatching, which seems a lower degree of difficulty. for anything but the most common synthetic, we can even make the max leverage 1x


[07-May-19 01:59 AM] jl777c#5810
it would just be covered by the overall system capital as it grows


[07-May-19 01:59 AM] TonyL#3577
Have some crazy idea: what if to make positions as NFTs


[07-May-19 02:00 AM] jl777c#5810
aha! then whoever owns it needs to be the "house" for that position? but that would require to match the leverage exactly


[07-May-19 02:01 AM] jl777c#5810
it seems a needless complication, though the orderbook is automatically gained


[07-May-19 02:01 AM] jl777c#5810
for the BET sidechain, the BET fee address should be a snapshot payments CC script


[07-May-19 02:01 AM] TonyL#3577
I think it can open interesting possibilities because of native tokendex, and can collect fees on position withdraw to NFT and deposit from NFT


[07-May-19 02:02 AM] TonyL#3577
So like a inside of platform trading might be free


[07-May-19 02:02 AM] jl777c#5810
lets do NFT of positions later, the complexity of enforcing leverage, costbasis inside an NFT...


[07-May-19 02:02 AM] TonyL#3577
But if you want to trade on secondary market - you have to pay for position withdrawal into token


[07-May-19 02:02 AM] TonyL#3577
Oh yes sure, just a conceptual idea üòÉ


[07-May-19 02:02 AM] jl777c#5810
we want to incentivize trading on secondary market


[07-May-19 02:03 AM] jl777c#5810
any trade that lowers system risk is guaranteed profits


[07-May-19 02:07 AM] jl777c#5810
with the snapshot CC as the destination for fees, as you win your bets, you then get a bigger share of the overall trading fees


[07-May-19 02:08 AM] TonyL#3577
`BETS` coin have revenue share from sidechains trading CCs ?


[07-May-19 02:08 AM] jl777c#5810
the prices CC monetization is to go to a BET address, but that requires accumulating and distributing it out manually


[07-May-19 02:09 AM] jl777c#5810
by making a BET sidechain and then paying the BET monetization to the snapshot CC script, it automates the process


[07-May-19 02:09 AM] jl777c#5810
the more BET (sidechain) you have, the larger percentage of the revshare payments you get


[07-May-19 02:10 AM] jl777c#5810
totally blockchain enforced, from the creation of the BET fees to the airdropping of the collected revshares


[07-May-19 02:10 AM] jl777c#5810
BET might become the first actual DAO

{Reactions}
üåù 

[07-May-19 02:16 AM] TonyL#3577
`for example, creating a new position can be limited to 10x leverage, but that can be matched by a 100x leverage using 10% of funds. if it gets rekt, then the original amount is available for the opposite orderbook again` - such dynamic hedging definetly got sense


[07-May-19 02:19 AM] TonyL#3577
Maybe we can start from simple thing first:  
some `marketstat` call which output bets directions (like a: market: BTC_USD,  total_longs: 100, total_shorts: 50, spread: -50)
So with such current spread it's possible to open longs with leverage only x5 or x10 lets say but shorts possible to open with leverage up to x100 (in sizes less than moving spread to another side)


[07-May-19 02:21 AM] jl777c#5810
to calculate system exposure the "opposite orderbook" must be calculated anyway


[07-May-19 02:21 AM] jl777c#5810
rpc calls can be made to display just the ones that match a specific synthetic


[07-May-19 02:21 AM] jl777c#5810
so it would be a matter to select an orderbook item, set leverage and fund it


[07-May-19 02:21 AM] TonyL#3577
Yes, I'm just explaining on visible example because can't correctly explain what needs to be done on consensus level


[07-May-19 02:22 AM] jl777c#5810
for all bets, find ones without a balancing trade (maybe using baton) and add to opposite orderbook list (or just sum the relevant details)


[07-May-19 02:23 AM] jl777c#5810
from the rpc side, you just need to get a list of available things to match


[07-May-19 02:23 AM] jl777c#5810
and a way to match an orderbook item with a specified leverage


[07-May-19 02:25 AM] jl777c#5810
other than changing max leverage allowed and linking balancing bets, it seems not so much change on the consensus side


[07-May-19 02:25 AM] jl777c#5810
and this avoids having to make many iterations on risk management


[07-May-19 02:25 AM] jl777c#5810
decentralize the risk


[07-May-19 02:25 AM] jl777c#5810
so the system does its best to minimize the net exposure


[07-May-19 02:26 AM] TonyL#3577
But from risk side: 500 with x1 leverage as I see is almost the same as 5 with x100 leverage (500 vs 500). Why we cant just summarize longs and shorts risk amount (bet amonut * leverage) on market and stimulate equalizing?


[07-May-19 02:26 AM] jl777c#5810
and this net exposure is limited to some sane maximum based on system capital


[07-May-19 02:27 AM] TonyL#3577
Balance each positon is complicated but balance whole market should be positions_amount easier


[07-May-19 02:27 AM] jl777c#5810
yes, ultimately that is what the system does, but we have specific utxo and not a balance based system, so how would you deal with 1000 bets made in mempool?


[07-May-19 02:27 AM] jl777c#5810
i disagree


[07-May-19 02:27 AM] jl777c#5810
i think balancing each position is much simpler


[07-May-19 02:27 AM] jl777c#5810
maybe more complex for GUI


[07-May-19 02:27 AM] jl777c#5810
but GUI can treat the possible bets as "utxo" and present a balance based display


[07-May-19 02:28 AM] jl777c#5810
maybe if we change the entire internals to be oriented toward a specific synthetic and all its positions, a balance based method makes sense


[07-May-19 02:28 AM] jl777c#5810
so this is more an implementation question than a design


[07-May-19 02:29 AM] jl777c#5810
the goal is clear, decentralize the risk exposure by incentivizing opposite positions

{Reactions}
üëç 

[07-May-19 02:29 AM] jl777c#5810
and yes, the display to user can simply show the max leverage allowed for a synthetic, will be different for long maxleverage and short maxleverage


[07-May-19 02:30 AM] TonyL#3577
Yep that what my thought - for GUI it might be complicated to show "unbalanced" positions with offer to balance in case of endless markets amount


[07-May-19 02:30 AM] jl777c#5810
based on amount bet, N total bets can be made that add up to the desired exposure


[07-May-19 02:31 AM] TonyL#3577
So in GUI might be abstracted just to leverage allowed to choose, yep just implementation question


[07-May-19 02:31 AM] jl777c#5810
it could be that 20% of the bets cant be made due to someone else getting the baton


[07-May-19 02:32 AM] jl777c#5810
so the GUI should show a maximum amount that wants to be bet at the specified leverage, and then it shows how much actually was able to be submitted to mempool (and then confirmed)


[07-May-19 02:32 AM] TonyL#3577
GUI should be quite clever this time hehe


[07-May-19 02:36 AM] jl777c#5810
i think we can name the BET sidechain BETS, so for testing the first one can be BETS0


[07-May-19 02:37 AM] jl777c#5810
make it so it can do the snapshot payments CC using some reasonable amount of accumulated profits, blackjok8r is the one to ask on how to set it up


[07-May-19 02:38 AM] jl777c#5810
i have a feeling there will be some sidechain specific issues, and maybe snapshot issues too. we can do a single node gateways CC for BETS0


[07-May-19 02:39 AM] jl777c#5810
let me know when it is setup and I can fund it with some BET


[07-May-19 02:41 AM] TonyL#3577
Ok, will wrap head a little over paymentsCC, consult with jok3r and go ahead üëç


[07-May-19 02:43 AM] jl777c#5810
since it will be based on BET fees, it doesnt need to do the bootstrapping, well other than getting the right CC vout to hardcode the BET fees to


[07-May-19 02:45 AM] Deleted User#0000
payments seems to be keeping consensus in my game so far. I'm not 100% sure merge RPC stuff is perfectly stable. Need to get a chain up for Alright to test that, however fo test chain, we should just use it and see if any bugs arise.


[07-May-19 02:46 AM] jl777c#5810
yes, BETS0 is just a test chain, dimxy will need the scriptPubKey that sends to a snapshot CC, maybe we need to make a tx with opret first and then update the prices CC, not sure

{Reactions}
üëå 

[07-May-19 02:47 AM] dimxy#2587
I think I get the whole idea that we introduce an opposite position and stimulate to use it to get the fund balanced. More details will be discovered while implementing.  I think probably we  might need to calculate the balance for every block (otherwise it is going to be too many calculations for a single rpc call)


[07-May-19 02:48 AM] jl777c#5810
yes, balance needs to be calculated every block


[07-May-19 02:48 AM] jl777c#5810
but that can be cached locally, i dont think it needs to be in consensus


[07-May-19 02:48 AM] Deleted User#0000
I already know how to implement tracking of top 3999 address, such that the last notarized height the balance fo the top 3999 addresses is known. Also it will be possible to know the live balance of each top 3999 address at each block, but basing tx conensus on this leaves possibility of tx not being mined in the enxt exact block and such would become invalid if the balance changed before it was mined.


[07-May-19 02:49 AM] jl777c#5810
snapshots can just be paid out max daily, likely not even monthly as it is only for the BET fees


[07-May-19 02:49 AM] Deleted User#0000
I have not actaully tried to implement this yet, as the snapshot is working perfectly as it is, just a little slow for chain syncs when chain gets longer.


[07-May-19 03:40 AM] TonyL#3577
@jl777c Just to be sure if I understood idea correct: should be part of `BETS0` pricesCC revenue  distributed on main `BET` chain between `BET` coin holders or on `BETS0` ?

So scheme is something like this: "buffer" wallet A accumulating fees, then each let's say 6 hours 20% of fees airdropping to holders of (not sure what exactly), another 80% sendning to pricesCC address which covers payouts for bets.

If setup `BET` <- `BETS0` 1:1 gateway I think that I have to set extra low mining rewards on `BETS0` and this chain should be notarised


[07-May-19 03:41 AM] jl777c#5810
no


[07-May-19 03:41 AM] jl777c#5810
BETS0 is a BET sidechain


[07-May-19 03:41 AM] jl777c#5810
that is the only direct connection to BET


[07-May-19 03:41 AM] jl777c#5810
prices CC fees goes to a snapshot CC address


[07-May-19 03:42 AM] jl777c#5810
anybody can then trigger a 100% payout to BET0 holders in proportion, ie. airdrop of the accumulated fees


[07-May-19 03:42 AM] jl777c#5810
all sidechains need to have a low mining reward that is fully covered by external subsidies


[07-May-19 03:43 AM] jl777c#5810
and it should be notarized, but we can live without it while testing


[07-May-19 03:43 AM] jl777c#5810
people use prices CC, snapshot address accumulates fees, anyone can trigger an airdrop in propoprtion to BETS0 held in normal address


[07-May-19 03:44 AM] jl777c#5810
the idea is for BETS0 chain to attract BET deposits into BETS0 to collect the revshares


[07-May-19 03:45 AM] Deleted User#0000
ok so you can send BET to the BETS0 chain, and the amount held there determines the proportions of who is paid.


[07-May-19 03:46 AM] Deleted User#0000
so the BET chain istelf, has nothing much to do with it, apart from being the source of the funds?


[07-May-19 03:46 AM] jl777c#5810
its only purpose is to have external value in the BETS0 chain


[07-May-19 03:46 AM] jl777c#5810
each BET is worth a few dollars


[07-May-19 03:47 AM] jl777c#5810
so this automatically creates a bounty system to find bugs or just earn money betting


[07-May-19 03:47 AM] jl777c#5810
not to mention create one of the first ever fully functioning DAO


[07-May-19 03:47 AM] Deleted User#0000
I think I understand this now, should work with existing paymetns plan, although we may need to use 2 plans, to distribute the 20/80 revenue first, so the 20% goes to airdrop payments plan, and the otehr 80% can go back where its uspposed to be.


[07-May-19 03:47 AM] jl777c#5810
there is no 20/80


[07-May-19 03:48 AM] jl777c#5810
100% goes to snapshot, tony was just confused


[07-May-19 03:48 AM] Deleted User#0000
that is even easier üòÉ


[07-May-19 03:48 AM] jl777c#5810
yes, i tried to design the different pieces so they can be combined without changes


[07-May-19 03:49 AM] Deleted User#0000
so we need a verushash11 chain with low block rewards with a payments plan created, then the pricessCC will need to pay its fees to the txidpk address.


[07-May-19 03:49 AM] Deleted User#0000
I think this covers it ?


[07-May-19 03:49 AM] Deleted User#0000
if pricesCC fees are hardcoded in source no earlytxid is needed, that is for address to pay to.


[07-May-19 03:50 AM] jl777c#5810
it seems so


[07-May-19 03:50 AM] jl777c#5810
will need to bootstrap just the BET fee scriptPubKey, but that wont affect chain creation


[07-May-19 03:51 AM] jl777c#5810
or with the extra data, maybe we cam know the exact scriptPubKey ahead of time


[07-May-19 03:52 AM] Deleted User#0000
currently the txidpk address does nto use an op_return or ccvout... but if you can create this address before starting the pricessCC, either hardcode this address in pricessCC code, OR use earlytxid to define the address.


[07-May-19 03:55 AM] Deleted User#0000
`./komodod -ac_name=BETS0 -ac_supply=0 -ac_reward=10000 -ac_cc=2 -ac_algo=verushash11 -ac_snapshot=1440 ` @TonyL  something like this will work pretty well I think.


[07-May-19 03:59 AM] TonyL#3577
Thanks @Deleted User Is ac_snapshot period in minutes of how often it be claimed or?


[07-May-19 04:02 AM] Deleted User#0000
an_snapshot is required to use payments Airdropp... 1440 means 1440 blocks (24H) a snapshot of the chain is made, this is valid for 24H until the next once happens, any paymentsrelease issued between this range will use the saved balances at that height. It was very tricky to get paymetns airdrop to reach consenus. Currently doing it more than once a day will be just too slow. I know how to fix this, at least at a conceptual level, but I have not implemented it at this stage as this solution seems very stable even if its a little slow.


[07-May-19 04:02 AM] jl777c#5810
this is perfectly fine

{Reactions}
üëç 

[07-May-19 04:03 AM] Deleted User#0000
One thing that needs to be checked is that the address balances saved are actually correct üòâ It has to rewind blocks back tothe last notarized height (or 100 blocks)


[07-May-19 04:04 AM] Deleted User#0000
I think I can do this by just using -stopat on the payments game chain. Will trey to do this tomorrow.


[07-May-19 04:10 AM] jl777c#5810
it could be months before there are enough revshare accumulated to warrant a payment release, so daily granularity is no problem at all


[07-May-19 04:16 AM] TonyL#3577
After jok3r explanation I wonder that before start sidechain chain pricesCC should be able to send fees to address from `earlytxid` param


[07-May-19 04:16 AM] jl777c#5810
there is no need for earlytxid


[07-May-19 04:16 AM] Deleted User#0000
doing it longer than 1 day is also problematic, as it has to rewind back to the last snapshot height every daemon start, and doing that for thousands and tousands of blocks will take a long time.


[07-May-19 04:17 AM] Deleted User#0000
I think that we do need it, because we need he scriptpubkey to pay to, and plan must be created for that fisrt.


[07-May-19 04:17 AM] Deleted User#0000
regardless if you use txidpk address or global address you still need the plan creation txid


[07-May-19 04:18 AM] jl777c#5810
oh, ok, i guess we need some detailed step by step


[07-May-19 04:19 AM] Deleted User#0000
the -earlytxid will need to be coded into the pricesCC liek I did with `komodo_appendACscript`


[07-May-19 04:20 AM] Deleted User#0000
https://github.com/blackjok3rtt/komodo/blob/jl777/src/komodo_bitcoind.h#L2048

{Embed}
https://github.com/blackjok3rtt/komodo/blob/jl777/src/komodo_bitcoind.h
blackjok3rtt/komodo
Komodo. Contribute to blackjok3rtt/komodo development by creating an account on GitHub.
https://images-ext-2.discordapp.net/external/H9TDr69kM7mmxGBcENY3FInyORgkC6up-3NZ7sRUihU/%3Fs%3D400%26v%3D4/https/avatars3.githubusercontent.com/u/30971146


[07-May-19 04:22 AM] Deleted User#0000
maybe something in validation, to amke sure people cannot start a chain with a diffrent or no -earlytxid and then pay something else.


[07-May-19 09:45 PM] TonyL#3577
So I wonder we need help of @dimxy with hardcoding of address from -earlytxid usage as an address for fees to start a such chain


[07-May-19 10:27 PM] dimxy#2587
seems I had the address for this


[07-May-19 10:29 PM] jl777c#5810
the payout address needs to be to a special CC vout that does snapshots


[07-May-19 10:59 PM] jl777c#5810
payments sent to that address would only be released as a snapshot airdrop


[07-May-19 10:59 PM] jl777c#5810
since it will be a sidechain of BET, (assuming all BET coins are in the sidechain) it acts like sending to BET address and distributing from there


[07-May-19 11:00 PM] jl777c#5810
i expect there will be different BET sidechains, so in a way the BET hodler would bet on which sidechain has the best revshares


[07-May-19 11:00 PM] dimxy#2587
what 's the special vout structure?


[07-May-19 11:00 PM] jl777c#5810
for non-side chains, it would be sent to a normal address


[07-May-19 11:00 PM] jl777c#5810
you need to get the exact scriptPubKey from blockjok8r


[07-May-19 11:12 PM] Deleted User#0000
it is created by making th payment plan, then funded with payments fund. It has no op_return. 
```txidpk = CCtxidaddr(txidaddr,txid);
mtx.vout.push_back(MakeCC1of2vout(EVAL_PAYMENTS,amount,Paymentspk,txidpk));```
You need to create the payments plan First, so you have the txid. this txid could be supplied by an op_return with `-earlytxid` or you can make payments plan, then hardcode the txid in the daemon.


[07-May-19 11:12 PM] Deleted User#0000
any payments ccvout in that address can be spent by paymentsrelease


[07-May-19 11:13 PM] Deleted User#0000
Alternativly you can pay it to global paymentsCC address with a ccopret or opreturn. But I think in this case its not required to do that, only adds extra complexity


[07-May-19 11:17 PM] jl777c#5810
i dont want to hardcode txid in the daemon, it needs to automaticall switch between payout to snapshot for BET sidechain or to normal BET address in other case


[07-May-19 11:25 PM] Deleted User#0000
If showen where in pricessCC it is amking this payment I can add it if required, using -earlytxid.


[07-May-19 11:27 PM] jl777c#5810
I think the prices CC code just needs to look for -earlytxid if it exists and if it is sidechain then send to payments CC scriptPubKey


[07-May-19 11:28 PM] jl777c#5810
else send to BET address


[07-May-19 11:28 PM] dimxy#2587
is it 0,5% of bet amout?


[07-May-19 11:28 PM] jl777c#5810
yes, that sounds good


[07-May-19 11:35 PM] Deleted User#0000
How i did it for appendACscript was ther first time it is needed by validation, lookup the earlytxid op_return and save it to a static variable.


[07-May-19 11:36 PM] Deleted User#0000
pretty sure it must be in validation code, otherwise its not consensus and people will be able to change it


[07-May-19 11:37 PM] jl777c#5810
yes it is in the validation code, of course


[07-May-19 11:37 PM] jl777c#5810
just not the specific txid


[07-May-19 11:37 PM] jl777c#5810
usage of the EARLYTXID variable is done and further it needs to make sure it is within first 100 blocks of chain and a valid txid to use for the intended purpose


[07-May-19 11:38 PM] jl777c#5810
but this can be coded once for all the usages of earlytxid based plans


[07-May-19 11:38 PM] jl777c#5810
we might need another param to differentiate between different usages


[07-May-19 11:38 PM] jl777c#5810
or maybe it is encoded in the scriptPubKey


[07-May-19 11:39 PM] jl777c#5810
its ok to be updating the validation code once, but not for each and every different txid


[09-May-19 12:46 AM] dimxy#2587
as I understand we need to start a new prices cc chain to make earlytxid work


[09-May-19 12:54 AM] jl777c#5810
yes, it is for bootstrapping a new chain


[09-May-19 12:54 AM] jl777c#5810
so it can have the validations all active too


[09-May-19 12:56 AM] Mihailo#5902
I haven't merged some fix for earlytxid to FSM yet..


[09-May-19 12:56 AM] Mihailo#5902
But I see someone added 
```cpp
 ASSETCHAINS_EARLYTXIDCONTRACT = GetArg("-ac_earlytxidcontract",0);
fprintf(stderr, "ASSETCHAINS_EARLYTXIDCONTRACT.%i\n", ASSETCHAINS_EARLYTXIDCONTRACT);```


[09-May-19 12:57 AM] Mihailo#5902
This should not be ac param


[09-May-19 12:57 AM] Deleted User#0000
Why ?


[09-May-19 12:59 AM] Mihailo#5902
As ac params should affect magiccalc and this is added later when chain is already created so it should be regular param. I think JL mentioned it like that.


[09-May-19 12:59 AM] Mihailo#5902
I've made it like this:
```cpp
KOMODO_EARLYTXID = Parseuint256(GetArg("-earlytxid","0").c_str());
    if (KOMODO_EARLYTXID!=zeroid && (tx_height(KOMODO_EARLYTXID)==0 || tx_height(KOMODO_EARLYTXID)>100))
    {
        fprintf(stderr,"earlytx can be only in first 100 blocks or does not exist\n");
        StartShutdown();
    }```


[09-May-19 01:00 AM] Deleted User#0000
no, incorrect. This needs to be magic value, becuase it defines what contract the earlytxid script pubkey is used by... If iot did not affect magic people can just chagne the contract eval code and pay to diffrent contracts.


[09-May-19 01:01 AM] Mihailo#5902
Oh, maybe I misunderstood EARLYTXIDCONTRACT


[09-May-19 01:01 AM] Deleted User#0000
As earlytxid was already there, I just used it as it was. I guess with that check on daemon load, some of my code can be remvoed, but thats isnt not a big deal, we can sort it out.


[09-May-19 01:01 AM] Mihailo#5902
EARLYTXID should just contain the txid of valid CC create tx.


[09-May-19 01:01 AM] Deleted User#0000
I used it very diffrenctly


[09-May-19 01:02 AM] Mihailo#5902
Yep, so as I said probably we are speaking of different things üòâ


[09-May-19 01:02 AM] Deleted User#0000
With the way I used it, I created a new RPC that creates an op_return with an arbitrary hex string.


[09-May-19 01:04 AM] jl777c#5810
there is earlytxid and earlytxidcontract

{Reactions}
üëå 

[09-May-19 01:04 AM] jl777c#5810
two different things


[09-May-19 01:05 AM] jl777c#5810
latter needs to affect magic


[09-May-19 01:05 AM] jl777c#5810
former cant


[09-May-19 01:05 AM] Deleted User#0000
This is used to strore the scriptPukKey the contract/ac_script pays to. 
There are 2 ways its currently used, it can take an op_return for a contract and append that to the CCvout, so that coinbase cna pay a contract with ac_script, earlytxid appends extra data from the op_return to the ac_script.
Allowing coinbase to fund a contract. Also added yesterday for prices/payments to work together, we can make payments plan before block 100, extract the scriptpubkey that allows it to be paid, and then another contract can use thisscriptpubkey to fund the paymetns plan. Should also work for any contract.


[09-May-19 01:06 AM] Deleted User#0000
In short, coinbase pays a contract, and a contract can pay a contract. But its limited basically to a special chain. You cant create contracts that fund each other on a chain that already exists.


[09-May-19 01:07 AM] Mihailo#5902
üëç


[09-May-19 01:11 AM] TonyL#3577
```Also added yesterday for prices/payments to work together, we can make payments plan before block 100, extract the scriptpubkey that allows it to be paid, and then another contract can use thisscriptpubkey to fund the paymetns plan.``` @Deleted User Could you please provide some guide how to start prices chain with fees paying on airdrop contract address and how to initiate airdrop distribution then?


[09-May-19 01:12 AM] Deleted User#0000
https://github.com/blackjok3rtt/komodo/blob/jl777/src/cc/prices.cpp#L15
Any question fee free to ask.

{Embed}
https://github.com/blackjok3rtt/komodo/blob/jl777/src/cc/prices.cpp
blackjok3rtt/komodo
Komodo. Contribute to blackjok3rtt/komodo development by creating an account on GitHub.
https://images-ext-2.discordapp.net/external/H9TDr69kM7mmxGBcENY3FInyORgkC6up-3NZ7sRUihU/%3Fs%3D400%26v%3D4/https/avatars3.githubusercontent.com/u/30971146

{Reactions}
üëç 

[09-May-19 01:12 AM] TonyL#3577
If I understood prices/payments to work together correct


[09-May-19 01:12 AM] TonyL#3577
Thanks


[09-May-19 01:12 AM] Deleted User#0000
yes by using the `-ac_earlytxidcontract=237` the chain knows that the scriptpubkey inside the earlytxid, is to be used to pay something from the pricesCC.


[09-May-19 01:14 AM] Deleted User#0000
working out teh parameters for the paymentsairdrop is liekly the hardest aprt really. They need to be sane so that the contract will function with the amounts it wil be receiving, how many address it wil be paying etc. An address cannot receive less than 10k sats. So if the plan is designed incirrectly, it could take years, before a release is possible.


[09-May-19 02:12 AM] TonyL#3577
Started chain with `ac_earlytxidcontract` and `earlytxid` :  https://paste.ubuntu.com/p/HzS7bqM3dp/ 
```./komodo-cli -ac_name=TONYPS paymentsinfo '["baf43b87789357495aa22aa3f3451b28daa8619cba0480fe615e6442cc61e332"]'
{
  "plan_type": "snapshot",
  "lockedblocks": 10,
  "minrelease": 10,
  "minimum": 10000,
  "bottom": 0,
  "top": 3999,
  "fixedFlag": 0,
  "excludeScriptPubkeys": [
  ],
  "RWSZtPBs9GTiftNzBCbQ1M8eJFQgNYPgFf": 100.00000000,
  "REpyKi7avsVduqZ3eimncK4uKqSArLTGGK": 0.00000000,
  "totalfunds": 100.00000000,
  "elegiblefunds": 100.00000000,
  "min_release_height": 37,
  "result": "success"
}
```


[09-May-19 02:14 AM] TonyL#3577
Not totally sure if pricesCC should send fees to earlytxid payments plan atm - will try to open few positions now


[09-May-19 02:17 AM] Deleted User#0000
no idea if prices has been coded to actually send the fees to the plan or not... I just added the functions with some examples


[09-May-19 02:17 AM] TonyL#3577
Forgot to use prices params actually such as:
```-ac_cbopret=7 -ac_prices="LTC, BCHABC, XMR, IOTA, ZEC, WAVES, LSK, DCR, RVN, DASH, XEM, BTS, ICX, HOT, STEEM, ENJ, STRAT" -ac_cclib=prices```


[09-May-19 02:17 AM] TonyL#3577
Ah, I see


[09-May-19 02:17 AM] TonyL#3577
Have no idea as well üòÉ


[09-May-19 02:18 AM] TonyL#3577
Payment plan it seems I was able to create


[09-May-19 02:19 AM] Deleted User#0000
payments is working finefrom what I can tell, code is messy but it seems to be stable.


[09-May-19 02:22 AM] TonyL#3577
I see, so clue now is to send fees to paymentplan which declared in earlytxid, ensure that on bets it sending correctly, then check if it distributing to coin holders proportinally and then it's possible to launch `BETS0` chain backed by `BET` coin


[09-May-19 02:34 AM] jl777c#5810
-ac_cclib=prices is not needed it is not in libcc

{Reactions}
üëå 

[09-May-19 02:49 AM] Deleted User#0000
@TonyL  Pushing fix for pricesbet. I think you will need this fix to test it. It should actually pay the correct address from what I can see, bt I left it all commented out ü§¶

{Reactions}
üëç 

[09-May-19 02:49 AM] Deleted User#0000
https://github.com/jl777/komodo/pull/1474

{Embed}
https://github.com/jl777/komodo/pull/1474
fixes, prepare for tokens airdrop support.  by blackjok3rtt ¬∑ Pul...
fixes pricesbetRPC
https://images-ext-1.discordapp.net/external/ZluS_vPUp--Ma1oFnNdhU0YaB0OEwzwGFNPA2N_uSAk/%3Fs%3D400%26v%3D4/https/avatars2.githubusercontent.com/u/5962559


[09-May-19 10:56 PM] TonyL#3577
I have chain with such params:
```./komodod -ac_name=TONYPS2 -ac_supply=1000 -ac_reward=10000000 -ac_cc=2 -ac_snapshot=50 -ac_sapling=1 -ac_earlytxidcontract=237 -ac_cbopret=7 -ac_prices="LTC, BCHABC, XMR, IOTA, ZEC, WAVES, LSK, DCR, RVN, DASH, XEM, BTS, ICX, HOT, STEEM, ENJ, STRAT" -ac_pubkey=039433dc3749aece1bd568f374a45da3b0bc6856990d7da3cd175399577940a775 -ac_perc=77777  -pubkey=0209bc25e2f5a9e252a88365de34bab4511638fadf4131d6f692efbe8186feefaf -earlytxid=703c858c0771edf1f24fec447a5f60636ad597bcd8965f41bd26b5596bb67df4  -addnode=159.69.45.70 -daemon```

`prices` call returning only one price atm:
```./komodo-cli -ac_name=TONYPS2 prices 1
{
  "firstheight": 2,
  "timestamps": [
    1557467533
  ],
  "pricefeeds": [
    {
      "name": "BTC_USD",
      "prices": [
        [
          6301.47330000
        ]
      ]
    },
    {
      "name": "BTC_GBP",
      "prices": [
        [
          4844.97590000
        ]
      ]
    },
    {
      "name": "BTC_EUR",
      "prices": [
        [
          5612.72230000
        ]
      ]
    },
```


[09-May-19 10:57 PM] TonyL#3577
Am I missing something or some min blocks amount should pass until other two prices will be calculated? (using latest jl777)


[09-May-19 11:03 PM] jl777c#5810
is it printing out all the prices it is getting?


[09-May-19 11:05 PM] TonyL#3577
https://paste.ubuntu.com/p/dd7mtFkvPV/ full output looks like this


[09-May-19 11:05 PM] TonyL#3577
And have such prints in stdout

{Attachments}
https://cdn.discordapp.com/attachments/560714286369079299/576288759725686785/unknown.png


[09-May-19 11:06 PM] jl777c#5810
it needs more data

{Reactions}
üëå 

[09-May-19 11:12 PM] TonyL#3577
I think that for BETS0 will use more tickers to make it more interesting for players - all from top20 or top30 lets say


[10-May-19 12:07 AM] TonyL#3577
Hmm, 130 blocks already and still single price. How much data approx it needs to calculate others?


[10-May-19 12:16 AM] TonyL#3577
Tried to delete blocks on one node and resync - now on `./komodo-cli -ac_name=TONYPS2 prices 1` daemon crashing with such backtrace: https://paste.ubuntu.com/p/GNxpGnwyJK/


[10-May-19 12:18 AM] TonyL#3577
Ah, blocks not syncing thats why it's crashing. With synced chain prices works fine - just still have single price


[10-May-19 03:21 AM] TonyL#3577
`  "height": 330,`
single price still so maybe clue in something different.
Btw this chain I started with default blocktime vs REKT0 `-ac_blocktime=600` (not sure but maybe its reflecting in these prices calculation)


[10-May-19 06:06 AM] jl777c#5810
how many blocks in a day?


[10-May-19 06:06 AM] jl777c#5810
until then the prices wont be all there


[10-May-19 06:06 AM] jl777c#5810
you can also add some popular stocks

{Reactions}
üëç 

[10-May-19 06:18 AM] TonyL#3577
1 minute blocks, so should be around 1440 blocks in a day. Ah it delayed 24 hours, so have to wait 24 hours, I see


[10-May-19 06:40 AM] TonyL#3577
Maybe it is worth to have some prices chain test mode? Make delay for test chains 30 minutes lets say so will able to test chains faster.
Because if now I did something wrong with earlytxid on chain setup or want to test chain with stocks param I have to wait 24 hours to accumulate prices what looks like not very effective way to test on this point.


[10-May-19 08:48 AM] dimxy#2587
I added a check for acceptable amount, by finding opposite positions like BTC_USD to BTC_USD,!  
Actually I'm checking sum(leverage\*amount) for both up-positions and down-positions. If amount could be fit to balance this is okay to add the bet. (I'm checking this only for simple positions)
if it is not fit to the balance of opposites I check if the bet's leverage*amount  <  10% from free totalfund (that is  collected from fees and rekt positions). 
So we need some initial fund to start accept bets


[10-May-19 08:50 AM] dimxy#2587
there is a new pricesgetorderbook rpc that outputs matched posiitons and  their balances and total fund's amounts


[10-May-19 09:19 AM] TonyL#3577
Great, updating üî• 
` from free totalfund (that is  collected from fees and rekt positions). ` are rekt positions and fees the same funds at the moment? (we need to airdrop by paymentsCC only fees as I understand)


[10-May-19 10:01 AM] jl777c#5810
you can start with some minimum acceptable risk in a #define, then bets can start. of course we need to seed it with some real funds before sizeable betting can happen

{Reactions}
üëå 

[10-May-19 11:42 AM] dimxy#2587
yes  rekt and fees  are printed as one amount 'TotalFund' like this is fund's own  free money.
Oh, no sorry, TotalFund  is all available amount on global pricespk address.  TotalRekt - what was rekt ,TotalBets - amount on all bets not rekt or cashed out.
So fees are somewhere  within (TotalFunds - TotalRekt - TotalBets)


[10-May-19 09:14 PM] TonyL#3577
Got such prints on REKT0 sync atm:
```PricesValidate() ValidateBetTx=false the fee was paid to wrong address.
PricesValidate() ValidateBetTx=false the fee was paid to wrong address.
PricesValidate() ValidateBetTx=false the fee was paid to wrong address.
```


[10-May-19 09:15 PM] TonyL#3577
Some not correct costbasises: (upd it's in satoshies so looks correct)

``` ./komodo-cli -ac_name=REKT0 pricesgetorderbook
{
  "BTC_USD": {
    "positions": [
      {
        "isOpen": 1,
        "expression": "BTC_USD, 1",
        "costbasis": 612614641379,
        "leverage": -1,
        "equity": 2183,
        "isUpPosition": 0
      },
      {
        "isOpen": 1,
        "expression": "BTC_USD, 1",
        "costbasis": 613136067793,
        "leverage": -2,
        "equity": 1074,
        "isUpPosition": 0
      }
    ],
    "DiffLeveragedPosition": -4444
  },
  "KMD_BTC": {
    "positions": [
      {
        "isOpen": 1,
        "expression": "KMD_BTC, 1",
        "costbasis": 18998,
        "leverage": 3,
        "equity": 86937,
        "isUpPosition": 0
      },
      {
        "isOpen": 1,
        "expression": "KMD_BTC, !, 1",
        "costbasis": 527370530534,
        "leverage": 3,
        "equity": 90344,
        "isUpPosition": 1
      }
    ],
    "DiffLeveragedPosition": 0
  },
  "TotalFund": 1031.39209834,
  "TotalEquity": 0.00090194,
  "TotalRekt": 0.00041111,
  "TotalBets": 0.00092221,
  "TotalCashoutBets": 0.00056000
}```


[10-May-19 09:18 PM] TonyL#3577
Quite strange - mypriceslist is empty for me now, but I'm using same wallet.dat and same pubkey as before (have same balance as before)


[10-May-19 09:18 PM] TonyL#3577
```./komodo-cli -ac_name=REKT0 mypriceslist
PricesList()  bettxid=2c93acfdf17e59372406c08bf9018eab73b54e2e8aef7a55d442bd9e1af25812 mypk=029fe332bce5ccc040c8a13ef5a4664ae841a7b5d3ee6c3ada144c1f3f9b4e1186 opretpk=0318538aa68f00415522b48c3c08131a9bb648fc7aa4d8ce7ed1a4dcdcc55101f5 filter=0 bAppend=0
PricesList()  bettxid=9553d61d3e17686a50e2355230cf6b922df8fbab263a50b6410bacb0ddfe501c mypk=029fe332bce5ccc040c8a13ef5a4664ae841a7b5d3ee6c3ada144c1f3f9b4e1186 opretpk=0318538aa68f00415522b48c3c08131a9bb648fc7aa4d8ce7ed1a4dcdcc55101f5 filter=0 bAppend=0
PricesList()  bettxid=90e844752680696877a82dbadf6c950abeb7727b6be67568d8f7c9c305499585 mypk=029fe332bce5ccc040c8a13ef5a4664ae841a7b5d3ee6c3ada144c1f3f9b4e1186 opretpk=0318538aa68f00415522b48c3c08131a9bb648fc7aa4d8ce7ed1a4dcdcc55101f5 filter=0 bAppend=0
PricesList()  bettxid=19382ae60b2e9d9fbe074313c4b57f2274391946bf3f604416bed9947c02210b mypk=029fe332bce5ccc040c8a13ef5a4664ae841a7b5d3ee6c3ada144c1f3f9b4e1186 opretpk=0318538aa68f00415522b48c3c08131a9bb648fc7aa4d8ce7ed1a4dcdcc55101f5 filter=0 bAppend=0
PricesList()  bettxid=ff6f4af9c2b6e6e4d5254529da567a7eb40c4c8f333826e1f3cc3d378976adbc mypk=029fe332bce5ccc040c8a13ef5a4664ae841a7b5d3ee6c3ada144c1f3f9b4e1186 opretpk=0318538aa68f00415522b48c3c08131a9bb648fc7aa4d8ce7ed1a4dcdcc55101f5 filter=0 bAppend=0
PricesList()  bettxid=e07a4e635ba7ac7f173d88c63b4c1d044d5a8927ba7fa2811a9ae5017f1aa948 mypk=029fe332bce5ccc040c8a13ef5a4664ae841a7b5d3ee6c3ada144c1f3f9b4e1186 opretpk=0318538aa68f00415522b48c3c08131a9bb648fc7aa4d8ce7ed1a4dcdcc55101f5 filter=0 bAppend=0
[
]
```


[10-May-19 09:20 PM] TonyL#3577
It looks like recent changes have "cleared" orders history


[10-May-19 09:38 PM] TonyL#3577
Hmm have problems with test chain on jl777 branch which started tomorrow with earlytxid param. I stopped it at night - today cant sync nodes with such errors in debug.log:

```2019-05-11 04:33:11 ERROR: CheckTransaction(): invalid script data for coinbase time lock
2019-05-11 04:33:11 AcceptBlock block from future error
```


[10-May-19 09:40 PM] TonyL#3577
New opened position on REKT0 displaying in mypriceslist and can get `pricesinfo` for it:
``` ./komodo-cli -ac_name=REKT0 pricesinfo b7277d45ffdbbdb7e43b403fef97fd2f269d3548d29f2d8b556009b3c262f65f
prices_syntheticprice errcode in switch=-1
prices_syntheticprice error getting price (could be end of chain)
error getting synthetic price at height.5463
prices_scanchain() prices_syntheticprofits returned -1, finishing...
{
  "rekt": 0,
  "open": 1,
  "expression": "BTC_USD, 1",
  "reduced": "BTC_USD, 1",
  "costbasis": 6241.12646206,
  "costbasis_test_period": 7,
  "bets": [
    {
      "positionsize": 1.00000000,
      "profits": 0.00000000,
      "costbasis": 6241.12646206,
      "firstheight": 5460
    }
  ],
  "leverage": 1,
  "TotalPositionSize": 1.00000000,
  "TotalProfits": 0.00000000,
  "equity": 1.00000000,
  "LastPrice": 6241.12646206,
  "LastHeight": 5462,
  "LiquidationPrice": 0.00000000
}
```


[10-May-19 09:41 PM] TonyL#3577
Ah, calculations in pricesgetorderbook doing in satoshies gotcha


[10-May-19 09:41 PM] TonyL#3577
Am I understand correct that `"isUpPosition": 1` means that it is a Long position?


[10-May-19 09:43 PM] TonyL#3577
Not understood also what is ` "DiffLeveragedPosition"` (-4444 some strange value)


[10-May-19 10:03 PM] TonyL#3577
```I added a check for acceptable amount, by finding opposite positions like BTC_USD to BTC_USD,!```
Btw BTC_USD to BTC_USD,! just one of the cases of opossite positions. More common case of opossite positions should be:
 BTC_USD, minus some leverage  vs. BTC_USD plus some leverage

In general can't imagine situations where `!` sign is very needed because change leverage sign should do the same job (when you short BTC_USD it's the same as long USD_BTC)


[11-May-19 08:39 AM] siu#3920
http://kmd.money:8050/


[11-May-19 08:39 AM] siu#3920
ded üò¶


[11-May-19 09:07 AM] TonyL#3577
Thanks @siu , started daemon - should be up now

{Reactions}
üëç 

[12-May-19 12:24 AM] dimxy#2587
@TonyL  ```More common case of opossite positions should be:
 BTC_USD, minus some leverage  vs. BTC_USD plus some leverage```
Yes, I believe I cover this, because I sort  out up and down positions  and calculate thier balance as 'levegared position' that is  sum(positionUp*leverage). Not sure this quite correct just what I worked out


[12-May-19 12:44 AM] TonyL#3577
@dimxy
```{
  "BTC_USD": {
    "positions": [
      {
        "isOpen": 1,
        "expression": "BTC_USD, 1",
        "costbasis": 612614641379,
        "leverage": -1,
        "equity": 2009,
        "isUpPosition": 0
      },
      {
        "isOpen": 1,
        "expression": "BTC_USD, 1",
        "costbasis": 624858164551,
        "leverage": 1,
        "equity": 107477683,
        "isUpPosition": 1
      },
      {
        "isOpen": 1,
        "expression": "BTC_USD, 1",
        "costbasis": 613136067793,
        "leverage": -2,
        "equity": 900,
        "isUpPosition": 0
      }
    ],
    "DiffLeveragedPosition": 99995556
  },
  "KMD_BTC": {
    "positions": [
      {
        "isOpen": 1,
        "expression": "KMD_BTC, 1",
        "costbasis": 18998,
        "leverage": 3,
        "equity": 68859,
        "isUpPosition": 0
      },
      {
        "isOpen": 1,
        "expression": "KMD_BTC, !, 1",
        "costbasis": 527370530534,
        "leverage": 3,
        "equity": 109998,
        "isUpPosition": 1
      }
    ],
    "DiffLeveragedPosition": 0
  },
  "TotalFund": 1032.38719834,
  "TotalEquity": 0.00071768,
  "TotalRekt": 0.00041111,
  "TotalBets": 0.00092221,
  "TotalCashoutBets": 0.00056000
}
```

For KMD_BTC it's 0 by some reason and also looks like there is a problem in displaying:
```        "expression": "KMD_BTC, 1",
        "costbasis": 18998,
        "leverage": 3,
        "equity": 86937,
        "isUpPosition": 0```

if isUpPosition should display if it long or short - it should be 1 because it is long and for KMD_BTC, ! it should be 0 because it's KMD_BTC short (so vice versa to current displaying for this pair)


[12-May-19 12:46 AM] TonyL#3577
For BTC_USD number looks plausable but calculations seems not correct:
 107477683 - 2009 - (900 * 2)  = 107473874 != 99995556


[12-May-19 12:48 AM] TonyL#3577
(just to highlight) Negative leverage for this pair detecting as isUpPostion 0
```        "expression": "BTC_USD, 1",
        "costbasis": 613136067793,
        "leverage": -2,
        "equity": 900,
        "isUpPosition": 0```

But for this pair positive leverage detecting as isUposition 0:
```      {
        "isOpen": 1,
        "expression": "KMD_BTC, 1",
        "costbasis": 18998,
        "leverage": 3,
        "equity": 68859,
        "isUpPosition": 0
      },```


[12-May-19 12:55 AM] dimxy#2587
yes I reversed up/down flag for xxx_btc  positions (comparing to usd positions). Seems I need to reverse it back, thanks.
I use for balance calculation the initial 'positionsize' value (but did not add it to the output - will add).
Let me correct all this...

{Reactions}
üôå (2) 

[12-May-19 01:01 AM] TonyL#3577
@dimxy great!

 I'm a little bit (actually much) confused with current quest of chain creation with fees airdrop to holders. It looks like @Deleted User implemented mechanism to airdrop some funds from pricesCC - but  I'm not sure if it fees or not, and wasn't able to test it yet because have no luck with new chain starting. We have to airdrop only fees but not rekt funds

Also could you please advice how / in which place of pricesCC code I can change delay in prices forming for testing purposes? (for these airdrops testing I want to make test chain on which second and third price will appear faster than in 24 hours)


[12-May-19 01:03 AM] TonyL#3577
I'm reading now carefully `Mastering Bitcoin` -> `Mastering Cryptoconditions` -> `C Programming language` so hope soon will understand whats going on in code better


[12-May-19 01:03 AM] TonyL#3577
üòÉ

{Reactions}
üëç 

[12-May-19 01:06 AM] dimxy#2587
Actually I do not know much about airdrop yet. I know that I need to add a special vout to pair a fraction of fee to some script.
For 24 hour cycle  a PRICES_DAYWINDOW #define is responsible


[12-May-19 01:09 AM] TonyL#3577
Ah I see, will wait your review / adjustments to go ahead with this airdrop testing so. I thought you communicated with jok3r on this matter because he PR'ed to your repo üòÉ 

`For 24 hour cycle  a PRICES_DAYWINDOW #define is responsible` - hmm I've started chain with daemons both precompiled with DTESTMODE flag (thought it will make PRICES_DAYWINDOW = 7) but had only single price


[12-May-19 01:09 AM] TonyL#3577
Will play with this define, thanks


[12-May-19 01:16 AM] dimxy#2587
TESTMODE now only changes the costbasis detection period (I switched to this as you once noted your chart showed incorrect period in the TESTMODE)
So you need to change PRICES_DAYWINDOW itself too to have shorter period

{Reactions}
üëç 

[12-May-19 01:18 AM] dimxy#2587
I added joker's code for paying out fee but did not enable it yet as I understand we need to switch to a new chain for it to work


[12-May-19 01:21 AM] jl777c#5810
maybe it makes sense to start a chain and have the fees going to a hardcoded address


[12-May-19 01:21 AM] jl777c#5810
that way the fees are easy to understand and can be debugge


[12-May-19 01:21 AM] jl777c#5810
once it is debugged, just change the destination of the fee to the snapshot CC scriptPubKey


[12-May-19 01:24 AM] jl777c#5810
as long as the chain is setup properly, it wont need a new chain to switch the fee destination


[12-May-19 01:24 AM] jl777c#5810
just dont enforce validation for the fee until it is all understood


[12-May-19 01:24 AM] jl777c#5810
to understand the snapshot payment CC, imagine a CC where you can specify that all funds to an address are only distributed as an airdrop based on coin balance


[12-May-19 01:25 AM] jl777c#5810
any funds send to the snapshot address, accumulates until an airdrop is triggered


[12-May-19 01:25 AM] jl777c#5810
getting it setup properly requires a few tricks


[12-May-19 01:29 AM] TonyL#3577
I think (or at least hope üòÉ ) that I setup correct chain with such earlytxid and payment plan (got prints that snapshot made). Just need a connection with pricesCC now


[12-May-19 01:30 AM] Deleted User#0000
Yes, payments cc has an address that is calculated from the creation txid. All u need to do is send payments cc vout to this address. Once enough funds arrive you can release it and it makes a tx with up to 3999 recipients


[12-May-19 01:30 AM] jl777c#5810
it checks for dust limits?


[12-May-19 01:31 AM] Deleted User#0000
Your can't release a payment if any recipient gets less than 10k SATs, this can be raised. There is no need for inputs.check because you can do payments merge


[12-May-19 01:33 AM] jl777c#5810
would that allow a dust attack?


[12-May-19 01:33 AM] jl777c#5810
make an address with very few coins so it would end up less than 10k sats revshare


[12-May-19 01:33 AM] jl777c#5810
then it stops all payouts?


[12-May-19 01:34 AM] Deleted User#0000
That's up to the plans designer of who to pay ... If u design a plan that can't be paid coins burnt I guess


[12-May-19 01:34 AM] Deleted User#0000
You can merge any inputs as long as.its not all dust


[12-May-19 01:35 AM] jl777c#5810
can you set a dust threshold for output


[12-May-19 01:35 AM] jl777c#5810
so anybody that would get less than the dust threshold is skipped


[12-May-19 01:35 AM] Deleted User#0000
Its 10k sat


[12-May-19 01:35 AM] Deleted User#0000
You cana already raise it


[12-May-19 01:35 AM] jl777c#5810
it sounds like the entire airdrop is stopped if a single payout address goes below 10k sats?


[12-May-19 01:35 AM] Deleted User#0000
Yes currently


[12-May-19 01:36 AM] jl777c#5810
its wrong


[12-May-19 01:36 AM] Deleted User#0000
It would fail


[12-May-19 01:36 AM] jl777c#5810
so I make an address with 1000 sats in it


[12-May-19 01:36 AM] jl777c#5810
as a share of overall snapshot, it will be very small


[12-May-19 01:36 AM] jl777c#5810
and basically make the minimum airdrop size very big


[12-May-19 01:37 AM] jl777c#5810
in fact it might need to be 10x the coin supply


[12-May-19 01:37 AM] jl777c#5810
you see the problem?


[12-May-19 01:37 AM] Deleted User#0000
I think maybe we are talking about something else... I'm talking who can be paid... The amount paid. Your talking about a minimum balance needed to get an allocation?


[12-May-19 01:37 AM] jl777c#5810
lets say we have 100 coins to be airdropped to 100 addresses


[12-May-19 01:38 AM] jl777c#5810
but the smallest addresses dont get more than 0.0001


[12-May-19 01:38 AM] jl777c#5810
this airdrop is not possible


[12-May-19 01:38 AM] jl777c#5810
why not just skip addresses that dont get 0.0001 ?


[12-May-19 01:39 AM] jl777c#5810
the way it is most all airdrops can be prevented just be creating an address with a small amount in it


[12-May-19 01:39 AM] Deleted User#0000
Seems easy enough


[12-May-19 01:40 AM] jl777c#5810
the "attack" would be frequent airdrops of small amounts to make the smaller coins not get anything, but that can be prevented by making the minimum total airdrop big enough


[12-May-19 01:40 AM] jl777c#5810
so it is much better to skip


[12-May-19 11:17 PM] dimxy#2587
I added a test vout with some fixed address where 0.5% fee is sent.
Also I added a check that this vout  should have not less than 10000 sat.


[12-May-19 11:17 PM] jl777c#5810
ok


[12-May-19 11:55 PM] Deleted User#0000
the input amount can be any amount... Im still trying to work out how to enforce minimum pay out... IMO just wait until there is enough funds in it to release


[12-May-19 11:55 PM] Deleted User#0000
Seems to need to rewriere entire validation to acheive this condition...


[12-May-19 11:59 PM] TonyL#3577
@dimxy Is there mechanism already to set this fixed address?


[13-May-19 12:01 AM] Deleted User#0000
Why need fixed address, I already added the paymentsCC address mechanisim... Its nto very complicated. What we need is a minimum release somehow so small amounts of funds can be released. Doyou need help to set this up?


[13-May-19 12:02 AM] Deleted User#0000
Im thinking just some exemption maybe soi that smaller amounts can be released or something... Its simply not possible to shorten the list of address that is paid.


[13-May-19 12:06 AM] Deleted User#0000
I think I can truncate the tx, but the total allocation would still include all elegible address


[13-May-19 12:06 AM] Deleted User#0000
So its not optimal at all.


[13-May-19 12:25 AM] dimxy#2587
well I just set it in the code as hex pubkey. Do we need it to be parametrized?


[13-May-19 12:27 AM] dimxy#2587
if we need some specific address - let's set it instead
@TonyL  This address is supposed just for testing. 
As we are ready to switch to a new chain I enable the code from blackjok which sends fee to the KOMODO_EARLYTXID_SCRIPTPUB


[13-May-19 12:45 AM] dimxy#2587
@Deleted User  Are you saying that I do not need to check the amount on the vout for payment cc? So it could be any amount on it even small?


[13-May-19 12:45 AM] Deleted User#0000
I already added all this


[13-May-19 12:45 AM] Deleted User#0000
The inputs can be merged.


[13-May-19 12:46 AM] Deleted User#0000
its the utputs that james has the issue with... I see only one simple solution, and I dont really think its very fair as such... although how liley will it be that under 10ksat is paid... if the plan has a sane minimum release it will be fine.


[13-May-19 12:47 AM] dimxy#2587
@Deleted User I set the fixed address as it was suggested just for testing before switching to a new chain


[13-May-19 12:47 AM] Deleted User#0000
Yes I added all the stuff for new chain. I thaught one had been started. sorry not been avalible much last few days to keep up.


[13-May-19 12:48 AM] Deleted User#0000
it simply takes a scriptpubkey, so for testing you arte hard coding a scriptpubkey that is fine, as long as what I added is actually working... as I didnt test it with a real chain because hte pricessCC wasnt finsihed for it at the time.


[13-May-19 12:51 AM] Deleted User#0000
Ive fixed a few bugs with paymentsCC, and I guess I need to add this trunctation of the tx in the RPC... I assume this will work, although its not a very nice solution it should at least work.


[13-May-19 01:26 PM] TonyL#3577
@dimxy I'm not able to sync REKT0 with latest daemon from your repo 
At first sync stuck on 5841 with such prints in debug.log:
```2019-05-13 20:17:05 ERROR: CheckTransaction(): invalid script data for coinbase time lock
2019-05-13 20:17:05 AcceptBlock block from future error
```
Then tried to resync from scratch. But stuck earlier and was banned by all nodes:
```  "blocks": 3100,
  "longestchain": 3751,
  "timeoffset": 0,
  "tiptime": 1556116125,
  "connections": 0,
```


[13-May-19 01:29 PM] dimxy#2587
Ok, I'll also try this


[13-May-19 01:30 PM] TonyL#3577
I think that before I was in consensus with only yours nodes


[13-May-19 01:30 PM] TonyL#3577
Before I stuck I've tried to generate `pricesbet` and `pricesaddfunds` transactions and both had 0.5% vout to the same address


[13-May-19 01:31 PM] TonyL#3577
So seems it work - not tested interesting cases yet like a txfee amount bet


[13-May-19 01:44 PM] dimxy#2587
I have disabled the costbasis funcid but such txns still exist, correcting...


[13-May-19 01:45 PM] jl777c#5810
how will you fix it in a way that wont allow people to make costbasis funcid?


[13-May-19 01:45 PM] jl777c#5810
maybe for now a chain specific exemption?


[13-May-19 01:48 PM] dimxy#2587
Yes now I'm advancing the non-validating height for REKT0.
I suppose in a new chain we won't have such issue and txns will be stable


[13-May-19 01:49 PM] jl777c#5810
ok, good


[13-May-19 01:50 PM] dimxy#2587
updated the repo


[13-May-19 01:57 PM] TonyL#3577
@dimxy This time I stuck on:
```  "blocks": 3766,
  "longestchain": 5852,
  "timeoffset": 0,
  "tiptime": 1556557906,
  "connections": 0,
```


[13-May-19 01:57 PM] TonyL#3577
Same prints in debug.log:
```2019-05-13 20:57:12 ERROR: CheckTransaction(): invalid script data for coinbase time lock
2019-05-13 20:57:12 AcceptBlock block from future error
```


[13-May-19 02:01 PM] dimxy#2587
I had issues like this while sync in progress, it stopped and continued itself


[13-May-19 02:03 PM] TonyL#3577
```  "balance": 1106.76698000,
  "blocks": 3776,
  "longestchain": 3776,
  "timeoffset": 0,
  "tiptime": 1556534350,
  "connections": 1,
```


[13-May-19 02:03 PM] TonyL#3577
Are you on same height?


[13-May-19 02:04 PM] TonyL#3577
Looks like we made one more fork hehe, before there were 5800+ blocks


[13-May-19 02:04 PM] dimxy#2587
I im stuck at 3100 from costbasis,
in some other cases i saw pause and continue


[13-May-19 02:05 PM] TonyL#3577
Yes, on latest I passed trough 3100


[13-May-19 02:05 PM] TonyL#3577
But now longestchain is just 3700 blocks instead of 5800 before, thats why I asked on which height are you


[13-May-19 02:06 PM] dimxy#2587
now I am at 5853

{Reactions}
üëå 

[13-May-19 02:09 PM] TonyL#3577
Deleted blocks - stuck on other height now
```  "balance": 1189.31468000,
  "blocks": 4043,
  "longestchain": 5853,
  "timeoffset": 0,
  "tiptime": 1556689878,
  "connections": 0,
```


[13-May-19 02:09 PM] TonyL#3577
Looks like I have to try until it sync üòÉ


[13-May-19 02:11 PM] TonyL#3577
Maybe it's just connectivity issues to your node


[13-May-19 02:12 PM] dimxy#2587
I saw this several times while syncing
ERROR: CheckTransaction(): invalid script data for coinbase time lock
It pauses and continues on such errors.I did not do anything


[13-May-19 02:13 PM] TonyL#3577
```  "balance": 2156.27187190,
  "blocks": 5854,
  "longestchain": 5854,
  "timeoffset": 0,
  "tiptime": 1557781294,
  "connections": 1,
```

{Reactions}
üëç 

[13-May-19 02:13 PM] TonyL#3577
Yay


[13-May-19 02:13 PM] TonyL#3577
Synced now üòÉ just strange that one time it decided that longestchain is `3776` blocks


[13-May-19 02:15 PM] dimxy#2587
maybe this was from the ban


[13-May-19 02:23 PM] TonyL#3577
pricesbet: https://paste.ubuntu.com/p/j3Rc8ppc5g/
pricesaddfunding: https://paste.ubuntu.com/p/9RZYyjzXSK/

Both have 0.5% output to RAvTXi4GRktCdudNsB2ocFLEyvyoWJ4ty6

Is this print:
```PricesValidate() ValidateAddFundingTx = false invalid position size in the opreturn
PricesValidate() funcId=A ValidatebetTx = false incorrect vout number for bet tx```
on pricesaddfunding broadcasting expected? @dimxy


[13-May-19 11:56 PM] dimxy#2587
This could be because as I added payment cc vout so some older bet tx could not be validated.
That is, when an addfunding tx is added I do step back and validate the initial bettx too
(because initial bet tx has no cc vin I think I should validate it this way, that is, after some new tx with cc vins like addfunding tx is added)

{Reactions}
üëç 

[14-May-19 12:36 AM] dimxy#2587
actually now most of validation code just logs errors and returns true


[14-May-19 12:41 AM] TonyL#3577
btw pricesbet not checking on amounts of digits in number. There is a check on pricesbet amount to be > than 0.1 but number like this do the trick: 
```./komodo-cli -ac_name=REKT0 pricesbet 0.10000000000000000000000000000001 1 "BTC_USD, 1"````


[14-May-19 12:42 AM] TonyL#3577
And position size became exactly 0.1


[14-May-19 12:42 AM] TonyL#3577
```./komodo-cli -ac_name=REKT0 pricesinfo 60802b79cfbf577619ccc3974b9be48b2e6e43b4a0b2a65138ccfb8c0eb1706e
prices_syntheticprice errcode in switch=-1
prices_syntheticprice error getting price (could be end of chain)
error getting synthetic price at height.5913
prices_scanchain() prices_syntheticprofits returned -1, finishing...
{
  "rekt": 0,
  "open": 1,
  "expression": "BTC_USD, 1",
  "reduced": "BTC_USD, 1",
  "costbasis": 7299.15801862,
  "bets": [
    {
      "positionsize": 0.10000000,
      "profits": 0.00000000,
      "costbasis": 7299.15801862,
      "firstheight": 5911
    }
  ],
  "leverage": 1,
  "TotalPositionSize": 0.10000000,
  "TotalProfits": 0.00000000,
  "equity": 0.10000000,
  "LastPrice": 7299.15801862,
  "LastHeight": 5912,
  "LiquidationPrice": 0.00000000
}
```


[14-May-19 12:42 AM] TonyL#3577
Not sure if it can cause the problems - just observation üòÉ


[14-May-19 12:44 AM] TonyL#3577
Even with such lowest position 0.5% fee sent to same address as before:
```    {
      "value": 0.00050000,
      "valueSat": 50000,
      "n": 4,
      "scriptPubKey": {
        "asm": "037c803ec82d12da939ac04379bbc1130a9065c53d8244a61eece1db942cf0efa7 OP_CHECKSIG",
        "hex": "21037c803ec82d12da939ac04379bbc1130a9065c53d8244a61eece1db942cf0efa7ac",
        "reqSigs": 1,
        "type": "pubkey",
        "addresses": [
          "RAvTXi4GRktCdudNsB2ocFLEyvyoWJ4ty6"
        ]
      }
```


[14-May-19 12:51 AM] dimxy#2587
well I think such an issue may be in all rpcs where coins are passed. Maybe we should develop a common checking function which is this case could warn that number is truncated


[14-May-19 12:57 AM] TonyL#3577
Yep, I wonder any accuracy with order less than satoshi dont have sense because satoshi indivisible


[14-May-19 03:50 AM] TonyL#3577
@dimxy `As we are ready to switch to a new chain I enable the code from blackjok which sends fee to the KOMODO_EARLYTXID_SCRIPTPUB` - just to clarify - is this code active already if I'll start new chain with `earlytxid` param?


[14-May-19 03:52 AM] TonyL#3577
impatience to run a chain with real value trading rolls over üòÇ


[14-May-19 03:52 AM] dimxy#2587
i need to enable this code

{Reactions}
üëå 

[14-May-19 03:53 AM] dimxy#2587
let me review it once more..


[14-May-19 11:36 AM] dimxy#2587
blackjok said he made some important corrections to payments cc which he push into jl777 branch.
prices cc actually in a branch from FSM branch. So seems I need to add them manually, 
studying his changes...


[14-May-19 11:45 AM] jl777c#5810
i will push to FSM


[14-May-19 11:45 AM] jl777c#5810
merged


[14-May-19 11:45 AM] jl777c#5810
now FSM is same as jl777

{Reactions}
üëç 

[14-May-19 12:56 PM] dimxy#2587
I enabled code sending to KOMODO_EARLYTXID_SCRIPTPUB.
(creating bet does not work any more on this chain as params are incompatible)

{Reactions}
üëå 

[14-May-19 12:57 PM] jl777c#5810
launch a new chain if needed

{Reactions}
üëå 

[14-May-19 01:52 PM] TonyL#3577
Great! Will go ahead tomorrow with earlytxid chain testing


[15-May-19 12:49 AM] TonyL#3577
@dimxy `I enabled code sending to KOMODO_EARLYTXID_SCRIPTPUB.` is version with this code enabled in FSM/jl777 or I should use your repo to test?


[15-May-19 12:55 AM] dimxy#2587
still my repo (I merged in it the changes in FSM)

{Reactions}
üëç 

[15-May-19 12:56 AM] Deleted User#0000
@TonyL  make sure your on the latest. I am pretty sure its working fine, but its incompatible with any old chains. I  had to change hwo paymetnsrelease works.

{Reactions}
üëç 

[15-May-19 12:56 AM] Deleted User#0000
Ping me if any issues. I'll keep an eye on discord.


[15-May-19 12:57 AM] TonyL#3577
Sure, thank you for prompt answers!


[15-May-19 12:57 AM] Deleted User#0000
just lucky I was here at this eact time üòÇ


[15-May-19 12:59 AM] TonyL#3577
Yesterday I received special bracelet from Hong Kong temple which should attract luck, so not surprising

{Reactions}
shexy üëç 

[15-May-19 12:59 AM] TonyL#3577
üòÉ


[15-May-19 01:12 AM] dimxy#2587
I m trying to run a new chain with params to run payments rpcs.
receiving error:
terminate called after throwing an instance of 'std::invalid_argument'
  what():  Unsupported Equihash parameters
Aborted


[15-May-19 01:13 AM] dimxy#2587
params: 
./komodod -ac_cbopret=7 -ac_prices="LTC, BCHABC, XMR, IOTA, ZEC, WAVES, LSK, DCR, RVN, DASH, XEM, BTS, ICX, HOT, STEEM, ENJ, STRAT" -ac_name=PRICESXY1  -ac_cclib=prices -ac_cc=2  -ac_supply=100000000 -ac_reward=1000000000 -ac_nk=96,5 -ac_blocktime=60  -ac_snapshot=50 -ac_sapling=1 -ac_earlytxidcontract=237  -printtoconsole -testnode=1 -gen -genproclimit=1


[15-May-19 01:13 AM] Deleted User#0000
take ac_nk out opf the params

{Reactions}
üëç 

[15-May-19 01:13 AM] Deleted User#0000
dont really need it, it just allows to mine blocks faster


[15-May-19 01:14 AM] Deleted User#0000
`/komodod -ac_cbopret=7 -ac_prices="LTC, BCHABC, XMR, IOTA, ZEC, WAVES, LSK, DCR, RVN, DASH, XEM, BTS, ICX, HOT, STEEM, ENJ, STRAT" -ac_name=PRICESXY1  -ac_cclib=prices -ac_cc=2  -ac_supply=100000000 -ac_reward=1000000000 -ac_snapshot=50 -ac_sapling=1 -ac_earlytxidcontract=237  -printtoconsole -testnode=1 -gen -genproclimit=1`


[15-May-19 01:14 AM] Deleted User#0000
that should do it.


[15-May-19 01:29 AM] TonyL#3577
Btw which API are we using to get stocks price? (otherwords - where is it possible to check list with tickers which I'm able to add to `-ac_stocks` param)


[15-May-19 01:47 AM] dimxy#2587
they are all in komodo_gateway.h (can find by "http", some are commented out)

{Reactions}
üëç 

[15-May-19 01:59 AM] TonyL#3577
https://api.iextrading.com/1.0/tops/last wide selection! üòÉ


[15-May-19 02:18 AM] dimxy#2587
I am receiving many errors on my new prices chain:
"CheckTransaction(): invalid script data for coinbase time lock"
(maybe this is because I set ac_blocktime=60?)


[15-May-19 02:21 AM] TonyL#3577
I've started such chain:
```./komodod -ac_name=PRICEST -ac_cc=2 -ac_supply=100000000 -ac_reward=1000000000 -ac_cbopret=7 -ac_prices="LTC, BCHABC, XMR, IOTA, ZEC, WAVES, LSK, DCR, RVN, DASH, XEM, BTS, ICX, HOT, STEEM, ENJ, STRAT" -ac_stocks="AAPL, IBM, EA" -ac_snapshot=50 -ac_sapling=1 -ac_earlytxidcontract=237 -addnode=159.69.45.70 -pubkey=02147f20fbe0c3cc443cbded55a533bf2621a6efa0c089ac3b7a903f1d63f6690f -daemon
```
Then when I'm starting mining:
```./komodo-cli -ac_name=PRICEST setgenerate true 1``` daemon deadly hangs


[15-May-19 02:22 AM] TonyL#3577
Have modified PRICES_DAYWINDOW:
```-#define PRICES_DAYWINDOW ((3600*24/ASSETCHAINS_BLOCKTIME) + 1)
+#define PRICES_DAYWINDOW ((3600*1/ASSETCHAINS_BLOCKTIME) + 1)
```


[15-May-19 02:25 AM] dimxy#2587
what is your blocktime?


[15-May-19 02:25 AM] TonyL#3577
Should be default (1 min)


[15-May-19 02:26 AM] TonyL#3577
I expected window 61 (1 hour)


[15-May-19 02:27 AM] dimxy#2587
on REKT0 it was 600 (10min). I can see checks with 60sec constants - could be overlaps or so. I think I 'll recreate the chain with 120 or more


[15-May-19 02:28 AM] TonyL#3577
Will try now with default PRICES_DAYWINDOW


[15-May-19 02:32 AM] TonyL#3577
Aha, found the reason - it not because of `PRICES_DAYWINDOW` but because of `ac_stocks` param


[15-May-19 02:32 AM] TonyL#3577
With `-ac_stocks="AAPL, IBM, EA" ` daemon hangs right after I start mining, but without this param it works fine


[15-May-19 03:01 AM] dimxy#2587
we would need to wait for 2*PRICES_DAYWINDOW to begin to receive smoothed prices


[15-May-19 03:01 AM] dimxy#2587
so it seems better to set it to a lower value to test


[15-May-19 03:03 AM] TonyL#3577
Yes, that was a plan


[15-May-19 03:03 AM] TonyL#3577
Now I'm started chain with such window: `#define PRICES_DAYWINDOW ((3600*1/ASSETCHAINS_BLOCKTIME) + 1)`


[15-May-19 03:04 AM] TonyL#3577
If it's `2*PIRCES_DAYWINDOW` it will take ~2 hours with default blocktime for smoothed prices


[15-May-19 03:14 AM] TonyL#3577
Started chain with such daywindow and earlytxid,  lets check if 3 prices propagate in 2 hours üòÉ

{Reactions}
üëç 

[15-May-19 04:52 AM] TonyL#3577
```  "result": "success",
  "seed": -1177246481141807744,
  "height": 155,
  "maxsamples": 1,
  "width": 124,
  "daywindow": 61,
  "numpricefeeds": 55
```

Have 3 prices now

```
./komodo-cli -ac_name=PRICEST1 pricesbet 1 1 "BTC_USD, 1"
parsed synthetic: BTC_USD 1 
assetchains_contract.237 vs eval_prices.237
prices_isacceptableamount() amount=100000000 leverage=1 fundTotals.totalFund=0 fundTotals.totalEquity=0
{
  "result": "error",
  "error": "too big amount and leverage"
}
```


[15-May-19 04:55 AM] TonyL#3577
Aha, so now cant place any bet because of 0 CC balance


[15-May-19 04:55 AM] TonyL#3577
```./komodo-cli -ac_name=PRICEST1 pricesaddress
{
  "result": "success",
  "PricesCCAddress": "RAL5Vh8NXmFqEKJRKrk1KjKaUckK7mM1iS",
  "PricesCCBalance": 0.00000000,
  "PricesNormalAddress": "RBunXCsMHk5NPd6q8SQfmpgre3x133rSwZ",
  "PricesNormalBalance": 0.00000000,
  "PricesCCTokensAddress": "RTSAiZc1b5H8WKPjqydsNfG11bLjbXZAY5",
  "myCCAddress(Prices)": "RG8gAg24y8q87jxGQbjLpWM3fYGxxvCpd8",
  "myCCbalance(Prices)": 0.00000000,
  "myaddress": "RT3ShiVNAnCoAQw7UoNQBMZhUbQyvXsnQJ",
  "mybalance": 100001459.10064752,
  "myaddr": "RG8gAg24y8q87jxGQbjLpWM3fYGxxvCpd8",
  "houseaddr": "RQc5neVkUcy44CqV9hj7ZukiiT9vNipqZT",
  "exposureaddr": "RJuhhPF7s8bR1532NWLnYZeCSs5BY9ZZBC"
}
```
Should I fund manually `PricesCCAddress` or `PricesNormalAddress`, oh or  `houseaddr` I think ?


[15-May-19 04:58 AM] dimxy#2587
I just added a method pricesrefillfund


[15-May-19 04:58 AM] dimxy#2587
in the repo

{Reactions}
üëç 

[15-May-19 05:02 AM] TonyL#3577
I can see you changed define to `#define PRICES_DAYWINDOW (7)` in komodo_defs.h, we should keep in mind to change it back later üòÉ


[15-May-19 05:03 AM] dimxy#2587
ah yes


[15-May-19 05:03 AM] dimxy#2587
i ll return it to the original


[15-May-19 05:10 AM] TonyL#3577
`pricesrefillfund` refilled my fund üëç 
```./komodo-cli -ac_name=PRICEST1 pricesgetorderbook
{
  "TotalFund": 1000000.00000000,
  "TotalEquity": 0.00000000,
  "TotalRekt": 0.00000000,
  "TotalBets": 0.00000000,
  "TotalCashoutBets": 0.00000000
}
```


[15-May-19 05:15 AM] TonyL#3577
Placed one bet:
```./komodo-cli -ac_name=PRICEST1 pricesbet 10000 1 "BTC_USD, 1"
{
  "hex": "0400008085202f89015f19423bb3ad2daa1750fe4b40a8e3377c2c0f1026dfa5c80f9c54d626ecbdf1010000004847304402205551b1d9a244d2f39880bc612a8421b55dd91bfb8c7f519ddfc5a6b4ca7ef958022032d56f64ad2fda8149f31fbd12e4852aac99fc5543af7d1ae33a92bf248c51ee01ffffffff071027000000000000302ea22c8020bd07328de731fec74670ef9f1f51843a5ff6a37b9d65efc92d5e52924ab4cbe98103120c008203000401cc1027000000000000302ea22c80203ee64ec5f134da404710d306dcd9ca54a0139b3c4827b43a988fc6316e6c2a688103120c008203000401cc001e9faae7000000302ea22c80203ee64ec5f134da404710d306dcd9ca54a0139b3c4827b43a988fc6316e6c2a688103120c008203000401cc10270000000000002321039894cb054c0032e99e65e715b03799607aa91212a16648d391b6fa2cc52ed0cfac00f2052a01000000302ea22c8020dea998f43423439942836e05d57ec8f553f419887861cd2f28044bc881eb297781031210008203000401cc209c2e37142b23002321038d6ad45605f9378227af37415603c93184a92425897006da6446b76652510ab9ac0000000000000000626a4c5fed4221038d6ad45605f9378227af37415603c93184a92425897006da6446b76652510ab9a40000000010a5d4e800000001002389849abb00000002010001080000000000000000000000000000000000000000000000000000000000000000000000006d0100000000000000000000000000",
  "txid": "61f7f260979422c48c65913671c5dcaf4d0c487e33ceb07da04b87222b62613d",
  "result": "success"
}
```
```./komodo-cli -ac_name=PRICEST1 sendrawtransaction hex^^
61f7f260979422c48c65913671c5dcaf4d0c487e33ceb07da04b87222b62613d```


[15-May-19 05:15 AM] TonyL#3577
```./komodo-cli -ac_name=PRICEST1 mypriceslist
[
]
```
```./komodo-cli -ac_name=PRICEST1 pricesinfo 61f7f260979422c48c65913671c5dcaf4d0c487e33ceb07da04b87222b62613d
{
}
```


[15-May-19 05:16 AM] TonyL#3577
```./komodo-cli -ac_name=PRICEST1 getrawtransaction 61f7f260979422c48c65913671c5dcaf4d0c487e33ceb07da04b87222b62613d
0400008085202f89015f19423bb3ad2daa1750fe4b40a8e3377c2c0f1026dfa5c80f9c54d626ecbdf1010000004847304402205551b1d9a244d2f39880bc612a8421b55dd91bfb8c7f519ddfc5a6b4ca7ef958022032d56f64ad2fda8149f31fbd12e4852aac99fc5543af7d1ae33a92bf248c51ee01ffffffff071027000000000000302ea22c8020bd07328de731fec74670ef9f1f51843a5ff6a37b9d65efc92d5e52924ab4cbe98103120c008203000401cc1027000000000000302ea22c80203ee64ec5f134da404710d306dcd9ca54a0139b3c4827b43a988fc6316e6c2a688103120c008203000401cc001e9faae7000000302ea22c80203ee64ec5f134da404710d306dcd9ca54a0139b3c4827b43a988fc6316e6c2a688103120c008203000401cc10270000000000002321039894cb054c0032e99e65e715b03799607aa91212a16648d391b6fa2cc52ed0cfac00f2052a01000000302ea22c8020dea998f43423439942836e05d57ec8f553f419887861cd2f28044bc881eb297781031210008203000401cc209c2e37142b23002321038d6ad45605f9378227af37415603c93184a92425897006da6446b76652510ab9ac0000000000000000626a4c5fed4221038d6ad45605f9378227af37415603c93184a92425897006da6446b76652510ab9a40000000010a5d4e800000001002389849abb00000002010001080000000000000000000000000000000000000000000000000000000000000000000000006d0100000000000000000000000000
```


[15-May-19 05:17 AM] TonyL#3577
Bet is not tracking as bet @dimxy but betamount funds added to "TotalFund" :
```./komodo-cli -ac_name=PRICEST1 pricesgetorderbook
{
  "TotalFund": 1009950.00010000,
  "TotalEquity": 0.00000000,
  "TotalRekt": 0.00000000,
  "TotalBets": 0.00000000,
  "TotalCashoutBets": 0.00000000
}
```


[15-May-19 05:17 AM] dimxy#2587
yes something's broken

{Reactions}
üëå 

[15-May-19 05:27 AM] dimxy#2587
updated (just forgot to remove height checking for the old chain)


[15-May-19 05:49 AM] jl777c#5810
@TonyL for -ac_stocks, dont put spaces after ,


[15-May-19 05:49 AM] jl777c#5810
-ac_stocks="AAPL,IBM,EA"


[15-May-19 05:49 AM] jl777c#5810
above works


[15-May-19 05:58 AM] TonyL#3577
Ah, ok


[15-May-19 06:13 AM] TonyL#3577
Can see betslist / my bet info on latest


[15-May-19 06:14 AM] TonyL#3577
I have only one bet on chain at the moment:
```./komodo-cli -ac_name=PRICEST1 pricesinfo 61f7f260979422c48c65913671c5dcaf4d0c487e33ceb07da04b87222b62613d
prices_syntheticprice errcode in switch=-1
prices_syntheticprice error getting price (could be end of chain)
error getting synthetic price at height.170
prices_scanchain() prices_syntheticprofits returned -1, finishing...
{
  "rekt": 0,
  "open": 1,
  "expression": "BTC_USD, 1",
  "reduced": "BTC_USD, 1",
  "costbasis": 8056.07195901,
  "bets": [
    {
      "positionsize": 10000.00000000,
      "profits": -5.99670000,
      "costbasis": 8056.07195901,
      "firstheight": 164
    }
  ],
  "leverage": 1,
  "TotalPositionSize": 10000.00000000,
  "TotalProfits": -5.99670000,
  "equity": 9994.00330000,
  "LastPrice": 8051.24100491,
  "LastHeight": 169,
  "LiquidationPrice": 0.00000000
}
```


[15-May-19 06:14 AM] TonyL#3577
``` ./komodo-cli -ac_name=PRICEST1 pricesgetorderbook
prices_syntheticprice errcode in switch=-1
prices_syntheticprice error getting price (could be end of chain)
error getting synthetic price at height.170
prices_scanchain() prices_syntheticprofits returned -1, finishing...
prices_ispositionup returns true for BTC for expr=BTC_USD, 1
{
  "BTC_USD": {
    "positions": [
      {
        "isOpen": 1,
        "expression": "BTC_USD, 1",
        "positionsize": 1000000000000,
        "costbasis": 805607195901,
        "leverage": 1,
        "equity": 999400330000,
        "isUpPosition": 1
      }
    ],
    "DiffLeveragedPosition": 1000000000000
  },
  "TotalFund": 1009950.00010000,
  "TotalEquity": 9994.00330000,
  "TotalRekt": 0.00000000,
  "TotalBets": 10000.00000000,
  "TotalCashoutBets": 0.00000000
}
```


[15-May-19 06:15 AM] TonyL#3577
Initially I filled fund for `1000000.00010000`


[15-May-19 06:15 AM] TonyL#3577
Player is now ` "TotalProfits": -5.99670000` so current Fund equity in this bet should be `+5.99670000`


[15-May-19 06:16 AM] TonyL#3577
Not sure why equity of players summed up with Fund funds


[15-May-19 06:18 AM] TonyL#3577
Ah, from other side player equity is the sum which fund needs to payout if player wants to cashout right now


[15-May-19 06:18 AM] TonyL#3577
But anyway I wonder if real funds summarising with equity it might be quite confusing


[15-May-19 06:20 AM] TonyL#3577
```./komodo-cli -ac_name=PRICEST1 paymentsinfo '["0deaa8d69fbea7cbaf85fbd1ace7e26c173b52e761cdf6edc3eecf04e1879e7f"]'
{
  "plan_type": "snapshot",
  "lockedblocks": 10,
  "minrelease": 10,
  "minimum": 10000,
  "bottom": 0,
  "top": 3999,
  "fixedFlag": 0,
  "excludeAddresses": [
  ],
  "RTkpZPTDPBUhY1miULTjVf8dcsHxz8G1KQ": 100.00000000,
  "REpyKi7avsVduqZ3eimncK4uKqSArLTGGK": 0.00000000,
  "totalfunds": 100.00000000,
  "elegiblefunds": 100.00000000,
  "min_release_height": 169,
  "result": "success"
}
```


[15-May-19 06:20 AM] TonyL#3577
Only initial funding amount in my payment plan (betfee not summarised)


[15-May-19 06:20 AM] dimxy#2587
yes I calculate TotalEquity like what the house owes
TotalFund - all amount total on prices globalpk


[15-May-19 06:21 AM] TonyL#3577
Ah, there is a 0.5% fee, so it's real money in `TotalFund`


[15-May-19 06:21 AM] TonyL#3577
Was my confusion


[15-May-19 06:21 AM] dimxy#2587
so TotalEqity is in TotalFund


[15-May-19 06:22 AM] dimxy#2587
we may change it of course


[15-May-19 06:23 AM] TonyL#3577
It's not a problem I think: if needed current fund equity can be calculated as `totalbets - players_equity (TotalEqutiy in this output)`


[15-May-19 06:23 AM] TonyL#3577
I can see that fee was sent to needed address:
```    {
      "value": 50.00000000,
      "valueSat": 5000000000,
      "n": 4,
      "scriptPubKey": {
        "asm": "a22c8020dea998f43423439942836e05d57ec8f553f419887861cd2f28044bc881eb297781031210008203000401 OP_CHECKCRYPTOCONDITION",
        "hex": "2ea22c8020dea998f43423439942836e05d57ec8f553f419887861cd2f28044bc881eb297781031210008203000401cc",
        "reqSigs": 1,
        "type": "cryptocondition",
        "addresses": [
          "RTkpZPTDPBUhY1miULTjVf8dcsHxz8G1KQ"
        ]
      }
    },
```


[15-May-19 06:24 AM] TonyL#3577
Same address as in paymentsinfo print


[15-May-19 06:24 AM] TonyL#3577
Just sum in paymentsinfo remained the same


[15-May-19 06:45 AM] TonyL#3577
@Deleted User Fees sending now on this `RTkpZPTDPBUhY1miULTjVf8dcsHxz8G1KQ` address:
```    {
      "value": 5.00000000,
      "valueSat": 500000000,
      "n": 4,
      "scriptPubKey": {
        "asm": "a22c8020dea998f43423439942836e05d57ec8f553f419887861cd2f28044bc881eb297781031210008203000401 OP_CHECKCRYPTOCONDITION",
        "hex": "2ea22c8020dea998f43423439942836e05d57ec8f553f419887861cd2f28044bc881eb297781031210008203000401cc",
        "reqSigs": 1,
        "type": "cryptocondition",
        "addresses": [
          "RTkpZPTDPBUhY1miULTjVf8dcsHxz8G1KQ"
        ]
      }
``` 

but in `paymentsinfo` I can see only the sum of initial `paymentsfund` 

```
./komodo-cli -ac_name=PRICEST1 paymentsinfo '["0deaa8d69fbea7cbaf85fbd1ace7e26c173b52e761cdf6edc3eecf04e1879e7f"]'
{
  "plan_type": "snapshot",
  "lockedblocks": 10,
  "minrelease": 10,
  "minimum": 10000,
  "bottom": 0,
  "top": 3999,
  "fixedFlag": 0,
  "excludeAddresses": [
  ],
  "RTkpZPTDPBUhY1miULTjVf8dcsHxz8G1KQ": 100.00000000,
  "REpyKi7avsVduqZ3eimncK4uKqSArLTGGK": 0.00000000,
  "totalfunds": 100.00000000,
  "elegiblefunds": 100.00000000,
  "min_release_height": 172,
  "result": "success"
}
```


[15-May-19 06:46 AM] Deleted User#0000
can I have chain params and repo please, it will be faster for me to check it that way


[15-May-19 06:47 AM] TonyL#3577
Sure:
```./komodod -ac_name=PRICEST1 -ac_cc=2 -ac_supply=100000000 -ac_reward=1000000000 -ac_cbopret=7 -ac_prices="LTC, BCHABC, XMR, IOTA, ZEC, WAVES, LSK, DCR, RVN, DASH, XEM, BTS, ICX, HOT, STEEM, ENJ, STRAT" -ac_snapshot=50 -ac_sapling=1 -ac_earlytxidcontract=237 -addnode=159.69.45.70 -earlytxid=02c20fb0af23090076b800fe9ae6546af986983618957f296bd6f56ca27ea065 -daemon```

https://github.com/dimxy/komodo/tree/prices-rpc

{Embed}
https://github.com/dimxy/komodo/tree/prices-rpc
dimxy/komodo
Komodo. Contribute to dimxy/komodo development by creating an account on GitHub.
https://images-ext-2.discordapp.net/external/FG7_8N0jtCftKtsAk7K5U05eeO1dpQWPnEQ9A5NQLBI/%3Fs%3D400%26v%3D4/https/avatars0.githubusercontent.com/u/21120539


[15-May-19 06:48 AM] TonyL#3577
@Deleted User Ah and I have custom daywindow ```#define PRICES_DAYWINDOW ((3600*1/ASSETCHAINS_BLOCKTIME) + 1)``` in src/komodo_defs.h (just need to change 24 to 1 before compilation)


[15-May-19 06:48 AM] Deleted User#0000
cool thanks. will check.

{Reactions}
üëç 

[15-May-19 06:49 AM] Deleted User#0000
has the tx confirmed btw? its shows 0 balance for unconfirmed utxos


[15-May-19 06:49 AM] TonyL#3577
Yes, sure


[15-May-19 06:50 AM] TonyL#3577
```  "confirmations": 11,
  "rawconfirmations": 11,
```

{Reactions}
üëç 

[15-May-19 06:51 AM] TonyL#3577
txs with bet fees sent to `RTkpZPTDPBUhY1miULTjVf8dcsHxz8G1KQ` :
```./komodo-cli -ac_name=PRICEST1 priceslist
[
  "61f7f260979422c48c65913671c5dcaf4d0c487e33ceb07da04b87222b62613d",
  "5a1b91986fbb1236df9a501a859acf35077976ea4a6aa9615f5d40d1e0c20894"
]
```


[15-May-19 06:51 AM] Deleted User#0000
thanks.


[15-May-19 07:59 AM] dimxy#2587
```if real funds summarising with equity...```
I did not find yet any methodology how real houses manage their funds. Very interesting to know about them.
I think we are similar to forex. So we could accept bets as long as there are balance with opposite positions (as we discussed). 
Sure real funds use more sophisticated technics than just funding "BTC_USD" vs "BTC_USD,!"

Just have read: some pairs might move in similar directions, in that case they are 'correlated pairs' like EUR/USD and GBP/USD. Correlation is measured with a coefficient.


[15-May-19 08:17 AM] Deleted User#0000
@TonyL  the funds are sending there correctly.. but they are in the wrong vout, so I need to fix this. Will have a look... It seems to me that I can loop each vout of the tx and check which ones are paymentscc vouts so it doesnt need vout 1 or 0 limitation.


[15-May-19 08:18 AM] Deleted User#0000
Pretty sure this is only RPC limitaiton


[15-May-19 08:24 AM] Deleted User#0000
Actually this is very easy fix.

{Reactions}
üëç 

[15-May-19 09:08 AM] Deleted User#0000
https://github.com/jl777/komodo/pull/1481

{Embed}
https://github.com/jl777/komodo/pull/1481
fix payments balance by blackjok3rtt ¬∑ Pull Request #1481 ¬∑ jl77...
vout limitation is not required by anything in validation so this should work.
https://images-ext-1.discordapp.net/external/ZluS_vPUp--Ma1oFnNdhU0YaB0OEwzwGFNPA2N_uSAk/%3Fs%3D400%26v%3D4/https/avatars2.githubusercontent.com/u/5962559


[15-May-19 09:08 AM] Deleted User#0000
I tried to make PR to dimxy repo but I had too many changes


[15-May-19 09:16 AM] dimxy#2587
I believe I have those changes in my repo as I merged yesterday FSM, and before that JL merged the latest JL777 branch into FSM


[15-May-19 09:21 AM] Deleted User#0000
I can make PR to your repo then.. if you like


[15-May-19 09:22 AM] Deleted User#0000
prices-rpc branch of your repo does not lave the latest payments changes


[15-May-19 09:23 AM] Deleted User#0000
I think its ok. It just means any funding in the plan cant be spent after we update


[15-May-19 09:25 AM] Deleted User#0000
https://github.com/dimxy/komodo/pull/6

{Embed}
https://github.com/dimxy/komodo/pull/6
payments CC changes by blackjok3rtt ¬∑ Pull Request #6 ¬∑ dimxy/komodo
https://images-ext-2.discordapp.net/external/FG7_8N0jtCftKtsAk7K5U05eeO1dpQWPnEQ9A5NQLBI/%3Fs%3D400%26v%3D4/https/avatars0.githubusercontent.com/u/21120539


[15-May-19 09:25 AM] dimxy#2587
ok lets try it


[15-May-19 09:26 AM] Deleted User#0000
as long as we all update the daemon once you merge that it will be ok.


[15-May-19 09:26 AM] Deleted User#0000
not easy to remake chain so hopefully it works ok. So far only payments fund happened so nothing has touched validation yet.


[15-May-19 09:48 AM] dimxy#2587
merged


[15-May-19 09:49 AM] Deleted User#0000
cool Im updating my node


[15-May-19 09:49 AM] Deleted User#0000
will check the payments  still works in a min


[15-May-19 10:14 AM] Deleted User#0000
It seems no merge or release happened. merge is broken, pushed fix to jl777 branch, you guys dont need that though so it does nt matter. Did paymetns release and it worked üòÉ


[15-May-19 10:35 AM] dimxy#2587
no merge in my repo?


[15-May-19 10:38 AM] dimxy#2587
i squashed commits btw


[15-May-19 11:05 AM] TonyL#3577
So is it better to test on prices-rpc or jl777 now? üòÉ


[15-May-19 11:32 AM] dimxy#2587
I'll pull once more the FSM (I saw last jl777 merge into it) and think we may use my repo

{Reactions}
üëç 

[15-May-19 11:53 AM] dimxy#2587
updated


[15-May-19 12:02 PM] TonyL#3577
https://github.com/dimxy/komodo/blob/prices-rpc/src/komodo_defs.h#L45 is it expected state? üòÉ

{Embed}
https://github.com/dimxy/komodo/blob/prices-rpc/src/komodo_defs.h
dimxy/komodo
Komodo. Contribute to dimxy/komodo development by creating an account on GitHub.
https://images-ext-2.discordapp.net/external/FG7_8N0jtCftKtsAk7K5U05eeO1dpQWPnEQ9A5NQLBI/%3Fs%3D400%26v%3D4/https/avatars0.githubusercontent.com/u/21120539


[15-May-19 12:15 PM] dimxy#2587
well, no,
as I change it for my test chain, I forget to set it to original, sorry.
as 2 days  have passed it wont be problem any more - be set to original permanent
updated

{Reactions}
üëç 

[15-May-19 12:22 PM] TonyL#3577
Oh yes, I have other on my test chain as well. Just might be a problem when we will forget about this change


[15-May-19 12:24 PM] TonyL#3577
```./komodo-cli -ac_name=PRICEST1 paymentsinfo "['0deaa8d69fbea7cbaf85fbd1ace7e26c173b52e761cdf6edc3eecf04e1879e7f']"
{
  "plan_type": "snapshot",
  "lockedblocks": 10,
  "minrelease": 10,
  "minimum": 10000,
  "bottom": 0,
  "top": 3999,
  "fixedFlag": 0,
  "excludeAddresses": [
  ],
  "RTkpZPTDPBUhY1miULTjVf8dcsHxz8G1KQ": 156.00000000,
  "utxos": 4,
  "REpyKi7avsVduqZ3eimncK4uKqSArLTGGK": 0.00000000,
  "utxos": 0,
  "totalfunds": 156.00000000,
  "elegiblefunds": 156.00000000,
  "min_release_height": 500,
  "result": "success"
}
``` have more funds in payments plan now üòÉ


[15-May-19 12:26 PM] TonyL#3577
After 1000 bet placed, 5 expected added:
```./komodo-cli -ac_name=PRICEST1 paymentsinfo "['0deaa8d69fbea7cbaf85fbd1ace7e26c173b52e761cdf6edc3eecf04e1879e7f']"
not elegible to be spent yet height.501 vs elegible_ht.511 blocksleft.10
{
  "plan_type": "snapshot",
  "lockedblocks": 10,
  "minrelease": 10,
  "minimum": 10000,
  "bottom": 0,
  "top": 3999,
  "fixedFlag": 0,
  "excludeAddresses": [
  ],
  "RTkpZPTDPBUhY1miULTjVf8dcsHxz8G1KQ": 161.00000000,
  "utxos": 5,
  "REpyKi7avsVduqZ3eimncK4uKqSArLTGGK": 0.00000000,
  "utxos": 0,
  "totalfunds": 161.00000000,
  "elegiblefunds": 156.00000000,
  "min_release_height": 501,
  "result": "success"
}
```


[15-May-19 12:26 PM] TonyL#3577
So looks like fees accumulating on paymentsplan working fine now, next have to check distribution


[15-May-19 12:38 PM] TonyL#3577
@Deleted User a little bit confused with `paymentsrelease` call

Have 156 egible funds in payments plan:
``` ./komodo-cli -ac_name=PRICEST1 paymentsinfo '["0deaa8d69fbea7cbaf85fbd1ace7e26c173b52e761cdf6edc3eecf04e1879e7f"]'
{
  "plan_type": "snapshot",
  "lockedblocks": 10,
  "minrelease": 10,
  "minimum": 10000,
  "bottom": 0,
  "top": 3999,
  "fixedFlag": 0,
  "excludeAddresses": [
  ],
  "RTkpZPTDPBUhY1miULTjVf8dcsHxz8G1KQ": 161.00000000,
  "utxos": 5,
  "REpyKi7avsVduqZ3eimncK4uKqSArLTGGK": 0.00000000,
  "utxos": 0,
  "totalfunds": 161.00000000,
  "elegiblefunds": 156.00000000,
  "min_release_height": 510,
  "result": "success"
}
```

Trying to release 100:
```./komodo-cli -ac_name=PRICEST1 paymentsrelease "[%220deaa8d69fbea7cbaf85fbd1ace7e26c173b52e761cdf6edc3eecf04e1879e7f%22,100]"
{
  "result": "error",
  "error": "value too small, try releasing a larger amount, or use skipminimum flag"
}
```


[15-May-19 12:39 PM] TonyL#3577
But it looks like "amount to small" limitation determining by "minrelease" :
```./komodo-cli -ac_name=PRICEST1 paymentsrelease "
[%220deaa8d69fbea7cbaf85fbd1ace7e26c173b52e761cdf6edc3eecf04e1879e7f%22,1]"
{
  "result": "error",
  "error": "amount too smal",
  "amount": 1.00000000,
  "minrelease": 10.00000000
}
```


[15-May-19 12:40 PM] TonyL#3577
I thought that `"minimum": 10000` is some dust filter with default 10k satoshi - is it minimum funds amount on plan to execute release? (I'm on latest dimxy/prices-rpc and same chain as b4)


[15-May-19 12:51 PM] TonyL#3577
https://github.com/dimxy/komodo/blob/prices-rpc/src/cc/payments.cpp#L876 it this check, I wonder it casued by vouts order üòÉ

{Embed}
https://github.com/dimxy/komodo/blob/prices-rpc/src/cc/payments.cpp
dimxy/komodo
Komodo. Contribute to dimxy/komodo development by creating an account on GitHub.
https://images-ext-2.discordapp.net/external/FG7_8N0jtCftKtsAk7K5U05eeO1dpQWPnEQ9A5NQLBI/%3Fs%3D400%26v%3D4/https/avatars0.githubusercontent.com/u/21120539


[15-May-19 12:54 PM] dimxy#2587
So that check in pricebet for min fee is still needed? (I removed it as I understand blackjok he could work with any fee)


[15-May-19 12:55 PM] TonyL#3577
Not sure if it needed but looks like this place in code not working now üòÉ


[15-May-19 11:32 PM] Deleted User#0000
@TonyL  
https://docs.google.com/document/d/1WCQb3ZAPTHS_mYxm70P3F-D9Y7QGT6JcXxhyWZuPS80/edit?usp=sharing

{Embed}
https://docs.google.com/document/d/1WCQb3ZAPTHS_mYxm70P3F-D9Y7QGT6JcXxhyWZuPS80/edit?usp=sharing
Payments CC RPCs
Payments CC RPCs  paymentstxidopret  ‚Äò[allocation,‚ÄùscriptPubKey‚Äù,(‚Äùdestopret‚Äù)]‚Äô Allocation is a number that defines how much to pay, using 50 and 50 for example would pay half the released amount to each address.  NOTE: this takes scriptpubleys NOT address‚Äôs.  ...
https://images-ext-2.discordapp.net/external/PxTRVi5MGPR3ehBWwmmhIOTBpkL-_agd1V-uXUEEwb0/https/lh6.googleusercontent.com/TAzg2MVrryDRYNHOWzTqSG0WzZ_8naluueoIPisSEd-40q1xbeNqylMyEQa9z7Ly9f1DxQ%3Dw1200-h630-p


[16-May-19 12:41 AM] Deleted User#0000
I guess I should just make skip minimum the default to avoid future confusion... but I dont really like it as if not enough is released it basically means only the largest whales get anything.


[16-May-19 12:50 AM] TonyL#3577
@Deleted User So should it be: ```paymentsrelease ‚Äò[‚Äúcreatetxid‚Äù,amount,true]‚Äô ``` ?


[16-May-19 12:52 AM] TonyL#3577
```Skipminimum is a flag, if there are address with such low balance minimumtoaddress cannot be paid, this will truncate the rich list off at the first address that is being paid the wrong amount. 
``` from description it looks like it's better to use this flag all the time


[16-May-19 12:53 AM] TonyL#3577
```./komodo-cli -ac_name=PRICEST1 paymentsrelease "[%220deaa8d69fbea7cbaf85fbd1ace7e26c173b52e761cdf6edc3eecf04e1879e7f%22,100,true]"
{
  "result": "error",
  "error": "value too small, try releasing a larger amount, or use skipminimum flag"
}
```


[16-May-19 01:09 AM] TonyL#3577
Or should `paymentsairdrop` call distribute tokens?


[16-May-19 01:12 AM] Deleted User#0000
Thwe problem is with it... if the minrelease has been set too small... Then it will simply always fail, as the amount paid si just dust. If you force skipminimum all the time, then it will alwyas work, but mostly it will only pay a copuple of the top address. I tested ths skipminimum thing and it works quite well, wasnt able to find a way to cheat it. I guess we can enforce it all the time, but that then forces the plan creator to make sane values.


[16-May-19 01:13 AM] Deleted User#0000
`./komodo-cli -ac_name=PRICEST1 paymentsrelease "[%220deaa8d69fbea7cbaf85fbd1ace7e26c173b52e761cdf6edc3eecf04e1879e7f%22,100,1]"`


[16-May-19 01:14 AM] Deleted User#0000
that will work.


[16-May-19 01:17 AM] TonyL#3577
```./komodo-cli -ac_name=PRICEST1 paymentsrelease "[%220deaa8d69fbea7cbaf85fbd1ace7e26c173b52e761cdf6edc3eecf04e1879e7f%22,100,1]"
{
  "amount": 100.00000000,
  "newamount": 99.99996060,
  "hex": "0400008085202f89023d61622b22874ba07db0ce337e480c4dafdcc5713691658cc422949760f2f76104000000a74ca5a281a1a0819ca28194a067a56580210358f1764f82c63abc7c7455555fd1d3184905e30e819e97667e247e5792b468568140ae70da77dbf483781eedcc2c4040ba0fdbeee8d2ed5ea4f27ba74083be72366640c51626ad0638bb2da43563db809d38f96c8c8ed0c290c45d85a815816fb623a129a52780202be7dc4ff083edb6b3a86574105c765a7065684f9e5aa1b1b555726b6c918a3e8103020000af038001f0a10001ffffffff6aaabcfb15c596aebcdd7cfd4b60b36bb5dd8688eb349b807b9729535d02267200000000a74ca5a281a1a0819ca28194a067a56580210358f1764f82c63abc7c7455555fd1d3184905e30e819e97667e247e5792b46856814069773bdfc9664c3d13c8ccbef118e60ac3f1a0dd52f9904d0fd6cb4f55b0720f099f0129b201ef4d01111564f9db7ecb93e4e4ae13eaf4c18219c85c2d03d5a3a129a52780202be7dc4ff083edb6b3a86574105c765a7065684f9e5aa1b1b555726b6c918a3e8103020000af038001f0a10001ffffffff0254da052a01000000642ea22c8020dea998f43423439942836e05d57ec8f553f419887861cd2f28044bc881eb297781031210008203000401cc320401f001022c6a2af0527f9e87e104cfeec3edf6cd61e7523b176ce2e7acd1fb85afcba7be9fd6a8ea0d00e40b5402000000759cd40b54020000001976a914c2d8a5f4593d5e19a3b75056a85ed5cc6fbe6f6888ac00000000da0500000000000000000000000000",
  "txid": "d3e0915ed1b09e02f70561315831327a6450f9ed9ffb55188135a5d2b1b8f699",
  "result": "success"
}
``` aha


[16-May-19 01:21 AM] TonyL#3577
So if assume that in general paymentsCC distribute funds correctly - pricesCC fees distribution works


[16-May-19 01:24 AM] Deleted User#0000
Yes. I already released some funds yesterday and that worked fine.


[16-May-19 01:26 AM] Deleted User#0000
Payments cc has been passed to gcharang and hopefully alright to test when he gets home. I'm 99% sure its good. I have confirmed snapshot height is correct and we ran chain with 20 nodes for 5 days, all seemed to agree on snapshot perfectly.


[16-May-19 01:28 AM] TonyL#3577
Great! Have to re-test `-ac_stocks` and can start 24 hours delay `BETS0` chain today I wonder


[16-May-19 02:24 AM] TonyL#3577
Is it possible to change `-ac_prices` and `-ac_stocks` parameters of chain "on fly" after chain creation or new chain needs to be created each time when you want to change these params?
Not totally understand how nodes come to consensus of which pairs are allowed to trade on this chain


[16-May-19 02:29 AM] jl777c#5810
they are ac parameters, to change it is to change the chain


[16-May-19 02:29 AM] jl777c#5810
choose wisely


[16-May-19 02:30 AM] jl777c#5810
there has to be a minimum payout, otherwise the largest address can attack by doing payments release at max frequency


[16-May-19 02:33 AM] TonyL#3577
There is a `"minrelease": 10.00000000` param of payment plan


[16-May-19 02:33 AM] TonyL#3577
Just hard to predict some fine values now because value/common denomination of BETS0 coin is unknown atm


[16-May-19 02:41 AM] TonyL#3577
I wonder on BETS0 we can test things and make estimates/notes for BETS1 
Since it will be chain with almost 0 emission all depends of BETS "mother" coin üòÉ


[16-May-19 02:47 AM] jl777c#5810
yes


[16-May-19 04:18 AM] TonyL#3577
`-ac_stocks` without space working fine


[16-May-19 04:22 AM] jl777c#5810
likely -ac_prices would too, so might be less confusing to never have space


[16-May-19 04:42 AM] TonyL#3577
```-ac_prices="ETH,LTC,BNB,NEO,BCC,LRC,QTUM,OMG,ZRX,STRAT,IOTA,XVG,KMD,EOS,ZEC,DASH,TRX,XRP,STORJ,XMR,BAT,BTS,LSK,ADA,WAVES,STEEM,RVN,DCR,BCHABC"
-ac_stocks="AAPL,ADBE,ADSK,AKAM,AMD,AMZN,ATVI,BB,CDW,CRM,CSCO,CYBR,DBX,EA,FB,GDDY,GOOG,GRMN,GSAT,HPQ,IBM,INFY,INTC,INTU,JNPR,MSFT,MSI,MU,MXL,NATI,NCR,NFLX,NTAP,NVDA,ORCL,PANW,PYPL,QCOM,RHT,S,SHOP,SNAP,SPOT,SYMC,SYNA,T,TRIP,TWTR,TXN,VMW,VOD,VRSN,VZ,WDC,XRX,YELP,YNDX,ZEN,XAU,XAG,XPT,XPD,DJIA,SPX,NDX,VIX"```


[16-May-19 04:42 AM] TonyL#3577
Have to take more cryptopairs maybe, for stocks I just took these arrays: https://github.com/dimxy/komodo/blob/prices-rpc/src/komodo_gateway.h#L1996

{Embed}
https://github.com/dimxy/komodo/blob/prices-rpc/src/komodo_gateway.h
dimxy/komodo
Komodo. Contribute to dimxy/komodo development by creating an account on GitHub.
https://images-ext-2.discordapp.net/external/FG7_8N0jtCftKtsAk7K5U05eeO1dpQWPnEQ9A5NQLBI/%3Fs%3D400%26v%3D4/https/avatars0.githubusercontent.com/u/21120539


[16-May-19 04:44 AM] TonyL#3577
https://paste.ubuntu.com/p/Gsrmtb93Zj/ all somethingBTC pairs which binance API have


[16-May-19 04:45 AM] jl777c#5810
be careful with adding the more obscure ones as if they get delisted, then the chain will stall


[16-May-19 04:47 AM] TonyL#3577
Oh dunno what is in CZ mind üò¶  
Will remove BCC, BCHABC and TRX from list above so as these assets in my personal risk zone


[16-May-19 04:49 AM] TonyL#3577
Btw we can make ` Berkshire Hathaway \ cryptos` markets to troll Buffet üòÉ


[16-May-19 04:50 AM] TonyL#3577
By "trolling" I mean respect paying. Added `BRK.A` üòÉ


[16-May-19 04:52 AM] jl777c#5810
funny idea


[16-May-19 05:04 AM] TonyL#3577
So proposed chain params are:
```./komodod -ac_name=BETS0 -ac_cbopret=7 -ac_cc=10777 -ac_reward=10000 -ac_supply=7777  -ac_blocktime=300 -ac_snapshot=288 -ac_sapling=1 -ac_earlytxidcontract=237
```
Crypto tickers:
`-ac_prices="ETH,LTC,BNB,NEO,LRC,QTUM,OMG,ZRX,STRAT,IOTA,XVG,KMD,EOS,ZEC,DASH,XRP,STORJ,XMR,BAT,BTS,LSK,ADA,WAVES,STEEM,RVN,DCR,XEM,ICX, HOT,ENJ"`
Stock tickers:
`-ac_stocks="AAPL,ADBE,ADSK,AKAM,AMD,AMZN,ATVI,BB,CDW,CRM,CSCO,CYBR,DBX,EA,FB,GDDY,GOOG,GRMN,GSAT,HPQ,IBM,INFY,INTC,INTU,JNPR,MSFT,MSI,MU,MXL,NATI,NCR,NFLX,NTAP,NVDA,ORCL,PANW,PYPL,QCOM,RHT,S,SHOP,SNAP,SPOT,SYMC,SYNA,T,TRIP,TWTR,TXN,VMW,VOD,VRSN,VZ,WDC,XRX,YELP,YNDX,ZEN,XAU,XAG,XPT,XPD,DJIA,SPX,NDX,VIX,BRK.A"`

and -earlytxid of airdrop plan with such params:
 `paymentsairdrop '[576,100,0,3999,0,0]'`

What should mean funds unlock every 576 blocks (~each two 48 hours) with snapshot every 288 blocks (~once in 24 hours) with 100 coins in fees minrelease for up to 3999 top BETS0 holders wallets


[16-May-19 05:06 AM] Deleted User#0000
I think `ac_snapshot` sshould be 288 blocks. U300s block time makes 288 blocks per day?  Doing it too often is not a good idea...


[16-May-19 05:07 AM] TonyL#3577
Yep, should be 288 blocks per day


[16-May-19 05:08 AM] TonyL#3577
Aha, so maturing should be 288 as well I wonder


[16-May-19 05:08 AM] TonyL#3577
If maturing is faster than snapshot it looks not fair


[16-May-19 05:11 AM] Deleted User#0000
snapshot just determines who ranks on rich list... It shouldnt really change much each day...


[16-May-19 05:11 AM] Deleted User#0000
guess with a chain with basically 0 balacne on it though.... ü§î


[16-May-19 05:12 AM] Deleted User#0000
you can just make lockedblocks 2x288 
So it takes 2 days, before any fees can be paid out.

{Reactions}
üëç 

[16-May-19 05:17 AM] TonyL#3577
Removed ac_perc - was not correct and more than block reward.  I will just fund house from `-ac_supply=7777` since we have RPC call for it anow and left myself few coins to test


[16-May-19 05:19 AM] Deleted User#0000
looks good man üòÉ

{Reactions}
üëç 

[16-May-19 05:20 AM] TonyL#3577
@jl777c Is `BETS` chain in `-ac_cc=10777` cluster?


[16-May-19 06:35 AM] jl777c#5810
cluster is ok, doesnt matter until notarized


[16-May-19 06:56 AM] TonyL#3577
Great, so will start such chain now. ~2 days should take data accumulation for smoothed prices, then on Sunday I'll test and then prepare interface multiOS bundles if betting works fine

{Reactions}
shexy 

[16-May-19 07:04 AM] dimxy#2587
I have read some more about how betting works. Probably we may improve something in prices.
First, how to find opposite positions which cancel out each other. Now I use very simple algorithm just searching explicit opposites like BTC_USD vs BTC_USD,!
I understand real betting brokers calculate correlation between prices for some period which allows to compare different prices.
(BTW we earlier discussed that XYZ_BTC cancels out BTC_ABC but now I see we could take into account the correlation between those prices)
So we might calculate a correlation matrix between prices for some period and use to better define cancelling positions (like EUR_USD vs USD_GBP). 
I think this would even allow to oppose complex synthetics (what we now do not yet)
 
Second, about risk management. Seems betting companies have several strategies. For instance, there are two kinds of orderbooks, A and B. 
As I understood orders in B book are just opposite positions betting against each other, that involves now risk for the house.
But if there are many positions betting in the same direction the house can go on real markets with these funds taking off risks from itself (with A book orders).
Seems we cannot use such strategy in prices cc? That is all we can do is just stop accepting bets if risks of losses for the house are too high, as in this case the house actually bets against the bettors.


[16-May-19 07:23 AM] jl777c#5810
maybe there can be a special bet that allows anybody to fund the opposite positions


[16-May-19 07:53 AM] dimxy#2587
If such bets exist could it be an impression for a bettor that the house actually persuades him to make some kinds of bets? (seems betting companies do not disclose made bets publicly)


[16-May-19 07:54 AM] jl777c#5810
just an idea that allows active balancing


[16-May-19 07:55 AM] jl777c#5810
not for, or against it


[16-May-19 08:03 AM] dimxy#2587
I have now a rpc that allows a bettor to list all positions grouped by their symbols and up/down sign and where he could find an opposite position and available amount


[16-May-19 08:47 AM] TonyL#3577
Add corellation matrix approach in spot of risk management is definetly very interesting direction for house involvement


[16-May-19 08:48 AM] TonyL#3577
But to build reliable corellation matrix which really means something you need really good sampling depth


[16-May-19 08:48 AM] TonyL#3577
Few years lets say


[16-May-19 08:49 AM] TonyL#3577
And here there will be little difficulties because different coins were overlaid at different times


[16-May-19 08:51 AM] TonyL#3577
In general I think I can make some pilot API (or can do it as script) on top of Binance API (and also can combine it with stocks if needed) which will return corellation matrix for needed pairs. So pricesCC will able to just call this API and use data


[16-May-19 08:53 AM] TonyL#3577
Things with significant positive corellation we will be able to consider as same thing (in spot of risks) and it should simplify life


[16-May-19 08:57 AM] TonyL#3577
Hmm for large synthetics we can make some algo based on corellation as well:
Lets say player opened position for synthetic with 3 elements - we can find  most negative corellation (between these prices datasets) "opposite" 3 elements combination and add it as  "recommended" opossite position with discount fee


[16-May-19 09:02 AM] jl777c#5810
if it has 3 elements, likely parts of if cancel out


[16-May-19 09:02 AM] jl777c#5810
what is important is the NET exposure


[16-May-19 09:02 AM] jl777c#5810
total amount long BTC, short BTC


[16-May-19 09:02 AM] jl777c#5810
long USD, short USD, ...


[16-May-19 09:02 AM] jl777c#5810
the net amount is the risk exposure to each coin


[16-May-19 09:03 AM] jl777c#5810
so any bet that reduces the overall exposure is reducing risk and should be incentivized


[16-May-19 09:03 AM] jl777c#5810
any bet that increases the overall exposure is increasing risk and should be de-incentivized


[16-May-19 09:04 AM] TonyL#3577
In cmc top100 99% of things have strong positive corelllation


[16-May-19 09:04 AM] TonyL#3577
So to simplify we can actually just abstract to crypto longs/shorts balance


[16-May-19 09:04 AM] jl777c#5810
that can be a secondary aspect, but it shouldnt be primary


[16-May-19 09:04 AM] jl777c#5810
statistical correlation usually works


[16-May-19 09:04 AM] jl777c#5810
usually


[16-May-19 09:05 AM] jl777c#5810
but if it isnt a delta neutral portfolio, there is exposure, regardless of historical correlation


[16-May-19 09:05 AM] jl777c#5810
unless you think that no single crypto will outperform the others


[16-May-19 09:05 AM] jl777c#5810
or underperform


[16-May-19 09:06 AM] TonyL#3577
Anyway from past numbers you can take only "usually" cases because you can't know feature
For BTC_USD USD_BTC it's clear how to make 0 risk portfolio, yes


[16-May-19 09:07 AM] TonyL#3577
But if I open position: BTC_USD + some stable pair (USD/CHF let's say) - it's a different case already


[16-May-19 09:07 AM] TonyL#3577
Ah, maybe from huge synthetic just specify most volatile one


[16-May-19 09:12 AM] TonyL#3577
Beside of pairs corellation in spot of risks we should concider volatility: so if BTC_USD have lets say 3%/day avg volatility - Apple stocks move 0.3%/day everage and risks for house different (numbers just from head)


[16-May-19 09:14 AM] TonyL#3577
On Bitmex I can take x100 leverage for BTC but for some EOS or ADA only x20 - it's because of different volatility and trade volumes. Maybe we have to make similar leverage caps for different markets


[16-May-19 09:16 AM] dimxy#2587
I think for different markets should be different correlation matrixes, sure


[16-May-19 09:21 AM] TonyL#3577
I mean not corellation but volatility. Corellation matrixes we can build for everything actually, actually yes statistical corellation its how things did in past and "usually" (means maybe) it will behave same way in future. It might be some third circle of defence: 

Simpliest "first circle of defense" - less leverage on more volatile things
Second circle is to try balance things like BTC_USD USD_BTC (in long synthetics can balance most volatile components) - by dynamic maximal allowed leverage (similar to bookmakers float coefficients)
Third circle might be some statistical methods like corellation matrixes or common components analysis lets say - if Microsoft stocks corelates with BTCSV_BTC - we can try to balance these things and etc


[16-May-19 09:21 AM] TonyL#3577
Moreover I think there is one possibility which we not considered yet - fund can place bets as well


[16-May-19 09:25 AM] dimxy#2587
As I understood it when a bettor places a bet and the fund does not enter real market with this amount, it actually means this bettor is against the fund: if he wins the fund loses and pays its money.
And of course no an opposite bet


[16-May-19 09:26 AM] TonyL#3577
Oh I just had some crazy idea with risks balancing by automated crypto purchasing. Hedging and etc


[16-May-19 09:26 AM] TonyL#3577
üòÉ


[16-May-19 09:27 AM] dimxy#2587
yes this is better risk managemnt


[16-May-19 09:28 AM] TonyL#3577
Many missclicks, sorry üòÉ


[16-May-19 09:29 AM] TonyL#3577
Maybe players will not rekt fund on BETS0 ü§û


[16-May-19 09:33 AM] jl777c#5810
the blockchain cant be doing external purchases


[16-May-19 09:33 AM] jl777c#5810
this is why i suggested having a way to take on the opposite positions


[16-May-19 09:33 AM] jl777c#5810
then specific nodes can actively try to balance things


[16-May-19 09:33 AM] TonyL#3577
Oh these external purchases was the worst idea from the list above üòÉ


[16-May-19 09:34 AM] jl777c#5810
no argument


[16-May-19 09:35 AM] jl777c#5810
we cant have anything overcomplicated


[16-May-19 09:36 AM] jl777c#5810
maybe forex and stock bets can be 777x


[16-May-19 09:36 AM] jl777c#5810
btcusd 100x


[16-May-19 09:36 AM] jl777c#5810
the rest 10x


[16-May-19 09:36 AM] jl777c#5810
complex synthetic uses the lowest


[16-May-19 09:36 AM] TonyL#3577
Yes, trading AI which have own blockchain and can traid on CEXes it's somewhere close to singularity - what if she will rekt anybody ü§î


[16-May-19 09:37 AM] TonyL#3577
Looks fine such leverage deviding imo


[16-May-19 09:38 AM] TonyL#3577
`complex synthetic uses the lowest` - and this is good rule and players will not able to hide some volatile core in non volatile tale


[16-May-19 10:10 AM] TonyL#3577
https://blog.bitmex.com/bitmex-leverage-statistics-april-2019/

{Embed}
https://blog.bitmex.com/bitmex-leverage-statistics-april-2019/
BitMEX Leverage Statistics, April 2019


[16-May-19 10:13 AM] jl777c#5810
nothing wrong with using similar risk management to bitmex


[16-May-19 10:15 AM] TonyL#3577
Yup, this report showing that huge leverage using not so often


[16-May-19 10:28 AM] TonyL#3577
Can spin chain with such params:
```./komodod -ac_name=BETS0 -ac_cbopret=7 -ac_cc=10777 -ac_reward=10000 -ac_supply=7777 -ac_blocktime=300 -ac_snapshot=288 -ac_sapling=1 -ac_earlytxidcontract=237 -ac_prices="ETH, LTC, BNB, NEO, LRC, QTUM, OMG, ZRX, STRAT, IOTA, XVG, KMD, EOS, ZEC, DASH, XRP, STORJ, XMR, BAT, BTS, LSK, ADA, WAVES, STEEM, RVN, DCR, XEM, ICX, HOT, ENJ" -ac_stocks="AAPL,ADBE,ADSK,AKAM,AMD,AMZN,ATVI,BB,CDW,CRM,CSCO,CYBR,DBX,EA,FB,GDDY,GOOG,GRMN,GSAT,HPQ,IBM,INFY,INTC,INTU,JNPR,MSFT,MSI,MU,MXL,NATI,NCR,NFLX,NTAP,NVDA,ORCL,PANW,PYPL,QCOM,RHT,S,SHOP,SNAP,SPOT,SYMC,SYNA,T,TRIP,TWTR,TXN,VMW,VOD,VRSN,VZ,WDC,XRX,YELP,YNDX,ZEN,XAU,XAG,XPT,XPD,DJIA,SPX,NDX,VIX,BRK.A" -daemon```

Symthoms are similar to situation when I had ac_stocks with spaces (daemon not respond on rpc calls after I start mining)


[16-May-19 10:29 AM] TonyL#3577
https://paste.ubuntu.com/p/ZX947cBJgk/ prints I have


[16-May-19 10:30 AM] TonyL#3577
Looks like it hangs because of too many elements


[16-May-19 10:31 AM] TonyL#3577
Aha, no. Just collected prices until `ZEN` (maybe other tickers not working with current API, testing)
bad news for lovers of precious metals... üòÉ but it works without `XAU,XAG,XPT,XPD,DJIA,SPX,NDX,VIX`


[16-May-19 10:37 AM] jl777c#5810
you can try to manually issue those. maybe the syntax is a bit different


[16-May-19 10:48 AM] dimxy#2587
different string split parsers working seems


[16-May-19 10:50 AM] TonyL#3577
https://api.iextrading.com/1.0/tops/last just no such tickers (XAU,XAG,XPT,XPD,DJIA,SPX,NDX,VIX) in this api


[16-May-19 10:51 AM] TonyL#3577
Checked their website - it looks like they have only stocks and some indexes, no commodities


[16-May-19 10:53 AM] TonyL#3577
Anyway it looks like a not big deal on this point and we can add prices in fututre depends of users demand


[16-May-19 10:55 AM] TonyL#3577
Is there any safe way to clean non-sent mempool?


[16-May-19 10:56 AM] TonyL#3577
I generated transaction to mempool when no nodes mine, then realized that better to use other param but now "non-correct" transaction is in mempool


[16-May-19 10:57 AM] jl777c#5810
if it is in the mempool, and it is valid, it is hard to get rid of


[16-May-19 10:57 AM] TonyL#3577
I see, wonder it's recorded to wallet.dat


[16-May-19 10:58 AM] jl777c#5810
yes


[16-May-19 11:12 AM] TonyL#3577
`BETS0` baby born. Maturing now üòÉ


[16-May-19 11:14 AM] TonyL#3577
Have 7777 coins total premine
7000 in fund, 7.777 in fund fees (with minrelease 10), rest I left for testers


[16-May-19 11:16 AM] TonyL#3577
```     "name": "BRK.A_USD",
      "prices": [
        [
          309850.00000000
        ]
``` :3040_kingpeepo:


[16-May-19 12:11 PM] allbits#5898
Wen testing?


[16-May-19 12:30 PM] TonyL#3577
Probably next week


[16-May-19 12:35 PM] dimxy#2587
BTW, about that TonyL idea of hedging by trading with some funds on cryptomarkets: 
although blockchain cant make purchases, I assume there is an owner of betting fund and he might decide to hedge risks by sending some funding to cryptomarkets...


[16-May-19 12:37 PM] TonyL#3577
Since anybody can quite easily start own fund (to be a kinda broker) there might be a lot of interesting approaches/strategies


[16-May-19 12:38 PM] TonyL#3577
Theoretically some actual broker business can try to merge some services to such CC imo (just with some modifications - let's say only x1 leverage positions and only 1 item specific synthetic)


[16-May-19 12:40 PM] TonyL#3577
Hope fintech sector will notice this tech, in combination with other CCs it looks like gamechanger üòÉ


[16-May-19 12:40 PM] TonyL#3577
Or maybe no need existing fintech sector but new one needs to be built ü§î

{Reactions}
üëç 

[16-May-19 12:41 PM] jl777c#5810
i think if people see that the balancing bets are incentivized, then they are more likely to do them, especially the contrarians who would want to make the bet against what everybody knows will happen


[16-May-19 12:42 PM] jl777c#5810
the question becomes what level of incentive can be allowed


[16-May-19 12:44 PM] TonyL#3577
Maybe somewhere around usual maker/taker fee on CEXes
If we taking 0.5% for unbalanced positions we may take let's say 0.2% for "balancing" end


[16-May-19 12:44 PM] TonyL#3577
Or 0.5 0.3


[16-May-19 12:44 PM] jl777c#5810
maybe we make it 1% for unbalance and 0% for balancing


[16-May-19 12:47 PM] TonyL#3577
Aha, looks like Bitmex added longs paying to shorts / shorts paying to longs thing to solve similar balance problem


[16-May-19 12:47 PM] TonyL#3577
When more shorts than longs opened - there shorts paying to longs each 8 hours and vice versa


[16-May-19 12:48 PM] dimxy#2587
As I can see in the real world situations could be often when many positions are still unbalanced, so the house is at risk to lose


[16-May-19 12:49 PM] jl777c#5810
yes, perfect balance is never achieved


[16-May-19 12:49 PM] jl777c#5810
the trick is to manage it within the range where the capital available will absorb the worst case


[16-May-19 12:52 PM] TonyL#3577
I wonder we can evolve risk management mechanisms with each BETSX chain - let's say if chain 1 rekt - we can add more "defense" for next chain and start it with more funding and so on


[16-May-19 12:54 PM] TonyL#3577
Not possible to predict now what will happen because there is no such markets for now (at least I don't know any) where you can construct some synthetic with stocks and cryptos and bet on it with leverage


[16-May-19 12:54 PM] jl777c#5810
exactly


[16-May-19 12:55 PM] jl777c#5810
this is an iterative process


[16-May-19 12:55 PM] jl777c#5810
at some point the BETi chain will represent real money and we get to see the real testing


[16-May-19 12:55 PM] jl777c#5810
at first it will be easy to break though


[16-May-19 12:57 PM] TonyL#3577
Will BETS0 be pegged to BETS value?


[16-May-19 12:57 PM] TonyL#3577
Or maybe we can just set some bounty in KMD for best traders to try to drain it asap


[16-May-19 12:57 PM] jl777c#5810
if it is ready for sidechain testing, we can


[16-May-19 12:57 PM] TonyL#3577
And with each BETSi chain we can make traders tournament


[16-May-19 12:58 PM] jl777c#5810
yes, that is simpler


[16-May-19 12:58 PM] TonyL#3577
Until it's solid


[16-May-19 12:58 PM] jl777c#5810
maybe sidechain testing is done separately


[16-May-19 12:58 PM] jl777c#5810
until the betting and sidechain are working in isolation


[16-May-19 12:58 PM] jl777c#5810
then we combine it


[16-May-19 12:58 PM] jl777c#5810
and it will automatically be a for money tournament all the time


[16-May-19 01:00 PM] TonyL#3577
Ok, so for now for BETSi chains will make bounty mechanics similar to KMDICE funds locked in betting plan


[16-May-19 01:01 PM] TonyL#3577
And I think I can put BETSi KMD gateway for winning withdrawal to battletest gateways as well


[16-May-19 01:01 PM] TonyL#3577
Ah, gateway import value not export üòÉ


[16-May-19 01:01 PM] TonyL#3577
So need vice versa - deposit some KMD to get some BETSi


[16-May-19 01:03 PM] jl777c#5810
how will you do that? you would need -ac_pegs working


[16-May-19 01:03 PM] jl777c#5810
oh, wait


[16-May-19 01:03 PM] jl777c#5810
you can make a normal KMD gateways CC


[16-May-19 01:03 PM] jl777c#5810
and then put orders in the DEX


[16-May-19 01:03 PM] TonyL#3577
Yeah, thats what I'm thinking about


[16-May-19 01:03 PM] TonyL#3577
gatewaysCC


[16-May-19 01:04 PM] TonyL#3577
I have 700 free supply now and 7000 locked in plan


[16-May-19 01:04 PM] TonyL#3577
At first I can sell these 700 in gatewaysCC for KMD


[16-May-19 01:04 PM] TonyL#3577
Then players can bet to try drain these funds and withdraw back


[16-May-19 01:05 PM] jl777c#5810
or make an NFT, with expensive price


[16-May-19 01:05 PM] jl777c#5810
the winner is the first that can purchase the NFT


[16-May-19 01:05 PM] jl777c#5810
redeemable for all the deposited KMD


[16-May-19 01:05 PM] TonyL#3577
Oh nice idea


[16-May-19 01:06 PM] TonyL#3577
Only problem is that what if somebody will buy all available in gateway supply


[16-May-19 01:06 PM] TonyL#3577
Like a one person - it will kill all fun


[16-May-19 01:07 PM] jl777c#5810
i think there would be contest participants that are just given a fixed amount of BET0


[16-May-19 01:09 PM] TonyL#3577
Aha, at first collect applications with discord username and wallet address, then just send available supply in same proportions between participants


[16-May-19 01:10 PM] TonyL#3577
Winner have to make most profit from trading


[16-May-19 01:15 PM] TonyL#3577
I think I have to redesign chain so:  700 supply + 7000 in fund if give each participant 7 coins (100 participants cap) it might take a lot of time and a lot of luck is needed to drain it.
I think I'll make 7000 circulating supply and 7000 funds in house so players will have 1:100 proportion


[16-May-19 01:16 PM] TonyL#3577
Have to make some leaderboard also


[16-May-19 01:16 PM] TonyL#3577
Oh explorer richlist will be leaderboard actually üòÉ


[17-May-19 12:51 AM] jl777c#5810
https://www.ccn.com/bitcoin-price-crashes-6400-triggered-35-million-sell-order

{Embed}
https://www.ccn.com/bitcoin-price-crashes-6400-triggered-35-million-sell-order
Bitcoin Price Crashes to $6,400 Triggered by Massive $35 Million S...
By CCN: On May 17, within minutes, the bitcoin price plummeted from around $7,800 to $6,400 in a flash crash, recording an unexpected 18 percent drop.        The sudden decline in the bitcoin price led the valuation
https://images-ext-2.discordapp.net/external/W0B15PCTyA9EOIU18g4AxQGtqSqs6FWdO9GcCICdPV4/https/www.ccn.com/wp-content/uploads/2019/05/Bitcoin-trading-red-stock.jpg


[17-May-19 12:51 AM] jl777c#5810
a single trader games bitstamp price (buy dumping 2000+ BTC!) to change bitmex marked price to gain on his short positions!


[17-May-19 12:52 AM] jl777c#5810
interestingly prices CC design avoids such things as we use the 24hr price so it isnt the free money the "short bitmex and dump on the market" strategy is


[17-May-19 01:08 AM] Andersen#8337
Mean  median  24Hrs  index  ?


[17-May-19 01:09 AM] Andersen#8337
Like  Bitmex marking price , but longer period


[17-May-19 01:14 AM] jl777c#5810
the marking price is the 24 average of the correlated prices: http://159.69.45.70:8050/


[17-May-19 01:14 AM] jl777c#5810
the green line


[17-May-19 01:15 AM] jl777c#5810
correlated price is the brown line, which is a randomly selected price from the past day that correlates with majority of price samples starting from that random price (rotating buffer)


[17-May-19 01:18 AM] Andersen#8337
great


[17-May-19 01:27 AM] jl777c#5810
it is still possible to mess around with prices, but only if you sustain it for better part of the day


[17-May-19 04:42 AM] jorian#4555
so you dump the market to shit, but because you opened short positions you profit insanely


[17-May-19 04:42 AM] jorian#4555
smart move


[17-May-19 05:48 AM] jl777c#5810
if he opened a 100x short, on a 35 million dollar sell, drops price $1000, makes $200 million?


[17-May-19 05:48 AM] jl777c#5810
even if he didnt collect the $35 mil from selling, it would be ok


[17-May-19 08:18 AM] TonyL#3577
Trying to make  testnet for BETS0 with same chain params but with little delay to test rekt bot and GUI 

So for this chain using specific daemon with  `#define PRICES_DAYWINDOW (7)` in komodo_defs.h but in prices output daywindow is 289. 
```  "result": "success",
  "seed": 2525121736298361961,
  "height": 27,
  "maxsamples": 1,
  "width": 580,
  "daywindow": 289,
  "numpricefeeds": 127
```
Am I need to change daywindow defining somewhere else?


[17-May-19 08:22 AM] jl777c#5810
how is the 289 calculated in the rpc call that prints the "daywindow"


[17-May-19 08:22 AM] jl777c#5810
the answer is in the source code


[17-May-19 08:22 AM] jl777c#5810
seek and you shall find


[17-May-19 08:28 AM] TonyL#3577
https://github.com/dimxy/komodo/blob/prices-rpc/src/rpc/blockchain.cpp#L1316


[17-May-19 08:28 AM] TonyL#3577
As I understand it should print just `PRICES_DAYWINDOW`


[17-May-19 08:29 AM] TonyL#3577
So problem is that `PRICES_DAYWINDOW` not changed


[17-May-19 08:41 AM] TonyL#3577
Problem was obviously on human side haha üòÉ (messed with aliases and daemons folders)


[17-May-19 10:19 AM] TonyL#3577
@dimxy Attempted to rekt bet: https://paste.ubuntu.com/p/Y6Nz4QsXCj/ but on pricesrekt transaction broadcast got:
```error code: -26
error message:
16: mandatory-script-verify-flag-failed (Script evaluated without error but finished with a false/empty top stack element)
```
And ```
PricesValidate() ValidateBetTx=false incorrect vout number for bet tx
CC Eval EVAL_PRICES Invalid: incorrect vout number for bet tx spending tx eb3d4413c1a7b0955b3be91d12c4135a6f65a33809e845744fb2c0a4526de1d``` in stdout

{Reactions}
üëå 

[17-May-19 10:21 AM] TonyL#3577
Also looks suspicious that profits loss became more than positionsize with negative equity (I wonder if it's rekt it should became 0)
```  "positionsize": 1.00000000,
      "profits": -1.04048070,```


[17-May-19 10:24 AM] TonyL#3577
https://github.com/dimxy/komodo/blob/prices-rpc/src/cc/prices.cpp#L1337 I think there should be special case kinda `if is_rekt` it became 0 but not negative

{Embed}
https://github.com/dimxy/komodo/blob/prices-rpc/src/cc/prices.cpp
dimxy/komodo
Komodo. Contribute to dimxy/komodo development by creating an account on GitHub.
https://images-ext-2.discordapp.net/external/FG7_8N0jtCftKtsAk7K5U05eeO1dpQWPnEQ9A5NQLBI/%3Fs%3D400%26v%3D4/https/avatars0.githubusercontent.com/u/21120539


[17-May-19 10:42 AM] dimxy#2587
I thought I was supposed that there were soft of 'scanners' which would check actually every block for rekt positions and would not allow equity go to negative


[17-May-19 10:43 AM] jl777c#5810
should be, but no guarantee. need to handle even negative cases


[17-May-19 10:45 AM] dimxy#2587
ok, we need prevent this


[17-May-19 10:45 AM] TonyL#3577
```I thought I was supposed that there were soft of 'scanners' which would check actually every block for rekt positions and would not allow equity go to negative``` but (called info on same block on which bet got rekt):
```  "rektheight": 132,
  "LastHeight": 132,```


[17-May-19 10:45 AM] jl777c#5810
cant prevent, sometimes prices change a lot


[17-May-19 10:45 AM] jl777c#5810
need to handle


[17-May-19 10:50 AM] dimxy#2587
@TonyL could you also decode this tx eb3d4413c1a7b0955b3be91d12c4135a6f65a33809e845744fb2c0a4526de1d4?


[17-May-19 10:50 AM] TonyL#3577
https://paste.ubuntu.com/p/gtrmMDfPdt/ @dimxy


[17-May-19 10:51 AM] dimxy#2587
thanks

{Reactions}
üëç 

[17-May-19 11:02 AM] dimxy#2587
actually it is time to setup some min amount percentage below which rekt is considered. 
Now I simply check if equity are  < 0.
Maybe set something like 10% from initial betamount ?


[17-May-19 11:02 AM] jl777c#5810
yes


[17-May-19 11:07 AM] TonyL#3577
Will be these 10% of left equity returned back to player in case of rekt on this point?


[17-May-19 11:07 AM] jl777c#5810
no


[17-May-19 11:08 AM] TonyL#3577
Insurance liquidation lambo fund? üòÉ


[17-May-19 11:08 AM] jl777c#5810
it will be split between whoever submits the rekt and the house


[17-May-19 11:08 AM] jl777c#5810
90% to house 10% to the rekt-er


[17-May-19 11:08 AM] jl777c#5810
i think that will ensure all rektable positions are rekt


[17-May-19 11:09 AM] TonyL#3577
Hmm,  10% from initial betamount looks too huge


[17-May-19 11:09 AM] TonyL#3577
imo


[17-May-19 11:10 AM] TonyL#3577
Maybe something around 2-3%?


[17-May-19 11:11 AM] jl777c#5810
maybe depends on leverage


[17-May-19 11:11 AM] jl777c#5810
the more leverage the higher the percentage cutoff


[17-May-19 11:11 AM] jl777c#5810
2% for 1:1, 10% for 100x


[17-May-19 11:11 AM] TonyL#3577
Since fee is flat - thats fair


[17-May-19 11:11 AM] jl777c#5810
with the daily smoothing its not like dumping 2000 BTC to change the price will rekt you immediate


[17-May-19 02:06 PM] dimxy#2587
BTW, before this, we fixed to whom who did rekt 0,2% from the amount
now he will receive from 2%\*10% = 0,2% to 10%\*10% = 1%


[17-May-19 02:10 PM] TonyL#3577
High leverage bets = high risks for house üòÉ

{Reactions}
üëå 

[17-May-19 02:20 PM] allbits#5898
@TonyL how much BET you want


[17-May-19 02:21 PM] TonyL#3577
DM'ed


[17-May-19 02:27 PM] dimxy#2587
I accidently set daywindow to the original value 24h, seems it cleared data - i see costbasis=0


[17-May-19 02:28 PM] dimxy#2587
so i need to wait for sometime


[17-May-19 02:29 PM] dimxy#2587
I updated the repo  - corrected validation and added min margin,
but cannot check arithmetic  as no historical data yet


[17-May-19 02:32 PM] TonyL#3577
Great, will try on my test chain üëç


[17-May-19 02:45 PM] TonyL#3577
Hmm, I have daywindow 7 and never set it other but my positions costbasis, lastprice, profits are 0 as well


[17-May-19 02:49 PM] TonyL#3577
Opened new positions and it's same, but `prices` call returning prices


[17-May-19 02:57 PM] dimxy#2587
yes, new errors , incorrect min margin


[17-May-19 03:04 PM] dimxy#2587
updated repo

{Reactions}
üëç 

[17-May-19 03:11 PM] dimxy#2587
do not rekt yet please!


[17-May-19 03:11 PM] dimxy#2587
small err

{Reactions}
üëç 

[17-May-19 03:13 PM] dimxy#2587
corrected flag for rekt


[17-May-19 03:14 PM] TonyL#3577
Updating


[17-May-19 03:19 PM] dimxy#2587
it still easily goes negative with leverage 777 even with min margin (or something wrong with arithmetic)
(but my daywindow is test and small =7)


[17-May-19 03:24 PM] TonyL#3577
Using same daywindow on the test chain


[17-May-19 03:24 PM] TonyL#3577
What if for this use some variable B which connected to variable A and if variable A is positive B = A, but if A is negative B = 0 ?


[17-May-19 03:25 PM] TonyL#3577
So B will never jump into negative


[17-May-19 03:27 PM] TonyL#3577
Have non-zero data for my positions afrer update with some negative profits/equity


[17-May-19 03:30 PM] TonyL#3577
In general if despite of negative amounts all payouts doing correct I can just show negative as 0 in GUI


[17-May-19 03:34 PM] dimxy#2587
it is possible, just arithmetic  will be incorrect in pricesinfo


[17-May-19 03:36 PM] dimxy#2587
as I understand  777 is too big, and 100%/777 = just 0,12% price change sends position to negative


[17-May-19 03:38 PM] dimxy#2587
as we allow %1 price change per block we probably should not allow leverage > 100 or even less


[17-May-19 03:40 PM] TonyL#3577
Aha, x100 is nice limit


[17-May-19 03:40 PM] TonyL#3577
Anyway higher leverage don't have much practical sense

{Reactions}
üëç 

[18-May-19 05:39 AM] TonyL#3577
Hi @dimxy ! So if back to rekt things:
https://paste.ubuntu.com/p/8Cyvw5fxz3/ made some rekts yesterday, it looks like 10% from `profit` sending to "rekter" (since profits went negative `-1.5` rekter received `~0.15`, for other bet where profit was `-1` rekter received `~0.1`
I thought it should be 10% from 10%


[18-May-19 05:48 AM] dimxy#2587
yes, needs to be corrected


[18-May-19 05:51 AM] dimxy#2587
I thought yet about negative equity due to large loss: 
if we cut such losses at 10% not allowing to go negative, we would actually forgive the bettor his losses from his thoughtless big leverages.  It could be unfair


[18-May-19 05:53 AM] dimxy#2587
I think better to limit allowed leverages to never allow to go negative.


[18-May-19 05:54 AM] TonyL#3577
I had some dream last night about PoW rekt mechanics üòÇ


[18-May-19 05:55 AM] TonyL#3577
It was chinese mining farm setup many ASICS to rekt my billion bet first

{Reactions}
üòÄ 

[18-May-19 05:56 AM] dimxy#2587
Unlike bitmex or similar who can more precise control on prices moves, we don have it as we have 10min time interval and changes might go to  1%


[18-May-19 05:57 AM] TonyL#3577
Btw I'm starting chains with 5 mins blocktime now


[18-May-19 05:57 AM] TonyL#3577
Yes, we have not best mechanics for high leverages gambling


[18-May-19 05:57 AM] TonyL#3577
But just can left it up to 100 in case if somebody will want to sponsor house this way üòÉ


[18-May-19 05:58 AM] dimxy#2587
i can see you use 200 leverage, so 0,5% move would eat position


[18-May-19 05:58 AM] TonyL#3577
Yeah, very easy to get rekt


[18-May-19 05:59 AM] TonyL#3577
But almost impossible to take profit because bet maturing 24 hours


[18-May-19 06:01 AM] TonyL#3577
Only attention deserving strategy with high leverage is scalping - but imo it's not possible to scalp with 24 hours delay and bet on average


[18-May-19 06:05 AM] dimxy#2587
yes our betting is based on very smoothed value


[18-May-19 06:07 AM] TonyL#3577
From my point of view it's strategy based mostly on apophenia TA and coin toss gambling - maybe for such bets chain with blocktime/prices updates every 10 seconds or so is needed


[18-May-19 06:07 AM] TonyL#3577
But if somebody will want to sponsor fund on 10 minutes blocks chain - it's good for fund üòÉ


[18-May-19 06:11 AM] jl777c#5810
we cant have too fast a blocktime, that would mean a lot of price queries and nodes could get blocked


[18-May-19 06:12 AM] dimxy#2587
the services return updates with 1 min interval as I can see


[18-May-19 06:13 AM] jl777c#5810
not faster than a minute, yes


[18-May-19 06:14 AM] jl777c#5810
for 10 minute blocks, i think at 2 minutes or so


[18-May-19 08:04 AM] dimxy#2587
@TonyL  i updated the repo with the rekt fee correction

{Reactions}
üëç 

[18-May-19 08:40 AM] TonyL#3577
@dimxy Updated. https://paste.ubuntu.com/p/DZZMkVTSHW/ initial bet size was 1 coin but in rekt outputs only ~0.84 ü§î


[18-May-19 08:42 AM] TonyL#3577
https://paste.ubuntu.com/p/6Fx7jfWxT6/ inputs of this rekt transaction


[18-May-19 08:43 AM] TonyL#3577
Aha, looks like initial 0.995 bet (1 - 0.5% txfee) was separated there, and then on rekt this 0.84 vout used
```   {
      "txid": "be78d5f35d72ca5f747363541950f5a629b56e331968890c63335e2c165c7e89",
      "vout": 2,
      "address": "RAL5Vh8NXmFqEKJRKrk1KjKaUckK7mM1iS",
      "scriptSig": {
        "asm": "a276a072a26ba067a5658021039894cb054c0032e99e65e715b03799607aa91212a16648d391b6fa2cc52ed0cf81406071c4f484c8a35a1124a718341990b3f5942cfc981038824952e8686d7a53b12b1f8f1a353fac5d5d086cce574893fe0259e155becc8b554cc0c0316182d097a100af038001eda10001",
        "hex": "4c79a276a072a26ba067a5658021039894cb054c0032e99e65e715b03799607aa91212a16648d391b6fa2cc52ed0cf81406071c4f484c8a35a1124a718341990b3f5942cfc981038824952e8686d7a53b12b1f8f1a353fac5d5d086cce574893fe0259e155becc8b554cc0c0316182d097a100af038001eda10001"
      },
      "value": 0.99500000,
      "valueSat": 99500000,
      "sequence": 4294967295
    }
  ],
  "vout": [
    {
      "value": 0.15491800,
      "valueSat": 15491800,
      "n": 0,
      "scriptPubKey": {
        "asm": "034a4e4bd93ae67870436fa3692c1810712fba6d1601ba051d64acc40f3353959a OP_CHECKSIG",
        "hex": "21034a4e4bd93ae67870436fa3692c1810712fba6d1601ba051d64acc40f3353959aac",
        "reqSigs": 1,
        "type": "pubkey",
        "addresses": [
          "REX61PeWLe8GkFwS16zbrtTCNMgpK2DhsJ"
        ]
      }
    },
    {
      "value": 0.84008200,
      "valueSat": 84008200,
      "n": 1,
      "scriptPubKey": {
        "asm": "a22c80203ee64ec5f134da404710d306dcd9ca54a0139b3c4827b43a988fc6316e6c2a688103120c008203000401 OP_CHECKCRYPTOCONDITION",
        "hex": "2ea22c80203ee64ec5f134da404710d306dcd9ca54a0139b3c4827b43a988fc6316e6c2a688103120c008203000401cc",
        "reqSigs": 1,
        "type": "cryptocondition",
        "addresses": [
          "RAL5Vh8NXmFqEKJRKrk1KjKaUckK7mM1iS"
        ]
      },```


[18-May-19 08:45 AM] dimxy#2587
0.84 is probably the change


[18-May-19 08:49 AM] TonyL#3577
Hmm thats strange - it looks like in input tx of pricesrekt 0.15 from initial 0.995 bet returned to player and 0.84 to fund

Also rekter received  `"value": 0.00100000,`, initial bet was 1 coin (200 leverage), 10% from 1 coin is 0.1, 2% from 0.1 is 0.002


[18-May-19 08:57 AM] dimxy#2587
actually I consider fund's coins as a whole. That is I don't spend specific bet's inputs but add any available inputs from fund's global address and just provide the balance (if I correctly understand your concern)


[18-May-19 08:57 AM] TonyL#3577
Ah, I see


[18-May-19 08:57 AM] TonyL#3577
But anyway rekter received twice less funds than should


[18-May-19 08:58 AM] TonyL#3577
Maybe math working not correct there because balance became negatvie


[18-May-19 09:01 AM] TonyL#3577
Funds coins as a whole sounds dangerous - like a one left hole might allow to spend all fund funds 
Just Ethereum DAO hack sit in memory üòÉ


[18-May-19 09:03 AM] dimxy#2587
need to consider this


[18-May-19 09:03 AM] dimxy#2587
fund value as whole allows better value management


[18-May-19 09:04 AM] TonyL#3577
Yeah, thats should remove complicity. Our chains isolated so aftermath of hack should be less than for ETH


[18-May-19 09:04 AM] dimxy#2587
BTW for large leverage seems we set min margin as 10% and rekt fee 10% from it


[18-May-19 09:04 AM] TonyL#3577
Thats one of assetchains as sidechains scaling advantages - easier to fork without mainchain value /info loss üòÉ


[18-May-19 09:06 AM] TonyL#3577
`BTW for large leverage seems we set min margin as 10% and rekt fee 10% from it`
Hmm in such case shouldn't it be `1 * 0.1 * 0.1 = 0.01` instead of 0.001 ?


[18-May-19 09:06 AM] dimxy#2587
min margin calculation is: 
[1, 100] - min margin propotional to leverage, 
[100, 777] - min margin fixed at 10% (otherwise it would grow > 50%)


[18-May-19 09:08 AM] dimxy#2587
checking calc...  foundüòÄ


[18-May-19 09:09 AM] dimxy#2587
thanks!

{Reactions}
üî• 

[18-May-19 09:18 AM] dimxy#2587
```Funds coins as a whole sounds dangerous - like a one left hole might allow to spend all fund funds ```
In the validation code we check that only cashout or rekt transactions could spend the fund


[18-May-19 09:19 AM] TonyL#3577
Sounds like a challenge for Alright üòÉ

{Reactions}
üëç 

[18-May-19 09:24 AM] Deleted User#0000
Check the TX Fee aswel... üòâ


[18-May-19 09:24 AM] Deleted User#0000
if spending from global address, need to check txfee always in validation. I added function for this to make it easy


[18-May-19 09:33 AM] TonyL#3577
I'm out of reketed bet - will take a little additional time to prepare new ones to test last fix


[18-May-19 10:04 AM] TonyL#3577
Rekt on latest looks fine:
```  "vout": [
    {
      "value": 0.01000000,
      "valueZat": 1000000,
      "n": 0,
      "scriptPubKey": {
        "asm": "034a4e4bd93ae67870436fa3692c1810712fba6d1601ba051d64acc40f3353959a OP_CHECKSIG",
        "hex": "21034a4e4bd93ae67870436fa3692c1810712fba6d1601ba051d64acc40f3353959aac",
        "reqSigs": 1,
        "type": "pubkey",
        "addresses": [
          "REX61PeWLe8GkFwS16zbrtTCNMgpK2DhsJ"
        ]
      }
    },
    {
      "value": 0.98500000,
      "valueZat": 98500000,
      "n": 1,
      "scriptPubKey": {
        "asm": "a22c80203ee64ec5f134da404710d306dcd9ca54a0139b3c4827b43a988fc6316e6c2a688103120c008203000401 OP_CHECKCRYPTOCONDITION",
        "hex": "2ea22c80203ee64ec5f134da404710d306dcd9ca54a0139b3c4827b43a988fc6316e6c2a688103120c008203000401cc",
        "reqSigs": 1,
        "type": "cryptocondition",
        "addresses": [
          "RAL5Vh8NXmFqEKJRKrk1KjKaUckK7mM1iS"
        ]
      }
    },
```

{Reactions}
üëç 

[18-May-19 10:05 AM] TonyL#3577
And looks like latest changes were not hardforking so can just update BETS0 nodes without chain restart


[18-May-19 10:05 AM] TonyL#3577
BETS0 almost matured, just 100 blocks left for smoothed prices calculation (it have 5 min blocks)


[18-May-19 03:39 PM] TonyL#3577
Rekt hunter on duty üòÉ

{Attachments}
https://cdn.discordapp.com/attachments/560714286369079299/579437823233359943/unknown.png


[19-May-19 12:08 AM] jl777c#5810
when everybody runs it, there will be a big mempool conflict


[19-May-19 12:08 AM] jl777c#5810
which is ok, but if there will be literally N variants of same tx, then this will likely cause some issues


[19-May-19 12:09 AM] jl777c#5810
i strongly suggest to require a rekt tx to be like faucetget, ie txid start and end with 0x00

{Reactions}
üëå 

[19-May-19 09:34 AM] TonyL#3577
Maybe in future it can evaluate to some rekt mining so people will setup mining pools to share rekt rewards


[19-May-19 09:34 AM] TonyL#3577
Kinda on top of blockchain blocks some "rekt blocks" transactions


[19-May-19 09:38 AM] jl777c#5810
faucetget basically does mining and takes about 20 to 60 seconds


[19-May-19 09:45 AM] TonyL#3577
Yup, can remember that. I meant some version where diff is not hardcoded but dynamic


[19-May-19 09:45 AM] TonyL#3577
So miners competition will be üòÉ


[19-May-19 09:47 AM] TonyL#3577
BETS0 matured meanwhile üòÉ


[19-May-19 09:54 AM] jl777c#5810
ah, yes interesting. diff adjustment for the tx mining


[20-May-19 01:49 PM] TonyL#3577 (pinned)
https://github.com/tonymorony/komodo-cctools-python/releases/download/0.01prices/prices_app_BETS0.zip

Ubuntu users who want to participate in prices testing might test this precompiled portable of prices web-interface and komodod 

1) Download
2) unzip
3) cd prices_app_v2
3) start daemon and wait until BETS0 is synced:  ```./komodod -ac_name=BETS0 -ac_cbopret=7 -ac_cc=10777 -ac_reward=10000 -ac_supply=156177 -ac_blocktime=300 -ac_snapshot=288 -ac_sapling=1 -ac_earlytxidcontract=237 -ac_prices="ETH, LTC, BNB, NEO, LRC, QTUM, OMG, ZRX, STRAT, IOTA, XVG, KMD, EOS, ZEC, DASH, XRP, STORJ, XMR, BAT, BTS, LSK, ADA, WAVES, STEEM, RVN, DCR, XEM, ICX, HOT, ENJ" -ac_stocks="AAPL,ADBE,ADSK,AKAM,AMD,AMZN,ATVI,BB,CDW,CRM,CSCO,CYBR,DBX,EA,FB,GDDY,GOOG,GRMN,GSAT,HPQ,IBM,INFY,INTC,INTU,JNPR,MSFT,MSI,MU,MXL,NATI,NCR,NFLX,NTAP,NVDA,ORCL,PANW,PYPL,QCOM,RHT,S,SHOP,SNAP,SPOT,SYMC,SYNA,T,TRIP,TWTR,TXN,VMW,VOD,VRSN,VZ,WDC,XRX,YELP,YNDX,ZEN,BRK.A" -addnode=159.69.45.70 -earlytxid=d0de610ad271e0ef966d006a1c6cde67780bb40118f3efdec9bf07e86081e184 -daemon```
4) Start application `./prices_app_v2`

5) Webinterface should be availiable in browser `0.0.0.0:777`


[20-May-19 01:50 PM] TonyL#3577
If you'll see webinterface it means that portable works üòÉ


[20-May-19 01:51 PM] TonyL#3577
Should be compatible with Ubuntu 16.04+


[20-May-19 02:09 PM] allbits#5898
Noob trying this :)

Daemon started but longestchain staying at 0


[20-May-19 02:10 PM] allbits#5898
Ahh, there it goes!


[20-May-19 02:11 PM] allbits#5898
Longestchain 944 right now?


[20-May-19 02:13 PM] TonyL#3577
Yup


[20-May-19 02:14 PM] allbits#5898
K. Need to go away from keyboard for a bit. Will get back to it later

{Reactions}
üëç 

[20-May-19 02:50 PM] SHossain#0007

{Attachments}
https://cdn.discordapp.com/attachments/560714286369079299/580150290888654879/Screenshot_from_2019-05-20_22-49-37.png


[20-May-19 02:51 PM] SHossain#0007
it works.


[20-May-19 02:54 PM] SHossain#0007

{Attachments}
https://cdn.discordapp.com/attachments/560714286369079299/580151331323510795/Screenshot_from_2019-05-20_22-53-31.png


[20-May-19 02:54 PM] SHossain#0007

{Attachments}
https://cdn.discordapp.com/attachments/560714286369079299/580151358699864064/Screenshot_from_2019-05-20_22-53-40.png

{Reactions}
üî• 

[20-May-19 04:05 PM] allbits#5898
So what exactly do I put in my browser address window?


[20-May-19 04:06 PM] SHossain#0007
127.0.0.1:777


[20-May-19 04:07 PM] allbits#5898
Not working for me


[20-May-19 04:08 PM] allbits#5898
But the command worked in terminal. It's giving all kinds of price output


[20-May-19 04:24 PM] allbits#5898
Any ideas? Remember I'm a noob. I take all instruction literally


[20-May-19 04:25 PM] SHossain#0007
how many terminals you are running?


[20-May-19 04:25 PM] SHossain#0007
which command worked?


[20-May-19 04:26 PM] allbits#5898
./prices_app_v2 worked


[20-May-19 04:26 PM] allbits#5898
I've got eight terminals open right now


[20-May-19 04:26 PM] SHossain#0007
you are super advanced üòÉ


[20-May-19 04:27 PM] allbits#5898
Hahaha


[20-May-19 04:27 PM] SHossain#0007
did you see this message when you started `./prices_app_v2`?
```
 * Serving Flask app "app" (lazy loading)
 * Environment: production
   WARNING: This is a development server. Do not use it in a production deployment.
   Use a production WSGI server instead.
 * Debug mode: off
 * Running on http://0.0.0.0:777/ (Press CTRL+C to quit)
```


[20-May-19 04:28 PM] allbits#5898
Oh boy. Such a noob error lol. I was looking at wrong terminal hehe


[20-May-19 04:29 PM] allbits#5898
I got s bunch of errors and it exited


[20-May-19 04:29 PM] SHossain#0007
did you start the daemon with pubkey? or, did you set the pubkey later after the daemon started?


[20-May-19 04:30 PM] SHossain#0007
when you say error, please make sure to post the error here. otherwise, we wouldn't know what error you have.


[20-May-19 04:31 PM] allbits#5898
I did not start daemon with pubkey, I think.  I literally copied and pasted Tony's command


[20-May-19 04:31 PM] SHossain#0007
ok


[20-May-19 04:32 PM] allbits#5898
It's clearly the problem as that's what the error says


[20-May-19 04:32 PM] SHossain#0007
use this command
```
./komodo-cli -ac_name=BETS0 getnewaddress
```


[20-May-19 04:32 PM] SHossain#0007
it will generate a new address for you


[20-May-19 04:32 PM] allbits#5898
Ok


[20-May-19 04:32 PM] SHossain#0007
then use
```
./komodo-cli -ac_name=BETS0 validateaddress Rxxxxxxx
```


[20-May-19 04:33 PM] SHossain#0007
replace Rxxxxxxxxx with the address you got


[20-May-19 04:33 PM] SHossain#0007
that will display `pubkey` for you


[20-May-19 04:34 PM] SHossain#0007
then use
```
./komodo-cli -ac_name=BETS0 setpubkey xxxxxxxxxxx
```


[20-May-19 04:34 PM] allbits#5898
Ok got it


[20-May-19 04:34 PM] SHossain#0007
replace `xxxxxxxxxx` with the pubkey you got


[20-May-19 04:35 PM] allbits#5898
Done


[20-May-19 04:36 PM] SHossain#0007
now use `./prices_app_v2`


[20-May-19 04:37 PM] allbits#5898
Errors


[20-May-19 04:37 PM] allbits#5898
Seem like permissions


[20-May-19 04:37 PM] allbits#5898
sudo?


[20-May-19 04:37 PM] SHossain#0007
yes `sudo ./prices_app_v2`


[20-May-19 04:37 PM] SHossain#0007
@TonyL seems i'm not alone in this


[20-May-19 04:38 PM] allbits#5898
Yay!!!


[20-May-19 04:42 PM] allbits#5898
What can I do with this now?


[20-May-19 04:45 PM] SHossain#0007
nothing


[20-May-19 04:45 PM] SHossain#0007
you confirmed it works üòÑ


[20-May-19 04:45 PM] SHossain#0007
you can browse to `127.0.0.1:777`


[20-May-19 04:46 PM] allbits#5898
I've done that. I see it in browser and can select various pairs to look at. Is there any actions to be taken, testing to be done?


[20-May-19 04:46 PM] SHossain#0007
Tony will add more things for testing later


[20-May-19 04:47 PM] SHossain#0007
this is the early version of his Prices CC dAPP


[20-May-19 04:47 PM] SHossain#0007
it seems me and you had to run with `sudo`


[20-May-19 04:48 PM] SHossain#0007
i wonder if this is the case with everyone


[20-May-19 04:50 PM] allbits#5898
K. Thanks for your help

{Reactions}
üëçüèΩ 

[20-May-19 06:38 PM] TonyL#3577
Great that it started üëç  Added `sudo` to instruction


[20-May-19 06:47 PM] TonyL#3577
`What can I do with this now?` - more details/guidance will be revealed during this week. Traders competition is coming üòÉ 
`BETS0` supply is not distributed yet and will be distributed among the participants. 

Testing of portable GUIs  start it's a step0 of preparation üòÉ


[20-May-19 07:15 PM] allbits#5898
üëå


[20-May-19 07:16 PM] allbits#5898
Noob friendly so far!

{Reactions}
üëç 

[20-May-19 09:31 PM] gcharang#6833
Pinned a message.


[21-May-19 05:39 AM] SHossain#0007
nice work on this @TonyL


[21-May-19 10:31 AM] dimxy#2587
@TonyL  added rekt txid \'mining\'

{Reactions}
üëç 

[21-May-19 10:52 AM] TonyL#3577
Updating


[21-May-19 11:12 AM] TonyL#3577
```PricesValidate() ValidateFinalTx=false incorrect rekt txid
CC Eval EVAL_PRICES Invalid: incorrect rekt txid spending tx 5c5779b68f4d01d2caae111358c8c31e77d64246291014e1b3d9f2c3532fc417
PricesValidate() ValidateFinalTx=false incorrect rekt txid
CC Eval EVAL_PRICES Invalid: incorrect rekt txid spending tx 0d2fb1dfe3ebcb6ac6404b14d4f50c1a05772644b8e3176598c79d7188ce1b59
```
Seems that change is hardforking for testnet


[21-May-19 11:33 AM] TonyL#3577
Good news is that no bets/rekts yet on BETS0 so I just updated it nodes. Temporary deleted from github testing portable GUI since it contains daemon out of consensus (rektsensus)


[21-May-19 11:39 AM] dimxy#2587
better to remove the validation of txid then... removed


[21-May-19 11:42 AM] dimxy#2587
How many bet tx are we expecting?
(searching the opposite bets algo is not very efficient and it might be a bottleneck)


[21-May-19 11:53 AM] TonyL#3577
`How many bet tx are we expecting?` 
In case of bots/automated trading it might be thousands per day. On early stages maybe tens-hundreds


[21-May-19 12:01 PM] TonyL#3577
I can make some scaling spam test üòÉ


[21-May-19 12:01 PM] TonyL#3577
Like I did with diceCC: just spam stuff `while True` üòÉ


[21-May-19 12:03 PM] dimxy#2587
for thousands it will be very slow, 
needs optimizing


[21-May-19 12:03 PM] TonyL#3577
Very unlikely it'll be thousands on REKT0


[21-May-19 12:04 PM] SHossain#0007
i can keep mining


[21-May-19 12:04 PM] SHossain#0007
just let me know when to start


[21-May-19 12:12 PM] TonyL#3577
Sure, you can start miner if you wish. Just blockreward is very low on REKT0 (10000 sat) because idea of this bounty chain is "fixed" supply


[21-May-19 12:16 PM] SHossain#0007
i'm not after mining reward. want to keep the chain going and validate all txs for tests


[21-May-19 12:16 PM] SHossain#0007
will start a miner with 1 thread now


[21-May-19 12:20 PM] allbits#5898
Should I update


[21-May-19 12:23 PM] TonyL#3577
I think everybody fine now because dimxy removed rekt txid validation üòÉ


[21-May-19 12:23 PM] TonyL#3577
@dimxy rekt txid "mining" works


[21-May-19 12:23 PM] TonyL#3577
Made helicopter from my laptop üòÉ

{Reactions}
üòÄ (2) 

[21-May-19 01:14 PM] TonyL#3577
OSX portable will come tomorrow (I hope) üòÉ


[22-May-19 12:52 PM] TonyL#3577
BETs public testing will start in #kmdlabs cluster üî• , also some quality documentation needs to be preapred so testers will understand what to do so ETA of testing start moving a little bit ahead (maybe 1-2 weeks from now)

{Reactions}
üôå (3) 

[25-May-19 11:20 AM] TonyL#3577
https://docs.google.com/document/d/1O5hJ_ZeBWK-xP3f3RM48ruG3mOlsPbbLcXjyqtn0Oew/edit?usp=sharing trying to describe basic infromation about pricesCC in single place (for testers)

{Embed}
https://docs.google.com/document/d/1O5hJ_ZeBWK-xP3f3RM48ruG3mOlsPbbLcXjyqtn0Oew/edit?usp=sharing
PricesCC doc
PricesCC - synthetic price betting "game", though most would call this trading  Users can open long and short leveraged positions using assets for which prices recording on a chain by trust less oracle.  Prices:  For example, on CFEKBET0 chain can be traded:  	BTCUSD, BTC to ...
https://images-ext-2.discordapp.net/external/wDPhk8tB2gI_R73yZWnP8nK7P0cIFcrrnRO4c6eiMrI/https/lh6.googleusercontent.com/x1zsIJElF2pmbaAQMoyo8issOldm6tXFWttEzjiEaH1doGAGg5tjAILPM-76LTvAnikq6g%3Dw1200-h630-p

{Reactions}
üëç (4) 

[25-May-19 11:21 AM] TonyL#3577
Actually mostly using description which James shared with me with some additional examples


[02-Jun-19 03:48 AM] CrisF#3405
Hi, I thought that there was a really good explanation of how to create trading pairs by jl777 at the start of the channel.  Can't seem to find it.
Where should I look to find info on creating pairs?


[02-Jun-19 04:06 AM] CrisF#3405
Ahh, sry, found it down the bottom of the google doc ü§¶


[02-Jun-19 06:05 AM] TonyL#3577
Hi @CrisF ! Feel free to ask if something is not clear from doc. I've tried to merge all jl777 explanations with some additional examples but maybe something is missing.


[02-Jun-19 06:09 AM] CrisF#3405
Hi Tony üëã
Thanks.  I wasn't able to get the `synthetic` formatted correctly to make a bet.


[02-Jun-19 06:10 AM] CrisF#3405
I'm about to head out for the day but will try again tomorrow.


[02-Jun-19 06:15 AM] TonyL#3577
Which synthetic you've tried to make and which error received?


[02-Jun-19 06:16 AM] CrisF#3405
I tried "ZECUSD, USDAAPL, *, -1.7" and multiple variations of that.


[02-Jun-19 06:17 AM] TonyL#3577
I see, so doc is not clear I think :/


[02-Jun-19 06:18 AM] TonyL#3577
I'll add to it all pairs which activated on CFEKBET1 chain to make it more clear


[02-Jun-19 06:18 AM] CrisF#3405
The error on the UI said something about format error


[02-Jun-19 06:18 AM] TonyL#3577
This synthetic is not correct


[02-Jun-19 06:19 AM] TonyL#3577
Such tickers does not exists (there are only altcoins/btc pairs, also `_` is separator in ticker) and for single stack weight just 1


[02-Jun-19 06:19 AM] TonyL#3577
Also in GUI input synthetic without `"`


[02-Jun-19 06:20 AM] CrisF#3405
Ok, cool!

{Reactions}
üëç 

[02-Jun-19 06:20 AM] TonyL#3577
You can check call: `./komodo-cli -ac_name=CFEKBET1 prices 1`


[02-Jun-19 06:20 AM] TonyL#3577
In output you'll see all tickers which you can use in synthetic combining


[02-Jun-19 06:21 AM] CrisF#3405
I did try a few withe the `_` and also with `1`, but not together.


[02-Jun-19 06:21 AM] CrisF#3405
Great!


[02-Jun-19 06:22 AM] CrisF#3405
I've shut it down for the night but will get on to it tomrrow üòÉ


[02-Jun-19 06:22 AM] TonyL#3577
`ZEC_BTC, USD_AAPL, *, 1`
will work  - it'll be (ZEC*USD) /  (BTC * APPL) price üòÉ Good night!


[02-Jun-19 06:24 AM] CrisF#3405
ohh, üëç Thanks!
Not sure your timezone now, but you too üåö

{Reactions}
labs 

[02-Jun-19 07:01 AM] CrisF#3405
Well, I've fired it all back up again and have 2 bets placed.  1 cli and one UI. ü§û 
üí§

{Reactions}
üî• 

[02-Jun-19 08:10 AM] TonyL#3577
List of the tickers available on CFEKBET1: https://paste.ubuntu.com/p/5vyDm6kjYv/ 
(added to doc too)

{Reactions}
3040_kingpeepo 

[02-Jun-19 08:10 AM] Bar_F1sh_Rel#0834
OK - so I have the server running on VM1 and can access the web-interface from a windoz PC (through the auth setting in dash.ini) - now how do I provide some collateral??


[02-Jun-19 08:10 AM] TonyL#3577
https://docs.google.com/document/d/1O5hJ_ZeBWK-xP3f3RM48ruG3mOlsPbbLcXjyqtn0Oew/edit have you read this doc?

{Embed}
https://docs.google.com/document/d/1O5hJ_ZeBWK-xP3f3RM48ruG3mOlsPbbLcXjyqtn0Oew/edit
PricesCC doc
PricesCC - synthetic price betting "game", though most would call this trading  Users can open long and short leveraged positions using assets for which prices recording on a chain by trust less oracle.  Prices:  For example, on CFEKBET1 chain can be traded:  	BTCUSD, BTC to ...
https://images-ext-2.discordapp.net/external/wDPhk8tB2gI_R73yZWnP8nK7P0cIFcrrnRO4c6eiMrI/https/lh6.googleusercontent.com/x1zsIJElF2pmbaAQMoyo8issOldm6tXFWttEzjiEaH1doGAGg5tjAILPM-76LTvAnikq6g%3Dw1200-h630-p


[02-Jun-19 08:11 AM] Bar_F1sh_Rel#0834
Yeah - can I send Bet1 from my NN to the BET1 pubkey address?


[02-Jun-19 08:12 AM] TonyL#3577
GUI communicating now with wallet on your VM1


[02-Jun-19 08:12 AM] TonyL#3577
So you should have balance on it


[02-Jun-19 08:13 AM] Bar_F1sh_Rel#0834
My wallet is empty üòû


[02-Jun-19 08:14 AM] TonyL#3577
I can send some


[02-Jun-19 08:18 AM] Bar_F1sh_Rel#0834
my address should be ``RUubda5XgQSrfaBr6Gs1kpN3GNFDsevRbY``


[02-Jun-19 08:18 AM] TonyL#3577
`aa14db02597d02230edffa1eeb5faba70bb54374bb4da5ff454888ab9a489e52`


[02-Jun-19 08:21 AM] Bar_F1sh_Rel#0834
Thanks - I'll wait for that to confirm.


[02-Jun-19 09:56 PM] Mylo#8306
can you play `prices` without LABS or you need LABS installed with prices?


[02-Jun-19 09:58 PM] Mylo#8306
`mypriceslist` changed to `pricesmylist` would not break the naming convention used for RPC calls (already noted on google doc) - everything is named `prices*****`


[02-Jun-19 09:59 PM] Mylo#8306
looks like answer to my first question is `can play without LABS` - because of the precompiled binaries example for pirces @TonyL


[02-Jun-19 09:59 PM] Mylo#8306
the "CFEKBET1" bundle.


[02-Jun-19 10:00 PM] TonyL#3577
(mypriceslist -> pricesmylist) Maybe I made typo in doc


[02-Jun-19 10:01 PM] TonyL#3577
In bundle actually precompiled kmdlabs (pricescomp branch) daemon


[02-Jun-19 10:01 PM] TonyL#3577
`mypriceslist` this call named


[02-Jun-19 10:02 PM] TonyL#3577
Oh, it is proposal to make all calls looks the same? (start from `price`)


[02-Jun-19 10:04 PM] Mylo#8306
yes,, proposal to change rpc name üòÉ


[02-Jun-19 10:04 PM] TonyL#3577
Need one more coffee, sry üòÉ


[02-Jun-19 10:05 PM] TonyL#3577
mypriceslist have semantic sense imo


[02-Jun-19 10:06 PM] TonyL#3577
from other side it might confuse somebody yeah


[02-Jun-19 10:08 PM] Mylo#8306
<app><func>
app=prices 

8 out of  9 RPC methods follow that naming convention.


[02-Jun-19 10:09 PM] Mylo#8306
easier to teach pp/devsl about blockchain applications if the pattern is there imo

{Reactions}
üëç 

[06-Jun-19 12:23 PM] jl777c#5810
https://medium.com/circle-trader/overview-of-btc-margin-lending-pool-losses-a2f0905aaa56

{Embed}
https://medium.com/circle-trader/overview-of-btc-margin-lending-pool-losses-a2f0905aaa56
Overview of BTC Margin Lending Pool Losses
On Poloniex, we provide a peer-to-peer margin lending and borrowing system for our customers outside of the United States. Below, we‚Ä¶


[06-Jun-19 12:28 PM] TonyL#3577
`All BTC loans on Poloniex are lent in a common pool` - thats why I proposed separate funds between markets with different volatility and etc, looks like the huge risks management mistake


[06-Jun-19 12:30 PM] TonyL#3577
1 volatile market get rekt whole fund, that is just wow. And I bet they have tens of suits with financial degree in their team. Losses the same as marketcap of this CLAM


[06-Jun-19 12:31 PM] TonyL#3577

{Attachments}
https://cdn.discordapp.com/attachments/560714286369079299/586275930096271400/unknown.png


[06-Jun-19 12:40 PM] jl777c#5810
but dont we currently have just one common pool too? i guess we need to separate things out per synthetic?


[06-Jun-19 12:42 PM] TonyL#3577
We have one common too at the moment


[06-Jun-19 01:05 PM] TonyL#3577
`i guess we need to separate things out per synthetic?` - I think it might be easier to implement on some chain where allowed to trade only few pais without possibility to create complex synthetics.
When you have endless amount of synthetics - you need to maintain funds in each synthetic pool to make player be able open positions. Now we have infinity variations of prices


[06-Jun-19 01:06 PM] jl777c#5810
yes, i guess i made it have too much power


[06-Jun-19 01:07 PM] TonyL#3577
It's something like a keep the plasma


[06-Jun-19 01:07 PM] TonyL#3577
Not easy üòÉ


[06-Jun-19 01:12 PM] TonyL#3577
For relatively small houses we can abstract from this problem


[06-Jun-19 01:13 PM] TonyL#3577
Problem became actual when fund amount same order as one of the traded assets marketcap


[06-Jun-19 01:14 PM] TonyL#3577
Most important is asset liquidity for sure. Simulating in head and in different scenarios market manipulators always win on some point


[16-Jun-19 03:44 AM] Mylo#8306
https://medium.com/market-protocol/mpx-mainnet-ahead-2881b915d334

{Embed}
https://medium.com/market-protocol/mpx-mainnet-ahead-2881b915d334
Mainnet Ahoy!
After a ton of hard work, we are excited to announce our mainnet launch coming June 24th.
https://images-ext-2.discordapp.net/external/V_gcWBcFEcoSWKstf2QlSWv7-ZEPD7b_x3j0YfhyByw/https/cdn-images-1.medium.com/max/1200/1%2AXXQRgxOjNhtlCGqq-VBPrA.png


[16-Jun-19 03:44 AM] Mylo#8306
Synthetic prices etc.


[25-Jun-19 09:24 AM] jl777c#5810
https://www.coindesk.com/synthetix-trader-rolls-back-broken-trades-that-netted-1-billion-profit

{Embed}
John Biggs
https://www.coindesk.com/synthetix-trader-rolls-back-broken-trades-that-netted-1-billion-profit
Synthetix Trader Rolls Back Broken Trades That Netted $1 Billion P...
A rogue API caused Synthetix pricing to go wild. A bot profited, but the bot owner rolled back the trades.
https://images-ext-1.discordapp.net/external/DWyz-RUG58hsYBZdm3cnXtTRiMkDIqXOIe5yiJIhxQ8/https/static.coindesk.com/wp-content/uploads/2019/06/nanna-moilanen-IO-dd1MJnCk-unsplash.jpg

{Reactions}
üò≥ (2) üçû (2) 

[01-Oct-19 02:58 AM] Mylo#8306
are the quotes stored in the PRICES blockchain accessible by OTHER blockchain through some cross-chain verification/lookup, currently?

if so, can the OTHER blockchain issue a payment based on a quoted price being higher than a specified value?


[01-Oct-19 02:59 AM] Mylo#8306
e.g.
OTHER blockchain will send a payment every 50,000th block if PRICES records the price of KMD being >$0.60


[01-Oct-19 03:00 AM] Mylo#8306
if not now, possibly in the future.


[02-Oct-19 11:21 AM] dimxy#2587
The quotes are accessible only through prices rpc call (no any oracle solution for this yet AFAIK)


[02-Oct-19 11:32 AM] jl777c#5810
you would need to do something like the gateways CC does, write the merkle roots to an oracle for the PRICES chain. then you can prove any specific transaction, using merkle proofs.


[02-Oct-19 11:32 AM] jl777c#5810
the prices are stored in the coinbase opreturn. so prove the coinbase tx that has the price you need


[02-Oct-19 11:33 AM] jl777c#5810
alternatively, a multi-nspv solution  might be more direct way to solve this sort of multichain problem

{Reactions}
üíØ 

[02-Oct-19 06:15 PM] Mylo#8306
ok thanks & thanks.
multi-nspv solution sounds more accessible to tech folk like me


[03-Nov-19 02:32 PM] Regnar#6164 (pinned)
```- Prices
  - Synthetic Prices Betting Game - [https://docs.google.com/document/d/1O5hJ_ZeBWK-xP3f3RM48ruG3mOlsPbbLcXjyqtn0Oew/edit](https://docs.google.com/document/d/1O5hJ_ZeBWK-xP3f3RM48ruG3mOlsPbbLcXjyqtn0Oew/edit)
  - Prices CC App2 in Python - [https://github.com/tonymorony/komodo-cctools-python/blob/master/prices_app_v2.py](https://github.com/tonymorony/komodo-cctools-python/blob/master/prices_app_v2.py)
  - Prices CC Visualization in Python - [https://github.com/tonymorony/komodo-cctools-python/blob/master/prices_visualization_server.py](https://github.com/tonymorony/komodo-cctools-python/blob/master/prices_visualization_server.py)
  - Prices CC Rekt Inspector in Python - [https://github.com/tonymorony/komodo-cctools-python/blob/master/rekt_inspector.py](https://github.com/tonymorony/komodo-cctools-python/blob/master/rekt_inspector.py)
  - Live Synthetic Price Feed - [http://159.69.45.70:8050/](http://159.69.45.70:8050/)
  - Live Synthetic Price Feed 2 - [http://kmd.money:8050/](http://kmd.money:8050/)```

Hey all, if you have any proof of concepts, or built something cool for Prices CC, please let me know. The goal is to build out a list of concepts using CCs to help show other developers what is possible and add this to the Komodo docs page. TUIs are good too


[04-Nov-19 12:41 AM] ronyi#5719
https://github.com/tonymorony/komodo-cctools-python/releases/download/0.01prices/prices_app_BETS0.zip not found


[04-Nov-19 01:39 AM] Mylo#8306
Pinned a message.


[04-Nov-19 04:31 AM] Regnar#6164
I think that was the older one and was replaced by `app_v2.py` not sure thought


[04-Nov-19 04:31 AM] Regnar#6164
`https://github.com/tonymorony/komodo-cctools-python/blob/master/prices_app_v2.py`


[18-Dec-19 06:43 AM] Mylo#8306
https://twitter.com/synthetix_io/status/1207183071889387520

{Embed}
Synthetix (@synthetix_io)
https://twitter.com/synthetix_io/status/1207183071889387520
The Synthetix team + community is extremely excited about the new live integration with Chainlink, decentralizing the first wave of our price feeds! This is a landmark moment for #DeFi and we're extremely grateful to everyone at @chainlink for their assistance through the ...
Likes
263
Twitter


[18-Dec-19 06:44 AM] Mylo#8306
Each CC needs it‚Äôs own twitter feed imo!


[18-Dec-19 06:45 AM] Mylo#8306
@SHossain üëÜ - reminds me of BarterDEX atomic swap days of tweeting out the first swap with xxxxx coin/token üôÇ


[18-Dec-19 11:12 AM] SHossain#0007
True. Other projects like to send out tweet of everything they do


[20-Dec-19 02:09 PM] Regnar#6164
https://dos.network/

{Embed}
https://dos.network/
DOS Network
A Layer-2 Decentralized Oracle Service Network for Multiple Blockchains

{Reactions}
üëç 

[20-Dec-19 02:09 PM] Regnar#6164
Another whole project that is solved by CC Oracles


[11-Jan-20 09:45 AM] jl777c#5810
@gcharang https://developers.komodoplatform.com/basic-docs/antara/antara-api/prices.html

{Embed}
https://developers.komodoplatform.com/basic-docs/antara/antara-api/prices.html
Komodo Developer Documentation
Documentation for developers building on the Komodo Platform
https://images-ext-2.discordapp.net/external/JRuH6_LDrjOGd6HbRckiIc9OBFcyJGE1c7DjCukFvtA/https/developers.komodoplatform.com/start-here-pics/Dev_Docs_Introduction_small.png


[11-Jan-20 09:45 AM] jl777c#5810
above page is very out of date. there is a lot of different DTO that can be launched now


[11-Jan-20 09:47 AM] jl777c#5810
https://github.com/dimxy/komodo/wiki/%27Prices%27-module-configuration-notes

{Embed}
https://github.com/dimxy/komodo/wiki/%27Prices%27-module-configuration-notes
dimxy/komodo
Komodo. Contribute to dimxy/komodo development by creating an account on GitHub.
https://images-ext-2.discordapp.net/external/FG7_8N0jtCftKtsAk7K5U05eeO1dpQWPnEQ9A5NQLBI/%3Fs%3D400%26v%3D4/https/avatars0.githubusercontent.com/u/21120539


[11-Jan-20 09:48 AM] gcharang#6833
thanks! will update


[15-Jan-20 06:49 AM] sergipcm#2275
hey out of curiosity @gcharang do you know how to retrieve stored prices on a chain via -ac_feed ?


[15-Jan-20 07:05 AM] jl777c#5810
there is an rpc for this, dont remember the details


[15-Jan-20 07:11 AM] TonyL#3577
If I remember correct it's a `prices` RPC call


[15-Jan-20 07:11 AM] TonyL#3577
https://github.com/tonymorony/komodo-cctools-python/blob/master/lib/visualization_lib.py#L8

{Embed}
https://github.com/tonymorony/komodo-cctools-python/blob/master/lib/visualization_lib.py
tonymorony/komodo-cctools-python
Python libs and interfaces for Komodo cryptoconditions consensus modules - tonymorony/komodo-cctools-python
https://images-ext-1.discordapp.net/external/Holp9AfaeFvGp5-FK21tFWPUG6Vhnnx7aN2SJk6LnTA/https/repository-images.githubusercontent.com/151382224/5007df00-6c99-11e9-8f36-dfd6d7e8d715


[15-Jan-20 07:12 AM] TonyL#3577
at least that's what I used in my interface code üòÖ


[15-Jan-20 07:14 AM] sergipcm#2275
ok so I guess they can be fetched by ts


[15-Jan-20 07:14 AM] sergipcm#2275
or hopefully by closest matching block timestamp


[15-Jan-20 07:14 AM] sergipcm#2275
that would be helpfull


[15-Jan-20 07:15 AM] TonyL#3577
there are timestamps in response, sure


[15-Jan-20 07:16 AM] sergipcm#2275
hopefully we can have the RPC call documented soon


[15-Jan-20 07:17 AM] jl777c#5810
@gcharang this isnt documented?


[15-Jan-20 07:17 AM] sergipcm#2275
maybe I missed it but so far havent been able to find it


[15-Jan-20 07:19 AM] TonyL#3577
https://docs.google.com/document/d/1O5hJ_ZeBWK-xP3f3RM48ruG3mOlsPbbLcXjyqtn0Oew/edit

{Embed}
https://docs.google.com/document/d/1O5hJ_ZeBWK-xP3f3RM48ruG3mOlsPbbLcXjyqtn0Oew/edit
PricesCC doc
PricesCC - betting "game" based on ‚Äúsynthetic prices‚Äù, though most would call this margin trading  Users can open long and short leveraged positions against the house (CC module) for various assets. The prices of assets are recorded on the blockchain by a trustless oracle...
https://images-ext-2.discordapp.net/external/wDPhk8tB2gI_R73yZWnP8nK7P0cIFcrrnRO4c6eiMrI/https/lh6.googleusercontent.com/x1zsIJElF2pmbaAQMoyo8issOldm6tXFWttEzjiEaH1doGAGg5tjAILPM-76LTvAnikq6g%3Dw1200-h630-p


[15-Jan-20 07:20 AM] TonyL#3577
I can remember we've started to write some doc for a kmdlabs testers and then pricesCC testing stopped


[15-Jan-20 07:22 AM] sergipcm#2275
thats nice doc thanks Tony, would keep it to check it later. Guess its easier to understand how rpc call works here

{Reactions}
üëç 

[15-Jan-20 09:21 PM] gcharang#6833
@jl777c am still working on it
will have it ready by tomorrow


[20-Jan-20 03:21 AM] gcharang#6833
@dimxy from  <https://github.com/dimxy/komodo/wiki/%27Prices%27-module-configuration-notes>
> The Prices module also allows to add a custom shared object library that could retrieve values if the internal parser features are not sufficient. The library should implement a specific parsing function that will be provided with the returned json and configuration parameters for data retrieving and should return the value.

can you confirm what I have written below is an accurate description?
```
The Prices module allows the addition of a custom shared object library (a `.so` file) that has the necessary parsing function that can retrieve values from the json returned by a web api. This can be used if the the json returned is non-standard and the internal parser's features are not sufficient. The parsing function will take the json and some configuration options like `customdata` as arguments and returns the price
```

{Reactions}
üëç 

[20-Jan-20 03:23 AM] dimxy#2587
'is non-standard' may be?

{Reactions}
üëç 

[20-Jan-20 03:26 AM] gcharang#6833
ty! can you tell me the branch and repo from which I can test the latest prices module? @dimxy


[20-Jan-20 03:27 AM] dimxy#2587
it is in the jl777 FSM branch

{Reactions}
üëç 

[20-Jan-20 06:18 AM] gcharang#6833
> To make the Prices module work there should be also -ac_cbopret, -ac_cclib=prices and -ac_cc=n (where n >=2) komodod parameters.
@dimxy is the parameter `-ac_cclib=prices` still required to launch a prices chain ?


[20-Jan-20 06:31 AM] dimxy#2587
I dont know much about about this param -ac_cclib I thought it is needed to run cc as .so libs.
Prices cc module is built within komodod executable, so seems -ac_cclib is not needed
I tried to run a prices chain without it and no any errors occurred.


[20-Jan-20 06:33 AM] gcharang#6833
hmm, got it
the -ac_cclib param is used to indicate a so file that contains an entire Antara module (dynamic module)


[20-Jan-20 06:36 AM] dimxy#2587
I can see there is yet another prices.c in cc/games subdir


[20-Jan-20 06:36 AM] dimxy#2587
seems ac_cclib=prices is to load it


[20-Jan-20 06:38 AM] dimxy#2587
that prices.c is not related to the prices cc module which works with prices DTO data (obtained by ac_cbopret)


[20-Jan-20 06:47 AM] gcharang#6833
understood. fyi, this is the method to load a dynamic module (sudoku):
```
cd src/cc
./makecclib
cp sudokucc.so ../libcc.so
cd ../..
make -j$(nproc)
```
after doing that, the chain needs to be started with `-ac_cclib=sudoku`
anyway, this detail is not relevant now as prices cc is builtin

{Reactions}
üëç 

[24-Mar-20 10:18 PM] Mylo#8306
The -ac_feeds parameter has interval with minimum 120s. Why so high?


[24-Mar-20 10:19 PM] jl777c#5810
all nodes need to query online api and some (many) rate limit

{Reactions}
üëç 

[24-Mar-20 10:22 PM] Mylo#8306
Ok thanks. I‚Äôm going to test with non-financial data. Will have more questions relating to DTO.

40% of the way down this page, cumulative time waited average price.  https://uniswap.org/blog/uniswap-v2/

Does kmd dto do any of this stuff?


[24-Mar-20 10:23 PM] Mylo#8306
Sorry on iPad, cannot disable embed atm


[24-Mar-20 10:24 PM] jl777c#5810
there isnt a weight to each DTO data, it is in consensus or it isnt. a binary state


[24-Mar-20 10:24 PM] jl777c#5810
you can construct whatever time series you want from the raw consensus data


[24-Mar-20 10:25 PM] Mylo#8306
Ok understand.


[24-Mar-20 10:25 PM] Mylo#8306
Thx


[23-Aug-20 09:32 AM] Ism#3433
hi al


==============================================================
Exported 2,314 message(s)
==============================================================
